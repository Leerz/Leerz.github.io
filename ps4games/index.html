<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PremazingPH Games</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
    }
    iframe {
      width: 100vw; height: 100vh;
      border: none;
      display: block;
    }
  </style>
</head>
<body>
  <iframe id="viewer"></iframe>
  <script>
    const base64html = `PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLGluaXRpYWwtc2NhbGU9MSIgLz4KPHRpdGxlIGlkPSJwYWdlVGl0bGUiPkdhbWUgU2VsZWN0b3I8L3RpdGxlPgo8c3R5bGU+Cjpyb290ey0tYmc6I2Y0ZjZmODstLXBhbmVsOiNmZmY7LS1tdXRlZDojNmI3MjgwOy0tcHJpbWFyeTojMDM2NmQ2Oy0tYWNjZW50OiNmZjhhMDA7LS1kYW5nZXI6I2VmNDQ0NDstLXJhZGl1czoxMHB4fQoqe2JveC1zaXppbmc6Ym9yZGVyLWJveH0KaHRtbCxib2R5e2hlaWdodDoxMDAlO21hcmdpbjowO2ZvbnQtZmFtaWx5OkludGVyLFNlZ29lIFVJLEFyaWFsLHNhbnMtc2VyaWY7YmFja2dyb3VuZDp2YXIoLS1iZyk7Y29sb3I6IzExMX0KLmhlYWRlcntwb3NpdGlvbjpmaXhlZDt0b3A6MDtyaWdodDowO2xlZnQ6MDtoZWlnaHQ6NzZweDtiYWNrZ3JvdW5kOnZhcigtLXBhbmVsKTtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDoxMnB4O3BhZGRpbmc6MTBweCAxNHB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNlNmVlZjY7ei1pbmRleDo2MH0KLmhlYWRlciAuc2VhcmNoe2ZsZXg6MTttaW4td2lkdGg6MTYwcHh9Ci5oZWFkZXIgaW5wdXQuc2VhcmNoLCAuaGVhZGVyIGJ1dHRvbntoZWlnaHQ6NDRweDtib3JkZXItcmFkaXVzOjEwcHg7Ym9yZGVyOjFweCBzb2xpZCAjZTZlZWY2O3BhZGRpbmc6MCAxMnB4fQouaGVhZGVyIC5hY3Rpb25ze2Rpc3BsYXk6ZmxleDtnYXA6OHB4O2FsaWduLWl0ZW1zOmNlbnRlcn0KLmhlYWRlciAudXBsb2Fke2JhY2tncm91bmQ6dmFyKC0tYWNjZW50KTtjb2xvcjojZmZmO2JvcmRlcjpub25lO3BhZGRpbmc6MTBweCAxNnB4O2JvcmRlci1yYWRpdXM6MTBweDtmb250LXdlaWdodDo2MDB9Ci5jb250YWluZXJ7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczoxZnIgMzgwcHg7Z2FwOjEycHg7cGFkZGluZzpjYWxjKDc2cHggKyAxMnB4KSAxMnB4IDE2cHg7aGVpZ2h0OmNhbGMoMTAwdmgpfQoubGVmdFBhbmV7YmFja2dyb3VuZDp2YXIoLS1wYW5lbCk7Ym9yZGVyLXJhZGl1czoxMnB4O3BhZGRpbmc6MTJweDtvdmVyZmxvdzphdXRvO2JveC1zaGFkb3c6MCA2cHggMThweCByZ2JhKDEyLDE4LDMwLDAuMDQpfQoucmlnaHRQYW5le2JhY2tncm91bmQ6dmFyKC0tcGFuZWwpO2JvcmRlci1yYWRpdXM6MTJweDtwYWRkaW5nOjEycHg7b3ZlcmZsb3c6aGlkZGVuO2JveC1zaGFkb3c6MCA2cHggMThweCByZ2JhKDEyLDE4LDMwLDAuMDQpO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW59Ci5pdGVte2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpjZW50ZXI7cGFkZGluZzoxMHB4O2JvcmRlci1yYWRpdXM6OHB4O2JvcmRlcjoxcHggc29saWQgdHJhbnNwYXJlbnQ7Y3Vyc29yOnBvaW50ZXI7bWFyZ2luLWJvdHRvbTo4cHh9Ci5pdGVtOmhvdmVye2JhY2tncm91bmQ6I2ZiZmRmZn0KLml0ZW0uc2VsZWN0ZWR7YmFja2dyb3VuZDojMGIzYjY2O2NvbG9yOiNmZmZ9Ci5tZXRhe2ZvbnQtc2l6ZToxMnB4O2NvbG9yOnZhcigtLW11dGVkKX0KLmNvbnRyb2xze2Rpc3BsYXk6Z3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6MWZyIDFmcjtnYXA6OHB4O21hcmdpbi1ib3R0b206OHB4fQouY29udHJvbHMgLmZ1bGx7Z3JpZC1jb2x1bW46MSAvIC0xfQouZmlsZW5hbWUtcHJldmlld3tncmlkLWNvbHVtbjoxIC8gLTE7cGFkZGluZzo4cHg7YmFja2dyb3VuZDojZjlmYWZiO2JvcmRlcjoxcHggc29saWQgI2U1ZTdlYjtib3JkZXItcmFkaXVzOjhweDtmb250LWZhbWlseTptb25vc3BhY2U7b3ZlcmZsb3cteDphdXRvO3doaXRlLXNwYWNlOm5vd3JhcH0KLmluZm9Sb3d7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcjtwYWRkaW5nOjEwcHg7Ym9yZGVyLXJhZGl1czo4cHg7YmFja2dyb3VuZDojZmZmO21hcmdpbi10b3A6OHB4O2JvcmRlcjoxcHggc29saWQgI2YxZjVmOX0KLmJ0bntwYWRkaW5nOjhweCAxMnB4O2JvcmRlci1yYWRpdXM6OHB4O2JvcmRlcjpub25lO2JhY2tncm91bmQ6dmFyKC0tcHJpbWFyeSk7Y29sb3I6I2ZmZjtjdXJzb3I6cG9pbnRlcn0KLmJ0bi5naG9zdHtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O2NvbG9yOnZhcigtLXByaW1hcnkpO2JvcmRlcjoxcHggc29saWQgI2U2ZWVmNn0KLnNtYWxse2ZvbnQtc2l6ZToxM3B4O2NvbG9yOnZhcigtLW11dGVkKX0KLm92ZXJsYXl7cG9zaXRpb246Zml4ZWQ7aW5zZXQ6MDtiYWNrZ3JvdW5kOnJnYmEoMjE1LDI0MCwyNTAsLjk1KTtkaXNwbGF5Om5vbmU7ZmxleC1kaXJlY3Rpb246Y29sdW1uO3otaW5kZXg6MTUwfQoub3ZlcmxheSAuaGVhZHtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47cGFkZGluZzoxMnB4O2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjU1KTthbGlnbi1pdGVtczpjZW50ZXJ9Ci5vdmVybGF5IC5ib2R5e3BhZGRpbmc6MTJweDtvdmVyZmxvdzphdXRvO2ZsZXg6MX0KLm92ZXJsYXkgLnJvd3tkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO3BhZGRpbmc6OHB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4wNil9Ci5vdmVybGF5IC5yb3cuaGlnaGxpZ2h0IHtiYWNrZ3JvdW5kOiAjZmZmM2NkO3RyYW5zaXRpb246IGJhY2tncm91bmQgMC42cyBlYXNlO30KI2ZpbGVzTW9kYWw6OmJhY2tkcm9wIHtiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMyk7fQojdG90YWxzLmV4Y2VlZGVkIHtjb2xvcjogI2MwMDtmb250LXdlaWdodDogYm9sZDt9Ci5idG4uZGFuZ2VyIHtiYWNrZ3JvdW5kOiAjYzAwO2NvbG9yOiAjZmZmO30KLm92ZXJsYXkgYnV0dG9uLmljb257cGFkZGluZzo2cHggOHB4O2JvcmRlci1yYWRpdXM6NnB4O2JvcmRlcjpub25lO2N1cnNvcjpwb2ludGVyO21hcmdpbi1sZWZ0OjZweH0KLm92ZXJsYXkgYnV0dG9uLnVwLCAub3ZlcmxheSBidXR0b24uZG93bntiYWNrZ3JvdW5kOiNmZmY7Y29sb3I6IzExMX0KLm92ZXJsYXkgYnV0dG9uLnJlbW92ZXtiYWNrZ3JvdW5kOnZhcigtLWRhbmdlcik7Y29sb3I6I2ZmZn0KLmZvb3RlckNvbnRyb2xze2Rpc3BsYXk6ZmxleDtnYXA6OHB4O2ZsZXgtd3JhcDp3cmFwO2FsaWduLWl0ZW1zOmNlbnRlcn0KQG1lZGlhIChtYXgtd2lkdGg6OTAwcHgpewogIC5jb250YWluZXJ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjFmcjsgcGFkZGluZy10b3A6Y2FsYyg3NnB4ICsgOHB4KX0KICAucmlnaHRQYW5le29yZGVyOi0xfQogIC5oZWFkZXJ7cGFkZGluZzo4cHh9Cn0KLnNlbGVjdGVkLXBhbmVsIHttYXJnaW4tdG9wOiAxMnB4O2JhY2tncm91bmQ6IHZhcigtLXBhbmVsKTtib3JkZXI6IDFweCBzb2xpZCAjZTZlZWY2O2JvcmRlci1yYWRpdXM6IDEwcHg7Ym94LXNoYWRvdzogMCA0cHggMTJweCByZ2JhKDAsMCwwLDAuMDUpO2Rpc3BsYXk6IGZsZXg7ZmxleC1kaXJlY3Rpb246IGNvbHVtbjtoZWlnaHQ6IDEwMCU7b3ZlcmZsb3c6IGhpZGRlbjt9Ci5zZWxlY3RlZC1wYW5lbCAuaGVhZCB7YmFja2dyb3VuZDogI2Y4ZmFmYztwYWRkaW5nOiA4cHggMTJweDtib3JkZXItYm90dG9tOiAxcHggc29saWQgI2U2ZWVmNjtmb250LXdlaWdodDogNjAwO2ZvbnQtc2l6ZTogMTRweDt9Ci5zZWxlY3RlZC1wYW5lbCAuYm9keSB7ZmxleDogMTtvdmVyZmxvdy15OiBhdXRvO2ZvbnQtc2l6ZTogMTNweDtwYWRkaW5nOiA4cHggMTJweDt9CkBtZWRpYSAobWF4LXdpZHRoOiA5MDBweCkgey5zZWxlY3RlZC1wYW5lbCB7ZGlzcGxheTogbm9uZSAhaW1wb3J0YW50O319Ci5jb25maWctc2VjdGlvbiB7dHJhbnNpdGlvbjogYWxsIDAuMjVzIGVhc2U7fQoubW9iaWxlLW9ubHkge2Rpc3BsYXk6IG5vbmU7fQpAbWVkaWEgKG1heC13aWR0aDogOTAwcHgpIHsKICAubW9iaWxlLW9ubHkge2Rpc3BsYXk6IGJsb2NrO30KICAuY29uZmlnLXNlY3Rpb24ge2Rpc3BsYXk6IG5vbmU7fQogIC5jb25maWctc2VjdGlvbi5hY3RpdmUge2Rpc3BsYXk6IGJsb2NrO30KfQo8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogIDxkaXYgY2xhc3M9ImhlYWRlciI+Cgk8aW5wdXQgaWQ9InNlYXJjaCIgY2xhc3M9InNlYXJjaCIgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9IlNlYXJjaCBnYW1lcy4uLiI+CgkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CiAgICAgIDxidXR0b24gaWQ9InVwbG9hZEJ0biIgY2xhc3M9ImJ0biBnaG9zdCI+VXBsb2FkPC9idXR0b24+CiAgICAgIDxidXR0b24gaWQ9InNob3dTZWxlY3RlZCIgY2xhc3M9ImJ0biBnaG9zdCI+U2hvdzwvYnV0dG9uPgoJICA8YnV0dG9uIGlkPSJzb3J0TGF0ZXN0IiBjbGFzcz0iYnRuIGdob3N0Ij5Tb3J0PC9idXR0b24+CiAgICAgIDxidXR0b24gaWQ9ImNsZWFyU2VhcmNoIiBjbGFzcz0iYnRuIGdob3N0Ij5+PC9idXR0b24+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCiAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgIDxzZWN0aW9uIGNsYXNzPSJsZWZ0UGFuZSIgaWQ9ImxlZnRQYW5lIiBhcmlhLWxhYmVsPSJHYW1lIGxpc3QiPjwvc2VjdGlvbj4KCiAgICA8YXNpZGUgY2xhc3M9InJpZ2h0UGFuZSI+CjxidXR0b24gaWQ9InRvZ2dsZUNvbmZpZyIgY2xhc3M9ImJ0biBnaG9zdCBtb2JpbGUtb25seSIgc3R5bGU9Im1hcmdpbi1ib3R0b206OHB4OyI+SGlkZSBDb25maWd1cmF0aW9uPC9idXR0b24+Cgo8ZGl2IGlkPSJjb25maWdTZWN0aW9uIiBjbGFzcz0iY29uZmlnLXNlY3Rpb24iPgogICAgICA8ZGl2IGNsYXNzPSJjb250cm9scyI+CiAgICAgICAgPGlucHV0IGlkPSJjdXN0b21lciIgY2xhc3M9ImZ1bGwiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJDdXN0b21lciBuYW1lICh1c2UgdW5kZXJzY29yZXMpIj4KICAgICAgICA8ZGl2IGNsYXNzPSJmaWxlbmFtZS1wcmV2aWV3IiBpZD0iZmlsZW5hbWVQcmV2aWV3Ij5GaWxlbmFtZSBwcmV2aWV3IHdpbGwgYXBwZWFyIGhlcmXigKY8L2Rpdj4KCQk8ZGl2IGlkPSJkeW5hbWljQ29udHJvbHMiPjwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9ImluZm9Sb3ciIHN0eWxlPSJtYXJnaW4tdG9wOjhweDsiPgogICAgICAgIDxkaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJzbWFsbCI+U3BhY2UgZm9yIGdhbWVzPC9kaXY+CiAgICAgICAgICA8ZGl2PjxzdHJvbmcgaWQ9InNwYWNlIj4wPC9zdHJvbmc+IEdCPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9InNtYWxsIj5TZWxlY3RlZCBzaXplPC9kaXY+CiAgICAgICAgICA8ZGl2PjxzdHJvbmcgaWQ9InNlbGVjdGVkU2l6ZSI+MC4wMDwvc3Ryb25nPiBHQjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9ImluZm9Sb3ciIHN0eWxlPSJtYXJnaW4tdG9wOjhweDsiPgogICAgICAgIDxkaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJzbWFsbCI+SW5zdGFsbCBlc3RpbWF0ZTwvZGl2PgogICAgICAgICAgPGRpdj48c3BhbiBpZD0iaW5zdGFsbEVzdGltYXRlIj4waCAwbTwvc3Bhbj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ic21hbGwiPlNlbGVjdGVkPC9kaXY+CiAgICAgICAgICA8ZGl2PjxzcGFuIGlkPSJjb3VudCI+MDwvc3Bhbj4gZ2FtZXM8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogIDwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjEycHg7ZGlzcGxheTpmbGV4O2dhcDo4cHg7YWxpZ24taXRlbXM6Y2VudGVyOyI+CgkJPGlucHV0IGlkPSJzaGFyZWFibGUiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJVcGxvYWRlZCBmaWxlIGxpbmsiIHN0eWxlPSJmbGV4OjE7cGFkZGluZzo4cHg7Ym9yZGVyLXJhZGl1czo4cHg7Ym9yZGVyOjFweCBzb2xpZCAjZTZlZWY2IiByZWFkb25seT4KCQk8YnV0dG9uIGlkPSJjb3B5TGluayIgY2xhc3M9ImJ0biI+Q29weSBMaXN0ICYgTGluazwvYnV0dG9uPgogICAgICAgIDxidXR0b24gaWQ9InNhdmVCdG4iIGNsYXNzPSJidG4iPlNhdmU8L2J1dHRvbj4KCQk8bGFiZWwgZm9yPSJmaWxlSW4iIHN0eWxlPSJiYWNrZ3JvdW5kOiMzYTZkZjA7Y29sb3I6I2ZmZjtwYWRkaW5nOjVweCA1cHg7Ym9yZGVyLXJhZGl1czozcHg7Zm9udC1zaXplOjEycHg7Y3Vyc29yOnBvaW50ZXI7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZjtkaXNwbGF5OmlubGluZS1ibG9jazsiPk9wZW48L2xhYmVsPgo8aW5wdXQgaWQ9ImZpbGVJbiIgdHlwZT0iZmlsZSIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6MTJweDtkaXNwbGF5OmZsZXg7Z2FwOjhweDthbGlnbi1pdGVtczpjZW50ZXI7ZmxleC13cmFwOndyYXAiPgogICAgICAgIDxidXR0b24gaWQ9ImFkbWluRXhwb3J0IiBjbGFzcz0iYnRuIGdob3N0Ij5FeHBvcnQgQWRtaW48L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGlkPSJtYXRjaExpc3QiIGNsYXNzPSJidG4gZ2hvc3QiPk1hdGNoIExpc3Q8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGlkPSJiaW5MaXN0IiBjbGFzcz0iYnRuIGdob3N0Ij5VcGxvYWRzPC9idXR0b24+CgkJPGRpdiBpZD0iZmlsZUxpc3RDb250YWluZXIiIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij4KCQkgIDxkaXYgaWQ9ImJpbkZpbGVMaXN0Ij48L2Rpdj4KCQk8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjEycHg7ZmxleDoxO292ZXJmbG93OmF1dG87Zm9udC1zaXplOjEzcHg7Y29sb3I6dmFyKC0tbXV0ZWQpIj4KICAgICAgICA8ZGl2IGlkPSJzdGF0dXMiPlJlYWR5PC9kaXY+CiAgICAgIDwvZGl2Pgo8ZGl2IGlkPSJzZWxlY3RlZFBhbmVsIiBjbGFzcz0ic2VsZWN0ZWQtcGFuZWwiPgogIDxkaXYgY2xhc3M9ImJvZHkiIGlkPSJzZWxlY3RlZFBhbmVsQm9keSI+PC9kaXY+CjwvZGl2PgogICAgPC9hc2lkZT4KICA8L2Rpdj4KCiAgPGRpdiBjbGFzcz0ib3ZlcmxheSIgaWQ9Im92ZXJsYXkiPgogICAgPGRpdiBjbGFzcz0iaGVhZCI+PGRpdj48c3Ryb25nPlNlbGVjdGVkIFRpdGxlczwvc3Ryb25nPiDigJMgPHNwYW4gaWQ9Im92ZXJsYXlDb3VudCI+MDwvc3Bhbj48L2Rpdj48ZGl2PjxidXR0b24gaWQ9ImNsb3NlT3ZlcmxheSIgY2xhc3M9ImJ0biBnaG9zdCI+Q2xvc2U8L2J1dHRvbj48L2Rpdj48L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImJvZHkiIGlkPSJvdmVybGF5Qm9keSI+PC9kaXY+CiAgPC9kaXY+CjxkaXYgaWQ9ImZpbGVzTW9kYWwiIHN0eWxlPSJkaXNwbGF5Om5vbmU7cG9zaXRpb246Zml4ZWQ7dG9wOjUwJTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlKC01MCUsLTUwJSk7CiAgYmFja2dyb3VuZDojZmZmO3BhZGRpbmc6MTZweDtib3JkZXItcmFkaXVzOjEwcHg7Ym94LXNoYWRvdzowIDZweCAxOHB4IHJnYmEoMCwwLDAsMC4yNSk7ei1pbmRleDoyMDA7CiAgbWF4LXdpZHRoOjQyMHB4O3dpZHRoOjkwJTttYXgtaGVpZ2h0Ojcwdmg7b3ZlcmZsb3c6YXV0bztmb250LXNpemU6MTNweCI+CjwvZGl2Pgo8c2NyaXB0PgovLyA9PT09PT09PT09PT09PT09PT09PSBDT05GSUdVUkFUSU9OIEJMT0NLID09PT09PT09PT09PT09PT09PT09CmNvbnN0IENPTkZJRyA9IHsKICB4bWxGaWxlOiAncHJtem5nX3BzNFBLR19kYi54bWwnLCAgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBwbGF0Zm9ybSBYTUwKICBjbGllbnRGaWxlRXh0OiAnLkNMSV9QUk1aNCcsCiAgYWRtaW5GaWxlRXh0OiAnLlBSTVo0JywKICBmaWxlYmluQnVja2V0OiAnb2QxYmVsOHo2enBndDVldicsCiAgCiAgLy8gQXV0by1kZXRlY3RlZCBmcm9tIFhNTAogIHBsYXRmb3JtOiBudWxsLAogIHN0cnVjdHVyZVR5cGU6IG51bGwsICAvLyAnZm9sZGVycycgb3IgJ2ZpbGVzJwogIGFkbWluQmFzZVBhdGg6ICdROlxcXFBTNF9QS0dcXCcsCiAgCiAgc3RvcmFnZUNvbnRyb2xzOiBbCiAgICB7CiAgICAgIGlkOiAnY29uc29sZScsCiAgICAgIGxhYmVsOiAnQ29uc29sZScsCiAgICAgIHR5cGU6ICdzZWxlY3QnLAogICAgICBvcHRpb25zOiBbCiAgICAgICAgeyB2YWx1ZTogJ2ZhdCcsIGxhYmVsOiAnZmF0JyB9LAogICAgICAgIHsgdmFsdWU6ICdzbGltJywgbGFiZWw6ICdzbGltJyB9LAogICAgICAgIHsgdmFsdWU6ICdwcm8nLCBsYWJlbDogJ3BybycgfQogICAgICBdLAogICAgICBkZWZhdWx0OiAnZmF0JywKICAgICAgZmlsZW5hbWVUb2tlbjogdHJ1ZQogICAgfSwKICAgIHsKICAgICAgaWQ6ICdoZGQnLAogICAgICBsYWJlbDogJ0hERCAoR0IpJywKICAgICAgdHlwZTogJ3NlbGVjdCcsCiAgICAgIG9wdGlvbnM6IFsKICAgICAgICB7IHZhbHVlOiAnNTAwJywgbGFiZWw6ICc1MDAnIH0sCiAgICAgICAgeyB2YWx1ZTogJzEwMDAnLCBsYWJlbDogJzEwMDAnIH0sCiAgICAgICAgeyB2YWx1ZTogJzIwMDAnLCBsYWJlbDogJzIwMDAnIH0sCiAgICAgICAgeyB2YWx1ZTogJzMwMDAnLCBsYWJlbDogJzMwMDAnIH0sCiAgICAgICAgeyB2YWx1ZTogJzQwMDAnLCBsYWJlbDogJzQwMDAnIH0sCiAgICAgICAgeyB2YWx1ZTogJzUwMDAnLCBsYWJlbDogJzUwMDAnIH0KICAgICAgXSwKICAgICAgZGVmYXVsdDogJzUwMCcsCiAgICAgIGZpbGVuYW1lVG9rZW46ICdoZGQnLAogICAgICBzdG9yYWdlQ2FsYzogdHJ1ZQogICAgfSwKICBdLAogIAogIGNhbGN1bGF0ZVN0b3JhZ2U6IGZ1bmN0aW9uKHZhbHVlcykgewogICAgY29uc3QgY29uc29sZVZhbCA9IHZhbHVlcy5jb25zb2xlIHx8ICdmYXQnOwogICAgY29uc3QgaGRkVmFsID0gTnVtYmVyKHZhbHVlcy5oZGQgfHwgNTAwKTsKICAgIGNvbnN0IGJ1ZmZhID0gTWF0aC5mbG9vcihoZGRWYWwgLSAoaGRkVmFsICouMTgpICk7CiAgICBjb25zdCB0b3RhbFJlc2VydmVkID0gaGRkVmFsIC0gYnVmZmE7CiAgICByZXR1cm4gKGhkZFZhbCAtIHRvdGFsUmVzZXJ2ZWQpOwogIH0KfTsKLy8gPT09PT09PT09PT09PT09PT09PT0gRU5EIENPTkZJR1VSQVRJT04gPT09PT09PT09PT09PT09PT09PT0KCmNvbnN0IHN0YXRlID0geyBpdGVtczogW10sIHNlbGVjdGVkOiBbXSwgeG1sOiBudWxsLCBsYXN0VXBsb2FkOjAgfTsKY29uc3QgbGVmdFBhbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVmdFBhbmUnKTsKY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdmVybGF5Jyk7CmNvbnN0IG92ZXJsYXlCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ292ZXJsYXlCb2R5Jyk7CmNvbnN0IGlzTW9iaWxlID0gL01vYml8QW5kcm9pZHxpUGhvbmV8aVBhZHxpUG9kL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTsKY29uc3QgaXNMb2NhbCA9IGZhbHNlOwoKY29uc3QgTUlOX0RFTEFZID0gMTAwMDsKbGV0IG5vdyA9IERhdGUubm93KCk7CmxldCBsYXN0RXhwb3J0VGltZSA9IERhdGUubm93KCk7Cgpjb25zdCAkID0gaWQ9PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKZnVuY3Rpb24gZXNjKHMpeyByZXR1cm4gKHN8fCcnKS5yZXBsYWNlKC8mL2csJyZhbXA7JykucmVwbGFjZSgvPC9nLCcmbHQ7JykucmVwbGFjZSgvPi9nLCcmZ3Q7JykucmVwbGFjZSgvJy9nLCcmIzM5OycpLnJlcGxhY2UoLyIvZywnJnF1b3Q7Jyk7IH0KZnVuY3Rpb24gdG9hc3QobXNnKXsgJCgnc3RhdHVzJykudGV4dENvbnRlbnQgPSBtc2c7IHNldFRpbWVvdXQoKCk9PnsgaWYoJCgnc3RhdHVzJykudGV4dENvbnRlbnQgPT09IG1zZykgJCgnc3RhdHVzJykudGV4dENvbnRlbnQgPSAnUmVhZHknOyB9LCAyNTAwKTsgfQoKZnVuY3Rpb24gcGFyc2VTaXplVGV4dChzKXsgaWYoIXMpIHJldHVybiAwOyBjb25zdCBtID0gKCcnK3MpLm1hdGNoKC8oW1xkXC5dKylccyooR2lCfE1pQnxLaUJ8R0J8TUJ8S0J8QikvaSk7IGlmKCFtKSByZXR1cm4gMDsgY29uc3Qgdj1wYXJzZUZsb2F0KG1bMV0pOyBjb25zdCB1PW1bMl0udG9VcHBlckNhc2UoKTsgaWYodT09PSdCJykgcmV0dXJuIHY7IGlmKHU9PT0nS0InfHx1PT09J0tJQicpIHJldHVybiB2KjEwMjQ7IGlmKHU9PT0nTUInfHx1PT09J01JQicpIHJldHVybiB2KjEwMjQqMTAyNDsgcmV0dXJuIHYqMTAyNCoxMDI0KjEwMjQ7IH0KZnVuY3Rpb24gYnl0ZXNUb0dCKGIpeyByZXR1cm4gYi8oMTAyNCoxMDI0KjEwMjQpOyB9CgpmdW5jdGlvbiBidWlsZER5bmFtaWNDb250cm9scygpIHsKICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHluYW1pY0NvbnRyb2xzJyk7CiAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnOwogIGNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2dyaWQnOwogIGNvbnRhaW5lci5zdHlsZS5ncmlkVGVtcGxhdGVDb2x1bW5zID0gJzFmciAxZnInOwogIGNvbnRhaW5lci5zdHlsZS5nYXAgPSAnOHB4JzsKICAKICBDT05GSUcuc3RvcmFnZUNvbnRyb2xzLmZvckVhY2goY3RybCA9PiB7CiAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTsKICAgIGxhYmVsLmNsYXNzTmFtZSA9ICdzbWFsbCc7CiAgICBsYWJlbC50ZXh0Q29udGVudCA9IGN0cmwubGFiZWw7CiAgICBkaXYuYXBwZW5kQ2hpbGQobGFiZWwpOwogICAgaWYgKGN0cmwudHlwZSA9PT0gJ3NlbGVjdCcpIHsKICAgICAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VsZWN0Jyk7CiAgICAgIHNlbGVjdC5pZCA9IGN0cmwuaWQ7CiAgICAgIHNlbGVjdC5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBjdHJsLmxhYmVsKTsKICAgICAgY3RybC5vcHRpb25zLmZvckVhY2gob3B0ID0+IHsKICAgICAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsKICAgICAgICBvcHRpb24udmFsdWUgPSBvcHQudmFsdWU7CiAgICAgICAgb3B0aW9uLnRleHRDb250ZW50ID0gb3B0LmxhYmVsOwogICAgICAgIGlmIChvcHQudmFsdWUgPT09IGN0cmwuZGVmYXVsdCkgb3B0aW9uLnNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICBzZWxlY3QuYXBwZW5kQ2hpbGQob3B0aW9uKTsKICAgICAgfSk7CiAgICAgIGRpdi5hcHBlbmRDaGlsZChzZWxlY3QpOwogICAgICBzZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiB1cGRhdGVGaWxlbmFtZVByZXZpZXcoKSk7CiAgICAgIHNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB1cGRhdGVUb3RhbHMoKSk7CiAgICB9CiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGl2KTsKICB9KTsKfQoKYXN5bmMgZnVuY3Rpb24gbG9hZFhNTCgpewogIHRyeXsKICAgIGNvbnN0IHR4dCA9IGF3YWl0IGZldGNoKENPTkZJRy54bWxGaWxlKS50aGVuKHI9PnIudGV4dCgpKTsKICAgIGNvbnN0IHhtbCA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcodHh0LCdhcHBsaWNhdGlvbi94bWwnKTsKICAgIHN0YXRlLnhtbCA9IHhtbDsKICAgIAogICAgY29uc3Qgcm9vdCA9IHhtbC5kb2N1bWVudEVsZW1lbnQ7CiAgICBDT05GSUcucGxhdGZvcm0gPSByb290LmdldEF0dHJpYnV0ZSgncGxhdGZvcm0nKSB8fCAnVW5rbm93bic7CiAgICBDT05GSUcuc3RydWN0dXJlVHlwZSA9IHJvb3QuZ2V0QXR0cmlidXRlKCdzdHJ1Y3R1cmVUeXBlJykgfHwgJ2ZvbGRlcnMnOwogICAgCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFnZVRpdGxlJykudGV4dENvbnRlbnQgPSBgJHtDT05GSUcucGxhdGZvcm19IEdhbWVzYDsKICAgIAogICAgbGV0IGl0ZW1zID0gW107CiAgICAKICAgIGlmIChDT05GSUcuc3RydWN0dXJlVHlwZSA9PT0gJ2ZvbGRlcnMnKSB7CiAgICAgIGl0ZW1zID0gQXJyYXkuZnJvbSh4bWwucXVlcnlTZWxlY3RvckFsbCgnZm9sZGVyJykpCiAgICAgICAgLm1hcChmID0+ICh7CiAgICAgICAgICBuYW1lOiBmLmdldEF0dHJpYnV0ZSgnbmFtZScpLAogICAgICAgICAgc2NvcmU6IGYuZ2V0QXR0cmlidXRlKCdzY29yZScpIHx8ICcwJywKICAgICAgICAgIHNpemU6IGYuZ2V0QXR0cmlidXRlKCdzaXplJykgfHwgJzAgR2lCJywKICAgICAgICAgIGRhdGU6IGYuZ2V0QXR0cmlidXRlKCdkYXRlQ3JlYXRlZCcpIHx8ICcnLAogICAgICAgICAgZmlsZUNvdW50OiBmLmdldEF0dHJpYnV0ZSgnZmlsZUNvdW50JykgfHwgJzAnLAogICAgICAgICAgZmlsZXM6IEFycmF5LmZyb20oZi5xdWVyeVNlbGVjdG9yQWxsKCdmaWxlJykpLm1hcCh4ID0+IHguZ2V0QXR0cmlidXRlKCduYW1lJykpCiAgICAgICAgfSkpOwogICAgfSBlbHNlIHsKICAgICAgaXRlbXMgPSBBcnJheS5mcm9tKHhtbC5xdWVyeVNlbGVjdG9yQWxsKCdmaWxlJykpCiAgICAgICAgLm1hcChmID0+ICh7CiAgICAgICAgICBuYW1lOiBmLmdldEF0dHJpYnV0ZSgnbmFtZScpLAogICAgICAgICAgZmlsZW5hbWU6IGYuZ2V0QXR0cmlidXRlKCdmaWxlbmFtZScpIHx8IGYuZ2V0QXR0cmlidXRlKCduYW1lJyksCiAgICAgICAgICBzaXplOiBmLmdldEF0dHJpYnV0ZSgnc2l6ZScpIHx8ICcwIEdpQicsCiAgICAgICAgICBkYXRlOiBmLmdldEF0dHJpYnV0ZSgnZGF0ZUNyZWF0ZWQnKSB8fCAnJwogICAgICAgIH0pKTsKICAgIH0KICAgIAogICAgc3RhdGUuaXRlbXMgPSBpdGVtczsKICAgIHJlbmRlckxpc3QoaXRlbXMpOwogICAgdG9hc3QoYExvYWRlZCAke2l0ZW1zLmxlbmd0aH0gJHtDT05GSUcucGxhdGZvcm19IGdhbWVzYCk7CiAgfWNhdGNoKGUpeyAKICAgIGNvbnNvbGUuZXJyb3IoZSk7IAogICAgbGVmdFBhbmUuaW5uZXJIVE1MID0gYDxkaXYgc3R5bGU9ImNvbG9yOiNiOTFjMWM7cGFkZGluZzoxMnB4Ij5GYWlsZWQgdG8gbG9hZCAke0NPTkZJRy54bWxGaWxlfTwvZGl2PmA7IAogIH0KfQoKZnVuY3Rpb24gcmVuZGVyTGlzdChsaXN0KXsgCiAgbGVmdFBhbmUuaW5uZXJIVE1MID0gJyc7IAogIGlmKCFsaXN0fHwhbGlzdC5sZW5ndGgpeyAKICAgIGxlZnRQYW5lLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJtZXRhIj5ObyBpdGVtcyBmb3VuZDwvZGl2Pic7IAogICAgcmV0dXJuOyAKICB9CiAgCiAgbGlzdC5mb3JFYWNoKGl0ZW09PnsKICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOyAKICAgIHJvdy5jbGFzc05hbWU9J2l0ZW0nOyAKICAgIHJvdy5kYXRhc2V0Lm5hbWUgPSBpdGVtLm5hbWU7IAogICAgcm93LmRhdGFzZXQuc2l6ZSA9IGl0ZW0uc2l6ZTsKICAgIGlmIChpdGVtLmZpbGVuYW1lKSByb3cuZGF0YXNldC5maWxlbmFtZSA9IGl0ZW0uZmlsZW5hbWU7CiAgICAKICAgIGNvbnN0IG1ldGFJbmZvID0gaXRlbS5maWxlQ291bnQgPyBgRmlsZXM6ICR7aXRlbS5maWxlQ291bnR9YCA6ICcnOwogICAgY29uc3Qgc2NvcmVJbmZvID0gaXRlbS5zY29yZSA/IGBTY29yZTogJHtlc2MoaXRlbS5zY29yZSl9YCA6ICcnOwogICAgY29uc3QgZGF0ZUluZm8gPSBpdGVtLmRhdGUgPyBgTW9kaWZpZWQ6ICR7ZXNjKGl0ZW0uZGF0ZSl9YCA6ICcnOwogICAgY29uc3QgbWV0YVBhcnRzID0gW21ldGFJbmZvLCBzY29yZUluZm8sIGRhdGVJbmZvXS5maWx0ZXIoQm9vbGVhbikuam9pbignIDsgJyk7CiAgICAKICAgIGNvbnN0IGhhc0ZpbGVzID0gQ09ORklHLnN0cnVjdHVyZVR5cGUgPT09ICdmb2xkZXJzJyAmJiBpdGVtLmZpbGVzICYmIGl0ZW0uZmlsZXMubGVuZ3RoID4gMDsKICAgIAogICAgcm93LmlubmVySFRNTCA9IGAKICAgICAgPGRpdj4KICAgICAgICAke2hhc0ZpbGVzID8gYDxidXR0b24gY2xhc3M9ImJ0biBnaG9zdCBmaWxlLWJ0biIgc3R5bGU9InBhZGRpbmc6MnB4IDZweDtmb250LXNpemU6MTFweCI+PzwvYnV0dG9uPmAgOiAnJ30KICAgICAgICA8c3Ryb25nPiR7ZXNjKGl0ZW0ubmFtZSl9PC9zdHJvbmc+CiAgICAgICAgPGRpdiBjbGFzcz0nbWV0YSc+JHttZXRhUGFydHN9PC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSdtZXRhJz4ke2VzYyhpdGVtLnNpemUpfTwvZGl2PgogICAgYDsKCiAgICBpZihzdGF0ZS5zZWxlY3RlZC5zb21lKHM9PnMubmFtZT09PWl0ZW0ubmFtZSkpIHJvdy5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpOwogICAgCiAgICBpZiAoaGFzRmlsZXMpIHsKICAgICAgY29uc3QgZmlsZUJ0biA9IHJvdy5xdWVyeVNlbGVjdG9yKCcuZmlsZS1idG4nKTsKICAgICAgaWYgKGZpbGVCdG4pIHsKICAgICAgICBmaWxlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2KT0+ewogICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICBzaG93RmlsZXMoaXRlbS5uYW1lLCBpdGVtLmZpbGVzIHx8IFtdLCBpdGVtLnNpemUpOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJvdy5hZGRFdmVudExpc3RlbmVyKCdkYmxjbGljaycsICgpPT4gc2hvd0ZpbGVzKGl0ZW0ubmFtZSwgaXRlbS5maWxlc3x8W10sIGl0ZW0uc2l6ZSkpOwogICAgfQogICAgCiAgICByb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXYpPT57CiAgICAgIGlmKGV2LmFsdEtleSAmJiBoYXNGaWxlcyl7IAogICAgICAgIHNob3dGaWxlcyhpdGVtLm5hbWUsIGl0ZW0uZmlsZXMgfHwgW10sIGl0ZW0uc2l6ZSk7IAogICAgICAgIHJldHVybjsgCiAgICAgIH0gCiAgICAgIHRvZ2dsZVNlbGVjdChpdGVtLCByb3cpOyAKICAgIH0pOwogICAgCiAgICBsZWZ0UGFuZS5hcHBlbmRDaGlsZChyb3cpOwogIH0pOwp9CgpmdW5jdGlvbiB0b2dnbGVTZWxlY3QoaXRlbSwgcm93RWwpeyAKICBjb25zdCBpZHggPSBzdGF0ZS5zZWxlY3RlZC5maW5kSW5kZXgocz0+cy5uYW1lPT09aXRlbS5uYW1lKTsgCiAgaWYoaWR4Pj0wKXsgCiAgICBzdGF0ZS5zZWxlY3RlZC5zcGxpY2UoaWR4LDEpOyAKICAgIGlmKHJvd0VsKSByb3dFbC5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpOyAKICB9IGVsc2UgeyAKICAgIHN0YXRlLnNlbGVjdGVkLnB1c2goeyAKICAgICAgbmFtZTppdGVtLm5hbWUsIAogICAgICBmaWxlbmFtZTogaXRlbS5maWxlbmFtZSB8fCBpdGVtLm5hbWUsCiAgICAgIHNpemU6aXRlbS5zaXplIAogICAgfSk7IAogICAgaWYocm93RWwpIHJvd0VsLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7IAogIH0KICB1cGRhdGVUb3RhbHMoKTsgCiAgcmVuZGVyT3ZlcmxheSgpOyAKfQoKZnVuY3Rpb24gcmVuZGVyT3ZlcmxheSgpIHsKICBvdmVybGF5Qm9keS5pbm5lckhUTUwgPSAnJzsKICBzdGF0ZS5zZWxlY3RlZC5mb3JFYWNoKChzLGkpPT57CiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHJvdy5jbGFzc05hbWU9J3Jvdyc7CiAgICByb3cuaW5uZXJIVE1MID0gYAogICAgICA8ZGl2PgogICAgICAgIDxzdHJvbmc+JHtpKzF9LiAke2VzYyhzLm5hbWUpfTwvc3Ryb25nPgogICAgICAgIDxkaXYgY2xhc3M9J21ldGEnPiR7ZXNjKHMuc2l6ZSl9PC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2PgogICAgICAgIDxidXR0b24gY2xhc3M9J2ljb24gdXAnPnU8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSdpY29uIGRvd24nPmQ8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSdpY29uIHJlbW92ZSc+eDwvYnV0dG9uPgogICAgICA8L2Rpdj5gOwoKICAgIHJvdy5xdWVyeVNlbGVjdG9yKCcudXAnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT57CiAgICAgIGlmKGk+MCl7CiAgICAgICAgW3N0YXRlLnNlbGVjdGVkW2ktMV0sIHN0YXRlLnNlbGVjdGVkW2ldXSA9IFtzdGF0ZS5zZWxlY3RlZFtpXSwgc3RhdGUuc2VsZWN0ZWRbaS0xXV07CiAgICAgICAgcmVuZGVyT3ZlcmxheSgpOwogICAgICAgIHJlbmRlckxpc3Qoc3RhdGUuaXRlbXMpOwogICAgICAgIHVwZGF0ZVRvdGFscygpOwogICAgICAgIG92ZXJsYXlCb2R5LmNoaWxkcmVuW2ktMV0uY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0Jyk7CiAgICAgIH0KICAgIH0pOwoKICAgIHJvdy5xdWVyeVNlbGVjdG9yKCcuZG93bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PnsKICAgICAgaWYoaTxzdGF0ZS5zZWxlY3RlZC5sZW5ndGgtMSl7CiAgICAgICAgW3N0YXRlLnNlbGVjdGVkW2krMV0sIHN0YXRlLnNlbGVjdGVkW2ldXSA9IFtzdGF0ZS5zZWxlY3RlZFtpXSwgc3RhdGUuc2VsZWN0ZWRbaSsxXV07CiAgICAgICAgcmVuZGVyT3ZlcmxheSgpOwogICAgICAgIHJlbmRlckxpc3Qoc3RhdGUuaXRlbXMpOwogICAgICAgIHVwZGF0ZVRvdGFscygpOwogICAgICAgIG92ZXJsYXlCb2R5LmNoaWxkcmVuW2krMV0uY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0Jyk7CiAgICAgIH0KICAgIH0pOwoKICAgIHJvdy5xdWVyeVNlbGVjdG9yKCcucmVtb3ZlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+ewogICAgICBjb25zdCByZW1vdmVkID0gc3RhdGUuc2VsZWN0ZWQuc3BsaWNlKGksMSlbMF07CiAgICAgIGNvbnN0IGxlZnRSb3cgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pdGVtJykpCiAgICAgICAgLmZpbmQoeD0+eC5kYXRhc2V0Lm5hbWU9PT1yZW1vdmVkLm5hbWUpOwogICAgICBpZihsZWZ0Um93KSBsZWZ0Um93LmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7CiAgICAgIHJlbmRlck92ZXJsYXkoKTsKICAgICAgcmVuZGVyTGlzdChzdGF0ZS5pdGVtcyk7CiAgICAgIHVwZGF0ZVRvdGFscygpOwogICAgfSk7CgogICAgb3ZlcmxheUJvZHkuYXBwZW5kQ2hpbGQocm93KTsKICB9KTsKICAkKCdvdmVybGF5Q291bnQnKS50ZXh0Q29udGVudCA9IHN0YXRlLnNlbGVjdGVkLmxlbmd0aDsKICByZW5kZXJTZWxlY3RlZFBhbmVsKCk7Cn0KCiQoJ3Nob3dTZWxlY3RlZCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9Pnsgb3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOyByZW5kZXJPdmVybGF5KCk7IH0pOwokKCdjbG9zZU92ZXJsYXknKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT4gb3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnKTsKCmZ1bmN0aW9uIHNob3dGaWxlcyhuYW1lLCBmaWxlcywgc2l6ZSkgewogIGlmICghZmlsZXMgfHwgIWZpbGVzLmxlbmd0aCkgewogICAgYWxlcnQoYE5vIGZpbGVzIGZvciAke25hbWV9YCk7CiAgICByZXR1cm47CiAgfQoKICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlc01vZGFsJyk7CiAgbW9kYWwuaW5uZXJIVE1MID0gJyc7IAogIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogIAogIGNvbnN0IGhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIGhlYWRlci5pbm5lckhUTUwgPSBgPHN0cm9uZz4ke2VzYyhuYW1lKX08L3N0cm9uZz48YnI+PHNwYW4gY2xhc3M9Im1ldGEiPlNpemU6ICR7ZXNjKHNpemUpfSDigJMgJHtmaWxlcy5sZW5ndGh9IGZpbGVzPC9zcGFuPmA7CiAgbW9kYWwuYXBwZW5kQ2hpbGQoaGVhZGVyKTsKCiAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIGxpc3Quc3R5bGUubWFyZ2luVG9wID0gJzhweCc7CiAgbW9kYWwuYXBwZW5kQ2hpbGQobGlzdCk7CgogIGxldCBpbmRleCA9IDA7CiAgY29uc3QgYmF0Y2ggPSAyMDsKICBmdW5jdGlvbiBsb2FkTW9yZSgpIHsKICAgIGNvbnN0IG5leHQgPSBmaWxlcy5zbGljZShpbmRleCwgaW5kZXgrYmF0Y2gpOwogICAgbGlzdC5pbm5lckhUTUwgKz0gbmV4dC5tYXAoZj0+ZXNjKGYpKS5qb2luKCc8YnI+Jyk7CiAgICBpbmRleCArPSBiYXRjaDsKICAgIGlmIChpbmRleCA+PSBmaWxlcy5sZW5ndGgpIHsKICAgICAgbW9yZUJ0bi5yZW1vdmUoKTsKICAgIH0KICB9CgogIGNvbnN0IG1vcmVCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICBtb3JlQnRuLnRleHRDb250ZW50ID0gJ01vcmUnOwogIG1vcmVCdG4uY2xhc3NOYW1lID0gJ2J0biBnaG9zdCc7CiAgbW9yZUJ0bi5zdHlsZS5tYXJnaW5Ub3AgPSAnMTBweCc7CiAgbW9yZUJ0bi5vbmNsaWNrID0gbG9hZE1vcmU7CiAgbW9kYWwuYXBwZW5kQ2hpbGQobW9yZUJ0bik7CgogIGNvbnN0IGNsb3NlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgY2xvc2VCdG4udGV4dENvbnRlbnQgPSAnQ2xvc2UnOwogIGNsb3NlQnRuLmNsYXNzTmFtZSA9ICdidG4nOwogIGNsb3NlQnRuLnN0eWxlLm1hcmdpblRvcCA9ICcxMHB4JzsKICBjbG9zZUJ0bi5vbmNsaWNrID0gKCk9PnsgbW9kYWwuc3R5bGUuZGlzcGxheT0nbm9uZSc7IG1vZGFsLmlubmVySFRNTD0nJzsgfTsKICBtb2RhbC5hcHBlbmRDaGlsZChjbG9zZUJ0bik7CiAgbG9hZE1vcmUoKTsKfQoKZnVuY3Rpb24gZ2V0Q29udHJvbFZhbHVlcygpIHsKICBjb25zdCB2YWx1ZXMgPSB7fTsKICBDT05GSUcuc3RvcmFnZUNvbnRyb2xzLmZvckVhY2goY3RybCA9PiB7CiAgICBjb25zdCBlbCA9ICQoY3RybC5pZCk7CiAgICBpZiAoZWwpIHZhbHVlc1tjdHJsLmlkXSA9IGVsLnZhbHVlOwogIH0pOwogIHJldHVybiB2YWx1ZXM7Cn0KCmZ1bmN0aW9uIHVwZGF0ZVRvdGFscygpIHsKICBjb25zdCB0b3RhbEJ5dGVzID0gc3RhdGUuc2VsZWN0ZWQucmVkdWNlKChzdW0sIHMpID0+IHN1bSArIHBhcnNlU2l6ZVRleHQocy5zaXplKSwgMCk7CiAgY29uc3QgZ2IgPSBieXRlc1RvR0IodG90YWxCeXRlcyk7CiAgJCgnc2VsZWN0ZWRTaXplJykudGV4dENvbnRlbnQgPSBnYi50b0ZpeGVkKDIpOwoKICBjb25zdCBibG9hdGVkID0gdG90YWxCeXRlcyAqIDEuMjsKICBjb25zdCBzcGVlZCA9IDE0ICogMTAyNCAqIDEwMjQ7CiAgY29uc3Qgc2VjcyA9IE1hdGguY2VpbChibG9hdGVkIC8gc3BlZWQpOwogICQoJ2luc3RhbGxFc3RpbWF0ZScpLnRleHRDb250ZW50ID0gYCR7TWF0aC5mbG9vcihzZWNzLzM2MDApfWggJHtNYXRoLmZsb29yKChzZWNzJTM2MDApLzYwKX1tYDsKCiAgJCgnY291bnQnKS50ZXh0Q29udGVudCA9IHN0YXRlLnNlbGVjdGVkLmxlbmd0aDsKCiAgY29uc3QgdmFsdWVzID0gZ2V0Q29udHJvbFZhbHVlcygpOwogIGNvbnN0IHNwYWNlRm9yR2FtZXMgPSBDT05GSUcuY2FsY3VsYXRlU3RvcmFnZSh2YWx1ZXMpOwoKICAkKCdzcGFjZScpLnRleHRDb250ZW50ID0gaXNGaW5pdGUoc3BhY2VGb3JHYW1lcykgPyBzcGFjZUZvckdhbWVzIDogMDsKCiAgaWYgKGdiID4gc3BhY2VGb3JHYW1lcykgewogICAgJCgnc2VsZWN0ZWRTaXplJykuc3R5bGUuY29sb3IgPSAnI2MwMCc7CiAgICAkKCdzZWxlY3RlZFNpemUnKS5zdHlsZS5mb250V2VpZ2h0ID0gJ2JvbGQnOwogIH0gZWxzZSB7CiAgICAkKCdzZWxlY3RlZFNpemUnKS5zdHlsZS5jb2xvciA9ICcnOwogICAgJCgnc2VsZWN0ZWRTaXplJykuc3R5bGUuZm9udFdlaWdodCA9ICcnOwogIH0KCiAgdXBkYXRlRmlsZW5hbWVQcmV2aWV3KCk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZUZpbGVuYW1lUHJldmlldygpIHsKICBjb25zdCBjdXN0b21lciA9ICgkKCdjdXN0b21lcicpLnZhbHVlIHx8ICdjdXN0b21lcicpLnRyaW0oKS5yZXBsYWNlKC9bXmEtekEtWjAtOV0vZywnXycpLnRvTG93ZXJDYXNlKCk7CiAgY29uc3QgdmFsdWVzID0gZ2V0Q29udHJvbFZhbHVlcygpOwogIGNvbnN0IHRva2VucyA9IFtjdXN0b21lcl07CiAgCiAgQ09ORklHLnN0b3JhZ2VDb250cm9scy5mb3JFYWNoKGN0cmwgPT4gewogICAgaWYgKGN0cmwuZmlsZW5hbWVUb2tlbikgewogICAgICBjb25zdCB2YWwgPSB2YWx1ZXNbY3RybC5pZF0gfHwgY3RybC5kZWZhdWx0OwogICAgICBjb25zdCB0b2tlbiA9IGN0cmwuZmlsZW5hbWVUb2tlbiA9PT0gdHJ1ZSA/IHZhbCA6IChjdHJsLmZpbGVuYW1lVG9rZW4gKyB2YWwpOwogICAgICB0b2tlbnMucHVzaCh0b2tlbik7CiAgICB9CiAgfSk7CiAgCiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsKICBjb25zdCBzdGFtcCA9IG5vdy5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCkgKwogICAgU3RyaW5nKG5vdy5nZXRNb250aCgpICsgMSkucGFkU3RhcnQoMiwgJzAnKSArCiAgICBTdHJpbmcobm93LmdldERhdGUoKSkucGFkU3RhcnQoMiwgJzAnKSArCiAgICBTdHJpbmcobm93LmdldEhvdXJzKCkpLnBhZFN0YXJ0KDIsICcwJykgKwogICAgU3RyaW5nKG5vdy5nZXRNaW51dGVzKCkpLnBhZFN0YXJ0KDIsICcwJykgKwogICAgU3RyaW5nKG5vdy5nZXRTZWNvbmRzKCkpLnBhZFN0YXJ0KDIsICcwJyk7CiAgdG9rZW5zLnB1c2goc3RhbXApOwogIAogICQoJ2ZpbGVuYW1lUHJldmlldycpLnRleHRDb250ZW50ID0gdG9rZW5zLmpvaW4oJ18nKSArIENPTkZJRy5jbGllbnRGaWxlRXh0Owp9CgpmdW5jdGlvbiBkZWJvdW5jZShmbixtcz0yMDApeyBsZXQgaDsgcmV0dXJuICguLi5hKT0+eyBjbGVhclRpbWVvdXQoaCk7IGg9c2V0VGltZW91dCgoKT0+Zm4oLi4uYSksbXMpOyB9OyB9CgpmdW5jdGlvbiBzbWFydFNlYXJjaChpdGVtcywgcXVlcnkpIHsKICBpZiAoIXF1ZXJ5IHx8ICFxdWVyeS50cmltKCkpIHJldHVybiBpdGVtczsKICAKICBjb25zdCBxID0gcXVlcnkudG9Mb3dlckNhc2UoKS50cmltKCk7CiAgCiAgLy8gUGFyc2Ugc2VhcmNoIHRlcm1zOiBzdXBwb3J0IHF1b3RlcyBmb3IgZXhhY3QgcGhyYXNlcwogIGNvbnN0IHRlcm1zID0gW107CiAgY29uc3QgcXVvdGVSZWdleCA9IC8iKFteIl0rKSJ8JyhbXiddKyknfChcUyspL2c7CiAgbGV0IG1hdGNoOwogIAogIHdoaWxlICgobWF0Y2ggPSBxdW90ZVJlZ2V4LmV4ZWMocSkpICE9PSBudWxsKSB7CiAgICBjb25zdCB0ZXJtID0gKG1hdGNoWzFdIHx8IG1hdGNoWzJdIHx8IG1hdGNoWzNdKS50b0xvd2VyQ2FzZSgpOwogICAgdGVybXMucHVzaCh0ZXJtKTsKICB9CiAgCiAgaWYgKHRlcm1zLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGl0ZW1zOwogIAogIC8vIEZpbHRlciBpdGVtczogQUxMIHRlcm1zIG11c3QgbWF0Y2ggKEFORCBsb2dpYykKICByZXR1cm4gaXRlbXMuZmlsdGVyKGl0ZW0gPT4gewogICAgY29uc3Qgc2VhcmNoVGV4dCA9IChpdGVtLm5hbWUgfHwgJycpLnRvTG93ZXJDYXNlKCkKICAgICAgLnJlcGxhY2UoL1teXHdcc10vZywgJyAnKTsgLy8gUmVtb3ZlIHB1bmN0dWF0aW9uIGZvciBtYXRjaGluZwogICAgCiAgICByZXR1cm4gdGVybXMuZXZlcnkodGVybSA9PiBzZWFyY2hUZXh0LmluY2x1ZGVzKHRlcm0pKTsKICB9KTsKfQoKJCgnc2VhcmNoJykuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBkZWJvdW5jZSgoZSk9PnsgCiAgY29uc3QgcSA9IGUudGFyZ2V0LnZhbHVlIHx8ICcnOwogIGNvbnN0IGZpbHRlcmVkID0gc21hcnRTZWFyY2goc3RhdGUuaXRlbXMsIHEpOwogIHJlbmRlckxpc3QoZmlsdGVyZWQpOwp9LCAxODApKTsKCiQoJ2NsZWFyU2VhcmNoJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+eyAkKCdzZWFyY2gnKS52YWx1ZT0nJzsgcmVuZGVyTGlzdChzdGF0ZS5pdGVtcyk7ICQoJ3NlYXJjaCcpLmZvY3VzKCk7IH0pOwoKQ09ORklHLnN0b3JhZ2VDb250cm9scy5mb3JFYWNoKGN0cmwgPT4gewogIGNvbnN0IGlkID0gY3RybC5pZDsKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHsKICAgIGNvbnN0IGVsID0gJChpZCk7CiAgICBpZihlbCl7CiAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4gdXBkYXRlRmlsZW5hbWVQcmV2aWV3KCkpOwogICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB1cGRhdGVUb3RhbHMoKSk7CiAgICB9CiAgfSk7Cn0pOwoKJCgnY3VzdG9tZXInKS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHVwZGF0ZUZpbGVuYW1lUHJldmlldygpKTsKCmZ1bmN0aW9uIHBhcnNlRmlsZW5hbWVUb0NvbmZpZyhmbikgewogIGNvbnN0IGJhc2UgPSBmbi5yZXBsYWNlKG5ldyBSZWdFeHAoYFxcJHtDT05GSUcuY2xpZW50RmlsZUV4dH18XFwke0NPTkZJRy5hZG1pbkZpbGVFeHR9fFxcLih0eHQpJGAsICdpJyksICcnKTsKICBjb25zdCBwYXJ0cyA9IGJhc2Uuc3BsaXQoJ18nKTsKICBpZiAocGFydHMubGVuZ3RoIDwgMikgcmV0dXJuIG51bGw7CiAgCiAgY29uc3QgY29uZmlnID0geyBjdXN0b21lcjogcGFydHNbMF0gfTsKICAKICBDT05GSUcuc3RvcmFnZUNvbnRyb2xzLmZvckVhY2goY3RybCA9PiB7CiAgICBpZiAoY3RybC5maWxlbmFtZVRva2VuKSB7CiAgICAgIGNvbnN0IHBhdHRlcm4gPSBjdHJsLmZpbGVuYW1lVG9rZW4gPT09IHRydWUgCiAgICAgICAgPyBgXigke2N0cmwub3B0aW9ucy5tYXAobyA9PiBvLnZhbHVlKS5qb2luKCd8Jyl9KSRgCiAgICAgICAgOiBgXiR7Y3RybC5maWxlbmFtZVRva2VufVxcZCskYDsKICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKHBhdHRlcm4pOwogICAgICAKICAgICAgcGFydHMuZm9yRWFjaChwID0+IHsKICAgICAgICBpZiAocmVnZXgudGVzdChwKSkgewogICAgICAgICAgY29uZmlnW2N0cmwuaWRdID0gY3RybC5maWxlbmFtZVRva2VuID09PSB0cnVlID8gcCA6IHAucmVwbGFjZShjdHJsLmZpbGVuYW1lVG9rZW4sICcnKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwogIAogIHJldHVybiBjb25maWc7Cn0KCiQoJ2ZpbGVJbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldik9PnsKICBjb25zdCBmID0gZXYudGFyZ2V0LmZpbGVzWzBdOyAKICBpZighZikgcmV0dXJuOyAKICAKICBjb25zdCBjZmcgPSBwYXJzZUZpbGVuYW1lVG9Db25maWcoZi5uYW1lKTsgCiAgaWYoY2ZnKXsgCiAgICAkKCdjdXN0b21lcicpLnZhbHVlID0gY2ZnLmN1c3RvbWVyIHx8ICcnOwogICAgQ09ORklHLnN0b3JhZ2VDb250cm9scy5mb3JFYWNoKGN0cmwgPT4gewogICAgICBjb25zdCBlbCA9ICQoY3RybC5pZCk7CiAgICAgIGlmIChlbCAmJiBjZmdbY3RybC5pZF0pIHsKICAgICAgICBpZiAoY3RybC50eXBlID09PSAnc2VsZWN0JykgewogICAgICAgICAgQXJyYXkuZnJvbShlbC5vcHRpb25zKS5mb3JFYWNoKG8gPT4gewogICAgICAgICAgICBpZiAoby52YWx1ZSA9PT0gY2ZnW2N0cmwuaWRdKSBvLnNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICB1cGRhdGVGaWxlbmFtZVByZXZpZXcoKTsgCiAgICB1cGRhdGVUb3RhbHMoKTsKICB9CiAgCiAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsgCiAgcmVhZGVyLm9ubG9hZCA9IChlKT0+eyAKICAgIGNvbnN0IGxpbmVzID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCdcbicpLm1hcChzPT5zLnRyaW0oKSkuZmlsdGVyKEJvb2xlYW4pOyAKICAgIHN0YXRlLnNlbGVjdGVkPVtdOyAKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pdGVtJykuZm9yRWFjaChpPT5pLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJykpOwogICAgCiAgICBsaW5lcy5mb3JFYWNoKHRpdGxlPT57IAogICAgICBjb25zdCBsZWZ0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaXRlbScpKS5maW5kKGk9PmkuZGF0YXNldC5uYW1lPT09dGl0bGUpOyAKICAgICAgaWYobGVmdCl7IAogICAgICAgIGxlZnQuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTsgCiAgICAgICAgc3RhdGUuc2VsZWN0ZWQucHVzaCh7IG5hbWU6bGVmdC5kYXRhc2V0Lm5hbWUsIGZpbGVuYW1lOiBsZWZ0LmRhdGFzZXQuZmlsZW5hbWUgfHwgbGVmdC5kYXRhc2V0Lm5hbWUsIHNpemU6bGVmdC5kYXRhc2V0LnNpemUgfSk7IAogICAgICB9IGVsc2UgeyAKICAgICAgICBjb25zdCBtYXliZSA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLml0ZW0nKSkuZmluZChpPT5pLmRhdGFzZXQubmFtZSAmJiBpLmRhdGFzZXQubmFtZS50b0xvd2VyQ2FzZSgpPT09dGl0bGUudG9Mb3dlckNhc2UoKSk7IAogICAgICAgIGlmKG1heWJlKXsgCiAgICAgICAgICBtYXliZS5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpOyAKICAgICAgICAgIHN0YXRlLnNlbGVjdGVkLnB1c2goeyBuYW1lOm1heWJlLmRhdGFzZXQubmFtZSwgZmlsZW5hbWU6IG1heWJlLmRhdGFzZXQuZmlsZW5hbWUgfHwgbWF5YmUuZGF0YXNldC5uYW1lLCBzaXplOm1heWJlLmRhdGFzZXQuc2l6ZSB9KTsgCiAgICAgICAgfSAKICAgICAgfSAKICAgIH0pOyAKICAgIHVwZGF0ZVRvdGFscygpOyAKICAgIHJlbmRlck92ZXJsYXkoKTsgCiAgfTsKICByZWFkZXIucmVhZEFzVGV4dChmKTsKfSk7CgokKCdzYXZlQnRuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PnsKICBub3cgPSBEYXRlLm5vdygpOwogIGlmIChub3cgLSBsYXN0RXhwb3J0VGltZSA8IE1JTl9ERUxBWSkgewogICAgdG9hc3QoJ1BsZWFzZSB3YWl0IGJlZm9yZSBleHBvcnRpbmcgYWdhaW4nKTsKICAgIGFsZXJ0KCdQbGVhc2Ugd2FpdCBiZWZvcmUgZXhwb3J0aW5nIGFnYWluJyk7CiAgICByZXR1cm47CiAgfQogIGxhc3RFeHBvcnRUaW1lID0gbm93OwoKICBpZihzdGF0ZS5zZWxlY3RlZC5sZW5ndGg9PT0wKXsgYWxlcnQoJ05vIGl0ZW1zIHNlbGVjdGVkJyk7IHJldHVybjsgfQogIGNvbnN0IGN1c3QgPSAoJCgnY3VzdG9tZXInKS52YWx1ZXx8JycpLnRyaW0oKTsgCiAgaWYoIWN1c3QpeyBhbGVydCgnQ3VzdG9tZXIgbmFtZSByZXF1aXJlZCcpOyByZXR1cm47IH0KICBjb25zdCBmaWxlbmFtZSA9ICQoJ2ZpbGVuYW1lUHJldmlldycpLnRleHRDb250ZW50IHx8IGBsaXN0JHtDT05GSUcuY2xpZW50RmlsZUV4dH1gOwogIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbc3RhdGUuc2VsZWN0ZWQubWFwKHM9PnMubmFtZSkuam9pbignXG4nKV0sIHsgdHlwZTondGV4dC9wbGFpbicgfSk7IAogIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7IAogIGEuaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7IAogIGEuZG93bmxvYWQgPSBmaWxlbmFtZTsgCiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsgCiAgYS5jbGljaygpOyAKICBhLnJlbW92ZSgpOyAKICBVUkwucmV2b2tlT2JqZWN0VVJMKGEuaHJlZik7IAogIHRvYXN0KCdTYXZlZCBjbGllbnQgZmlsZScpOwp9KTsKCiQoJ2FkbWluRXhwb3J0Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCk9PnsKICBub3cgPSBEYXRlLm5vdygpOwogIGlmIChub3cgLSBsYXN0RXhwb3J0VGltZSA8IE1JTl9ERUxBWSkgewogICAgdG9hc3QoJ1BsZWFzZSB3YWl0IGJlZm9yZSBleHBvcnRpbmcgYWdhaW4nKTsKICAgIGFsZXJ0KCdQbGVhc2Ugd2FpdCBiZWZvcmUgZXhwb3J0aW5nIGFnYWluJyk7CiAgICByZXR1cm47CiAgfQogIGxhc3RFeHBvcnRUaW1lID0gbm93OwoKICBpZihzdGF0ZS5zZWxlY3RlZC5sZW5ndGg9PT0wKXsgYWxlcnQoJ05vIGl0ZW1zIHNlbGVjdGVkJyk7IHJldHVybjsgfQogIGNvbnN0IGN1c3QgPSAoJCgnY3VzdG9tZXInKS52YWx1ZXx8JycpLnRyaW0oKTsgCiAgaWYoIWN1c3QpeyBhbGVydCgnQ3VzdG9tZXIgbmFtZSByZXF1aXJlZCcpOyByZXR1cm47IH0KICAKICB0cnl7IAogICAgY29uc3QgeG1sdHh0ID0gYXdhaXQgZmV0Y2goQ09ORklHLnhtbEZpbGUpLnRoZW4ocj0+ci50ZXh0KCkpOyAKICAgIGNvbnN0IHhtbCA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoeG1sdHh0LCdhcHBsaWNhdGlvbi94bWwnKTsgCiAgICBsZXQgY29udGVudD0nJzsgCiAgICAKICAgIGlmIChDT05GSUcuc3RydWN0dXJlVHlwZSA9PT0gJ2ZvbGRlcnMnKSB7CiAgICAgIHN0YXRlLnNlbGVjdGVkLmZvckVhY2goc2VsPT57IAogICAgICAgIGNvbnN0IGZvbGRlciA9IEFycmF5LmZyb20oeG1sLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ZvbGRlcicpKS5maW5kKGY9PmYuZ2V0QXR0cmlidXRlKCduYW1lJyk9PT1zZWwubmFtZSk7IAogICAgICAgIGlmKGZvbGRlcil7IAogICAgICAgICAgZm9sZGVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ZpbGUnKS5mb3JFYWNoKGZpbGU9PiAKICAgICAgICAgICAgY29udGVudCArPSBgJHtDT05GSUcuYWRtaW5CYXNlUGF0aH0ke2ZvbGRlci5nZXRBdHRyaWJ1dGUoJ25hbWUnKX1cXCR7ZmlsZS5nZXRBdHRyaWJ1dGUoJ25hbWUnKX1cbmAKICAgICAgICAgICk7IAogICAgICAgIH0gCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgc3RhdGUuc2VsZWN0ZWQuZm9yRWFjaChzZWw9PnsgCiAgICAgICAgY29uc3QgZmlsZW5hbWUgPSBzZWwuZmlsZW5hbWUgfHwgc2VsLm5hbWU7CiAgICAgICAgY29udGVudCArPSBgJHtDT05GSUcuYWRtaW5CYXNlUGF0aH0ke2ZpbGVuYW1lfVxuYDsKICAgICAgfSk7CiAgICB9CiAgICAKICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7IAogICAgY29uc3Qgc3RhbXAgPSBgJHtub3cuZ2V0RnVsbFllYXIoKX0ke1N0cmluZyhub3cuZ2V0TW9udGgoKSsxKS5wYWRTdGFydCgyLCcwJyl9JHtTdHJpbmcobm93LmdldERhdGUoKSkucGFkU3RhcnQoMiwnMCcpfV8ke1N0cmluZyhub3cuZ2V0SG91cnMoKSkucGFkU3RhcnQoMiwnMCcpfSR7U3RyaW5nKG5vdy5nZXRNaW51dGVzKCkpLnBhZFN0YXJ0KDIsJzAnKX1gOyAKICAgIGNvbnN0IGZuYW1lID0gYCR7KGN1c3R8fCdjdXN0b21lcicpLnJlcGxhY2UoL1teYS16QS1aMC05XS9nLCdfJyl9XyR7c3RhbXB9JHtDT05GSUcuYWRtaW5GaWxlRXh0fWA7IAogICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtjb250ZW50XSwgeyB0eXBlOid0ZXh0L3BsYWluJyB9KTsgCiAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOyAKICAgIGEuaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7IAogICAgYS5kb3dubG9hZCA9IGZuYW1lOyAKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7IAogICAgYS5jbGljaygpOyAKICAgIGEucmVtb3ZlKCk7IAogICAgVVJMLnJldm9rZU9iamVjdFVSTChhLmhyZWYpOyAKICAgIHRvYXN0KCdBZG1pbiBleHBvcnQgcmVhZHknKTsgCiAgfWNhdGNoKGUpeyAKICAgIGNvbnNvbGUuZXJyb3IoZSk7IAogICAgdG9hc3QoJ0FkbWluIGV4cG9ydCBmYWlsZWQnKTsgCiAgfQp9KTsKCiQoJ3VwbG9hZEJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCk9PnsKICBpZihzdGF0ZS5zZWxlY3RlZC5sZW5ndGg9PT0wKXsgYWxlcnQoJ05vIGl0ZW1zIHNlbGVjdGVkJyk7IHJldHVybjsgfQogIGNvbnN0IGN1c3QgPSAoJCgnY3VzdG9tZXInKS52YWx1ZXx8JycpLnRyaW0oKTsgCiAgaWYoIWN1c3QpeyBhbGVydCgnQ3VzdG9tZXIgcmVxdWlyZWQnKTsgcmV0dXJuOyB9CiAgaWYoIWNvbmZpcm0oYFVwbG9hZCBsaXN0IGZvciAke2N1c3R9P2ApKSByZXR1cm47IAogIAogIGNvbnN0IGZpbGVuYW1lID0gJCgnZmlsZW5hbWVQcmV2aWV3JykudGV4dENvbnRlbnQgfHwgYGxpc3Qke0NPTkZJRy5jbGllbnRGaWxlRXh0fWA7IAogIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbc3RhdGUuc2VsZWN0ZWQubWFwKHM9PnMubmFtZSkuam9pbignXG4nKV0sIHsgdHlwZTondGV4dC9wbGFpbicgfSk7IAogIGNvbnN0IG5vdyA9IERhdGUubm93KCk7IAogIGlmKG5vdyAtIHN0YXRlLmxhc3RVcGxvYWQgPCAxNTAwMCl7IGFsZXJ0KCdQbGVhc2Ugd2FpdCAxNSBzZWNvbmRzIGJldHdlZW4gdXBsb2FkcycpOyByZXR1cm47IH0KICAKICB0cnl7IAogICAgY29uc3QgdXJsID0gYGh0dHBzOi8vZmlsZWJpbi5uZXQvJHtDT05GSUcuZmlsZWJpbkJ1Y2tldH0vJHtmaWxlbmFtZX1gOyAKICAgIGNvbnN0IHIgPSBhd2FpdCBmZXRjaCh1cmwseyBtZXRob2Q6J1BPU1QnLCBoZWFkZXJzOnsgJ0NvbnRlbnQtVHlwZSc6J3RleHQvcGxhaW4nIH0sIGJvZHk6IGJsb2IgfSk7IAogICAgCiAgICBpZihyLm9rIHx8IHIuc3RhdHVzPT09MjAxKXsgCiAgICAgIHN0YXRlLmxhc3RVcGxvYWQgPSBub3c7IAogICAgICAkKCdzaGFyZWFibGUnKS52YWx1ZSA9IGBodHRwczovL2ZpbGViaW4ubmV0LyR7Q09ORklHLmZpbGViaW5CdWNrZXR9LyR7ZmlsZW5hbWV9YDsgCiAgICAgIHRvYXN0KCdVcGxvYWRlZCB0byBmaWxlYmluJyk7IAogICAgICBzaG93QmFubmVyKCJVcGxvYWQgQ29tcGxldGUgLSBQcmVzcyBDb3B5IExpbmsgYW5kIHNlbmQgaXQgdG8gb3VyIGNoYXQiKTsKICAgICAgCiAgICAgIGNvbnN0IGNvbmZpZ1NlY3Rpb24gPSAkKCdjb25maWdTZWN0aW9uJyk7CiAgICAgIGNvbnN0IHRvZ2dsZUJ0biA9ICQoJ3RvZ2dsZUNvbmZpZycpOwogICAgICBpZiAoY29uZmlnU2VjdGlvbiAmJiB0b2dnbGVCdG4gJiYgY29uZmlnU2VjdGlvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7CiAgICAgICAgY29uZmlnU2VjdGlvbi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICB0b2dnbGVCdG4udGV4dENvbnRlbnQgPSAnU2hvdyBDb25maWd1cmF0aW9uJzsKICAgICAgfQogICAgICByZXR1cm47IAogICAgfSAKICB9Y2F0Y2goZSl7IAogICAgY29uc29sZS53YXJuKCdmaWxlYmluIGVycm9yJywgZSk7IAogIH0KICAKICB0cnl7IAogICAgY29uc3QgZm9ybSA9IG5ldyBGb3JtRGF0YSgpOyAKICAgIGZvcm0uYXBwZW5kKCdmaWxlJywgYmxvYiwgZmlsZW5hbWUpOyAKICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKCdodHRwczovL3VwbG9hZC5nb2ZpbGUuaW8vdXBsb2FkRmlsZScsIHsgbWV0aG9kOidQT1NUJywgYm9keTogZm9ybSB9KTsgCiAgICBjb25zdCBqID0gYXdhaXQgcmVzLmpzb24oKTsgCiAgICBpZihqLnN0YXR1cyA9PT0gJ29rJyl7IAogICAgICBzdGF0ZS5sYXN0VXBsb2FkID0gbm93OyAKICAgICAgJCgnc2hhcmVhYmxlJykudmFsdWUgPSBqLmRhdGEuZG93bmxvYWRQYWdlOyAKICAgICAgdG9hc3QoJ1VwbG9hZGVkIHRvIEdvRmlsZScpOyAKICAgICAgcmV0dXJuOyAKICAgIH0gCiAgICB0b2FzdCgnVXBsb2FkIGZhaWxlZCcpOyAKICB9Y2F0Y2goZSl7IAogICAgY29uc29sZS5lcnJvcihlKTsgCiAgICB0b2FzdCgnVXBsb2FkIGVycm9yJyk7IAogIH0KfSk7CgpsZXQgYmluTGlzdFBhZ2UgPSAwOwpjb25zdCBiaW5MaXN0UGFnZVNpemUgPSAxMDsKbGV0IGNhY2hlZEJpbkZpbGVzID0gbnVsbDsKCiQoJ2Jpbkxpc3QnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgdHJ5IHsKICAgIGNvbnN0IHIgPSBhd2FpdCBmZXRjaChgaHR0cHM6Ly9maWxlYmluLm5ldC8ke0NPTkZJRy5maWxlYmluQnVja2V0fT9qc29uYCwgewogICAgICBoZWFkZXJzOiB7ICJBY2NlcHQiOiAiYXBwbGljYXRpb24vanNvbiIgfQogICAgfSk7CiAgICBpZiAoIXIub2spIHsgdG9hc3QoYEZhaWxlZCB0byBmZXRjaCB1cGxvYWRzOiAke3Iuc3RhdHVzVGV4dH1gKTsgcmV0dXJuOyB9CgogICAgbGV0IGo7CiAgICB0cnkgewogICAgICBqID0gYXdhaXQgci5qc29uKCk7CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgdG9hc3QoIkZhaWxlZCB0byBwYXJzZSBzZXJ2ZXIgcmVzcG9uc2UiKTsKICAgICAgY29uc29sZS5lcnJvcihlcnIpOwogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKCFqLmZpbGVzIHx8ICFqLmZpbGVzLmxlbmd0aCkgeyB0b2FzdCgnTm8gZmlsZXMgZm91bmQnKTsgcmV0dXJuOyB9CgogICAgY29uc3Qgc29ydGVkID0gai5maWxlcy5zb3J0KChhLGIpPT4gbmV3IERhdGUoYi51cGRhdGVkX2F0KSAtIG5ldyBEYXRlKGEudXBkYXRlZF9hdCkpOwogICAgY2FjaGVkQmluRmlsZXMgPSBzb3J0ZWQ7CiAgICBiaW5MaXN0UGFnZSA9IDA7CiAgICByZW5kZXJCaW5MaXN0KCk7CiAgfSBjYXRjaCAoZSkgewogICAgY29uc29sZS5lcnJvcihlKTsKICAgIHRvYXN0KCdFcnJvciBmZXRjaGluZyB1cGxvYWRzJyk7CiAgfQp9KTsKCmZ1bmN0aW9uIHJlbmRlckJpbkxpc3QoKSB7CiAgaWYgKCFjYWNoZWRCaW5GaWxlcykgcmV0dXJuOwogIAogIGNvbnN0IHN0YXJ0ID0gYmluTGlzdFBhZ2UgKiBiaW5MaXN0UGFnZVNpemU7CiAgY29uc3QgZW5kID0gc3RhcnQgKyBiaW5MaXN0UGFnZVNpemU7CiAgY29uc3QgcGFnZUZpbGVzID0gY2FjaGVkQmluRmlsZXMuc2xpY2Uoc3RhcnQsIGVuZCk7CiAgY29uc3QgaGFzTW9yZSA9IGVuZCA8IGNhY2hlZEJpbkZpbGVzLmxlbmd0aDsKICAKICBsZXQgaHRtbCA9ICc8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6bGVmdDttYXJnaW4tYm90dG9tOjhweDsiPic7CiAgaHRtbCArPSAnPGJ1dHRvbiBpZD0iY2xvc2VCaW4iIGNsYXNzPSJidG4gZ2hvc3QiIHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7Ij5DbG9zZTwvYnV0dG9uPic7CiAgaHRtbCArPSBgPHN0cm9uZz5SZWNlbnQgVXBsb2Fkczwvc3Ryb25nPmA7CiAgaHRtbCArPSAnPC9kaXY+JzsKICAKICBodG1sICs9ICc8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjhweDttYXJnaW4tYm90dG9tOjhweDsiPic7CiAgaHRtbCArPSBgPGJ1dHRvbiBpZD0icHJldlBhZ2UiIGNsYXNzPSJidG4gZ2hvc3QiIHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7ZmxleDoxOyIgJHtiaW5MaXN0UGFnZSA9PT0gMCA/ICdkaXNhYmxlZCcgOiAnJ30+UHJldjwvYnV0dG9uPmA7CiAgaHRtbCArPSBgPHNwYW4gc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Zm9udC1zaXplOjEycHg7Y29sb3I6IzZiNzI4MDsiPlBhZ2UgJHtiaW5MaXN0UGFnZSArIDF9PC9zcGFuPmA7CiAgaHRtbCArPSBgPGJ1dHRvbiBpZD0ibmV4dFBhZ2UiIGNsYXNzPSJidG4gZ2hvc3QiIHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7ZmxleDoxOyIgJHshaGFzTW9yZSA/ICdkaXNhYmxlZCcgOiAnJ30+TmV4dDwvYnV0dG9uPmA7CiAgaHRtbCArPSAnPC9kaXY+JzsKICAKICBodG1sICs9ICc8dWwgc3R5bGU9Im1hcmdpbjowO3BhZGRpbmctbGVmdDoyMHB4OyI+JzsKICBwYWdlRmlsZXMuZm9yRWFjaChmaWxlID0+IHsKICAgIGNvbnN0IGZpbGVVcmwgPSBgaHR0cHM6Ly9maWxlYmluLm5ldC8ke0NPTkZJRy5maWxlYmluQnVja2V0fS8ke2VuY29kZVVSSUNvbXBvbmVudChmaWxlLmZpbGVuYW1lKX1gOwogICAgY29uc3QgYWRkZWREYXRlID0gbmV3IERhdGUoZmlsZS51cGRhdGVkX2F0KTsKICAgIGNvbnN0IGZvcm1hdHRlZERhdGUgPSBhZGRlZERhdGUudG9JU09TdHJpbmcoKS5zbGljZSgwLDEwKS5yZXBsYWNlKC8tL2csJycpOwogICAgY29uc3QgaG91cnMgPSBhZGRlZERhdGUuZ2V0SG91cnMoKTsKICAgIGNvbnN0IG1pbnV0ZXMgPSBhZGRlZERhdGUuZ2V0TWludXRlcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwnMCcpOwogICAgY29uc3QgYW1wbSA9IGhvdXJzID49IDEyID8gJ1BNJzonQU0nOwogICAgY29uc3QgZm9ybWF0dGVkVGltZSA9IGAke2hvdXJzICUgMTIgfHwgMTJ9OiR7bWludXRlc30gJHthbXBtfWA7CiAgICBjb25zdCBzdHJpcHBlZE5hbWUgPSBmaWxlLmZpbGVuYW1lLnNwbGl0KCcuJykuc2xpY2UoMCwtMSkuam9pbignLicpOwogICAgY29uc3QgZmlsZVNpemUgPSBmaWxlLmJ5dGVzX3JlYWRhYmxlIHx8ICcnOwogICAgaHRtbCArPSBgPGxpIHN0eWxlPSJtYXJnaW4tYm90dG9tOjRweDsgZm9udC1zaXplOiAxMnB4OyI+PGEgaHJlZj0iJHtmaWxlVXJsfSIgdGFyZ2V0PSJfYmxhbmsiIHN0eWxlPSJ0ZXh0LWRlY29yYXRpb246bm9uZTtjb2xvcjojMDM2NmQ2OyI+JHtmb3JtYXR0ZWREYXRlfSAke2Zvcm1hdHRlZFRpbWV9IHwgJHtzdHJpcHBlZE5hbWV9IHwgJHtmaWxlU2l6ZX08L2E+PC9saT5gOwogIH0pOwogIGh0bWwgKz0gJzwvdWw+JzsKCiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVMaXN0Q29udGFpbmVyJyk7CiAgY29udGFpbmVyLmlubmVySFRNTCA9IGh0bWw7CiAgY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogIGNvbnRhaW5lci5zdHlsZS5iYWNrZ3JvdW5kID0gJyNmOWZhZmInOwogIGNvbnRhaW5lci5zdHlsZS5wYWRkaW5nID0gJzEycHgnOwogIGNvbnRhaW5lci5zdHlsZS5ib3JkZXJSYWRpdXMgPSAnOHB4JzsKICBjb250YWluZXIuc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCAjZTVlN2ViJzsKICBjb250YWluZXIuc3R5bGUubWFyZ2luVG9wID0gJzhweCc7CiAgICBjb250YWluZXIuc3R5bGUub3ZlcmZsb3dZID0gJ2F1dG8nOwpjb250YWluZXIuc3R5bGUub3ZlcmZsb3dYID0gJ2hpZGRlbic7ICAgLy8gb3IgJ2F1dG8nIGlmIHlvdSBwcmVmZXIgaG9yaXpvbnRhbCBzY3JvbGwKY29udGFpbmVyLnN0eWxlLm1heEhlaWdodCA9ICczMDBweCc7ICAgIC8vIHNldCB3aGF0ZXZlciBmaXhlZCBoZWlnaHQgeW91IHdhbnQKCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlQmluJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIGJpbkxpc3RQYWdlID0gMDsKICAgIGNhY2hlZEJpbkZpbGVzID0gbnVsbDsKICB9KTsKICAKICBjb25zdCBwcmV2QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXZQYWdlJyk7CiAgaWYgKHByZXZCdG4gJiYgYmluTGlzdFBhZ2UgPiAwKSB7CiAgICBwcmV2QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICBiaW5MaXN0UGFnZS0tOwogICAgICByZW5kZXJCaW5MaXN0KCk7CiAgICB9KTsKICB9CiAgCiAgY29uc3QgbmV4dEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0UGFnZScpOwogIGlmIChuZXh0QnRuICYmIGhhc01vcmUpIHsKICAgIG5leHRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgIGJpbkxpc3RQYWdlKys7CiAgICAgIHJlbmRlckJpbkxpc3QoKTsKICAgIH0pOwogIH0KfQoKJCgnc2VhcmNoJykuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldikgPT4gewogIGlmIChldi5rZXkgPT09ICdFbnRlcicpIHsKICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAKICAgIGNvbnN0IHZpc2libGVJdGVtcyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLml0ZW0nKSkKICAgICAgLmZpbHRlcihlbCA9PiBlbC5vZmZzZXRQYXJlbnQgIT09IG51bGwpOyAvLyBPbmx5IHZpc2libGUgaXRlbXMKICAgIAogICAgLy8gQ2FsY3VsYXRlIHdoYXQgd291bGQgYmUgYWRkZWQKICAgIGNvbnN0IHRvQWRkID0gdmlzaWJsZUl0ZW1zLmZpbHRlcihlbCA9PiB7CiAgICAgIGNvbnN0IG5hbWUgPSBlbC5kYXRhc2V0Lm5hbWU7CiAgICAgIHJldHVybiAhc3RhdGUuc2VsZWN0ZWQuc29tZShzID0+IHMubmFtZSA9PT0gbmFtZSk7CiAgICB9KTsKICAgIAogICAgaWYgKHRvQWRkLmxlbmd0aCA9PT0gMCkgewogICAgICB0b2FzdCgnQWxsIHZpc2libGUgaXRlbXMgYWxyZWFkeSBzZWxlY3RlZCcpOwogICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIC8vIENhbGN1bGF0ZSB0b3RhbCBzaXplIG9mIGl0ZW1zIHRvIGJlIGFkZGVkCiAgICBsZXQgdG90YWxCeXRlcyA9IDA7CiAgICB0b0FkZC5mb3JFYWNoKGVsID0+IHsKICAgICAgdG90YWxCeXRlcyArPSBwYXJzZVNpemVUZXh0KGVsLmRhdGFzZXQuc2l6ZSk7CiAgICB9KTsKICAgIGNvbnN0IHRvdGFsR0IgPSBieXRlc1RvR0IodG90YWxCeXRlcykudG9GaXhlZCgyKTsKICAgIAogICAgLy8gQ29uZmlybWF0aW9uIGRpYWxvZwogICAgY29uc3QgY29uZmlybWVkID0gY29uZmlybSgKICAgICAgYEFkZCAke3RvQWRkLmxlbmd0aH0gZ2FtZSR7dG9BZGQubGVuZ3RoICE9PSAxID8gJ3MnIDogJyd9IGZyb20gc2VhcmNoIHJlc3VsdHM/XG5cbmAgKwogICAgICBgVG90YWwgc2l6ZTogJHt0b3RhbEdCfSBHQlxuXG5gICsKICAgICAgYFByZXNzIE9LIHRvIGFkZCB0aGVzZSBpdGVtcy5gCiAgICApOwogICAgCiAgICBpZiAoIWNvbmZpcm1lZCkgewogICAgICB0b2FzdCgnQWRkIGNhbmNlbGxlZCcpOwogICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIC8vIEFkZCB0aGUgaXRlbXMKICAgIGxldCBhZGRlZCA9IDA7CiAgICB0b0FkZC5mb3JFYWNoKGVsID0+IHsKICAgICAgY29uc3QgbmFtZSA9IGVsLmRhdGFzZXQubmFtZTsKICAgICAgY29uc3Qgc2l6ZSA9IGVsLmRhdGFzZXQuc2l6ZTsKICAgICAgY29uc3QgZmlsZW5hbWUgPSBlbC5kYXRhc2V0LmZpbGVuYW1lIHx8IG5hbWU7CiAgICAgIHN0YXRlLnNlbGVjdGVkLnB1c2goeyBuYW1lLCBmaWxlbmFtZSwgc2l6ZSB9KTsKICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTsKICAgICAgYWRkZWQrKzsKICAgIH0pOwogICAgCiAgICBpZiAoYWRkZWQgPiAwKSB7CiAgICAgIHVwZGF0ZVRvdGFscygpOwogICAgICByZW5kZXJPdmVybGF5KCk7CiAgICAgIHRvYXN0KGBBZGRlZCAke2FkZGVkfSBpdGVtJHthZGRlZCAhPT0gMSA/ICdzJyA6ICcnfSAoJHt0b3RhbEdCfSBHQilgKTsKICAgIH0KICB9Cn0pOwoKJCgnY29weUxpbmsnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICBjb25zdCBjdXN0ID0gKCQoJ2N1c3RvbWVyJykudmFsdWV8fCcnKS50cmltKCk7IAogIGlmKCFjdXN0KXsgYWxlcnQoJ0N1c3RvbWVyIG5hbWUgcmVxdWlyZWQnKTsgcmV0dXJuOyB9CiAgCiAgY29uc3QgcmF3TGluayA9ICQoJ3NoYXJlYWJsZScpLnZhbHVlLnRyaW0oKTsKICBjb25zdCBsaW5rID0gcmF3TGluawogICAgLnJlcGxhY2UoL15odHRwcz86XC9cLy8sICdoeHhwY2ZmJykKICAgIC5yZXBsYWNlKC9cLi9nLCAnX2RvdF8nKTsKCiAgY29uc3QgdGl0bGVzQXJyID0gc3RhdGUuc2VsZWN0ZWQubWFwKHMgPT4gcy5uYW1lKTsKCiAgaWYgKHRpdGxlc0Fyci5sZW5ndGggPT09IDApIHsKICAgIHRvYXN0KCdObyBzZWxlY3RlZCBsaXN0IHRvIGNvcHknKTsKICAgIGFsZXJ0KCdObyBzZWxlY3RlZCBsaXN0IHRvIGNvcHknKTsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IHRvdGFsQnl0ZXMgPSBzdGF0ZS5zZWxlY3RlZC5yZWR1Y2UoKHN1bSwgcykgPT4gc3VtICsgcGFyc2VTaXplVGV4dChzLnNpemUpLCAwKTsKICBjb25zdCB0b3RhbEdCID0gKHRvdGFsQnl0ZXMgLyAoMTAyNCAqKiAzKSkudG9GaXhlZCgyKTsKICBjb25zdCBjb3VudCA9IHRpdGxlc0Fyci5sZW5ndGg7CgogIGNvbnN0IGN1c3RvbWVyID0gKCQoJ2N1c3RvbWVyJykudmFsdWUgfHwgJycpLnRyaW0oKSB8fCAnVW5rbm93biBjdXN0b21lcic7CiAgY29uc3QgZmlsZW5hbWUgPSAkKCdmaWxlbmFtZVByZXZpZXcnKS50ZXh0Q29udGVudCB8fCBgbGlzdCR7Q09ORklHLmNsaWVudEZpbGVFeHR9YDsKCiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsKICBjb25zdCBzdGFtcCA9IG5vdy50b0xvY2FsZVN0cmluZygnZW4tVVMnLCB7CiAgICB5ZWFyOiAnbnVtZXJpYycsIG1vbnRoOiAnMi1kaWdpdCcsIGRheTogJzItZGlnaXQnLAogICAgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0Jywgc2Vjb25kOiAnMi1kaWdpdCcKICB9KTsKCiAgbGV0IGxpbmtUb1VzZSA9IGxpbms7CgogIGlmICghbGluaykgewogICAgY29uc3QgYXNrID0gY29uZmlybSgKICAgICAgYE5vIGxpbmsgZm91bmQuXG5cbmAgKwogICAgICBgTGlzdCBjb250YWlucyAke2NvdW50fSBpdGVtcyB0b3RhbGluZyAke3RvdGFsR0J9IEdCLlxuXG5gICsKICAgICAgYFdvdWxkIHlvdSBsaWtlIHRvIHVwbG9hZCBub3c/YAogICAgKTsKCiAgICBpZiAoYXNrKSB7CiAgICAgICQoJ3VwbG9hZEJ0bicpLmNsaWNrKCk7CiAgICAgIHNob3dCYW5uZXIoIlVwbG9hZGluZ+KAplxuXG5QbGVhc2Ugd2FpdCBmb3IgdGhlIGxpbmsgdG8gYXBwZWFyLCB0aGVuIHByZXNzIENvcHkgYWdhaW4uIik7CiAgICAgIHRvYXN0KCJVcGxvYWRpbmfigKYgd2FpdCBmb3IgbGluaywgdGhlbiBwcmVzcyBDb3B5IGFnYWluIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBsaW5rVG9Vc2UgPSAnKE5vIGxpbmsgdXBsb2FkZWQpJzsKICB9CgogIGNvbnN0IHN1bW1hcnkgPQogICAgYEN1c3RvbWVyOiAke2N1c3RvbWVyfVxuYCArCiAgICBgRmlsZW5hbWU6ICR7ZmlsZW5hbWV9XG5gICsKICAgIGBRdWFudGl0eTogJHtjb3VudH0gaXRlbXNcbmAgKwogICAgYFRvdGFsIFNpemU6ICR7dG90YWxHQn0gR0JcbmAgKwogICAgYEdlbmVyYXRlZDogJHtzdGFtcH1cblxuYCArCiAgICBgJHtsaW5rVG9Vc2V9XG5cbmA7CgogIGNvbnN0IGZpbmFsVGV4dCA9IHN1bW1hcnkgKyB0aXRsZXNBcnIuam9pbignXG4nKTsKCiAgbGV0IG1lc3NhZ2UgPSBsaW5rCiAgICA/IGBMaXN0ICYgbGluayBjb3BpZWQuICgke2NvdW50fSBpdGVtcywgJHt0b3RhbEdCfSBHQilgCiAgICA6IGBMaXN0IGNvcGllZCAobm8gbGluaykuICgke2NvdW50fSBpdGVtcywgJHt0b3RhbEdCfSBHQilgOwoKICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChmaW5hbFRleHQpLnRoZW4oKCkgPT4gewogICAgdG9hc3QobWVzc2FnZS5yZXBsYWNlKC9cbi9nLCAnICcpKTsKICAgIGFsZXJ0KG1lc3NhZ2UpOwogIH0pLmNhdGNoKCgpID0+IHsKICAgIGFsZXJ0KCdDb3B5IGZhaWxlZCwgcGxlYXNlIGNvcHkgbWFudWFsbHknKTsKICB9KTsKfSk7CgpmdW5jdGlvbiByZW5kZXJTZWxlY3RlZFBhbmVsKCkgewogIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0ZWRQYW5lbEJvZHknKTsKICBpZiAoIWJvZHkpIHJldHVybjsKCiAgYm9keS5pbm5lckhUTUwgPSAnJzsKICBzdGF0ZS5zZWxlY3RlZC5mb3JFYWNoKChzLCBpKSA9PiB7CiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHJvdy5jbGFzc05hbWUgPSAncm93JzsKICAgIHJvdy5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgcm93LnN0eWxlLmp1c3RpZnlDb250ZW50ID0gJ3NwYWNlLWJldHdlZW4nOwogICAgcm93LnN0eWxlLmFsaWduSXRlbXMgPSAnY2VudGVyJzsKICAgIHJvdy5zdHlsZS5wYWRkaW5nID0gJzZweCAwJzsKICAgIHJvdy5pbm5lckhUTUwgPSBgCiAgICAgIDxkaXY+CiAgICAgICAgPHN0cm9uZz4ke2kgKyAxfS4gJHtlc2Mocy5uYW1lKX08L3N0cm9uZz4KICAgICAgICA8ZGl2IGNsYXNzPSJtZXRhIj4ke2VzYyhzLnNpemUpfTwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDo0cHg7Ij4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJpY29uIHVwIj51PC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaWNvbiBkb3duIj5kPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaWNvbiByZW1vdmUiPng8L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICBgOwoKICAgIHJvdy5xdWVyeVNlbGVjdG9yKCcudXAnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgW3N0YXRlLnNlbGVjdGVkW2kgLSAxXSwgc3RhdGUuc2VsZWN0ZWRbaV1dID0gW3N0YXRlLnNlbGVjdGVkW2ldLCBzdGF0ZS5zZWxlY3RlZFtpIC0gMV1dOwogICAgICAgIHJlbmRlck92ZXJsYXkoKTsKICAgICAgICByZW5kZXJMaXN0KHN0YXRlLml0ZW1zKTsKICAgICAgICB1cGRhdGVUb3RhbHMoKTsKICAgICAgfQogICAgfSk7CgogICAgcm93LnF1ZXJ5U2VsZWN0b3IoJy5kb3duJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgIGlmIChpIDwgc3RhdGUuc2VsZWN0ZWQubGVuZ3RoIC0gMSkgewogICAgICAgIFtzdGF0ZS5zZWxlY3RlZFtpICsgMV0sIHN0YXRlLnNlbGVjdGVkW2ldXSA9IFtzdGF0ZS5zZWxlY3RlZFtpXSwgc3RhdGUuc2VsZWN0ZWRbaSArIDFdXTsKICAgICAgICByZW5kZXJPdmVybGF5KCk7CiAgICAgICAgcmVuZGVyTGlzdChzdGF0ZS5pdGVtcyk7CiAgICAgICAgdXBkYXRlVG90YWxzKCk7CiAgICAgIH0KICAgIH0pOwoKICAgIHJvdy5xdWVyeVNlbGVjdG9yKCcucmVtb3ZlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgIHN0YXRlLnNlbGVjdGVkLnNwbGljZShpLCAxKTsKICAgICAgcmVuZGVyT3ZlcmxheSgpOwogICAgICByZW5kZXJMaXN0KHN0YXRlLml0ZW1zKTsKICAgICAgdXBkYXRlVG90YWxzKCk7CiAgICB9KTsKCiAgICBib2R5LmFwcGVuZENoaWxkKHJvdyk7CiAgfSk7Cn0KCmNvbnN0IHRvZ2dsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGVDb25maWcnKTsKY29uc3QgY29uZmlnU2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maWdTZWN0aW9uJyk7CgppZiAoaXNNb2JpbGUgJiYgdG9nZ2xlQnRuICYmIGNvbmZpZ1NlY3Rpb24pIHsKICBjb25maWdTZWN0aW9uLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIHRvZ2dsZUJ0bi50ZXh0Q29udGVudCA9ICdIaWRlIENvbmZpZ3VyYXRpb24nOwoKICB0b2dnbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBjb25zdCBpc1Zpc2libGUgPSBjb25maWdTZWN0aW9uLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpOwogICAgdG9nZ2xlQnRuLnRleHRDb250ZW50ID0gaXNWaXNpYmxlID8gJ0hpZGUgQ29uZmlndXJhdGlvbicgOiAnU2hvdyBDb25maWd1cmF0aW9uJzsKICB9KTsKfQoKZnVuY3Rpb24gcGFyc2VEYXRlRmxleGlibGUocykgewogIGlmICghcykgcmV0dXJuIG51bGw7CiAgbGV0IGQgPSBuZXcgRGF0ZShzKTsKICBpZiAoIWlzTmFOKGQuZ2V0VGltZSgpKSkgcmV0dXJuIGQ7CgogIGNvbnN0IHltZCA9ICgnJytzKS5tYXRjaCgvKFxkezR9KVxEPyhcZHsxLDJ9KVxEPyhcZHsxLDJ9KS8pOwogIGlmICh5bWQpIHsKICAgIGQgPSBuZXcgRGF0ZShOdW1iZXIoeW1kWzFdKSwgTnVtYmVyKHltZFsyXSkgLSAxLCBOdW1iZXIoeW1kWzNdKSk7CiAgICBpZiAoIWlzTmFOKGQuZ2V0VGltZSgpKSkgcmV0dXJuIGQ7CiAgfQoKICBjb25zdCBkbXkgPSAoJycrcykubWF0Y2goLyhcZHsxLDJ9KVxEKFxkezEsMn0pXEQoXGR7NH0pLyk7CiAgaWYgKGRteSkgewogICAgZCA9IG5ldyBEYXRlKE51bWJlcihkbXlbM10pLCBOdW1iZXIoZG15WzJdKSAtIDEsIE51bWJlcihkbXlbMV0pKTsKICAgIGlmICghaXNOYU4oZC5nZXRUaW1lKCkpKSByZXR1cm4gZDsKICB9CgogIHJldHVybiBudWxsOwp9CgpsZXQgc29ydE1vZGUgPSAnbm9ybWFsJzsKCmZ1bmN0aW9uIHNvcnRDeWNsZSgpIHsKICBpZiAoIXN0YXRlLml0ZW1zIHx8IHN0YXRlLml0ZW1zLmxlbmd0aCA9PT0gMCkgewogICAgdG9hc3QoJ05vIGxpc3QgbG9hZGVkIHlldCcpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKHNvcnRNb2RlID09PSAnbm9ybWFsJykgewogICAgc29ydE1vZGUgPSAnbGF0ZXN0JzsKICAgIHN0YXRlLml0ZW1zLmZvckVhY2goaXQgPT4gewogICAgICBjb25zdCByYXcgPSBpdC5kYXRlIHx8IGl0LmRhdGVNb2RpZmllZCB8fCBpdC5tb2RpZmllZCB8fCAnJzsKICAgICAgY29uc3QgZCA9IHBhcnNlRGF0ZUZsZXhpYmxlKHJhdyk7CiAgICAgIGl0Ll9wYXJzZWREYXRlID0gZCA/IGQuZ2V0VGltZSgpIDogMDsKICAgIH0pOwogICAgc3RhdGUuaXRlbXMuc29ydCgoYSwgYikgPT4gYi5fcGFyc2VkRGF0ZSAtIGEuX3BhcnNlZERhdGUpOwogICAgcmVuZGVyTGlzdChzdGF0ZS5pdGVtcyk7CiAgICB0b2FzdCgnU29ydGVkIGJ5IExhdGVzdCBNb2RpZmllZCcpOwogICAgJCgnc29ydExhdGVzdCcpLnRleHRDb250ZW50ID0gJ0xhdGVzdCc7CgogIH0gZWxzZSBpZiAoc29ydE1vZGUgPT09ICdsYXRlc3QnKSB7CiAgICBzb3J0TW9kZSA9ICdzY29yZSc7CiAgICBzdGF0ZS5pdGVtcy5zb3J0KChhLCBiKSA9PiAocGFyc2VJbnQoYi5zY29yZSB8fCAwKSAtIHBhcnNlSW50KGEuc2NvcmUgfHwgMCkpKTsKICAgIHJlbmRlckxpc3Qoc3RhdGUuaXRlbXMpOwogICAgdG9hc3QoJ1NvcnRlZCBieSBTY29yZScpOwogICAgJCgnc29ydExhdGVzdCcpLnRleHRDb250ZW50ID0gJ1RvcCc7CgogIH0gZWxzZSB7CiAgICBzb3J0TW9kZSA9ICdub3JtYWwnOwogICAgcmVuZGVyTGlzdChzdGF0ZS5pdGVtcyk7CiAgICB0b2FzdCgnU29ydGVkIGJ5IE5hbWUgKE5vcm1hbCknKTsKICAgICQoJ3NvcnRMYXRlc3QnKS50ZXh0Q29udGVudCA9ICdTb3J0JzsKICB9Cn0KCmNvbnN0IHNvcnRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29ydExhdGVzdCcpOwppZiAoc29ydEJ0bikgewogIHNvcnRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzb3J0Q3ljbGUpOwp9CgpmdW5jdGlvbiBkZXRlY3RFbnZpcm9ubWVudCgpIHsKICBjb25zdCB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmE7CiAgY29uc3QgaXNNZXNzZW5nZXIgPSAvRkJBTnxGQkFWfEZCX0lBQnxNZXNzZW5nZXIvaS50ZXN0KHVhKTsKICBjb25zdCBpc0luc3RhZ3JhbSA9IC9JbnN0YWdyYW0vaS50ZXN0KHVhKTsKICBjb25zdCBpc1dlYlZpZXcgPSAvXGJ3dlxiLy50ZXN0KHVhKSB8fCAod2luZG93Lm5hdmlnYXRvci5zdGFuZGFsb25lID09PSBmYWxzZSk7CgogIGlmIChpc01lc3NlbmdlciB8fCBpc0luc3RhZ3JhbSB8fCBpc1dlYlZpZXcpIHsKICAgIHNob3dCYW5uZXIoIk1lc3NlbmdlciBvciBpbi1hcHAgd2VidmlldyBkZXRlY3RlZC5cblRoaXMgcGFnZSBpcyBiZXN0IHVzZWQgb24gYSBmdWxsIG1vYmlsZSBicm93c2VyIG9yIGRlc2t0b3AgYnJvd3NlciwgYnV0IGl0IHdpbGwgcHJvYmFibHkgd29yayBhbnl3YXkiLCA0MDAwKTsKICB9CiAgc2hvd0Jhbm5lcigiSG93IHRvIHVzZTpcblxuMS4gRW50ZXIgeW91ciBuYW1lXG4yLiBTZWxlY3QgeW91ciBkZXZpY2UgbW9kZWwgKE9MRUQvTGl0ZS9WMS9WMilcbjMuIFNlbGVjdCB5b3VyIFNEIENhcmQgU2l6ZVxuNC4gQ2hvb3NlIHlvdXIgZ2FtZXNcbjUuIFByZXNzIFVwbG9hZFxuNi4gU2VuZCB0aGUgZ2VuZXJhdGVkIGxpbmsgdG8gb3VyIGNoYXQgY29udmVyc2F0aW9uIiwgODAwMCk7Cn0KCmZ1bmN0aW9uIHNob3dCYW5uZXIobWVzc2FnZSwgZHVyYXRpb24gPSA0MDAwKSB7CiAgY29uc3QgYmFubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgYmFubmVyLmlubmVyVGV4dCA9IG1lc3NhZ2U7CiAgYmFubmVyLnN0eWxlLmNzc1RleHQgPSAicG9zaXRpb246Zml4ZWQ7dG9wOjMwJTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC44KTtjb2xvcjojZmZmO3BhZGRpbmc6MThweDtib3JkZXItcmFkaXVzOjE2cHg7Zm9udC1zaXplOjIycHg7ei1pbmRleDo5OTk5O2JveC1zaGFkb3c6MCAycHggNnB4IHJnYmEoMCwwLDAsMC4zKTt0cmFuc2l0aW9uOm9wYWNpdHkgMC41cyBlYXNlO3doaXRlLXNwYWNlOnByZS1saW5lO21heC13aWR0aDo4MCUiOwogIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYmFubmVyKTsKCiAgc2V0VGltZW91dCgoKSA9PiBiYW5uZXIuc3R5bGUub3BhY2l0eSA9ICIwIiwgZHVyYXRpb24pOwogIHNldFRpbWVvdXQoKCkgPT4gYmFubmVyLnJlbW92ZSgpLCBkdXJhdGlvbiArIDUwMCk7Cn0KCmZ1bmN0aW9uIGxldmVuc2h0ZWluRGlzdGFuY2Uoc3RyMSwgc3RyMikgewogIGNvbnN0IGxlbjEgPSBzdHIxLmxlbmd0aDsKICBjb25zdCBsZW4yID0gc3RyMi5sZW5ndGg7CiAgY29uc3QgbWF0cml4ID0gQXJyYXkobGVuMiArIDEpLmZpbGwobnVsbCkubWFwKCgpID0+IEFycmF5KGxlbjEgKyAxKS5maWxsKDApKTsKICAKICBmb3IgKGxldCBpID0gMDsgaSA8PSBsZW4xOyBpKyspIG1hdHJpeFswXVtpXSA9IGk7CiAgZm9yIChsZXQgaiA9IDA7IGogPD0gbGVuMjsgaisrKSBtYXRyaXhbal1bMF0gPSBqOwogIAogIGZvciAobGV0IGogPSAxOyBqIDw9IGxlbjI7IGorKykgewogICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gbGVuMTsgaSsrKSB7CiAgICAgIGNvbnN0IGNvc3QgPSBzdHIxW2kgLSAxXSA9PT0gc3RyMltqIC0gMV0gPyAwIDogMTsKICAgICAgbWF0cml4W2pdW2ldID0gTWF0aC5taW4oCiAgICAgICAgbWF0cml4W2pdW2kgLSAxXSArIDEsCiAgICAgICAgbWF0cml4W2ogLSAxXVtpXSArIDEsCiAgICAgICAgbWF0cml4W2ogLSAxXVtpIC0gMV0gKyBjb3N0CiAgICAgICk7CiAgICB9CiAgfQogIAogIHJldHVybiBtYXRyaXhbbGVuMl1bbGVuMV07Cn0KCmZ1bmN0aW9uIG5vcm1hbGl6ZVRpdGxlKHRpdGxlKSB7CiAgcmV0dXJuIHRpdGxlLnRvTG93ZXJDYXNlKCkKICAgIC5yZXBsYWNlKC9bXlx3XHNdL2csICcgJykgIC8vIFJlbW92ZSBwdW5jdHVhdGlvbgogICAgLnJlcGxhY2UoL1xzKy9nLCAnICcpICAgICAgLy8gQ29sbGFwc2Ugc3BhY2VzCiAgICAudHJpbSgpOwp9CgpmdW5jdGlvbiBnZXRLZXl3b3Jkcyh0aXRsZSkgewogIGNvbnN0IG5vcm1hbGl6ZWQgPSBub3JtYWxpemVUaXRsZSh0aXRsZSk7CiAgLy8gRmlsdGVyIG91dCBjb21tb24gd29yZHMKICBjb25zdCBzdG9wV29yZHMgPSBbJ3RoZScsICdvZicsICdhbmQnLCAnYScsICdhbicsICdpbicsICdvbicsICdmb3InLCAndG8nLCAnd2l0aCddOwogIHJldHVybiBub3JtYWxpemVkLnNwbGl0KCcgJykuZmlsdGVyKHdvcmQgPT4gd29yZC5sZW5ndGggPiAwICYmICFzdG9wV29yZHMuaW5jbHVkZXMod29yZCkpOwp9CgpmdW5jdGlvbiBleHRyYWN0TnVtYmVycyh0aXRsZSkgewogIGNvbnN0IG1hdGNoZXMgPSB0aXRsZS5tYXRjaCgvXGQrL2cpOwogIHJldHVybiBtYXRjaGVzID8gbWF0Y2hlcy5tYXAobiA9PiBuKSA6IFtdOwp9CgpmdW5jdGlvbiBjYWxjdWxhdGVNYXRjaFNjb3JlKHVzZXJUaXRsZSwgZGJUaXRsZSkgewogIGNvbnN0IHVzZXJLZXl3b3JkcyA9IGdldEtleXdvcmRzKHVzZXJUaXRsZSk7CiAgY29uc3QgZGJLZXl3b3JkcyA9IGdldEtleXdvcmRzKGRiVGl0bGUpOwogIAogIGlmICh1c2VyS2V5d29yZHMubGVuZ3RoID09PSAwKSByZXR1cm4geyBzY29yZTogMCwgbnVtYmVyTWF0Y2g6IGZhbHNlLCBjb25zZWN1dGl2ZU1hdGNoZXM6IDAgfTsKICAKICBsZXQgbWF0Y2hlZFdvcmRzID0gMDsKICBsZXQgcGFydGlhbE1hdGNoZXMgPSAwOwogIGxldCBjb25zZWN1dGl2ZU1hdGNoZXMgPSAwOwogIGxldCBsYXN0TWF0Y2hJbmRleCA9IC0yOwogIAogIC8vIENoZWNrIGZvciBudW1iZXIgbWF0Y2hpbmcKICBjb25zdCB1c2VyTnVtYmVycyA9IGV4dHJhY3ROdW1iZXJzKHVzZXJUaXRsZSk7CiAgY29uc3QgZGJOdW1iZXJzID0gZXh0cmFjdE51bWJlcnMoZGJUaXRsZSk7CiAgY29uc3QgaGFzRXhhY3ROdW1iZXJNYXRjaCA9IHVzZXJOdW1iZXJzLmxlbmd0aCA+IDAgJiYgCiAgICB1c2VyTnVtYmVycy5ldmVyeShudW0gPT4gZGJOdW1iZXJzLmluY2x1ZGVzKG51bSkpOwogIAogIHVzZXJLZXl3b3Jkcy5mb3JFYWNoKCh1c2VyV29yZCwgaWR4KSA9PiB7CiAgICBsZXQgbWF0Y2hlZCA9IGZhbHNlOwogICAgCiAgICAvLyBDaGVjayBmb3IgZXhhY3Qgd29yZCBtYXRjaAogICAgY29uc3QgZXhhY3RJZHggPSBkYktleXdvcmRzLmZpbmRJbmRleChkYldvcmQgPT4gZGJXb3JkID09PSB1c2VyV29yZCk7CiAgICBpZiAoZXhhY3RJZHggIT09IC0xKSB7CiAgICAgIG1hdGNoZWRXb3JkcyArPSAxOwogICAgICBtYXRjaGVkID0gdHJ1ZTsKICAgICAgCiAgICAgIC8vIFRyYWNrIGNvbnNlY3V0aXZlIG1hdGNoZXMKICAgICAgaWYgKGV4YWN0SWR4ID09PSBsYXN0TWF0Y2hJbmRleCArIDEpIHsKICAgICAgICBjb25zZWN1dGl2ZU1hdGNoZXMrKzsKICAgICAgfQogICAgICBsYXN0TWF0Y2hJbmRleCA9IGV4YWN0SWR4OwogICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIC8vIENoZWNrIGZvciBzdWJzdHJpbmcgbWF0Y2ggLSBidXQgcmVxdWlyZSBtaW5pbXVtIGxlbmd0aAogICAgLy8gQU5EIHRoZSB1c2VyIHdvcmQgbXVzdCBiZSBzdWJzdGFudGlhbCAoMysgY2hhcnMgZm9yIG1vc3QsIDQrIGZvciB2ZXJ5IGNvbW1vbiB3b3JkcykKICAgIGlmICh1c2VyV29yZC5sZW5ndGggPj0gMykgewogICAgICBjb25zdCBzdWJzdHJpbmdJZHggPSBkYktleXdvcmRzLmZpbmRJbmRleChkYldvcmQgPT4gewogICAgICAgIC8vIERCIHdvcmQgbXVzdCBiZSBsb25nIGVub3VnaCB0byBjb250YWluIHRoZSB1c2VyIHdvcmQgbWVhbmluZ2Z1bGx5CiAgICAgICAgaWYgKGRiV29yZC5sZW5ndGggPj0gdXNlcldvcmQubGVuZ3RoICsgMSAmJiBkYldvcmQuaW5jbHVkZXModXNlcldvcmQpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgLy8gT3IgaWYgdXNlciB3b3JkIGlzIGxvbmdlciwgY2hlY2sgaWYgaXQgY29udGFpbnMgREIgd29yZCAoZm9yIGNvbXBvdW5kIHdvcmRzKQogICAgICAgIGlmICh1c2VyV29yZC5sZW5ndGggPj0gNCAmJiB1c2VyV29yZC5pbmNsdWRlcyhkYldvcmQpICYmIGRiV29yZC5sZW5ndGggPj0gMykgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSk7CiAgICAgIAogICAgICBpZiAoc3Vic3RyaW5nSWR4ICE9PSAtMSkgewogICAgICAgIC8vIEdpdmUgaGlnaGVyIHNjb3JlIGZvciBsb25nZXIgbWF0Y2hlcwogICAgICAgIGNvbnN0IG1hdGNoU3RyZW5ndGggPSB1c2VyV29yZC5sZW5ndGggPj0gNCA/IDAuOCA6IDAuNjsKICAgICAgICBwYXJ0aWFsTWF0Y2hlcyArPSBtYXRjaFN0cmVuZ3RoOwogICAgICAgIG1hdGNoZWQgPSB0cnVlOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgCiAgICAvLyBDaGVjayBmb3IgdmVyeSBjbG9zZSB0eXBvIChzaW5nbGUgY2hhciBkaWZmZXJlbmNlKQogICAgLy8gT25seSBmb3Igd29yZHMgMysgY2hhcmFjdGVycwogICAgaWYgKHVzZXJXb3JkLmxlbmd0aCA+PSAzKSB7CiAgICAgIGRiS2V5d29yZHMuZm9yRWFjaChkYldvcmQgPT4gewogICAgICAgIGlmIChkYldvcmQubGVuZ3RoIDwgMykgcmV0dXJuOyAvLyBTa2lwIHNob3J0IHdvcmRzCiAgICAgICAgCiAgICAgICAgY29uc3QgbWF4TGVuID0gTWF0aC5tYXgodXNlcldvcmQubGVuZ3RoLCBkYldvcmQubGVuZ3RoKTsKICAgICAgICBjb25zdCBtaW5MZW4gPSBNYXRoLm1pbih1c2VyV29yZC5sZW5ndGgsIGRiV29yZC5sZW5ndGgpOwogICAgICAgIAogICAgICAgIC8vIE9ubHkgY29uc2lkZXIgaWYgbGVuZ3RocyBhcmUgc2ltaWxhcgogICAgICAgIGlmIChtYXhMZW4gLSBtaW5MZW4gPD0gMiAmJiBtaW5MZW4gPj0gMykgewogICAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBsZXZlbnNodGVpbkRpc3RhbmNlKHVzZXJXb3JkLCBkYldvcmQpOwogICAgICAgICAgaWYgKGRpc3RhbmNlIDw9IDIpIHsKICAgICAgICAgICAgcGFydGlhbE1hdGNoZXMgKz0gMC41OwogICAgICAgICAgICBtYXRjaGVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwogIAogIGNvbnN0IHRvdGFsTWF0Y2hlZCA9IG1hdGNoZWRXb3JkcyArIHBhcnRpYWxNYXRjaGVzOwogIGNvbnN0IHNjb3JlID0gdG90YWxNYXRjaGVkIC8gdXNlcktleXdvcmRzLmxlbmd0aDsKICAKICByZXR1cm4geyAKICAgIHNjb3JlLCAKICAgIG51bWJlck1hdGNoOiBoYXNFeGFjdE51bWJlck1hdGNoLAogICAgY29uc2VjdXRpdmVNYXRjaGVzLAogICAgdGl0bGVMZW5ndGg6IGRiS2V5d29yZHMubGVuZ3RoLAogICAgZXhhY3RXb3JkQ291bnQ6IG1hdGNoZWRXb3JkcyAgLy8gVHJhY2sgZXhhY3QgbWF0Y2hlcyBzZXBhcmF0ZWx5CiAgfTsKfQoKZnVuY3Rpb24gZmluZEJlc3RNYXRjaCh1c2VyVGl0bGUsIGRiSXRlbXMpIHsKICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplVGl0bGUodXNlclRpdGxlKTsKICAKICAvLyBUcnkgZXhhY3QgbWF0Y2ggZmlyc3QKICBjb25zdCBleGFjdE1hdGNoID0gZGJJdGVtcy5maW5kKGl0ZW0gPT4gbm9ybWFsaXplVGl0bGUoaXRlbS5uYW1lKSA9PT0gbm9ybWFsaXplZCk7CiAgaWYgKGV4YWN0TWF0Y2gpIHsKICAgIHJldHVybiB7IG1hdGNoOiBleGFjdE1hdGNoLCBjb25maWRlbmNlOiAnZXhhY3QnLCBzY29yZTogMS4wIH07CiAgfQogIAogIC8vIFNjb3JlIGFsbCBpdGVtcwogIGNvbnN0IHNjb3JlZCA9IGRiSXRlbXMubWFwKGl0ZW0gPT4gewogICAgY29uc3QgbWF0Y2hEYXRhID0gY2FsY3VsYXRlTWF0Y2hTY29yZSh1c2VyVGl0bGUsIGl0ZW0ubmFtZSk7CiAgICByZXR1cm4gewogICAgICBpdGVtLAogICAgICAuLi5tYXRjaERhdGEKICAgIH07CiAgfSkuZmlsdGVyKHMgPT4gcy5zY29yZSA+IDApOwogIAogIGlmIChzY29yZWQubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDsKICAKICAvLyBTb3J0IGJ5IHByaW9yaXR5OgogIC8vIDEuIE51bWJlciBtYXRjaCAoY3JpdGljYWwgZm9yIHNlcXVlbHMvdmVyc2lvbnMpCiAgLy8gMi4gRXhhY3Qgd29yZCBjb3VudCAocHJlZmVyIG1vcmUgZXhhY3QgbWF0Y2hlcykKICAvLyAzLiBTY29yZQogIC8vIDQuIENvbnNlY3V0aXZlIG1hdGNoZXMgKHdvcmQgb3JkZXIgbWF0dGVycykKICAvLyA1LiBTaG9ydGVyIHRpdGxlIChtb3JlIHByZWNpc2UpCiAgc2NvcmVkLnNvcnQoKGEsIGIpID0+IHsKICAgIC8vIFByaW9yaXR5IDE6IEV4YWN0IG51bWJlciBtYXRjaAogICAgaWYgKGEubnVtYmVyTWF0Y2ggJiYgIWIubnVtYmVyTWF0Y2gpIHJldHVybiAtMTsKICAgIGlmICghYS5udW1iZXJNYXRjaCAmJiBiLm51bWJlck1hdGNoKSByZXR1cm4gMTsKICAgIAogICAgLy8gUHJpb3JpdHkgMjogTW9yZSBleGFjdCB3b3JkIG1hdGNoZXMgd2lucwogICAgaWYgKGEuZXhhY3RXb3JkQ291bnQgIT09IGIuZXhhY3RXb3JkQ291bnQpIHsKICAgICAgcmV0dXJuIGIuZXhhY3RXb3JkQ291bnQgLSBhLmV4YWN0V29yZENvdW50OwogICAgfQogICAgCiAgICAvLyBQcmlvcml0eSAzOiBTY29yZSBkaWZmZXJlbmNlCiAgICBjb25zdCBzY29yZURpZmYgPSBiLnNjb3JlIC0gYS5zY29yZTsKICAgIGlmIChNYXRoLmFicyhzY29yZURpZmYpID4gMC4xNSkgcmV0dXJuIHNjb3JlRGlmZjsKICAgIAogICAgLy8gUHJpb3JpdHkgNDogQ29uc2VjdXRpdmUgbWF0Y2hlcyAocGhyYXNlIG1hdGNoaW5nKQogICAgaWYgKGEuY29uc2VjdXRpdmVNYXRjaGVzICE9PSBiLmNvbnNlY3V0aXZlTWF0Y2hlcykgewogICAgICByZXR1cm4gYi5jb25zZWN1dGl2ZU1hdGNoZXMgLSBhLmNvbnNlY3V0aXZlTWF0Y2hlczsKICAgIH0KICAgIAogICAgLy8gUHJpb3JpdHkgNTogUHJlZmVyIHNob3J0ZXIgdGl0bGVzCiAgICByZXR1cm4gYS50aXRsZUxlbmd0aCAtIGIudGl0bGVMZW5ndGg7CiAgfSk7CiAgCiAgY29uc3QgYmVzdCA9IHNjb3JlZFswXTsKICAKICAvLyBEZXRlcm1pbmUgY29uZmlkZW5jZSBiYXNlZCBvbiBzY29yZQogIGxldCBjb25maWRlbmNlOwogIGlmIChiZXN0LnNjb3JlID49IDAuOTUpIHsKICAgIGNvbmZpZGVuY2UgPSAnaGlnaCc7CiAgfSBlbHNlIGlmIChiZXN0LnNjb3JlID49IDAuNykgewogICAgY29uZmlkZW5jZSA9ICdtZWRpdW0nOwogIH0gZWxzZSBpZiAoYmVzdC5zY29yZSA+PSAwLjUpIHsKICAgIGNvbmZpZGVuY2UgPSAnbG93JzsKICB9IGVsc2UgewogICAgcmV0dXJuIG51bGw7IC8vIFRvbyBsb3cgY29uZmlkZW5jZQogIH0KICAKICByZXR1cm4geyBtYXRjaDogYmVzdC5pdGVtLCBjb25maWRlbmNlLCBzY29yZTogYmVzdC5zY29yZSB9Owp9CgpmdW5jdGlvbiBtYXRjaFVzZXJMaXN0KHVzZXJMaXN0KSB7CiAgY29uc3QgbGluZXMgPSB1c2VyTGlzdC5zcGxpdCgnXG4nKS5tYXAocyA9PiBzLnRyaW0oKSkuZmlsdGVyKEJvb2xlYW4pOwogIGNvbnN0IHJlc3VsdHMgPSB7CiAgICBleGFjdDogW10sCiAgICBoaWdoOiBbXSwKICAgIG1lZGl1bTogW10sCiAgICBsb3c6IFtdLAogICAgbm90Rm91bmQ6IFtdCiAgfTsKICAKICBsaW5lcy5mb3JFYWNoKHVzZXJUaXRsZSA9PiB7CiAgICBjb25zdCByZXN1bHQgPSBmaW5kQmVzdE1hdGNoKHVzZXJUaXRsZSwgc3RhdGUuaXRlbXMpOwogICAgCiAgICBpZiAoIXJlc3VsdCkgewogICAgICByZXN1bHRzLm5vdEZvdW5kLnB1c2godXNlclRpdGxlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlc3VsdHNbcmVzdWx0LmNvbmZpZGVuY2VdLnB1c2goewogICAgICAgIG9yaWdpbmFsOiB1c2VyVGl0bGUsCiAgICAgICAgbWF0Y2hlZDogcmVzdWx0Lm1hdGNoLm5hbWUsCiAgICAgICAgc2l6ZTogcmVzdWx0Lm1hdGNoLnNpemUsCiAgICAgICAgc2NvcmU6IHJlc3VsdC5zY29yZQogICAgICB9KTsKICAgIH0KICB9KTsKICAKICByZXR1cm4gcmVzdWx0czsKfQoKJCgnbWF0Y2hMaXN0Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVzTW9kYWwnKTsKICBtb2RhbC5pbm5lckhUTUwgPSAnJzsKICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICBtb2RhbC5zdHlsZS5tYXhXaWR0aCA9ICc2MDBweCc7CiAgCiAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgaGVhZGVyLmlubmVySFRNTCA9ICc8c3Ryb25nPk1hdGNoIFVzZXIgTGlzdDwvc3Ryb25nPjxicj48c3BhbiBjbGFzcz0ibWV0YSI+UGFzdGUgdXNlclwncyBnYW1lIGxpc3QgYmVsb3cgKG9uZSBwZXIgbGluZSk8L3NwYW4+JzsKICBtb2RhbC5hcHBlbmRDaGlsZChoZWFkZXIpOwogIAogIGNvbnN0IHRleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTsKICB0ZXh0YXJlYS5zdHlsZS5jc3NUZXh0ID0gJ3dpZHRoOjEwMCU7bWluLWhlaWdodDoyMDBweDttYXJnaW4tdG9wOjEycHg7cGFkZGluZzo4cHg7Ym9yZGVyOjFweCBzb2xpZCAjZTVlN2ViO2JvcmRlci1yYWRpdXM6OHB4O2ZvbnQtZmFtaWx5Om1vbm9zcGFjZTtmb250LXNpemU6MTNweDsnOwogIHRleHRhcmVhLnBsYWNlaG9sZGVyID0gJ1N1cGVyIE1hcmlvIE9keXNzZXlcblRoZSBMZWdlbmQgb2YgWmVsZGFcbk1hcmlvIEthcnQgOFxuLi4uJzsKICBtb2RhbC5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7CiAgCiAgY29uc3QgYnRuQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgYnRuQ29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAnZGlzcGxheTpmbGV4O2dhcDo4cHg7bWFyZ2luLXRvcDoxMnB4Oyc7CiAgCiAgY29uc3QgbWF0Y2hCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICBtYXRjaEJ0bi50ZXh0Q29udGVudCA9ICdBbmFseXplICYgTWF0Y2gnOwogIG1hdGNoQnRuLmNsYXNzTmFtZSA9ICdidG4nOwogIG1hdGNoQnRuLm9uY2xpY2sgPSAoKSA9PiB7CiAgICBjb25zdCB1c2VyTGlzdCA9IHRleHRhcmVhLnZhbHVlLnRyaW0oKTsKICAgIGlmICghdXNlckxpc3QpIHsKICAgICAgYWxlcnQoJ1BsZWFzZSBwYXN0ZSBhIGdhbWUgbGlzdCcpOwogICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIHNob3dNYXRjaFJlc3VsdHModXNlckxpc3QpOwogIH07CiAgYnRuQ29udGFpbmVyLmFwcGVuZENoaWxkKG1hdGNoQnRuKTsKICAKICBjb25zdCBjbG9zZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogIGNsb3NlQnRuLnRleHRDb250ZW50ID0gJ0NhbmNlbCc7CiAgY2xvc2VCdG4uY2xhc3NOYW1lID0gJ2J0biBnaG9zdCc7CiAgY2xvc2VCdG4ub25jbGljayA9ICgpID0+IHsKICAgIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBtb2RhbC5pbm5lckhUTUwgPSAnJzsKICB9OwogIGJ0bkNvbnRhaW5lci5hcHBlbmRDaGlsZChjbG9zZUJ0bik7CiAgCiAgbW9kYWwuYXBwZW5kQ2hpbGQoYnRuQ29udGFpbmVyKTsKfSk7CgpmdW5jdGlvbiBzaG93TWF0Y2hSZXN1bHRzKHVzZXJMaXN0KSB7CiAgY29uc3QgcmVzdWx0cyA9IG1hdGNoVXNlckxpc3QodXNlckxpc3QpOwogIGNvbnN0IHRvdGFsTWF0Y2hlZCA9IHJlc3VsdHMuZXhhY3QubGVuZ3RoICsgcmVzdWx0cy5oaWdoLmxlbmd0aCArIHJlc3VsdHMubWVkaXVtLmxlbmd0aCArIHJlc3VsdHMubG93Lmxlbmd0aDsKICBjb25zdCB0b3RhbEl0ZW1zID0gdG90YWxNYXRjaGVkICsgcmVzdWx0cy5ub3RGb3VuZC5sZW5ndGg7CiAgCiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZXNNb2RhbCcpOwogIG1vZGFsLmlubmVySFRNTCA9ICcnOwogIG1vZGFsLnN0eWxlLm1heFdpZHRoID0gJzcwMHB4JzsKICBtb2RhbC5zdHlsZS5tYXhIZWlnaHQgPSAnODB2aCc7CiAgCiAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgaGVhZGVyLmlubmVySFRNTCA9IGA8c3Ryb25nPk1hdGNoIFJlc3VsdHM8L3N0cm9uZz48YnI+PHNwYW4gY2xhc3M9Im1ldGEiPk1hdGNoZWQ6ICR7dG90YWxNYXRjaGVkfSAvICR7dG90YWxJdGVtc308L3NwYW4+YDsKICBtb2RhbC5hcHBlbmRDaGlsZChoZWFkZXIpOwogIAogIGNvbnN0IHJlc3VsdENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIHJlc3VsdENvbnRhaW5lci5zdHlsZS5jc3NUZXh0ID0gJ21hcmdpbi10b3A6MTJweDttYXgtaGVpZ2h0OjQwMHB4O292ZXJmbG93LXk6YXV0bzsnOwogIAogIC8vIEV4YWN0IG1hdGNoZXMKICBpZiAocmVzdWx0cy5leGFjdC5sZW5ndGggPiAwKSB7CiAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MICs9IGA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjhweDsiPjxzdHJvbmcgc3R5bGU9ImNvbG9yOiMxMGI5ODE7Ij7inJMgRXhhY3QgTWF0Y2hlcyAoJHtyZXN1bHRzLmV4YWN0Lmxlbmd0aH0pPC9zdHJvbmc+PC9kaXY+YDsKICAgIHJlc3VsdHMuZXhhY3QuZm9yRWFjaChyID0+IHsKICAgICAgcmVzdWx0Q29udGFpbmVyLmlubmVySFRNTCArPSBgPGRpdiBzdHlsZT0icGFkZGluZzo0cHggOHB4O2JhY2tncm91bmQ6I2YwZmRmNDtib3JkZXItbGVmdDozcHggc29saWQgIzEwYjk4MTttYXJnaW4tYm90dG9tOjRweDtmb250LXNpemU6MTJweDsiPiR7ZXNjKHIubWF0Y2hlZCl9IDxzcGFuIHN0eWxlPSJjb2xvcjojNmI3MjgwOyI+JHtlc2Moci5zaXplKX08L3NwYW4+PC9kaXY+YDsKICAgIH0pOwogIH0KICAKICAvLyBIaWdoIGNvbmZpZGVuY2UKICBpZiAocmVzdWx0cy5oaWdoLmxlbmd0aCA+IDApIHsKICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgc3R5bGU9Im1hcmdpbjoxMnB4IDAgOHB4OyI+PHN0cm9uZyBzdHlsZT0iY29sb3I6IzNiODJmNjsiPuKJiCBIaWdoIENvbmZpZGVuY2UgKCR7cmVzdWx0cy5oaWdoLmxlbmd0aH0pPC9zdHJvbmc+PC9kaXY+YDsKICAgIHJlc3VsdHMuaGlnaC5mb3JFYWNoKHIgPT4gewogICAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MICs9IGA8ZGl2IHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7YmFja2dyb3VuZDojZWZmNmZmO2JvcmRlci1sZWZ0OjNweCBzb2xpZCAjM2I4MmY2O21hcmdpbi1ib3R0b206NHB4O2ZvbnQtc2l6ZToxMnB4OyI+PGRpdj4ke2VzYyhyLm9yaWdpbmFsKX0g4oaSIDxzdHJvbmc+JHtlc2Moci5tYXRjaGVkKX08L3N0cm9uZz48L2Rpdj48ZGl2IHN0eWxlPSJjb2xvcjojNmI3MjgwOyI+JHtlc2Moci5zaXplKX08L2Rpdj48L2Rpdj5gOwogICAgfSk7CiAgfQogIAogIC8vIE1lZGl1bSBjb25maWRlbmNlCiAgaWYgKHJlc3VsdHMubWVkaXVtLmxlbmd0aCA+IDApIHsKICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgc3R5bGU9Im1hcmdpbjoxMnB4IDAgOHB4OyI+PHN0cm9uZyBzdHlsZT0iY29sb3I6I2Y1OWUwYjsiPj8gTWVkaXVtIENvbmZpZGVuY2UgKCR7cmVzdWx0cy5tZWRpdW0ubGVuZ3RofSk8L3N0cm9uZz4gPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZToxMnB4O2NvbG9yOiM2YjcyODA7Ij5SZXZpZXcgdGhlc2U8L3NwYW4+PC9kaXY+YDsKICAgIHJlc3VsdHMubWVkaXVtLmZvckVhY2gociA9PiB7CiAgICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgc3R5bGU9InBhZGRpbmc6NHB4IDhweDtiYWNrZ3JvdW5kOiNmZmZiZWI7Ym9yZGVyLWxlZnQ6M3B4IHNvbGlkICNmNTllMGI7bWFyZ2luLWJvdHRvbTo0cHg7Zm9udC1zaXplOjEycHg7Ij48ZGl2PiR7ZXNjKHIub3JpZ2luYWwpfSDihpIgPHN0cm9uZz4ke2VzYyhyLm1hdGNoZWQpfTwvc3Ryb25nPjwvZGl2PjxkaXYgc3R5bGU9ImNvbG9yOiM2YjcyODA7Ij4ke2VzYyhyLnNpemUpfTwvZGl2PjwvZGl2PmA7CiAgICB9KTsKICB9CiAgCiAgLy8gTG93IGNvbmZpZGVuY2UKICBpZiAocmVzdWx0cy5sb3cubGVuZ3RoID4gMCkgewogICAgcmVzdWx0Q29udGFpbmVyLmlubmVySFRNTCArPSBgPGRpdiBzdHlsZT0ibWFyZ2luOjEycHggMCA4cHg7Ij48c3Ryb25nIHN0eWxlPSJjb2xvcjojZjk3MzE2OyI+4pqgIExvdyBDb25maWRlbmNlICgke3Jlc3VsdHMubG93Lmxlbmd0aH0pPC9zdHJvbmc+IDxzcGFuIHN0eWxlPSJmb250LXNpemU6MTJweDtjb2xvcjojNmI3MjgwOyI+VmVyaWZ5IG1hbnVhbGx5PC9zcGFuPjwvZGl2PmA7CiAgICByZXN1bHRzLmxvdy5mb3JFYWNoKHIgPT4gewogICAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MICs9IGA8ZGl2IHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7YmFja2dyb3VuZDojZmZmN2VkO2JvcmRlci1sZWZ0OjNweCBzb2xpZCAjZjk3MzE2O21hcmdpbi1ib3R0b206NHB4O2ZvbnQtc2l6ZToxMnB4OyI+PGRpdj4ke2VzYyhyLm9yaWdpbmFsKX0g4oaSIDxzdHJvbmc+JHtlc2Moci5tYXRjaGVkKX08L3N0cm9uZz48L2Rpdj48ZGl2IHN0eWxlPSJjb2xvcjojNmI3MjgwOyI+JHtlc2Moci5zaXplKX08L2Rpdj48L2Rpdj5gOwogICAgfSk7CiAgfQogIAogIC8vIE5vdCBmb3VuZAogIGlmIChyZXN1bHRzLm5vdEZvdW5kLmxlbmd0aCA+IDApIHsKICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgc3R5bGU9Im1hcmdpbjoxMnB4IDAgOHB4OyI+PHN0cm9uZyBzdHlsZT0iY29sb3I6I2VmNDQ0NDsiPuKclyBOb3QgRm91bmQgKCR7cmVzdWx0cy5ub3RGb3VuZC5sZW5ndGh9KTwvc3Ryb25nPjwvZGl2PmA7CiAgICByZXN1bHRzLm5vdEZvdW5kLmZvckVhY2godGl0bGUgPT4gewogICAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MICs9IGA8ZGl2IHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7YmFja2dyb3VuZDojZmVmMmYyO2JvcmRlci1sZWZ0OjNweCBzb2xpZCAjZWY0NDQ0O21hcmdpbi1ib3R0b206NHB4O2ZvbnQtc2l6ZToxMnB4OyI+JHtlc2ModGl0bGUpfTwvZGl2PmA7CiAgICB9KTsKICB9CiAgCiAgbW9kYWwuYXBwZW5kQ2hpbGQocmVzdWx0Q29udGFpbmVyKTsKICAKICBjb25zdCBidG5Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICBidG5Db250YWluZXIuc3R5bGUuY3NzVGV4dCA9ICdkaXNwbGF5OmZsZXg7Z2FwOjhweDttYXJnaW4tdG9wOjEycHg7ZmxleC13cmFwOndyYXA7JzsKICAKICBpZiAodG90YWxNYXRjaGVkID4gMCkgewogICAgY29uc3QgYWRkQWxsQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICBhZGRBbGxCdG4udGV4dENvbnRlbnQgPSBgQWRkICR7dG90YWxNYXRjaGVkfSBNYXRjaGVzIHRvIFNlbGVjdGlvbmA7CiAgICBhZGRBbGxCdG4uY2xhc3NOYW1lID0gJ2J0bic7CiAgICBhZGRBbGxCdG4ub25jbGljayA9ICgpID0+IHsKICAgICAgbGV0IGFkZGVkID0gMDsKICAgICAgWy4uLnJlc3VsdHMuZXhhY3QsIC4uLnJlc3VsdHMuaGlnaCwgLi4ucmVzdWx0cy5tZWRpdW0sIC4uLnJlc3VsdHMubG93XS5mb3JFYWNoKHIgPT4gewogICAgICAgIGlmICghc3RhdGUuc2VsZWN0ZWQuc29tZShzID0+IHMubmFtZSA9PT0gci5tYXRjaGVkKSkgewogICAgICAgICAgY29uc3QgaXRlbSA9IHN0YXRlLml0ZW1zLmZpbmQoaXQgPT4gaXQubmFtZSA9PT0gci5tYXRjaGVkKTsKICAgICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgIHN0YXRlLnNlbGVjdGVkLnB1c2goewogICAgICAgICAgICAgIG5hbWU6IGl0ZW0ubmFtZSwKICAgICAgICAgICAgICBmaWxlbmFtZTogaXRlbS5maWxlbmFtZSB8fCBpdGVtLm5hbWUsCiAgICAgICAgICAgICAgc2l6ZTogaXRlbS5zaXplCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhZGRlZCsrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIAogICAgICB1cGRhdGVUb3RhbHMoKTsKICAgICAgcmVuZGVyT3ZlcmxheSgpOwogICAgICByZW5kZXJMaXN0KHN0YXRlLml0ZW1zKTsKICAgICAgdG9hc3QoYEFkZGVkICR7YWRkZWR9IG1hdGNoZWQgZ2FtZXNgKTsKICAgICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgbW9kYWwuaW5uZXJIVE1MID0gJyc7CiAgICB9OwogICAgYnRuQ29udGFpbmVyLmFwcGVuZENoaWxkKGFkZEFsbEJ0bik7CiAgfQogIAogIGNvbnN0IGV4cG9ydE1hdGNoZWRCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICBleHBvcnRNYXRjaGVkQnRuLnRleHRDb250ZW50ID0gJ0V4cG9ydCBNYXRjaGVkJzsKICBleHBvcnRNYXRjaGVkQnRuLmNsYXNzTmFtZSA9ICdidG4gZ2hvc3QnOwogIGV4cG9ydE1hdGNoZWRCdG4ub25jbGljayA9ICgpID0+IHsKICAgIGNvbnN0IGNvbnRlbnQgPSBbLi4ucmVzdWx0cy5leGFjdCwgLi4ucmVzdWx0cy5oaWdoLCAuLi5yZXN1bHRzLm1lZGl1bSwgLi4ucmVzdWx0cy5sb3ddCiAgICAgIC5tYXAociA9PiByLm1hdGNoZWQpCiAgICAgIC5qb2luKCdcbicpOwogICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtjb250ZW50XSwgeyB0eXBlOiAndGV4dC9wbGFpbicgfSk7CiAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgYS5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgIGEuZG93bmxvYWQgPSBgbWF0Y2hlZF8ke0RhdGUubm93KCl9LnR4dGA7CiAgICBhLmNsaWNrKCk7CiAgICBVUkwucmV2b2tlT2JqZWN0VVJMKGEuaHJlZik7CiAgICB0b2FzdCgnRXhwb3J0ZWQgbWF0Y2hlZCBsaXN0Jyk7CiAgfTsKICBidG5Db250YWluZXIuYXBwZW5kQ2hpbGQoZXhwb3J0TWF0Y2hlZEJ0bik7CiAgCiAgaWYgKHJlc3VsdHMubm90Rm91bmQubGVuZ3RoID4gMCkgewogICAgY29uc3QgZXhwb3J0Tm90Rm91bmRCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgIGV4cG9ydE5vdEZvdW5kQnRuLnRleHRDb250ZW50ID0gJ0V4cG9ydCBOb3QgRm91bmQnOwogICAgZXhwb3J0Tm90Rm91bmRCdG4uY2xhc3NOYW1lID0gJ2J0biBnaG9zdCc7CiAgICBleHBvcnROb3RGb3VuZEJ0bi5zdHlsZS5iYWNrZ3JvdW5kID0gJyNmZWYyZjInOwogICAgZXhwb3J0Tm90Rm91bmRCdG4uc3R5bGUuY29sb3IgPSAnI2VmNDQ0NCc7CiAgICBleHBvcnROb3RGb3VuZEJ0bi5vbmNsaWNrID0gKCkgPT4gewogICAgICBjb25zdCBjb250ZW50ID0gcmVzdWx0cy5ub3RGb3VuZC5qb2luKCdcbicpOwogICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2NvbnRlbnRdLCB7IHR5cGU6ICd0ZXh0L3BsYWluJyB9KTsKICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgYS5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgYS5kb3dubG9hZCA9IGBub3RfZm91bmRfJHtEYXRlLm5vdygpfS50eHRgOwogICAgICBhLmNsaWNrKCk7CiAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwoYS5ocmVmKTsKICAgICAgdG9hc3QoJ0V4cG9ydGVkIG5vdCBmb3VuZCBsaXN0Jyk7CiAgICB9OwogICAgYnRuQ29udGFpbmVyLmFwcGVuZENoaWxkKGV4cG9ydE5vdEZvdW5kQnRuKTsKICB9CiAgCiAgY29uc3QgY2xvc2VCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICBjbG9zZUJ0bi50ZXh0Q29udGVudCA9ICdDbG9zZSc7CiAgY2xvc2VCdG4uY2xhc3NOYW1lID0gJ2J0biBnaG9zdCc7CiAgY2xvc2VCdG4ub25jbGljayA9ICgpID0+IHsKICAgIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBtb2RhbC5pbm5lckhUTUwgPSAnJzsKICB9OwogIGJ0bkNvbnRhaW5lci5hcHBlbmRDaGlsZChjbG9zZUJ0bik7CiAgCiAgbW9kYWwuYXBwZW5kQ2hpbGQoYnRuQ29udGFpbmVyKTsKfQoKaWYgKCFpc0xvY2FsKSB7CiAgY29uc3QgYWRtaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRtaW5FeHBvcnQnKTsKICBpZiAoYWRtaW4pIGFkbWluLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogIGNvbnN0IGJpbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaW5MaXN0Jyk7CiAgaWYgKGJpbikgYmluLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7Cn0KCmNvbnN0IHNlYXJjaElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaCcpOwoKaWYgKCFpc01vYmlsZSkgewogIGZ1bmN0aW9uIHJlZm9jdXNTZWFyY2goKSB7CiAgICBjb25zdCBhY3RpdmUgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50OwogICAgaWYgKAogICAgICBhY3RpdmUgJiYKICAgICAgKGFjdGl2ZS5pZCA9PT0gJ2N1c3RvbWVyJyB8fAogICAgICAgYWN0aXZlLnRhZ05hbWUgPT09ICdTRUxFQ1QnIHx8CiAgICAgICBhY3RpdmUudGFnTmFtZSA9PT0gJ1RFWFRBUkVBJykKICAgICkgcmV0dXJuOwogICAgc2VhcmNoSW5wdXQuZm9jdXMoKTsKICAgIHNlYXJjaElucHV0LnNlbGVjdCgpOwogIH0KCiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCByZWZvY3VzU2VhcmNoKTsKCiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgY29uc3QgbW9kYWxPcGVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVzTW9kYWwnKS5zdHlsZS5kaXNwbGF5ID09PSAnYmxvY2snOwogICAgY29uc3Qgb3ZlcmxheU9wZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3ZlcmxheScpLnN0eWxlLmRpc3BsYXkgPT09ICdmbGV4JzsKICAgIGlmICgKICAgICAgIW1vZGFsT3BlbiAmJgogICAgICAhb3ZlcmxheU9wZW4gJiYKICAgICAgZS50YXJnZXQuaWQgIT09ICdzZWFyY2gnICYmCiAgICAgIGUudGFyZ2V0LmlkICE9PSAnY3VzdG9tZXInICYmCiAgICAgICFlLnRhcmdldC5jbG9zZXN0KCdzZWxlY3QnKQogICAgKSB7CiAgICAgIHJlZm9jdXNTZWFyY2goKTsKICAgIH0KICB9KTsKCiAgWydjbGVhclNlYXJjaCcsICdzaG93U2VsZWN0ZWQnLCAnc2F2ZUJ0bicsICd1cGxvYWRCdG4nXS5mb3JFYWNoKGlkID0+IHsKICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKICAgIGlmIChidG4pIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHJlZm9jdXNTZWFyY2gpOwogIH0pOwoKICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdpdGVtJykpIHsKICAgICAgc2V0VGltZW91dChyZWZvY3VzU2VhcmNoLCAxMjApOwogICAgfQogIH0pOwoKICBbJ2Nsb3NlT3ZlcmxheSddLmZvckVhY2goaWQgPT4gewogICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgaWYgKGJ0bikgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gc2V0VGltZW91dChyZWZvY3VzU2VhcmNoLCAyMDApKTsKICB9KTsKCiAgc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldikgPT4gewogICAgaWYgKGV2LmtleSA9PT0gJ0VudGVyJykgewogICAgICBzZXRUaW1lb3V0KHJlZm9jdXNTZWFyY2gsIDE1MCk7CiAgICB9CiAgfSk7Cn0KCihhc3luYyBmdW5jdGlvbiBpbml0KCkgewogIGJ1aWxkRHluYW1pY0NvbnRyb2xzKCk7CiAgYXdhaXQgbG9hZFhNTCgpOwogIHVwZGF0ZVRvdGFscygpOwogIHVwZGF0ZUZpbGVuYW1lUHJldmlldygpOwp9KSgpOwo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+`;
    const decoded = atob(base64html);
    const iframe = document.getElementById('viewer');
    const doc = iframe.contentWindow.document;
    doc.open();
    doc.write(decoded);
    doc.close();
  </script>
</body>
</html>