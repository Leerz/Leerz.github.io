<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PremazingPH Games</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
    }
    iframe {
      width: 100vw; height: 100vh;
      border: none;
      display: block;
    }
  </style>
</head>
<body>
  <iframe id="viewer"></iframe>
  <script>
    const base64html = `PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLGluaXRpYWwtc2NhbGU9MSIgLz4KPHRpdGxlIGlkPSJwYWdlVGl0bGUiPkdhbWUgU2VsZWN0b3I8L3RpdGxlPgo8c3R5bGU+Cjpyb290ey0tYmc6I2Y0ZjZmODstLXBhbmVsOiNmZmY7LS1tdXRlZDojNmI3MjgwOy0tcHJpbWFyeTojMDM2NmQ2Oy0tYWNjZW50OiNmZjhhMDA7LS1kYW5nZXI6I2VmNDQ0NDstLXJhZGl1czoxMHB4fQoqe2JveC1zaXppbmc6Ym9yZGVyLWJveH0KaHRtbCxib2R5e2hlaWdodDoxMDAlO21hcmdpbjowO2ZvbnQtZmFtaWx5OkludGVyLFNlZ29lIFVJLEFyaWFsLHNhbnMtc2VyaWY7YmFja2dyb3VuZDp2YXIoLS1iZyk7Y29sb3I6IzExMX0KLmhlYWRlcntwb3NpdGlvbjpmaXhlZDt0b3A6MDtyaWdodDowO2xlZnQ6MDtoZWlnaHQ6NzZweDtiYWNrZ3JvdW5kOnZhcigtLXBhbmVsKTtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDoxMnB4O3BhZGRpbmc6MTBweCAxNHB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNlNmVlZjY7ei1pbmRleDo2MH0KLmhlYWRlciAuc2VhcmNoe2ZsZXg6MTttaW4td2lkdGg6MTYwcHh9Ci5oZWFkZXIgaW5wdXQuc2VhcmNoLCAuaGVhZGVyIGJ1dHRvbntoZWlnaHQ6NDRweDtib3JkZXItcmFkaXVzOjEwcHg7Ym9yZGVyOjFweCBzb2xpZCAjZTZlZWY2O3BhZGRpbmc6MCAxMnB4fQouaGVhZGVyIC5hY3Rpb25ze2Rpc3BsYXk6ZmxleDtnYXA6OHB4O2FsaWduLWl0ZW1zOmNlbnRlcn0KLmhlYWRlciAudXBsb2Fke2JhY2tncm91bmQ6dmFyKC0tYWNjZW50KTtjb2xvcjojZmZmO2JvcmRlcjpub25lO3BhZGRpbmc6MTBweCAxNnB4O2JvcmRlci1yYWRpdXM6MTBweDtmb250LXdlaWdodDo2MDB9Ci5jb250YWluZXJ7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczoxZnIgMzgwcHg7Z2FwOjEycHg7cGFkZGluZzpjYWxjKDc2cHggKyAxMnB4KSAxMnB4IDE2cHg7aGVpZ2h0OmNhbGMoMTAwdmgpfQoubGVmdFBhbmV7YmFja2dyb3VuZDp2YXIoLS1wYW5lbCk7Ym9yZGVyLXJhZGl1czoxMnB4O3BhZGRpbmc6MTJweDtvdmVyZmxvdzphdXRvO2JveC1zaGFkb3c6MCA2cHggMThweCByZ2JhKDEyLDE4LDMwLDAuMDQpfQoucmlnaHRQYW5le2JhY2tncm91bmQ6dmFyKC0tcGFuZWwpO2JvcmRlci1yYWRpdXM6MTJweDtwYWRkaW5nOjEycHg7b3ZlcmZsb3c6aGlkZGVuO2JveC1zaGFkb3c6MCA2cHggMThweCByZ2JhKDEyLDE4LDMwLDAuMDQpO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW59Ci5pdGVte2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpjZW50ZXI7cGFkZGluZzoxMHB4O2JvcmRlci1yYWRpdXM6OHB4O2JvcmRlcjoxcHggc29saWQgdHJhbnNwYXJlbnQ7Y3Vyc29yOnBvaW50ZXI7bWFyZ2luLWJvdHRvbTo4cHh9Ci5pdGVtOmhvdmVye2JhY2tncm91bmQ6I2ZiZmRmZn0KLml0ZW0uc2VsZWN0ZWR7YmFja2dyb3VuZDojMGIzYjY2O2NvbG9yOiNmZmZ9Ci5tZXRhe2ZvbnQtc2l6ZToxMnB4O2NvbG9yOnZhcigtLW11dGVkKX0KLmNvbnRyb2xze2Rpc3BsYXk6Z3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6MWZyIDFmcjtnYXA6OHB4O21hcmdpbi1ib3R0b206OHB4fQouY29udHJvbHMgLmZ1bGx7Z3JpZC1jb2x1bW46MSAvIC0xfQouZmlsZW5hbWUtcHJldmlld3tncmlkLWNvbHVtbjoxIC8gLTE7cGFkZGluZzo4cHg7YmFja2dyb3VuZDojZjlmYWZiO2JvcmRlcjoxcHggc29saWQgI2U1ZTdlYjtib3JkZXItcmFkaXVzOjhweDtmb250LWZhbWlseTptb25vc3BhY2U7b3ZlcmZsb3cteDphdXRvO3doaXRlLXNwYWNlOm5vd3JhcH0KLmluZm9Sb3d7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcjtwYWRkaW5nOjEwcHg7Ym9yZGVyLXJhZGl1czo4cHg7YmFja2dyb3VuZDojZmZmO21hcmdpbi10b3A6OHB4O2JvcmRlcjoxcHggc29saWQgI2YxZjVmOX0KLmJ0bntwYWRkaW5nOjhweCAxMnB4O2JvcmRlci1yYWRpdXM6OHB4O2JvcmRlcjpub25lO2JhY2tncm91bmQ6dmFyKC0tcHJpbWFyeSk7Y29sb3I6I2ZmZjtjdXJzb3I6cG9pbnRlcn0KLmJ0bi5naG9zdHtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O2NvbG9yOnZhcigtLXByaW1hcnkpO2JvcmRlcjoxcHggc29saWQgI2U2ZWVmNn0KLnNtYWxse2ZvbnQtc2l6ZToxM3B4O2NvbG9yOnZhcigtLW11dGVkKX0KLm92ZXJsYXl7cG9zaXRpb246Zml4ZWQ7aW5zZXQ6MDtiYWNrZ3JvdW5kOnJnYmEoMjE1LDI0MCwyNTAsLjk1KTtkaXNwbGF5Om5vbmU7ZmxleC1kaXJlY3Rpb246Y29sdW1uO3otaW5kZXg6MTUwfQoub3ZlcmxheSAuaGVhZHtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47cGFkZGluZzoxMnB4O2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjU1KTthbGlnbi1pdGVtczpjZW50ZXJ9Ci5vdmVybGF5IC5ib2R5e3BhZGRpbmc6MTJweDtvdmVyZmxvdzphdXRvO2ZsZXg6MX0KLm92ZXJsYXkgLnJvd3tkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO3BhZGRpbmc6OHB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4wNil9Ci5vdmVybGF5IC5yb3cuaGlnaGxpZ2h0IHtiYWNrZ3JvdW5kOiAjZmZmM2NkO3RyYW5zaXRpb246IGJhY2tncm91bmQgMC42cyBlYXNlO30KI2ZpbGVzTW9kYWw6OmJhY2tkcm9wIHtiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMyk7fQojdG90YWxzLmV4Y2VlZGVkIHtjb2xvcjogI2MwMDtmb250LXdlaWdodDogYm9sZDt9Ci5idG4uZGFuZ2VyIHtiYWNrZ3JvdW5kOiAjYzAwO2NvbG9yOiAjZmZmO30KLm92ZXJsYXkgYnV0dG9uLmljb257cGFkZGluZzo2cHggOHB4O2JvcmRlci1yYWRpdXM6NnB4O2JvcmRlcjpub25lO2N1cnNvcjpwb2ludGVyO21hcmdpbi1sZWZ0OjZweH0KLm92ZXJsYXkgYnV0dG9uLnVwLCAub3ZlcmxheSBidXR0b24uZG93bntiYWNrZ3JvdW5kOiNmZmY7Y29sb3I6IzExMX0KLm92ZXJsYXkgYnV0dG9uLnJlbW92ZXtiYWNrZ3JvdW5kOnZhcigtLWRhbmdlcik7Y29sb3I6I2ZmZn0KLmZvb3RlckNvbnRyb2xze2Rpc3BsYXk6ZmxleDtnYXA6OHB4O2ZsZXgtd3JhcDp3cmFwO2FsaWduLWl0ZW1zOmNlbnRlcn0KQG1lZGlhIChtYXgtd2lkdGg6OTAwcHgpewogIC5jb250YWluZXJ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjFmcjsgcGFkZGluZy10b3A6Y2FsYyg3NnB4ICsgOHB4KX0KICAucmlnaHRQYW5le29yZGVyOi0xfQogIC5oZWFkZXJ7cGFkZGluZzo4cHh9Cn0KLnNlbGVjdGVkLXBhbmVsIHttYXJnaW4tdG9wOiAxMnB4O2JhY2tncm91bmQ6IHZhcigtLXBhbmVsKTtib3JkZXI6IDFweCBzb2xpZCAjZTZlZWY2O2JvcmRlci1yYWRpdXM6IDEwcHg7Ym94LXNoYWRvdzogMCA0cHggMTJweCByZ2JhKDAsMCwwLDAuMDUpO2Rpc3BsYXk6IGZsZXg7ZmxleC1kaXJlY3Rpb246IGNvbHVtbjtoZWlnaHQ6IDEwMCU7b3ZlcmZsb3c6IGhpZGRlbjt9Ci5zZWxlY3RlZC1wYW5lbCAuaGVhZCB7YmFja2dyb3VuZDogI2Y4ZmFmYztwYWRkaW5nOiA4cHggMTJweDtib3JkZXItYm90dG9tOiAxcHggc29saWQgI2U2ZWVmNjtmb250LXdlaWdodDogNjAwO2ZvbnQtc2l6ZTogMTRweDt9Ci5zZWxlY3RlZC1wYW5lbCAuYm9keSB7ZmxleDogMTtvdmVyZmxvdy15OiBhdXRvO2ZvbnQtc2l6ZTogMTNweDtwYWRkaW5nOiA4cHggMTJweDt9CkBtZWRpYSAobWF4LXdpZHRoOiA5MDBweCkgey5zZWxlY3RlZC1wYW5lbCB7ZGlzcGxheTogbm9uZSAhaW1wb3J0YW50O319Ci5jb25maWctc2VjdGlvbiB7dHJhbnNpdGlvbjogYWxsIDAuMjVzIGVhc2U7fQoubW9iaWxlLW9ubHkge2Rpc3BsYXk6IG5vbmU7fQpAbWVkaWEgKG1heC13aWR0aDogOTAwcHgpIHsKICAubW9iaWxlLW9ubHkge2Rpc3BsYXk6IGJsb2NrO30KICAuY29uZmlnLXNlY3Rpb24ge2Rpc3BsYXk6IG5vbmU7fQogIC5jb25maWctc2VjdGlvbi5hY3RpdmUge2Rpc3BsYXk6IGJsb2NrO30KfQo8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogIDxkaXYgY2xhc3M9ImhlYWRlciI+Cgk8aW5wdXQgaWQ9InNlYXJjaCIgY2xhc3M9InNlYXJjaCIgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9IlNlYXJjaCBnYW1lcy4uLiI+CgkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CiAgICAgIDxidXR0b24gaWQ9InVwbG9hZEJ0biIgY2xhc3M9ImJ0biBnaG9zdCI+VXBsb2FkPC9idXR0b24+CiAgICAgIDxidXR0b24gaWQ9InNob3dTZWxlY3RlZCIgY2xhc3M9ImJ0biBnaG9zdCI+U2hvdzwvYnV0dG9uPgoJICA8YnV0dG9uIGlkPSJzb3J0TGF0ZXN0IiBjbGFzcz0iYnRuIGdob3N0Ij5Tb3J0PC9idXR0b24+CiAgICAgIDxidXR0b24gaWQ9ImNsZWFyU2VhcmNoIiBjbGFzcz0iYnRuIGdob3N0Ij5+PC9idXR0b24+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCiAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgIDxzZWN0aW9uIGNsYXNzPSJsZWZ0UGFuZSIgaWQ9ImxlZnRQYW5lIiBhcmlhLWxhYmVsPSJHYW1lIGxpc3QiPjwvc2VjdGlvbj4KCiAgICA8YXNpZGUgY2xhc3M9InJpZ2h0UGFuZSI+CjxidXR0b24gaWQ9InRvZ2dsZUNvbmZpZyIgY2xhc3M9ImJ0biBnaG9zdCBtb2JpbGUtb25seSIgc3R5bGU9Im1hcmdpbi1ib3R0b206OHB4OyI+SGlkZSBDb25maWd1cmF0aW9uPC9idXR0b24+Cgo8ZGl2IGlkPSJjb25maWdTZWN0aW9uIiBjbGFzcz0iY29uZmlnLXNlY3Rpb24iPgogICAgICA8ZGl2IGNsYXNzPSJjb250cm9scyI+CiAgICAgICAgPGlucHV0IGlkPSJjdXN0b21lciIgY2xhc3M9ImZ1bGwiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJDdXN0b21lciBuYW1lICh1c2UgdW5kZXJzY29yZXMpIj4KICAgICAgICA8ZGl2IGNsYXNzPSJmaWxlbmFtZS1wcmV2aWV3IiBpZD0iZmlsZW5hbWVQcmV2aWV3Ij5GaWxlbmFtZSBwcmV2aWV3IHdpbGwgYXBwZWFyIGhlcmXigKY8L2Rpdj4KCQk8ZGl2IGlkPSJkeW5hbWljQ29udHJvbHMiPjwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9ImluZm9Sb3ciIHN0eWxlPSJtYXJnaW4tdG9wOjhweDsiPgogICAgICAgIDxkaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJzbWFsbCI+U3BhY2UgZm9yIGdhbWVzPC9kaXY+CiAgICAgICAgICA8ZGl2PjxzdHJvbmcgaWQ9InNwYWNlIj4wPC9zdHJvbmc+IEdCPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9InNtYWxsIj5TZWxlY3RlZCBzaXplPC9kaXY+CiAgICAgICAgICA8ZGl2PjxzdHJvbmcgaWQ9InNlbGVjdGVkU2l6ZSI+MC4wMDwvc3Ryb25nPiBHQjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9ImluZm9Sb3ciIHN0eWxlPSJtYXJnaW4tdG9wOjhweDsiPgogICAgICAgIDxkaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJzbWFsbCI+SW5zdGFsbCBlc3RpbWF0ZTwvZGl2PgogICAgICAgICAgPGRpdj48c3BhbiBpZD0iaW5zdGFsbEVzdGltYXRlIj4waCAwbTwvc3Bhbj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ic21hbGwiPlNlbGVjdGVkPC9kaXY+CiAgICAgICAgICA8ZGl2PjxzcGFuIGlkPSJjb3VudCI+MDwvc3Bhbj4gZ2FtZXM8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogIDwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjEycHg7ZGlzcGxheTpmbGV4O2dhcDo4cHg7YWxpZ24taXRlbXM6Y2VudGVyOyI+CgkJPGlucHV0IGlkPSJzaGFyZWFibGUiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJVcGxvYWRlZCBmaWxlIGxpbmsiIHN0eWxlPSJmbGV4OjE7cGFkZGluZzo4cHg7Ym9yZGVyLXJhZGl1czo4cHg7Ym9yZGVyOjFweCBzb2xpZCAjZTZlZWY2IiByZWFkb25seT4KCQk8YnV0dG9uIGlkPSJjb3B5TGluayIgY2xhc3M9ImJ0biI+Q29weSBMaXN0ICYgTGluazwvYnV0dG9uPgogICAgICAgIDxidXR0b24gaWQ9InNhdmVCdG4iIGNsYXNzPSJidG4iPlNhdmU8L2J1dHRvbj4KCQk8bGFiZWwgZm9yPSJmaWxlSW4iIHN0eWxlPSJiYWNrZ3JvdW5kOiMzYTZkZjA7Y29sb3I6I2ZmZjtwYWRkaW5nOjVweCA1cHg7Ym9yZGVyLXJhZGl1czozcHg7Zm9udC1zaXplOjEycHg7Y3Vyc29yOnBvaW50ZXI7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZjtkaXNwbGF5OmlubGluZS1ibG9jazsiPk9wZW48L2xhYmVsPgo8aW5wdXQgaWQ9ImZpbGVJbiIgdHlwZT0iZmlsZSIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6MTJweDtkaXNwbGF5OmZsZXg7Z2FwOjhweDthbGlnbi1pdGVtczpjZW50ZXI7ZmxleC13cmFwOndyYXAiPgogICAgICAgIDxidXR0b24gaWQ9ImFkbWluRXhwb3J0IiBjbGFzcz0iYnRuIGdob3N0Ij5FeHBvcnQgQWRtaW48L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGlkPSJtYXRjaExpc3QiIGNsYXNzPSJidG4gZ2hvc3QiPk1hdGNoIExpc3Q8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGlkPSJiaW5MaXN0IiBjbGFzcz0iYnRuIGdob3N0Ij5VcGxvYWRzPC9idXR0b24+CgkJPGRpdiBpZD0iZmlsZUxpc3RDb250YWluZXIiIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij4KCQkgIDxkaXYgaWQ9ImJpbkZpbGVMaXN0Ij48L2Rpdj4KCQk8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjEycHg7ZmxleDoxO292ZXJmbG93OmF1dG87Zm9udC1zaXplOjEzcHg7Y29sb3I6dmFyKC0tbXV0ZWQpIj4KICAgICAgICA8ZGl2IGlkPSJzdGF0dXMiPlJlYWR5PC9kaXY+CiAgICAgIDwvZGl2Pgo8ZGl2IGlkPSJzZWxlY3RlZFBhbmVsIiBjbGFzcz0ic2VsZWN0ZWQtcGFuZWwiPgogIDxkaXYgY2xhc3M9ImJvZHkiIGlkPSJzZWxlY3RlZFBhbmVsQm9keSI+PC9kaXY+CjwvZGl2PgogICAgPC9hc2lkZT4KICA8L2Rpdj4KCiAgPGRpdiBjbGFzcz0ib3ZlcmxheSIgaWQ9Im92ZXJsYXkiPgogICAgPGRpdiBjbGFzcz0iaGVhZCI+PGRpdj48c3Ryb25nPlNlbGVjdGVkIFRpdGxlczwvc3Ryb25nPiDigJMgPHNwYW4gaWQ9Im92ZXJsYXlDb3VudCI+MDwvc3Bhbj48L2Rpdj48ZGl2PjxidXR0b24gaWQ9ImNsb3NlT3ZlcmxheSIgY2xhc3M9ImJ0biBnaG9zdCI+Q2xvc2U8L2J1dHRvbj48L2Rpdj48L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImJvZHkiIGlkPSJvdmVybGF5Qm9keSI+PC9kaXY+CiAgPC9kaXY+CjxkaXYgaWQ9ImZpbGVzTW9kYWwiIHN0eWxlPSJkaXNwbGF5Om5vbmU7cG9zaXRpb246Zml4ZWQ7dG9wOjUwJTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlKC01MCUsLTUwJSk7CiAgYmFja2dyb3VuZDojZmZmO3BhZGRpbmc6MTZweDtib3JkZXItcmFkaXVzOjEwcHg7Ym94LXNoYWRvdzowIDZweCAxOHB4IHJnYmEoMCwwLDAsMC4yNSk7ei1pbmRleDoyMDA7CiAgbWF4LXdpZHRoOjQyMHB4O3dpZHRoOjkwJTttYXgtaGVpZ2h0Ojcwdmg7b3ZlcmZsb3c6YXV0bztmb250LXNpemU6MTNweCI+CjwvZGl2Pgo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgc3JjPSJjZmcuanMiPjwvc2NyaXB0Pgo8c2NyaXB0PgovLyA9PT09PT09PT09PT09PT09PT09PSBDT05GSUdVUkFUSU9OIEJMT0NLID09PT09PT09PT09PT09PT09PT09CgovLyA9PT09PT09PT09PT09PT09PT09PSBFTkQgQ09ORklHVVJBVElPTiA9PT09PT09PT09PT09PT09PT09PQoKY29uc3Qgc3RhdGUgPSB7IGl0ZW1zOiBbXSwgc2VsZWN0ZWQ6IFtdLCB4bWw6IG51bGwsIGxhc3RVcGxvYWQ6MCB9Owpjb25zdCBsZWZ0UGFuZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZWZ0UGFuZScpOwpjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ292ZXJsYXknKTsKY29uc3Qgb3ZlcmxheUJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3ZlcmxheUJvZHknKTsKY29uc3QgaXNNb2JpbGUgPSAvTW9iaXxBbmRyb2lkfGlQaG9uZXxpUGFkfGlQb2QvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOwpjb25zdCBpc0xvY2FsID0gZmFsc2U7Cgpjb25zdCBNSU5fREVMQVkgPSAxMDAwOwpsZXQgbm93ID0gRGF0ZS5ub3coKTsKbGV0IGxhc3RFeHBvcnRUaW1lID0gRGF0ZS5ub3coKTsKCmNvbnN0ICQgPSBpZD0+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwpmdW5jdGlvbiBlc2Mocyl7IHJldHVybiAoc3x8JycpLnJlcGxhY2UoLyYvZywnJmFtcDsnKS5yZXBsYWNlKC88L2csJyZsdDsnKS5yZXBsYWNlKC8+L2csJyZndDsnKS5yZXBsYWNlKC8nL2csJyYjMzk7JykucmVwbGFjZSgvIi9nLCcmcXVvdDsnKTsgfQpmdW5jdGlvbiB0b2FzdChtc2cpeyAkKCdzdGF0dXMnKS50ZXh0Q29udGVudCA9IG1zZzsgc2V0VGltZW91dCgoKT0+eyBpZigkKCdzdGF0dXMnKS50ZXh0Q29udGVudCA9PT0gbXNnKSAkKCdzdGF0dXMnKS50ZXh0Q29udGVudCA9ICdSZWFkeSc7IH0sIDI1MDApOyB9CgpmdW5jdGlvbiBwYXJzZVNpemVUZXh0KHMpeyBpZighcykgcmV0dXJuIDA7IGNvbnN0IG0gPSAoJycrcykubWF0Y2goLyhbXGRcLl0rKVxzKihHaUJ8TWlCfEtpQnxHQnxNQnxLQnxCKS9pKTsgaWYoIW0pIHJldHVybiAwOyBjb25zdCB2PXBhcnNlRmxvYXQobVsxXSk7IGNvbnN0IHU9bVsyXS50b1VwcGVyQ2FzZSgpOyBpZih1PT09J0InKSByZXR1cm4gdjsgaWYodT09PSdLQid8fHU9PT0nS0lCJykgcmV0dXJuIHYqMTAyNDsgaWYodT09PSdNQid8fHU9PT0nTUlCJykgcmV0dXJuIHYqMTAyNCoxMDI0OyByZXR1cm4gdioxMDI0KjEwMjQqMTAyNDsgfQpmdW5jdGlvbiBieXRlc1RvR0IoYil7IHJldHVybiBiLygxMDI0KjEwMjQqMTAyNCk7IH0KCmZ1bmN0aW9uIGJ1aWxkRHluYW1pY0NvbnRyb2xzKCkgewogIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkeW5hbWljQ29udHJvbHMnKTsKICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7CiAgY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnZ3JpZCc7CiAgY29udGFpbmVyLnN0eWxlLmdyaWRUZW1wbGF0ZUNvbHVtbnMgPSAnMWZyIDFmcic7CiAgY29udGFpbmVyLnN0eWxlLmdhcCA9ICc4cHgnOwogIAogIENPTkZJRy5zdG9yYWdlQ29udHJvbHMuZm9yRWFjaChjdHJsID0+IHsKICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgY29uc3QgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpOwogICAgbGFiZWwuY2xhc3NOYW1lID0gJ3NtYWxsJzsKICAgIGxhYmVsLnRleHRDb250ZW50ID0gY3RybC5sYWJlbDsKICAgIGRpdi5hcHBlbmRDaGlsZChsYWJlbCk7CiAgICBpZiAoY3RybC50eXBlID09PSAnc2VsZWN0JykgewogICAgICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWxlY3QnKTsKICAgICAgc2VsZWN0LmlkID0gY3RybC5pZDsKICAgICAgc2VsZWN0LnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGN0cmwubGFiZWwpOwogICAgICBjdHJsLm9wdGlvbnMuZm9yRWFjaChvcHQgPT4gewogICAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwogICAgICAgIG9wdGlvbi52YWx1ZSA9IG9wdC52YWx1ZTsKICAgICAgICBvcHRpb24udGV4dENvbnRlbnQgPSBvcHQubGFiZWw7CiAgICAgICAgaWYgKG9wdC52YWx1ZSA9PT0gY3RybC5kZWZhdWx0KSBvcHRpb24uc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgIHNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb24pOwogICAgICB9KTsKICAgICAgZGl2LmFwcGVuZENoaWxkKHNlbGVjdCk7CiAgICAgIHNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHVwZGF0ZUZpbGVuYW1lUHJldmlldygpKTsKICAgICAgc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHVwZGF0ZVRvdGFscygpKTsKICAgIH0KICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOwogIH0pOwp9Cgphc3luYyBmdW5jdGlvbiBsb2FkWE1MKCl7CiAgdHJ5ewogICAgY29uc3QgdHh0ID0gYXdhaXQgZmV0Y2goQ09ORklHLnhtbEZpbGUpLnRoZW4ocj0+ci50ZXh0KCkpOwogICAgY29uc3QgeG1sID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyh0eHQsJ2FwcGxpY2F0aW9uL3htbCcpOwogICAgc3RhdGUueG1sID0geG1sOwogICAgCiAgICBjb25zdCByb290ID0geG1sLmRvY3VtZW50RWxlbWVudDsKICAgIENPTkZJRy5wbGF0Zm9ybSA9IHJvb3QuZ2V0QXR0cmlidXRlKCdwbGF0Zm9ybScpIHx8ICdVbmtub3duJzsKICAgIENPTkZJRy5zdHJ1Y3R1cmVUeXBlID0gcm9vdC5nZXRBdHRyaWJ1dGUoJ3N0cnVjdHVyZVR5cGUnKSB8fCAnZm9sZGVycyc7CiAgICAKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdlVGl0bGUnKS50ZXh0Q29udGVudCA9IGAke0NPTkZJRy5wbGF0Zm9ybX0gR2FtZXNgOwogICAgCiAgICBsZXQgaXRlbXMgPSBbXTsKICAgIAogICAgaWYgKENPTkZJRy5zdHJ1Y3R1cmVUeXBlID09PSAnZm9sZGVycycpIHsKICAgICAgaXRlbXMgPSBBcnJheS5mcm9tKHhtbC5xdWVyeVNlbGVjdG9yQWxsKCdmb2xkZXInKSkKICAgICAgICAubWFwKGYgPT4gKHsKICAgICAgICAgIG5hbWU6IGYuZ2V0QXR0cmlidXRlKCduYW1lJyksCiAgICAgICAgICBzY29yZTogZi5nZXRBdHRyaWJ1dGUoJ3Njb3JlJykgfHwgJzAnLAogICAgICAgICAgc2l6ZTogZi5nZXRBdHRyaWJ1dGUoJ3NpemUnKSB8fCAnMCBHaUInLAogICAgICAgICAgZGF0ZTogZi5nZXRBdHRyaWJ1dGUoJ2RhdGVDcmVhdGVkJykgfHwgJycsCiAgICAgICAgICBmaWxlQ291bnQ6IGYuZ2V0QXR0cmlidXRlKCdmaWxlQ291bnQnKSB8fCAnMCcsCiAgICAgICAgICBmaWxlczogQXJyYXkuZnJvbShmLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ZpbGUnKSkubWFwKHggPT4geC5nZXRBdHRyaWJ1dGUoJ25hbWUnKSkKICAgICAgICB9KSk7CiAgICB9IGVsc2UgewogICAgICBpdGVtcyA9IEFycmF5LmZyb20oeG1sLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ZpbGUnKSkKICAgICAgICAubWFwKGYgPT4gKHsKICAgICAgICAgIG5hbWU6IGYuZ2V0QXR0cmlidXRlKCduYW1lJyksCiAgICAgICAgICBmaWxlbmFtZTogZi5nZXRBdHRyaWJ1dGUoJ2ZpbGVuYW1lJykgfHwgZi5nZXRBdHRyaWJ1dGUoJ25hbWUnKSwKICAgICAgICAgIHNpemU6IGYuZ2V0QXR0cmlidXRlKCdzaXplJykgfHwgJzAgR2lCJywKICAgICAgICAgIGRhdGU6IGYuZ2V0QXR0cmlidXRlKCdkYXRlQ3JlYXRlZCcpIHx8ICcnCiAgICAgICAgfSkpOwogICAgfQogICAgCiAgICBzdGF0ZS5pdGVtcyA9IGl0ZW1zOwogICAgcmVuZGVyTGlzdChpdGVtcyk7CiAgICB0b2FzdChgTG9hZGVkICR7aXRlbXMubGVuZ3RofSAke0NPTkZJRy5wbGF0Zm9ybX0gZ2FtZXNgKTsKICB9Y2F0Y2goZSl7IAogICAgY29uc29sZS5lcnJvcihlKTsgCiAgICBsZWZ0UGFuZS5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0iY29sb3I6I2I5MWMxYztwYWRkaW5nOjEycHgiPkZhaWxlZCB0byBsb2FkICR7Q09ORklHLnhtbEZpbGV9PC9kaXY+YDsgCiAgfQp9CgpmdW5jdGlvbiByZW5kZXJMaXN0KGxpc3QpeyAKICBsZWZ0UGFuZS5pbm5lckhUTUwgPSAnJzsgCiAgaWYoIWxpc3R8fCFsaXN0Lmxlbmd0aCl7IAogICAgbGVmdFBhbmUuaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9Im1ldGEiPk5vIGl0ZW1zIGZvdW5kPC9kaXY+JzsgCiAgICByZXR1cm47IAogIH0KICAKICBsaXN0LmZvckVhY2goaXRlbT0+ewogICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7IAogICAgcm93LmNsYXNzTmFtZT0naXRlbSc7IAogICAgcm93LmRhdGFzZXQubmFtZSA9IGl0ZW0ubmFtZTsgCiAgICByb3cuZGF0YXNldC5zaXplID0gaXRlbS5zaXplOwogICAgaWYgKGl0ZW0uZmlsZW5hbWUpIHJvdy5kYXRhc2V0LmZpbGVuYW1lID0gaXRlbS5maWxlbmFtZTsKICAgIAogICAgY29uc3QgbWV0YUluZm8gPSBpdGVtLmZpbGVDb3VudCA/IGBGaWxlczogJHtpdGVtLmZpbGVDb3VudH1gIDogJyc7CiAgICBjb25zdCBzY29yZUluZm8gPSBpdGVtLnNjb3JlID8gYFNjb3JlOiAke2VzYyhpdGVtLnNjb3JlKX1gIDogJyc7CiAgICBjb25zdCBkYXRlSW5mbyA9IGl0ZW0uZGF0ZSA/IGBNb2RpZmllZDogJHtlc2MoaXRlbS5kYXRlKX1gIDogJyc7CiAgICBjb25zdCBtZXRhUGFydHMgPSBbbWV0YUluZm8sIHNjb3JlSW5mbywgZGF0ZUluZm9dLmZpbHRlcihCb29sZWFuKS5qb2luKCcgOyAnKTsKICAgIAogICAgY29uc3QgaGFzRmlsZXMgPSBDT05GSUcuc3RydWN0dXJlVHlwZSA9PT0gJ2ZvbGRlcnMnICYmIGl0ZW0uZmlsZXMgJiYgaXRlbS5maWxlcy5sZW5ndGggPiAwOwogICAgCiAgICByb3cuaW5uZXJIVE1MID0gYAogICAgICA8ZGl2PgogICAgICAgICR7aGFzRmlsZXMgPyBgPGJ1dHRvbiBjbGFzcz0iYnRuIGdob3N0IGZpbGUtYnRuIiBzdHlsZT0icGFkZGluZzoycHggNnB4O2ZvbnQtc2l6ZToxMXB4Ij4/PC9idXR0b24+YCA6ICcnfQogICAgICAgIDxzdHJvbmc+JHtlc2MoaXRlbS5uYW1lKX08L3N0cm9uZz4KICAgICAgICA8ZGl2IGNsYXNzPSdtZXRhJz4ke21ldGFQYXJ0c308L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9J21ldGEnPiR7ZXNjKGl0ZW0uc2l6ZSl9PC9kaXY+CiAgICBgOwoKICAgIGlmKHN0YXRlLnNlbGVjdGVkLnNvbWUocz0+cy5uYW1lPT09aXRlbS5uYW1lKSkgcm93LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7CiAgICAKICAgIGlmIChoYXNGaWxlcykgewogICAgICBjb25zdCBmaWxlQnRuID0gcm93LnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWJ0bicpOwogICAgICBpZiAoZmlsZUJ0bikgewogICAgICAgIGZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXYpPT57CiAgICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIHNob3dGaWxlcyhpdGVtLm5hbWUsIGl0ZW0uZmlsZXMgfHwgW10sIGl0ZW0uc2l6ZSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcm93LmFkZEV2ZW50TGlzdGVuZXIoJ2RibGNsaWNrJywgKCk9PiBzaG93RmlsZXMoaXRlbS5uYW1lLCBpdGVtLmZpbGVzfHxbXSwgaXRlbS5zaXplKSk7CiAgICB9CiAgICAKICAgIHJvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldik9PnsKICAgICAgaWYoZXYuYWx0S2V5ICYmIGhhc0ZpbGVzKXsgCiAgICAgICAgc2hvd0ZpbGVzKGl0ZW0ubmFtZSwgaXRlbS5maWxlcyB8fCBbXSwgaXRlbS5zaXplKTsgCiAgICAgICAgcmV0dXJuOyAKICAgICAgfSAKICAgICAgdG9nZ2xlU2VsZWN0KGl0ZW0sIHJvdyk7IAogICAgfSk7CiAgICAKICAgIGxlZnRQYW5lLmFwcGVuZENoaWxkKHJvdyk7CiAgfSk7Cn0KCmZ1bmN0aW9uIHRvZ2dsZVNlbGVjdChpdGVtLCByb3dFbCl7IAogIGNvbnN0IGlkeCA9IHN0YXRlLnNlbGVjdGVkLmZpbmRJbmRleChzPT5zLm5hbWU9PT1pdGVtLm5hbWUpOyAKICBpZihpZHg+PTApeyAKICAgIHN0YXRlLnNlbGVjdGVkLnNwbGljZShpZHgsMSk7IAogICAgaWYocm93RWwpIHJvd0VsLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7IAogIH0gZWxzZSB7IAogICAgc3RhdGUuc2VsZWN0ZWQucHVzaCh7IAogICAgICBuYW1lOml0ZW0ubmFtZSwgCiAgICAgIGZpbGVuYW1lOiBpdGVtLmZpbGVuYW1lIHx8IGl0ZW0ubmFtZSwKICAgICAgc2l6ZTppdGVtLnNpemUgCiAgICB9KTsgCiAgICBpZihyb3dFbCkgcm93RWwuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTsgCiAgfQogIHVwZGF0ZVRvdGFscygpOyAKICByZW5kZXJPdmVybGF5KCk7IAp9CgpmdW5jdGlvbiByZW5kZXJPdmVybGF5KCkgewogIG92ZXJsYXlCb2R5LmlubmVySFRNTCA9ICcnOwogIHN0YXRlLnNlbGVjdGVkLmZvckVhY2goKHMsaSk9PnsKICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgcm93LmNsYXNzTmFtZT0ncm93JzsKICAgIHJvdy5pbm5lckhUTUwgPSBgCiAgICAgIDxkaXY+CiAgICAgICAgPHN0cm9uZz4ke2krMX0uICR7ZXNjKHMubmFtZSl9PC9zdHJvbmc+CiAgICAgICAgPGRpdiBjbGFzcz0nbWV0YSc+JHtlc2Mocy5zaXplKX08L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXY+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0naWNvbiB1cCc+dTwvYnV0dG9uPgogICAgICAgIDxidXR0b24gY2xhc3M9J2ljb24gZG93bic+ZDwvYnV0dG9uPgogICAgICAgIDxidXR0b24gY2xhc3M9J2ljb24gcmVtb3ZlJz54PC9idXR0b24+CiAgICAgIDwvZGl2PmA7CgogICAgcm93LnF1ZXJ5U2VsZWN0b3IoJy51cCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PnsKICAgICAgaWYoaT4wKXsKICAgICAgICBbc3RhdGUuc2VsZWN0ZWRbaS0xXSwgc3RhdGUuc2VsZWN0ZWRbaV1dID0gW3N0YXRlLnNlbGVjdGVkW2ldLCBzdGF0ZS5zZWxlY3RlZFtpLTFdXTsKICAgICAgICByZW5kZXJPdmVybGF5KCk7CiAgICAgICAgcmVuZGVyTGlzdChzdGF0ZS5pdGVtcyk7CiAgICAgICAgdXBkYXRlVG90YWxzKCk7CiAgICAgICAgb3ZlcmxheUJvZHkuY2hpbGRyZW5baS0xXS5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQnKTsKICAgICAgfQogICAgfSk7CgogICAgcm93LnF1ZXJ5U2VsZWN0b3IoJy5kb3duJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+ewogICAgICBpZihpPHN0YXRlLnNlbGVjdGVkLmxlbmd0aC0xKXsKICAgICAgICBbc3RhdGUuc2VsZWN0ZWRbaSsxXSwgc3RhdGUuc2VsZWN0ZWRbaV1dID0gW3N0YXRlLnNlbGVjdGVkW2ldLCBzdGF0ZS5zZWxlY3RlZFtpKzFdXTsKICAgICAgICByZW5kZXJPdmVybGF5KCk7CiAgICAgICAgcmVuZGVyTGlzdChzdGF0ZS5pdGVtcyk7CiAgICAgICAgdXBkYXRlVG90YWxzKCk7CiAgICAgICAgb3ZlcmxheUJvZHkuY2hpbGRyZW5baSsxXS5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQnKTsKICAgICAgfQogICAgfSk7CgogICAgcm93LnF1ZXJ5U2VsZWN0b3IoJy5yZW1vdmUnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT57CiAgICAgIGNvbnN0IHJlbW92ZWQgPSBzdGF0ZS5zZWxlY3RlZC5zcGxpY2UoaSwxKVswXTsKICAgICAgY29uc3QgbGVmdFJvdyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLml0ZW0nKSkKICAgICAgICAuZmluZCh4PT54LmRhdGFzZXQubmFtZT09PXJlbW92ZWQubmFtZSk7CiAgICAgIGlmKGxlZnRSb3cpIGxlZnRSb3cuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTsKICAgICAgcmVuZGVyT3ZlcmxheSgpOwogICAgICByZW5kZXJMaXN0KHN0YXRlLml0ZW1zKTsKICAgICAgdXBkYXRlVG90YWxzKCk7CiAgICB9KTsKCiAgICBvdmVybGF5Qm9keS5hcHBlbmRDaGlsZChyb3cpOwogIH0pOwogICQoJ292ZXJsYXlDb3VudCcpLnRleHRDb250ZW50ID0gc3RhdGUuc2VsZWN0ZWQubGVuZ3RoOwogIHJlbmRlclNlbGVjdGVkUGFuZWwoKTsKfQoKJCgnc2hvd1NlbGVjdGVkJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+eyBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7IHJlbmRlck92ZXJsYXkoKTsgfSk7CiQoJ2Nsb3NlT3ZlcmxheScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PiBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZScpOwoKZnVuY3Rpb24gc2hvd0ZpbGVzKG5hbWUsIGZpbGVzLCBzaXplKSB7CiAgaWYgKCFmaWxlcyB8fCAhZmlsZXMubGVuZ3RoKSB7CiAgICBhbGVydChgTm8gZmlsZXMgZm9yICR7bmFtZX1gKTsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVzTW9kYWwnKTsKICBtb2RhbC5pbm5lckhUTUwgPSAnJzsgCiAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgCiAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgaGVhZGVyLmlubmVySFRNTCA9IGA8c3Ryb25nPiR7ZXNjKG5hbWUpfTwvc3Ryb25nPjxicj48c3BhbiBjbGFzcz0ibWV0YSI+U2l6ZTogJHtlc2Moc2l6ZSl9IOKAkyAke2ZpbGVzLmxlbmd0aH0gZmlsZXM8L3NwYW4+YDsKICBtb2RhbC5hcHBlbmRDaGlsZChoZWFkZXIpOwoKICBjb25zdCBsaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgbGlzdC5zdHlsZS5tYXJnaW5Ub3AgPSAnOHB4JzsKICBtb2RhbC5hcHBlbmRDaGlsZChsaXN0KTsKCiAgbGV0IGluZGV4ID0gMDsKICBjb25zdCBiYXRjaCA9IDIwOwogIGZ1bmN0aW9uIGxvYWRNb3JlKCkgewogICAgY29uc3QgbmV4dCA9IGZpbGVzLnNsaWNlKGluZGV4LCBpbmRleCtiYXRjaCk7CiAgICBsaXN0LmlubmVySFRNTCArPSBuZXh0Lm1hcChmPT5lc2MoZikpLmpvaW4oJzxicj4nKTsKICAgIGluZGV4ICs9IGJhdGNoOwogICAgaWYgKGluZGV4ID49IGZpbGVzLmxlbmd0aCkgewogICAgICBtb3JlQnRuLnJlbW92ZSgpOwogICAgfQogIH0KCiAgY29uc3QgbW9yZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogIG1vcmVCdG4udGV4dENvbnRlbnQgPSAnTW9yZSc7CiAgbW9yZUJ0bi5jbGFzc05hbWUgPSAnYnRuIGdob3N0JzsKICBtb3JlQnRuLnN0eWxlLm1hcmdpblRvcCA9ICcxMHB4JzsKICBtb3JlQnRuLm9uY2xpY2sgPSBsb2FkTW9yZTsKICBtb2RhbC5hcHBlbmRDaGlsZChtb3JlQnRuKTsKCiAgY29uc3QgY2xvc2VCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICBjbG9zZUJ0bi50ZXh0Q29udGVudCA9ICdDbG9zZSc7CiAgY2xvc2VCdG4uY2xhc3NOYW1lID0gJ2J0bic7CiAgY2xvc2VCdG4uc3R5bGUubWFyZ2luVG9wID0gJzEwcHgnOwogIGNsb3NlQnRuLm9uY2xpY2sgPSAoKT0+eyBtb2RhbC5zdHlsZS5kaXNwbGF5PSdub25lJzsgbW9kYWwuaW5uZXJIVE1MPScnOyB9OwogIG1vZGFsLmFwcGVuZENoaWxkKGNsb3NlQnRuKTsKICBsb2FkTW9yZSgpOwp9CgpmdW5jdGlvbiBnZXRDb250cm9sVmFsdWVzKCkgewogIGNvbnN0IHZhbHVlcyA9IHt9OwogIENPTkZJRy5zdG9yYWdlQ29udHJvbHMuZm9yRWFjaChjdHJsID0+IHsKICAgIGNvbnN0IGVsID0gJChjdHJsLmlkKTsKICAgIGlmIChlbCkgdmFsdWVzW2N0cmwuaWRdID0gZWwudmFsdWU7CiAgfSk7CiAgcmV0dXJuIHZhbHVlczsKfQoKZnVuY3Rpb24gdXBkYXRlVG90YWxzKCkgewogIGNvbnN0IHRvdGFsQnl0ZXMgPSBzdGF0ZS5zZWxlY3RlZC5yZWR1Y2UoKHN1bSwgcykgPT4gc3VtICsgcGFyc2VTaXplVGV4dChzLnNpemUpLCAwKTsKICBjb25zdCBnYiA9IGJ5dGVzVG9HQih0b3RhbEJ5dGVzKTsKICAkKCdzZWxlY3RlZFNpemUnKS50ZXh0Q29udGVudCA9IGdiLnRvRml4ZWQoMik7CgogIGNvbnN0IGJsb2F0ZWQgPSB0b3RhbEJ5dGVzICogMS4yOwogIGNvbnN0IHNwZWVkID0gMTQgKiAxMDI0ICogMTAyNDsKICBjb25zdCBzZWNzID0gTWF0aC5jZWlsKGJsb2F0ZWQgLyBzcGVlZCk7CiAgJCgnaW5zdGFsbEVzdGltYXRlJykudGV4dENvbnRlbnQgPSBgJHtNYXRoLmZsb29yKHNlY3MvMzYwMCl9aCAke01hdGguZmxvb3IoKHNlY3MlMzYwMCkvNjApfW1gOwoKICAkKCdjb3VudCcpLnRleHRDb250ZW50ID0gc3RhdGUuc2VsZWN0ZWQubGVuZ3RoOwoKICBjb25zdCB2YWx1ZXMgPSBnZXRDb250cm9sVmFsdWVzKCk7CiAgY29uc3Qgc3BhY2VGb3JHYW1lcyA9IENPTkZJRy5jYWxjdWxhdGVTdG9yYWdlKHZhbHVlcyk7CgogICQoJ3NwYWNlJykudGV4dENvbnRlbnQgPSBpc0Zpbml0ZShzcGFjZUZvckdhbWVzKSA/IHNwYWNlRm9yR2FtZXMgOiAwOwoKICBpZiAoZ2IgPiBzcGFjZUZvckdhbWVzKSB7CiAgICAkKCdzZWxlY3RlZFNpemUnKS5zdHlsZS5jb2xvciA9ICcjYzAwJzsKICAgICQoJ3NlbGVjdGVkU2l6ZScpLnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7CiAgfSBlbHNlIHsKICAgICQoJ3NlbGVjdGVkU2l6ZScpLnN0eWxlLmNvbG9yID0gJyc7CiAgICAkKCdzZWxlY3RlZFNpemUnKS5zdHlsZS5mb250V2VpZ2h0ID0gJyc7CiAgfQoKICB1cGRhdGVGaWxlbmFtZVByZXZpZXcoKTsKfQoKZnVuY3Rpb24gdXBkYXRlRmlsZW5hbWVQcmV2aWV3KCkgewogIGNvbnN0IGN1c3RvbWVyID0gKCQoJ2N1c3RvbWVyJykudmFsdWUgfHwgJ2N1c3RvbWVyJykudHJpbSgpLnJlcGxhY2UoL1teYS16QS1aMC05XS9nLCdfJykudG9Mb3dlckNhc2UoKTsKICBjb25zdCB2YWx1ZXMgPSBnZXRDb250cm9sVmFsdWVzKCk7CiAgY29uc3QgdG9rZW5zID0gW2N1c3RvbWVyXTsKICAKICBDT05GSUcuc3RvcmFnZUNvbnRyb2xzLmZvckVhY2goY3RybCA9PiB7CiAgICBpZiAoY3RybC5maWxlbmFtZVRva2VuKSB7CiAgICAgIGNvbnN0IHZhbCA9IHZhbHVlc1tjdHJsLmlkXSB8fCBjdHJsLmRlZmF1bHQ7CiAgICAgIGNvbnN0IHRva2VuID0gY3RybC5maWxlbmFtZVRva2VuID09PSB0cnVlID8gdmFsIDogKGN0cmwuZmlsZW5hbWVUb2tlbiArIHZhbCk7CiAgICAgIHRva2Vucy5wdXNoKHRva2VuKTsKICAgIH0KICB9KTsKICAKICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpOwogIGNvbnN0IHN0YW1wID0gbm93LmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKSArCiAgICBTdHJpbmcobm93LmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpICsKICAgIFN0cmluZyhub3cuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCAnMCcpICsKICAgIFN0cmluZyhub3cuZ2V0SG91cnMoKSkucGFkU3RhcnQoMiwgJzAnKSArCiAgICBTdHJpbmcobm93LmdldE1pbnV0ZXMoKSkucGFkU3RhcnQoMiwgJzAnKSArCiAgICBTdHJpbmcobm93LmdldFNlY29uZHMoKSkucGFkU3RhcnQoMiwgJzAnKTsKICB0b2tlbnMucHVzaChzdGFtcCk7CiAgCiAgJCgnZmlsZW5hbWVQcmV2aWV3JykudGV4dENvbnRlbnQgPSB0b2tlbnMuam9pbignXycpICsgQ09ORklHLmNsaWVudEZpbGVFeHQ7Cn0KCmZ1bmN0aW9uIGRlYm91bmNlKGZuLG1zPTIwMCl7IGxldCBoOyByZXR1cm4gKC4uLmEpPT57IGNsZWFyVGltZW91dChoKTsgaD1zZXRUaW1lb3V0KCgpPT5mbiguLi5hKSxtcyk7IH07IH0KCmZ1bmN0aW9uIHNtYXJ0U2VhcmNoKGl0ZW1zLCBxdWVyeSkgewogIGlmICghcXVlcnkgfHwgIXF1ZXJ5LnRyaW0oKSkgcmV0dXJuIGl0ZW1zOwogIAogIGNvbnN0IHEgPSBxdWVyeS50b0xvd2VyQ2FzZSgpLnRyaW0oKTsKICAKICAvLyBQYXJzZSBzZWFyY2ggdGVybXM6IHN1cHBvcnQgcXVvdGVzIGZvciBleGFjdCBwaHJhc2VzCiAgY29uc3QgdGVybXMgPSBbXTsKICBjb25zdCBxdW90ZVJlZ2V4ID0gLyIoW14iXSspInwnKFteJ10rKSd8KFxTKykvZzsKICBsZXQgbWF0Y2g7CiAgCiAgd2hpbGUgKChtYXRjaCA9IHF1b3RlUmVnZXguZXhlYyhxKSkgIT09IG51bGwpIHsKICAgIGNvbnN0IHRlcm0gPSAobWF0Y2hbMV0gfHwgbWF0Y2hbMl0gfHwgbWF0Y2hbM10pLnRvTG93ZXJDYXNlKCk7CiAgICB0ZXJtcy5wdXNoKHRlcm0pOwogIH0KICAKICBpZiAodGVybXMubGVuZ3RoID09PSAwKSByZXR1cm4gaXRlbXM7CiAgCiAgLy8gRmlsdGVyIGl0ZW1zOiBBTEwgdGVybXMgbXVzdCBtYXRjaCAoQU5EIGxvZ2ljKQogIHJldHVybiBpdGVtcy5maWx0ZXIoaXRlbSA9PiB7CiAgICBjb25zdCBzZWFyY2hUZXh0ID0gKGl0ZW0ubmFtZSB8fCAnJykudG9Mb3dlckNhc2UoKQogICAgICAucmVwbGFjZSgvW15cd1xzXS9nLCAnICcpOyAvLyBSZW1vdmUgcHVuY3R1YXRpb24gZm9yIG1hdGNoaW5nCiAgICAKICAgIHJldHVybiB0ZXJtcy5ldmVyeSh0ZXJtID0+IHNlYXJjaFRleHQuaW5jbHVkZXModGVybSkpOwogIH0pOwp9CgokKCdzZWFyY2gnKS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGRlYm91bmNlKChlKT0+eyAKICBjb25zdCBxID0gZS50YXJnZXQudmFsdWUgfHwgJyc7CiAgY29uc3QgZmlsdGVyZWQgPSBzbWFydFNlYXJjaChzdGF0ZS5pdGVtcywgcSk7CiAgcmVuZGVyTGlzdChmaWx0ZXJlZCk7Cn0sIDE4MCkpOwoKJCgnY2xlYXJTZWFyY2gnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT57ICQoJ3NlYXJjaCcpLnZhbHVlPScnOyByZW5kZXJMaXN0KHN0YXRlLml0ZW1zKTsgJCgnc2VhcmNoJykuZm9jdXMoKTsgfSk7CgpDT05GSUcuc3RvcmFnZUNvbnRyb2xzLmZvckVhY2goY3RybCA9PiB7CiAgY29uc3QgaWQgPSBjdHJsLmlkOwogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4gewogICAgY29uc3QgZWwgPSAkKGlkKTsKICAgIGlmKGVsKXsKICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiB1cGRhdGVGaWxlbmFtZVByZXZpZXcoKSk7CiAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHVwZGF0ZVRvdGFscygpKTsKICAgIH0KICB9KTsKfSk7CgokKCdjdXN0b21lcicpLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4gdXBkYXRlRmlsZW5hbWVQcmV2aWV3KCkpOwoKZnVuY3Rpb24gcGFyc2VGaWxlbmFtZVRvQ29uZmlnKGZuKSB7CiAgY29uc3QgYmFzZSA9IGZuLnJlcGxhY2UobmV3IFJlZ0V4cChgXFwke0NPTkZJRy5jbGllbnRGaWxlRXh0fXxcXCR7Q09ORklHLmFkbWluRmlsZUV4dH18XFwuKHR4dCkkYCwgJ2knKSwgJycpOwogIGNvbnN0IHBhcnRzID0gYmFzZS5zcGxpdCgnXycpOwogIGlmIChwYXJ0cy5sZW5ndGggPCAyKSByZXR1cm4gbnVsbDsKICAKICBjb25zdCBjb25maWcgPSB7IGN1c3RvbWVyOiBwYXJ0c1swXSB9OwogIAogIENPTkZJRy5zdG9yYWdlQ29udHJvbHMuZm9yRWFjaChjdHJsID0+IHsKICAgIGlmIChjdHJsLmZpbGVuYW1lVG9rZW4pIHsKICAgICAgY29uc3QgcGF0dGVybiA9IGN0cmwuZmlsZW5hbWVUb2tlbiA9PT0gdHJ1ZSAKICAgICAgICA/IGBeKCR7Y3RybC5vcHRpb25zLm1hcChvID0+IG8udmFsdWUpLmpvaW4oJ3wnKX0pJGAKICAgICAgICA6IGBeJHtjdHJsLmZpbGVuYW1lVG9rZW59XFxkKyRgOwogICAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAocGF0dGVybik7CiAgICAgIAogICAgICBwYXJ0cy5mb3JFYWNoKHAgPT4gewogICAgICAgIGlmIChyZWdleC50ZXN0KHApKSB7CiAgICAgICAgICBjb25maWdbY3RybC5pZF0gPSBjdHJsLmZpbGVuYW1lVG9rZW4gPT09IHRydWUgPyBwIDogcC5yZXBsYWNlKGN0cmwuZmlsZW5hbWVUb2tlbiwgJycpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CiAgCiAgcmV0dXJuIGNvbmZpZzsKfQoKJCgnZmlsZUluJykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGV2KT0+ewogIGNvbnN0IGYgPSBldi50YXJnZXQuZmlsZXNbMF07IAogIGlmKCFmKSByZXR1cm47IAogIAogIGNvbnN0IGNmZyA9IHBhcnNlRmlsZW5hbWVUb0NvbmZpZyhmLm5hbWUpOyAKICBpZihjZmcpeyAKICAgICQoJ2N1c3RvbWVyJykudmFsdWUgPSBjZmcuY3VzdG9tZXIgfHwgJyc7CiAgICBDT05GSUcuc3RvcmFnZUNvbnRyb2xzLmZvckVhY2goY3RybCA9PiB7CiAgICAgIGNvbnN0IGVsID0gJChjdHJsLmlkKTsKICAgICAgaWYgKGVsICYmIGNmZ1tjdHJsLmlkXSkgewogICAgICAgIGlmIChjdHJsLnR5cGUgPT09ICdzZWxlY3QnKSB7CiAgICAgICAgICBBcnJheS5mcm9tKGVsLm9wdGlvbnMpLmZvckVhY2gobyA9PiB7CiAgICAgICAgICAgIGlmIChvLnZhbHVlID09PSBjZmdbY3RybC5pZF0pIG8uc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIHVwZGF0ZUZpbGVuYW1lUHJldmlldygpOyAKICAgIHVwZGF0ZVRvdGFscygpOwogIH0KICAKICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOyAKICByZWFkZXIub25sb2FkID0gKGUpPT57IAogICAgY29uc3QgbGluZXMgPSBlLnRhcmdldC5yZXN1bHQuc3BsaXQoJ1xuJykubWFwKHM9PnMudHJpbSgpKS5maWx0ZXIoQm9vbGVhbik7IAogICAgc3RhdGUuc2VsZWN0ZWQ9W107IAogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLml0ZW0nKS5mb3JFYWNoKGk9PmkuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKSk7CiAgICAKICAgIGxpbmVzLmZvckVhY2godGl0bGU9PnsgCiAgICAgIGNvbnN0IGxlZnQgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pdGVtJykpLmZpbmQoaT0+aS5kYXRhc2V0Lm5hbWU9PT10aXRsZSk7IAogICAgICBpZihsZWZ0KXsgCiAgICAgICAgbGVmdC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpOyAKICAgICAgICBzdGF0ZS5zZWxlY3RlZC5wdXNoKHsgbmFtZTpsZWZ0LmRhdGFzZXQubmFtZSwgZmlsZW5hbWU6IGxlZnQuZGF0YXNldC5maWxlbmFtZSB8fCBsZWZ0LmRhdGFzZXQubmFtZSwgc2l6ZTpsZWZ0LmRhdGFzZXQuc2l6ZSB9KTsgCiAgICAgIH0gZWxzZSB7IAogICAgICAgIGNvbnN0IG1heWJlID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaXRlbScpKS5maW5kKGk9PmkuZGF0YXNldC5uYW1lICYmIGkuZGF0YXNldC5uYW1lLnRvTG93ZXJDYXNlKCk9PT10aXRsZS50b0xvd2VyQ2FzZSgpKTsgCiAgICAgICAgaWYobWF5YmUpeyAKICAgICAgICAgIG1heWJlLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7IAogICAgICAgICAgc3RhdGUuc2VsZWN0ZWQucHVzaCh7IG5hbWU6bWF5YmUuZGF0YXNldC5uYW1lLCBmaWxlbmFtZTogbWF5YmUuZGF0YXNldC5maWxlbmFtZSB8fCBtYXliZS5kYXRhc2V0Lm5hbWUsIHNpemU6bWF5YmUuZGF0YXNldC5zaXplIH0pOyAKICAgICAgICB9IAogICAgICB9IAogICAgfSk7IAogICAgdXBkYXRlVG90YWxzKCk7IAogICAgcmVuZGVyT3ZlcmxheSgpOyAKICB9OwogIHJlYWRlci5yZWFkQXNUZXh0KGYpOwp9KTsKCiQoJ3NhdmVCdG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+ewogIG5vdyA9IERhdGUubm93KCk7CiAgaWYgKG5vdyAtIGxhc3RFeHBvcnRUaW1lIDwgTUlOX0RFTEFZKSB7CiAgICB0b2FzdCgnUGxlYXNlIHdhaXQgYmVmb3JlIGV4cG9ydGluZyBhZ2FpbicpOwogICAgYWxlcnQoJ1BsZWFzZSB3YWl0IGJlZm9yZSBleHBvcnRpbmcgYWdhaW4nKTsKICAgIHJldHVybjsKICB9CiAgbGFzdEV4cG9ydFRpbWUgPSBub3c7CgogIGlmKHN0YXRlLnNlbGVjdGVkLmxlbmd0aD09PTApeyBhbGVydCgnTm8gaXRlbXMgc2VsZWN0ZWQnKTsgcmV0dXJuOyB9CiAgY29uc3QgY3VzdCA9ICgkKCdjdXN0b21lcicpLnZhbHVlfHwnJykudHJpbSgpOyAKICBpZighY3VzdCl7IGFsZXJ0KCdDdXN0b21lciBuYW1lIHJlcXVpcmVkJyk7IHJldHVybjsgfQogIGNvbnN0IGZpbGVuYW1lID0gJCgnZmlsZW5hbWVQcmV2aWV3JykudGV4dENvbnRlbnQgfHwgYGxpc3Qke0NPTkZJRy5jbGllbnRGaWxlRXh0fWA7CiAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtzdGF0ZS5zZWxlY3RlZC5tYXAocz0+cy5uYW1lKS5qb2luKCdcbicpXSwgeyB0eXBlOid0ZXh0L3BsYWluJyB9KTsgCiAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsgCiAgYS5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsgCiAgYS5kb3dubG9hZCA9IGZpbGVuYW1lOyAKICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpOyAKICBhLmNsaWNrKCk7IAogIGEucmVtb3ZlKCk7IAogIFVSTC5yZXZva2VPYmplY3RVUkwoYS5ocmVmKTsgCiAgdG9hc3QoJ1NhdmVkIGNsaWVudCBmaWxlJyk7Cn0pOwoKJCgnYWRtaW5FeHBvcnQnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKT0+ewogIG5vdyA9IERhdGUubm93KCk7CiAgaWYgKG5vdyAtIGxhc3RFeHBvcnRUaW1lIDwgTUlOX0RFTEFZKSB7CiAgICB0b2FzdCgnUGxlYXNlIHdhaXQgYmVmb3JlIGV4cG9ydGluZyBhZ2FpbicpOwogICAgYWxlcnQoJ1BsZWFzZSB3YWl0IGJlZm9yZSBleHBvcnRpbmcgYWdhaW4nKTsKICAgIHJldHVybjsKICB9CiAgbGFzdEV4cG9ydFRpbWUgPSBub3c7CgogIGlmKHN0YXRlLnNlbGVjdGVkLmxlbmd0aD09PTApeyBhbGVydCgnTm8gaXRlbXMgc2VsZWN0ZWQnKTsgcmV0dXJuOyB9CiAgY29uc3QgY3VzdCA9ICgkKCdjdXN0b21lcicpLnZhbHVlfHwnJykudHJpbSgpOyAKICBpZighY3VzdCl7IGFsZXJ0KCdDdXN0b21lciBuYW1lIHJlcXVpcmVkJyk7IHJldHVybjsgfQogIAogIHRyeXsgCiAgICBjb25zdCB4bWx0eHQgPSBhd2FpdCBmZXRjaChDT05GSUcueG1sRmlsZSkudGhlbihyPT5yLnRleHQoKSk7IAogICAgY29uc3QgeG1sID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyh4bWx0eHQsJ2FwcGxpY2F0aW9uL3htbCcpOyAKICAgIGxldCBjb250ZW50PScnOyAKICAgIAogICAgaWYgKENPTkZJRy5zdHJ1Y3R1cmVUeXBlID09PSAnZm9sZGVycycpIHsKICAgICAgc3RhdGUuc2VsZWN0ZWQuZm9yRWFjaChzZWw9PnsgCiAgICAgICAgY29uc3QgZm9sZGVyID0gQXJyYXkuZnJvbSh4bWwucXVlcnlTZWxlY3RvckFsbCgnZm9sZGVyJykpLmZpbmQoZj0+Zi5nZXRBdHRyaWJ1dGUoJ25hbWUnKT09PXNlbC5uYW1lKTsgCiAgICAgICAgaWYoZm9sZGVyKXsgCiAgICAgICAgICBmb2xkZXIucXVlcnlTZWxlY3RvckFsbCgnZmlsZScpLmZvckVhY2goZmlsZT0+IAogICAgICAgICAgICBjb250ZW50ICs9IGAke0NPTkZJRy5hZG1pbkJhc2VQYXRofSR7Zm9sZGVyLmdldEF0dHJpYnV0ZSgnbmFtZScpfVxcJHtmaWxlLmdldEF0dHJpYnV0ZSgnbmFtZScpfVxuYAogICAgICAgICAgKTsgCiAgICAgICAgfSAKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBzdGF0ZS5zZWxlY3RlZC5mb3JFYWNoKHNlbD0+eyAKICAgICAgICBjb25zdCBmaWxlbmFtZSA9IHNlbC5maWxlbmFtZSB8fCBzZWwubmFtZTsKICAgICAgICBjb250ZW50ICs9IGAke0NPTkZJRy5hZG1pbkJhc2VQYXRofSR7ZmlsZW5hbWV9XG5gOwogICAgICB9KTsKICAgIH0KICAgIAogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsgCiAgICBjb25zdCBzdGFtcCA9IGAke25vdy5nZXRGdWxsWWVhcigpfSR7U3RyaW5nKG5vdy5nZXRNb250aCgpKzEpLnBhZFN0YXJ0KDIsJzAnKX0ke1N0cmluZyhub3cuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCcwJyl9XyR7U3RyaW5nKG5vdy5nZXRIb3VycygpKS5wYWRTdGFydCgyLCcwJyl9JHtTdHJpbmcobm93LmdldE1pbnV0ZXMoKSkucGFkU3RhcnQoMiwnMCcpfWA7IAogICAgY29uc3QgZm5hbWUgPSBgJHsoY3VzdHx8J2N1c3RvbWVyJykucmVwbGFjZSgvW15hLXpBLVowLTldL2csJ18nKX1fJHtzdGFtcH0ke0NPTkZJRy5hZG1pbkZpbGVFeHR9YDsgCiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2NvbnRlbnRdLCB7IHR5cGU6J3RleHQvcGxhaW4nIH0pOyAKICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7IAogICAgYS5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsgCiAgICBhLmRvd25sb2FkID0gZm5hbWU7IAogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsgCiAgICBhLmNsaWNrKCk7IAogICAgYS5yZW1vdmUoKTsgCiAgICBVUkwucmV2b2tlT2JqZWN0VVJMKGEuaHJlZik7IAogICAgdG9hc3QoJ0FkbWluIGV4cG9ydCByZWFkeScpOyAKICB9Y2F0Y2goZSl7IAogICAgY29uc29sZS5lcnJvcihlKTsgCiAgICB0b2FzdCgnQWRtaW4gZXhwb3J0IGZhaWxlZCcpOyAKICB9Cn0pOwoKJCgndXBsb2FkQnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKT0+ewogIGlmKHN0YXRlLnNlbGVjdGVkLmxlbmd0aD09PTApeyBhbGVydCgnTm8gaXRlbXMgc2VsZWN0ZWQnKTsgcmV0dXJuOyB9CiAgY29uc3QgY3VzdCA9ICgkKCdjdXN0b21lcicpLnZhbHVlfHwnJykudHJpbSgpOyAKICBpZighY3VzdCl7IGFsZXJ0KCdDdXN0b21lciByZXF1aXJlZCcpOyByZXR1cm47IH0KICBpZighY29uZmlybShgVXBsb2FkIGxpc3QgZm9yICR7Y3VzdH0/YCkpIHJldHVybjsgCiAgCiAgY29uc3QgZmlsZW5hbWUgPSAkKCdmaWxlbmFtZVByZXZpZXcnKS50ZXh0Q29udGVudCB8fCBgbGlzdCR7Q09ORklHLmNsaWVudEZpbGVFeHR9YDsgCiAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtzdGF0ZS5zZWxlY3RlZC5tYXAocz0+cy5uYW1lKS5qb2luKCdcbicpXSwgeyB0eXBlOid0ZXh0L3BsYWluJyB9KTsgCiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsgCiAgaWYobm93IC0gc3RhdGUubGFzdFVwbG9hZCA8IDE1MDAwKXsgYWxlcnQoJ1BsZWFzZSB3YWl0IDE1IHNlY29uZHMgYmV0d2VlbiB1cGxvYWRzJyk7IHJldHVybjsgfQogIAogIHRyeXsgCiAgICBjb25zdCB1cmwgPSBgaHR0cHM6Ly9maWxlYmluLm5ldC8ke0NPTkZJRy5maWxlYmluQnVja2V0fS8ke2ZpbGVuYW1lfWA7IAogICAgY29uc3QgciA9IGF3YWl0IGZldGNoKHVybCx7IG1ldGhvZDonUE9TVCcsIGhlYWRlcnM6eyAnQ29udGVudC1UeXBlJzondGV4dC9wbGFpbicgfSwgYm9keTogYmxvYiB9KTsgCiAgICAKICAgIGlmKHIub2sgfHwgci5zdGF0dXM9PT0yMDEpeyAKICAgICAgc3RhdGUubGFzdFVwbG9hZCA9IG5vdzsgCiAgICAgICQoJ3NoYXJlYWJsZScpLnZhbHVlID0gYGh0dHBzOi8vZmlsZWJpbi5uZXQvJHtDT05GSUcuZmlsZWJpbkJ1Y2tldH0vJHtmaWxlbmFtZX1gOyAKICAgICAgdG9hc3QoJ1VwbG9hZGVkIHRvIGZpbGViaW4nKTsgCiAgICAgIHNob3dCYW5uZXIoIlVwbG9hZCBDb21wbGV0ZSAtIFByZXNzIENvcHkgTGluayBhbmQgc2VuZCBpdCB0byBvdXIgY2hhdCIpOwogICAgICAKICAgICAgY29uc3QgY29uZmlnU2VjdGlvbiA9ICQoJ2NvbmZpZ1NlY3Rpb24nKTsKICAgICAgY29uc3QgdG9nZ2xlQnRuID0gJCgndG9nZ2xlQ29uZmlnJyk7CiAgICAgIGlmIChjb25maWdTZWN0aW9uICYmIHRvZ2dsZUJ0biAmJiBjb25maWdTZWN0aW9uLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykpIHsKICAgICAgICBjb25maWdTZWN0aW9uLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgIHRvZ2dsZUJ0bi50ZXh0Q29udGVudCA9ICdTaG93IENvbmZpZ3VyYXRpb24nOwogICAgICB9CiAgICAgIHJldHVybjsgCiAgICB9IAogIH1jYXRjaChlKXsgCiAgICBjb25zb2xlLndhcm4oJ2ZpbGViaW4gZXJyb3InLCBlKTsgCiAgfQogIAogIHRyeXsgCiAgICBjb25zdCBmb3JtID0gbmV3IEZvcm1EYXRhKCk7IAogICAgZm9ybS5hcHBlbmQoJ2ZpbGUnLCBibG9iLCBmaWxlbmFtZSk7IAogICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vdXBsb2FkLmdvZmlsZS5pby91cGxvYWRGaWxlJywgeyBtZXRob2Q6J1BPU1QnLCBib2R5OiBmb3JtIH0pOyAKICAgIGNvbnN0IGogPSBhd2FpdCByZXMuanNvbigpOyAKICAgIGlmKGouc3RhdHVzID09PSAnb2snKXsgCiAgICAgIHN0YXRlLmxhc3RVcGxvYWQgPSBub3c7IAogICAgICAkKCdzaGFyZWFibGUnKS52YWx1ZSA9IGouZGF0YS5kb3dubG9hZFBhZ2U7IAogICAgICB0b2FzdCgnVXBsb2FkZWQgdG8gR29GaWxlJyk7IAogICAgICByZXR1cm47IAogICAgfSAKICAgIHRvYXN0KCdVcGxvYWQgZmFpbGVkJyk7IAogIH1jYXRjaChlKXsgCiAgICBjb25zb2xlLmVycm9yKGUpOyAKICAgIHRvYXN0KCdVcGxvYWQgZXJyb3InKTsgCiAgfQp9KTsKCmxldCBiaW5MaXN0UGFnZSA9IDA7CmNvbnN0IGJpbkxpc3RQYWdlU2l6ZSA9IDEwOwpsZXQgY2FjaGVkQmluRmlsZXMgPSBudWxsOwoKJCgnYmluTGlzdCcpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICB0cnkgewogICAgY29uc3QgciA9IGF3YWl0IGZldGNoKGBodHRwczovL2ZpbGViaW4ubmV0LyR7Q09ORklHLmZpbGViaW5CdWNrZXR9P2pzb25gLCB7CiAgICAgIGhlYWRlcnM6IHsgIkFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uIiB9CiAgICB9KTsKICAgIGlmICghci5vaykgeyB0b2FzdChgRmFpbGVkIHRvIGZldGNoIHVwbG9hZHM6ICR7ci5zdGF0dXNUZXh0fWApOyByZXR1cm47IH0KCiAgICBsZXQgajsKICAgIHRyeSB7CiAgICAgIGogPSBhd2FpdCByLmpzb24oKTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICB0b2FzdCgiRmFpbGVkIHRvIHBhcnNlIHNlcnZlciByZXNwb25zZSIpOwogICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoIWouZmlsZXMgfHwgIWouZmlsZXMubGVuZ3RoKSB7IHRvYXN0KCdObyBmaWxlcyBmb3VuZCcpOyByZXR1cm47IH0KCiAgICAvLyA9PT09PT09PT09IEFERCBUSEVTRSAzIExJTkVTID09PT09PT09PT0KICAgIGNvbnN0IHBsYXRmb3JtRmlsZXMgPSBqLmZpbGVzLmZpbHRlcihmaWxlID0+IAogICAgICBmaWxlLmZpbGVuYW1lLmVuZHNXaXRoKENPTkZJRy5jbGllbnRGaWxlRXh0KQogICAgKTsKICAgIAogICAgaWYgKHBsYXRmb3JtRmlsZXMubGVuZ3RoID09PSAwKSB7CiAgICAgIHRvYXN0KGBObyAke0NPTkZJRy5wbGF0Zm9ybSB8fCAncGxhdGZvcm0nfSBmaWxlcyBmb3VuZGApOwogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3Qgc29ydGVkID0gcGxhdGZvcm1GaWxlcy5zb3J0KChhLGIpPT4gbmV3IERhdGUoYi51cGRhdGVkX2F0KSAtIG5ldyBEYXRlKGEudXBkYXRlZF9hdCkpOwogICAgLy8gPT09PT09PT09PSBDSEFOR0UgVEhJUyBMSU5FID09PT09PT09PT0KICAgIC8vIE9MRDogY29uc3Qgc29ydGVkID0gai5maWxlcy5zb3J0KC4uLikKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIAogICAgY2FjaGVkQmluRmlsZXMgPSBzb3J0ZWQ7CiAgICBiaW5MaXN0UGFnZSA9IDA7CiAgICByZW5kZXJCaW5MaXN0KCk7CiAgfSBjYXRjaCAoZSkgewogICAgY29uc29sZS5lcnJvcihlKTsKICAgIHRvYXN0KCdFcnJvciBmZXRjaGluZyB1cGxvYWRzJyk7CiAgfQp9KTsKCmZ1bmN0aW9uIHJlbmRlckJpbkxpc3QoKSB7CiAgaWYgKCFjYWNoZWRCaW5GaWxlcykgcmV0dXJuOwogIAogIGNvbnN0IHN0YXJ0ID0gYmluTGlzdFBhZ2UgKiBiaW5MaXN0UGFnZVNpemU7CiAgY29uc3QgZW5kID0gc3RhcnQgKyBiaW5MaXN0UGFnZVNpemU7CiAgY29uc3QgcGFnZUZpbGVzID0gY2FjaGVkQmluRmlsZXMuc2xpY2Uoc3RhcnQsIGVuZCk7CiAgY29uc3QgaGFzTW9yZSA9IGVuZCA8IGNhY2hlZEJpbkZpbGVzLmxlbmd0aDsKICAKICBsZXQgaHRtbCA9ICc8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6bGVmdDttYXJnaW4tYm90dG9tOjhweDsiPic7CiAgaHRtbCArPSAnPGJ1dHRvbiBpZD0iY2xvc2VCaW4iIGNsYXNzPSJidG4gZ2hvc3QiIHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7Ij5DbG9zZTwvYnV0dG9uPic7CiAgaHRtbCArPSBgPHN0cm9uZz5SZWNlbnQgVXBsb2Fkczwvc3Ryb25nPmA7CiAgaHRtbCArPSAnPC9kaXY+JzsKICAKICBodG1sICs9ICc8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjhweDttYXJnaW4tYm90dG9tOjhweDsiPic7CiAgaHRtbCArPSBgPGJ1dHRvbiBpZD0icHJldlBhZ2UiIGNsYXNzPSJidG4gZ2hvc3QiIHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7ZmxleDoxOyIgJHtiaW5MaXN0UGFnZSA9PT0gMCA/ICdkaXNhYmxlZCcgOiAnJ30+UHJldjwvYnV0dG9uPmA7CiAgaHRtbCArPSBgPHNwYW4gc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Zm9udC1zaXplOjEycHg7Y29sb3I6IzZiNzI4MDsiPlBhZ2UgJHtiaW5MaXN0UGFnZSArIDF9PC9zcGFuPmA7CiAgaHRtbCArPSBgPGJ1dHRvbiBpZD0ibmV4dFBhZ2UiIGNsYXNzPSJidG4gZ2hvc3QiIHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7ZmxleDoxOyIgJHshaGFzTW9yZSA/ICdkaXNhYmxlZCcgOiAnJ30+TmV4dDwvYnV0dG9uPmA7CiAgaHRtbCArPSAnPC9kaXY+JzsKICAKICBodG1sICs9ICc8dWwgc3R5bGU9Im1hcmdpbjowO3BhZGRpbmctbGVmdDoyMHB4OyI+JzsKICBwYWdlRmlsZXMuZm9yRWFjaChmaWxlID0+IHsKICAgIGNvbnN0IGZpbGVVcmwgPSBgaHR0cHM6Ly9maWxlYmluLm5ldC8ke0NPTkZJRy5maWxlYmluQnVja2V0fS8ke2VuY29kZVVSSUNvbXBvbmVudChmaWxlLmZpbGVuYW1lKX1gOwogICAgY29uc3QgYWRkZWREYXRlID0gbmV3IERhdGUoZmlsZS51cGRhdGVkX2F0KTsKICAgIGNvbnN0IGZvcm1hdHRlZERhdGUgPSBhZGRlZERhdGUudG9JU09TdHJpbmcoKS5zbGljZSgwLDEwKS5yZXBsYWNlKC8tL2csJycpOwogICAgY29uc3QgaG91cnMgPSBhZGRlZERhdGUuZ2V0SG91cnMoKTsKICAgIGNvbnN0IG1pbnV0ZXMgPSBhZGRlZERhdGUuZ2V0TWludXRlcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwnMCcpOwogICAgY29uc3QgYW1wbSA9IGhvdXJzID49IDEyID8gJ1BNJzonQU0nOwogICAgY29uc3QgZm9ybWF0dGVkVGltZSA9IGAke2hvdXJzICUgMTIgfHwgMTJ9OiR7bWludXRlc30gJHthbXBtfWA7CiAgICBjb25zdCBzdHJpcHBlZE5hbWUgPSBmaWxlLmZpbGVuYW1lLnNwbGl0KCcuJykuc2xpY2UoMCwtMSkuam9pbignLicpOwogICAgY29uc3QgZmlsZVNpemUgPSBmaWxlLmJ5dGVzX3JlYWRhYmxlIHx8ICcnOwogICAgaHRtbCArPSBgPGxpIHN0eWxlPSJtYXJnaW4tYm90dG9tOjRweDsgZm9udC1zaXplOiAxMnB4OyI+PGEgaHJlZj0iJHtmaWxlVXJsfSIgdGFyZ2V0PSJfYmxhbmsiIHN0eWxlPSJ0ZXh0LWRlY29yYXRpb246bm9uZTtjb2xvcjojMDM2NmQ2OyI+JHtmb3JtYXR0ZWREYXRlfSAke2Zvcm1hdHRlZFRpbWV9IHwgJHtzdHJpcHBlZE5hbWV9IHwgJHtmaWxlU2l6ZX08L2E+PC9saT5gOwogIH0pOwogIGh0bWwgKz0gJzwvdWw+JzsKCiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVMaXN0Q29udGFpbmVyJyk7CiAgY29udGFpbmVyLmlubmVySFRNTCA9IGh0bWw7CiAgY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogIGNvbnRhaW5lci5zdHlsZS5iYWNrZ3JvdW5kID0gJyNmOWZhZmInOwogIGNvbnRhaW5lci5zdHlsZS5wYWRkaW5nID0gJzEycHgnOwogIGNvbnRhaW5lci5zdHlsZS5ib3JkZXJSYWRpdXMgPSAnOHB4JzsKICBjb250YWluZXIuc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCAjZTVlN2ViJzsKICBjb250YWluZXIuc3R5bGUubWFyZ2luVG9wID0gJzhweCc7CiAgICBjb250YWluZXIuc3R5bGUub3ZlcmZsb3dZID0gJ2F1dG8nOwpjb250YWluZXIuc3R5bGUub3ZlcmZsb3dYID0gJ2hpZGRlbic7ICAgLy8gb3IgJ2F1dG8nIGlmIHlvdSBwcmVmZXIgaG9yaXpvbnRhbCBzY3JvbGwKY29udGFpbmVyLnN0eWxlLm1heEhlaWdodCA9ICczMDBweCc7ICAgIC8vIHNldCB3aGF0ZXZlciBmaXhlZCBoZWlnaHQgeW91IHdhbnQKCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlQmluJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIGJpbkxpc3RQYWdlID0gMDsKICAgIGNhY2hlZEJpbkZpbGVzID0gbnVsbDsKICB9KTsKICAKICBjb25zdCBwcmV2QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXZQYWdlJyk7CiAgaWYgKHByZXZCdG4gJiYgYmluTGlzdFBhZ2UgPiAwKSB7CiAgICBwcmV2QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICBiaW5MaXN0UGFnZS0tOwogICAgICByZW5kZXJCaW5MaXN0KCk7CiAgICB9KTsKICB9CiAgCiAgY29uc3QgbmV4dEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0UGFnZScpOwogIGlmIChuZXh0QnRuICYmIGhhc01vcmUpIHsKICAgIG5leHRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgIGJpbkxpc3RQYWdlKys7CiAgICAgIHJlbmRlckJpbkxpc3QoKTsKICAgIH0pOwogIH0KfQoKJCgnc2VhcmNoJykuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldikgPT4gewogIGlmIChldi5rZXkgPT09ICdFbnRlcicpIHsKICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAKICAgIGNvbnN0IHZpc2libGVJdGVtcyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLml0ZW0nKSkKICAgICAgLmZpbHRlcihlbCA9PiBlbC5vZmZzZXRQYXJlbnQgIT09IG51bGwpOyAvLyBPbmx5IHZpc2libGUgaXRlbXMKICAgIAogICAgLy8gQ2FsY3VsYXRlIHdoYXQgd291bGQgYmUgYWRkZWQKICAgIGNvbnN0IHRvQWRkID0gdmlzaWJsZUl0ZW1zLmZpbHRlcihlbCA9PiB7CiAgICAgIGNvbnN0IG5hbWUgPSBlbC5kYXRhc2V0Lm5hbWU7CiAgICAgIHJldHVybiAhc3RhdGUuc2VsZWN0ZWQuc29tZShzID0+IHMubmFtZSA9PT0gbmFtZSk7CiAgICB9KTsKICAgIAogICAgaWYgKHRvQWRkLmxlbmd0aCA9PT0gMCkgewogICAgICB0b2FzdCgnQWxsIHZpc2libGUgaXRlbXMgYWxyZWFkeSBzZWxlY3RlZCcpOwogICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIC8vIENhbGN1bGF0ZSB0b3RhbCBzaXplIG9mIGl0ZW1zIHRvIGJlIGFkZGVkCiAgICBsZXQgdG90YWxCeXRlcyA9IDA7CiAgICB0b0FkZC5mb3JFYWNoKGVsID0+IHsKICAgICAgdG90YWxCeXRlcyArPSBwYXJzZVNpemVUZXh0KGVsLmRhdGFzZXQuc2l6ZSk7CiAgICB9KTsKICAgIGNvbnN0IHRvdGFsR0IgPSBieXRlc1RvR0IodG90YWxCeXRlcykudG9GaXhlZCgyKTsKICAgIAogICAgLy8gQ29uZmlybWF0aW9uIGRpYWxvZwogICAgY29uc3QgY29uZmlybWVkID0gY29uZmlybSgKICAgICAgYEFkZCAke3RvQWRkLmxlbmd0aH0gZ2FtZSR7dG9BZGQubGVuZ3RoICE9PSAxID8gJ3MnIDogJyd9IGZyb20gc2VhcmNoIHJlc3VsdHM/XG5cbmAgKwogICAgICBgVG90YWwgc2l6ZTogJHt0b3RhbEdCfSBHQlxuXG5gICsKICAgICAgYFByZXNzIE9LIHRvIGFkZCB0aGVzZSBpdGVtcy5gCiAgICApOwogICAgCiAgICBpZiAoIWNvbmZpcm1lZCkgewogICAgICB0b2FzdCgnQWRkIGNhbmNlbGxlZCcpOwogICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIC8vIEFkZCB0aGUgaXRlbXMKICAgIGxldCBhZGRlZCA9IDA7CiAgICB0b0FkZC5mb3JFYWNoKGVsID0+IHsKICAgICAgY29uc3QgbmFtZSA9IGVsLmRhdGFzZXQubmFtZTsKICAgICAgY29uc3Qgc2l6ZSA9IGVsLmRhdGFzZXQuc2l6ZTsKICAgICAgY29uc3QgZmlsZW5hbWUgPSBlbC5kYXRhc2V0LmZpbGVuYW1lIHx8IG5hbWU7CiAgICAgIHN0YXRlLnNlbGVjdGVkLnB1c2goeyBuYW1lLCBmaWxlbmFtZSwgc2l6ZSB9KTsKICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTsKICAgICAgYWRkZWQrKzsKICAgIH0pOwogICAgCiAgICBpZiAoYWRkZWQgPiAwKSB7CiAgICAgIHVwZGF0ZVRvdGFscygpOwogICAgICByZW5kZXJPdmVybGF5KCk7CiAgICAgIHRvYXN0KGBBZGRlZCAke2FkZGVkfSBpdGVtJHthZGRlZCAhPT0gMSA/ICdzJyA6ICcnfSAoJHt0b3RhbEdCfSBHQilgKTsKICAgIH0KICB9Cn0pOwoKJCgnY29weUxpbmsnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICBjb25zdCBjdXN0ID0gKCQoJ2N1c3RvbWVyJykudmFsdWV8fCcnKS50cmltKCk7IAogIGlmKCFjdXN0KXsgYWxlcnQoJ0N1c3RvbWVyIG5hbWUgcmVxdWlyZWQnKTsgcmV0dXJuOyB9CiAgCiAgY29uc3QgcmF3TGluayA9ICQoJ3NoYXJlYWJsZScpLnZhbHVlLnRyaW0oKTsKICBjb25zdCBsaW5rID0gcmF3TGluawogICAgLnJlcGxhY2UoL15odHRwcz86XC9cLy8sICdoeHhwY2ZmJykKICAgIC5yZXBsYWNlKC9cLi9nLCAnX2RvdF8nKTsKCiAgY29uc3QgdGl0bGVzQXJyID0gc3RhdGUuc2VsZWN0ZWQubWFwKHMgPT4gcy5uYW1lKTsKCiAgaWYgKHRpdGxlc0Fyci5sZW5ndGggPT09IDApIHsKICAgIHRvYXN0KCdObyBzZWxlY3RlZCBsaXN0IHRvIGNvcHknKTsKICAgIGFsZXJ0KCdObyBzZWxlY3RlZCBsaXN0IHRvIGNvcHknKTsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IHRvdGFsQnl0ZXMgPSBzdGF0ZS5zZWxlY3RlZC5yZWR1Y2UoKHN1bSwgcykgPT4gc3VtICsgcGFyc2VTaXplVGV4dChzLnNpemUpLCAwKTsKICBjb25zdCB0b3RhbEdCID0gKHRvdGFsQnl0ZXMgLyAoMTAyNCAqKiAzKSkudG9GaXhlZCgyKTsKICBjb25zdCBjb3VudCA9IHRpdGxlc0Fyci5sZW5ndGg7CgogIGNvbnN0IGN1c3RvbWVyID0gKCQoJ2N1c3RvbWVyJykudmFsdWUgfHwgJycpLnRyaW0oKSB8fCAnVW5rbm93biBjdXN0b21lcic7CiAgY29uc3QgZmlsZW5hbWUgPSAkKCdmaWxlbmFtZVByZXZpZXcnKS50ZXh0Q29udGVudCB8fCBgbGlzdCR7Q09ORklHLmNsaWVudEZpbGVFeHR9YDsKCiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsKICBjb25zdCBzdGFtcCA9IG5vdy50b0xvY2FsZVN0cmluZygnZW4tVVMnLCB7CiAgICB5ZWFyOiAnbnVtZXJpYycsIG1vbnRoOiAnMi1kaWdpdCcsIGRheTogJzItZGlnaXQnLAogICAgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0Jywgc2Vjb25kOiAnMi1kaWdpdCcKICB9KTsKCiAgbGV0IGxpbmtUb1VzZSA9IGxpbms7CgogIGlmICghbGluaykgewogICAgY29uc3QgYXNrID0gY29uZmlybSgKICAgICAgYE5vIGxpbmsgZm91bmQuXG5cbmAgKwogICAgICBgTGlzdCBjb250YWlucyAke2NvdW50fSBpdGVtcyB0b3RhbGluZyAke3RvdGFsR0J9IEdCLlxuXG5gICsKICAgICAgYFdvdWxkIHlvdSBsaWtlIHRvIHVwbG9hZCBub3c/YAogICAgKTsKCiAgICBpZiAoYXNrKSB7CiAgICAgICQoJ3VwbG9hZEJ0bicpLmNsaWNrKCk7CiAgICAgIHNob3dCYW5uZXIoIlVwbG9hZGluZ+KAplxuXG5QbGVhc2Ugd2FpdCBmb3IgdGhlIGxpbmsgdG8gYXBwZWFyLCB0aGVuIHByZXNzIENvcHkgYWdhaW4uIik7CiAgICAgIHRvYXN0KCJVcGxvYWRpbmfigKYgd2FpdCBmb3IgbGluaywgdGhlbiBwcmVzcyBDb3B5IGFnYWluIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBsaW5rVG9Vc2UgPSAnKE5vIGxpbmsgdXBsb2FkZWQpJzsKICB9CgogIGNvbnN0IHN1bW1hcnkgPQogICAgYEN1c3RvbWVyOiAke2N1c3RvbWVyfVxuYCArCiAgICBgRmlsZW5hbWU6ICR7ZmlsZW5hbWV9XG5gICsKICAgIGBRdWFudGl0eTogJHtjb3VudH0gaXRlbXNcbmAgKwogICAgYFRvdGFsIFNpemU6ICR7dG90YWxHQn0gR0JcbmAgKwogICAgYEdlbmVyYXRlZDogJHtzdGFtcH1cblxuYCArCiAgICBgJHtsaW5rVG9Vc2V9XG5cbmA7CgogIGNvbnN0IGZpbmFsVGV4dCA9IHN1bW1hcnkgKyB0aXRsZXNBcnIuam9pbignXG4nKTsKCiAgbGV0IG1lc3NhZ2UgPSBsaW5rCiAgICA/IGBMaXN0ICYgbGluayBjb3BpZWQuICgke2NvdW50fSBpdGVtcywgJHt0b3RhbEdCfSBHQilgCiAgICA6IGBMaXN0IGNvcGllZCAobm8gbGluaykuICgke2NvdW50fSBpdGVtcywgJHt0b3RhbEdCfSBHQilgOwoKICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChmaW5hbFRleHQpLnRoZW4oKCkgPT4gewogICAgdG9hc3QobWVzc2FnZS5yZXBsYWNlKC9cbi9nLCAnICcpKTsKICAgIGFsZXJ0KG1lc3NhZ2UpOwogIH0pLmNhdGNoKCgpID0+IHsKICAgIGFsZXJ0KCdDb3B5IGZhaWxlZCwgcGxlYXNlIGNvcHkgbWFudWFsbHknKTsKICB9KTsKfSk7CgpmdW5jdGlvbiByZW5kZXJTZWxlY3RlZFBhbmVsKCkgewogIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0ZWRQYW5lbEJvZHknKTsKICBpZiAoIWJvZHkpIHJldHVybjsKCiAgYm9keS5pbm5lckhUTUwgPSAnJzsKICBzdGF0ZS5zZWxlY3RlZC5mb3JFYWNoKChzLCBpKSA9PiB7CiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHJvdy5jbGFzc05hbWUgPSAncm93JzsKICAgIHJvdy5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgcm93LnN0eWxlLmp1c3RpZnlDb250ZW50ID0gJ3NwYWNlLWJldHdlZW4nOwogICAgcm93LnN0eWxlLmFsaWduSXRlbXMgPSAnY2VudGVyJzsKICAgIHJvdy5zdHlsZS5wYWRkaW5nID0gJzZweCAwJzsKICAgIHJvdy5pbm5lckhUTUwgPSBgCiAgICAgIDxkaXY+CiAgICAgICAgPHN0cm9uZz4ke2kgKyAxfS4gJHtlc2Mocy5uYW1lKX08L3N0cm9uZz4KICAgICAgICA8ZGl2IGNsYXNzPSJtZXRhIj4ke2VzYyhzLnNpemUpfTwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDo0cHg7Ij4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJpY29uIHVwIj51PC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaWNvbiBkb3duIj5kPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaWNvbiByZW1vdmUiPng8L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICBgOwoKICAgIHJvdy5xdWVyeVNlbGVjdG9yKCcudXAnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgW3N0YXRlLnNlbGVjdGVkW2kgLSAxXSwgc3RhdGUuc2VsZWN0ZWRbaV1dID0gW3N0YXRlLnNlbGVjdGVkW2ldLCBzdGF0ZS5zZWxlY3RlZFtpIC0gMV1dOwogICAgICAgIHJlbmRlck92ZXJsYXkoKTsKICAgICAgICByZW5kZXJMaXN0KHN0YXRlLml0ZW1zKTsKICAgICAgICB1cGRhdGVUb3RhbHMoKTsKICAgICAgfQogICAgfSk7CgogICAgcm93LnF1ZXJ5U2VsZWN0b3IoJy5kb3duJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgIGlmIChpIDwgc3RhdGUuc2VsZWN0ZWQubGVuZ3RoIC0gMSkgewogICAgICAgIFtzdGF0ZS5zZWxlY3RlZFtpICsgMV0sIHN0YXRlLnNlbGVjdGVkW2ldXSA9IFtzdGF0ZS5zZWxlY3RlZFtpXSwgc3RhdGUuc2VsZWN0ZWRbaSArIDFdXTsKICAgICAgICByZW5kZXJPdmVybGF5KCk7CiAgICAgICAgcmVuZGVyTGlzdChzdGF0ZS5pdGVtcyk7CiAgICAgICAgdXBkYXRlVG90YWxzKCk7CiAgICAgIH0KICAgIH0pOwoKICAgIHJvdy5xdWVyeVNlbGVjdG9yKCcucmVtb3ZlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgIHN0YXRlLnNlbGVjdGVkLnNwbGljZShpLCAxKTsKICAgICAgcmVuZGVyT3ZlcmxheSgpOwogICAgICByZW5kZXJMaXN0KHN0YXRlLml0ZW1zKTsKICAgICAgdXBkYXRlVG90YWxzKCk7CiAgICB9KTsKCiAgICBib2R5LmFwcGVuZENoaWxkKHJvdyk7CiAgfSk7Cn0KCmNvbnN0IHRvZ2dsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGVDb25maWcnKTsKY29uc3QgY29uZmlnU2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maWdTZWN0aW9uJyk7CgppZiAoaXNNb2JpbGUgJiYgdG9nZ2xlQnRuICYmIGNvbmZpZ1NlY3Rpb24pIHsKICBjb25maWdTZWN0aW9uLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIHRvZ2dsZUJ0bi50ZXh0Q29udGVudCA9ICdIaWRlIENvbmZpZ3VyYXRpb24nOwoKICB0b2dnbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBjb25zdCBpc1Zpc2libGUgPSBjb25maWdTZWN0aW9uLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpOwogICAgdG9nZ2xlQnRuLnRleHRDb250ZW50ID0gaXNWaXNpYmxlID8gJ0hpZGUgQ29uZmlndXJhdGlvbicgOiAnU2hvdyBDb25maWd1cmF0aW9uJzsKICB9KTsKfQoKZnVuY3Rpb24gcGFyc2VEYXRlRmxleGlibGUocykgewogIGlmICghcykgcmV0dXJuIG51bGw7CiAgbGV0IGQgPSBuZXcgRGF0ZShzKTsKICBpZiAoIWlzTmFOKGQuZ2V0VGltZSgpKSkgcmV0dXJuIGQ7CgogIGNvbnN0IHltZCA9ICgnJytzKS5tYXRjaCgvKFxkezR9KVxEPyhcZHsxLDJ9KVxEPyhcZHsxLDJ9KS8pOwogIGlmICh5bWQpIHsKICAgIGQgPSBuZXcgRGF0ZShOdW1iZXIoeW1kWzFdKSwgTnVtYmVyKHltZFsyXSkgLSAxLCBOdW1iZXIoeW1kWzNdKSk7CiAgICBpZiAoIWlzTmFOKGQuZ2V0VGltZSgpKSkgcmV0dXJuIGQ7CiAgfQoKICBjb25zdCBkbXkgPSAoJycrcykubWF0Y2goLyhcZHsxLDJ9KVxEKFxkezEsMn0pXEQoXGR7NH0pLyk7CiAgaWYgKGRteSkgewogICAgZCA9IG5ldyBEYXRlKE51bWJlcihkbXlbM10pLCBOdW1iZXIoZG15WzJdKSAtIDEsIE51bWJlcihkbXlbMV0pKTsKICAgIGlmICghaXNOYU4oZC5nZXRUaW1lKCkpKSByZXR1cm4gZDsKICB9CgogIHJldHVybiBudWxsOwp9CgpsZXQgc29ydE1vZGUgPSAnbm9ybWFsJzsKCmZ1bmN0aW9uIHNvcnRDeWNsZSgpIHsKICBpZiAoIXN0YXRlLml0ZW1zIHx8IHN0YXRlLml0ZW1zLmxlbmd0aCA9PT0gMCkgewogICAgdG9hc3QoJ05vIGxpc3QgbG9hZGVkIHlldCcpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKHNvcnRNb2RlID09PSAnbm9ybWFsJykgewogICAgc29ydE1vZGUgPSAnbGF0ZXN0JzsKICAgIHN0YXRlLml0ZW1zLmZvckVhY2goaXQgPT4gewogICAgICBjb25zdCByYXcgPSBpdC5kYXRlIHx8IGl0LmRhdGVNb2RpZmllZCB8fCBpdC5tb2RpZmllZCB8fCAnJzsKICAgICAgY29uc3QgZCA9IHBhcnNlRGF0ZUZsZXhpYmxlKHJhdyk7CiAgICAgIGl0Ll9wYXJzZWREYXRlID0gZCA/IGQuZ2V0VGltZSgpIDogMDsKICAgIH0pOwogICAgc3RhdGUuaXRlbXMuc29ydCgoYSwgYikgPT4gYi5fcGFyc2VkRGF0ZSAtIGEuX3BhcnNlZERhdGUpOwogICAgcmVuZGVyTGlzdChzdGF0ZS5pdGVtcyk7CiAgICB0b2FzdCgnU29ydGVkIGJ5IExhdGVzdCBNb2RpZmllZCcpOwogICAgJCgnc29ydExhdGVzdCcpLnRleHRDb250ZW50ID0gJ0xhdGVzdCc7CgogIH0gZWxzZSBpZiAoc29ydE1vZGUgPT09ICdsYXRlc3QnKSB7CiAgICBzb3J0TW9kZSA9ICdzY29yZSc7CiAgICBzdGF0ZS5pdGVtcy5zb3J0KChhLCBiKSA9PiAocGFyc2VJbnQoYi5zY29yZSB8fCAwKSAtIHBhcnNlSW50KGEuc2NvcmUgfHwgMCkpKTsKICAgIHJlbmRlckxpc3Qoc3RhdGUuaXRlbXMpOwogICAgdG9hc3QoJ1NvcnRlZCBieSBTY29yZScpOwogICAgJCgnc29ydExhdGVzdCcpLnRleHRDb250ZW50ID0gJ1RvcCc7CgogIH0gZWxzZSB7CiAgICBzb3J0TW9kZSA9ICdub3JtYWwnOwogICAgcmVuZGVyTGlzdChzdGF0ZS5pdGVtcyk7CiAgICB0b2FzdCgnU29ydGVkIGJ5IE5hbWUgKE5vcm1hbCknKTsKICAgICQoJ3NvcnRMYXRlc3QnKS50ZXh0Q29udGVudCA9ICdTb3J0JzsKICB9Cn0KCmNvbnN0IHNvcnRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29ydExhdGVzdCcpOwppZiAoc29ydEJ0bikgewogIHNvcnRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzb3J0Q3ljbGUpOwp9CgpmdW5jdGlvbiBkZXRlY3RFbnZpcm9ubWVudCgpIHsKICBjb25zdCB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmE7CiAgY29uc3QgaXNNZXNzZW5nZXIgPSAvRkJBTnxGQkFWfEZCX0lBQnxNZXNzZW5nZXIvaS50ZXN0KHVhKTsKICBjb25zdCBpc0luc3RhZ3JhbSA9IC9JbnN0YWdyYW0vaS50ZXN0KHVhKTsKICBjb25zdCBpc1dlYlZpZXcgPSAvXGJ3dlxiLy50ZXN0KHVhKSB8fCAod2luZG93Lm5hdmlnYXRvci5zdGFuZGFsb25lID09PSBmYWxzZSk7CgogIGlmIChpc01lc3NlbmdlciB8fCBpc0luc3RhZ3JhbSB8fCBpc1dlYlZpZXcpIHsKICAgIHNob3dCYW5uZXIoIk1lc3NlbmdlciBvciBpbi1hcHAgd2VidmlldyBkZXRlY3RlZC5cblRoaXMgcGFnZSBpcyBiZXN0IHVzZWQgb24gYSBmdWxsIG1vYmlsZSBicm93c2VyIG9yIGRlc2t0b3AgYnJvd3NlciwgYnV0IGl0IHdpbGwgcHJvYmFibHkgd29yayBhbnl3YXkiLCA0MDAwKTsKICB9CiAgc2hvd0Jhbm5lcigiSG93IHRvIHVzZTpcblxuMS4gRW50ZXIgeW91ciBuYW1lXG4yLiBTZWxlY3QgeW91ciBkZXZpY2UgbW9kZWwgKE9MRUQvTGl0ZS9WMS9WMilcbjMuIFNlbGVjdCB5b3VyIFNEIENhcmQgU2l6ZVxuNC4gQ2hvb3NlIHlvdXIgZ2FtZXNcbjUuIFByZXNzIFVwbG9hZFxuNi4gU2VuZCB0aGUgZ2VuZXJhdGVkIGxpbmsgdG8gb3VyIGNoYXQgY29udmVyc2F0aW9uIiwgODAwMCk7Cn0KCmZ1bmN0aW9uIHNob3dCYW5uZXIobWVzc2FnZSwgZHVyYXRpb24gPSA0MDAwKSB7CiAgY29uc3QgYmFubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgYmFubmVyLmlubmVyVGV4dCA9IG1lc3NhZ2U7CiAgYmFubmVyLnN0eWxlLmNzc1RleHQgPSAicG9zaXRpb246Zml4ZWQ7dG9wOjMwJTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC44KTtjb2xvcjojZmZmO3BhZGRpbmc6MThweDtib3JkZXItcmFkaXVzOjE2cHg7Zm9udC1zaXplOjIycHg7ei1pbmRleDo5OTk5O2JveC1zaGFkb3c6MCAycHggNnB4IHJnYmEoMCwwLDAsMC4zKTt0cmFuc2l0aW9uOm9wYWNpdHkgMC41cyBlYXNlO3doaXRlLXNwYWNlOnByZS1saW5lO21heC13aWR0aDo4MCUiOwogIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYmFubmVyKTsKCiAgc2V0VGltZW91dCgoKSA9PiBiYW5uZXIuc3R5bGUub3BhY2l0eSA9ICIwIiwgZHVyYXRpb24pOwogIHNldFRpbWVvdXQoKCkgPT4gYmFubmVyLnJlbW92ZSgpLCBkdXJhdGlvbiArIDUwMCk7Cn0KCmZ1bmN0aW9uIGxldmVuc2h0ZWluRGlzdGFuY2Uoc3RyMSwgc3RyMikgewogIGNvbnN0IGxlbjEgPSBzdHIxLmxlbmd0aDsKICBjb25zdCBsZW4yID0gc3RyMi5sZW5ndGg7CiAgY29uc3QgbWF0cml4ID0gQXJyYXkobGVuMiArIDEpLmZpbGwobnVsbCkubWFwKCgpID0+IEFycmF5KGxlbjEgKyAxKS5maWxsKDApKTsKICAKICBmb3IgKGxldCBpID0gMDsgaSA8PSBsZW4xOyBpKyspIG1hdHJpeFswXVtpXSA9IGk7CiAgZm9yIChsZXQgaiA9IDA7IGogPD0gbGVuMjsgaisrKSBtYXRyaXhbal1bMF0gPSBqOwogIAogIGZvciAobGV0IGogPSAxOyBqIDw9IGxlbjI7IGorKykgewogICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gbGVuMTsgaSsrKSB7CiAgICAgIGNvbnN0IGNvc3QgPSBzdHIxW2kgLSAxXSA9PT0gc3RyMltqIC0gMV0gPyAwIDogMTsKICAgICAgbWF0cml4W2pdW2ldID0gTWF0aC5taW4oCiAgICAgICAgbWF0cml4W2pdW2kgLSAxXSArIDEsCiAgICAgICAgbWF0cml4W2ogLSAxXVtpXSArIDEsCiAgICAgICAgbWF0cml4W2ogLSAxXVtpIC0gMV0gKyBjb3N0CiAgICAgICk7CiAgICB9CiAgfQogIAogIHJldHVybiBtYXRyaXhbbGVuMl1bbGVuMV07Cn0KCmZ1bmN0aW9uIG5vcm1hbGl6ZVRpdGxlKHRpdGxlKSB7CiAgcmV0dXJuIHRpdGxlLnRvTG93ZXJDYXNlKCkKICAgIC5yZXBsYWNlKC9bXlx3XHNdL2csICcgJykgIC8vIFJlbW92ZSBwdW5jdHVhdGlvbgogICAgLnJlcGxhY2UoL1xzKy9nLCAnICcpICAgICAgLy8gQ29sbGFwc2Ugc3BhY2VzCiAgICAudHJpbSgpOwp9CgpmdW5jdGlvbiBnZXRLZXl3b3Jkcyh0aXRsZSkgewogIGNvbnN0IG5vcm1hbGl6ZWQgPSBub3JtYWxpemVUaXRsZSh0aXRsZSk7CiAgLy8gRmlsdGVyIG91dCBjb21tb24gd29yZHMKICBjb25zdCBzdG9wV29yZHMgPSBbJ3RoZScsICdvZicsICdhbmQnLCAnYScsICdhbicsICdpbicsICdvbicsICdmb3InLCAndG8nLCAnd2l0aCddOwogIHJldHVybiBub3JtYWxpemVkLnNwbGl0KCcgJykuZmlsdGVyKHdvcmQgPT4gd29yZC5sZW5ndGggPiAwICYmICFzdG9wV29yZHMuaW5jbHVkZXMod29yZCkpOwp9CgpmdW5jdGlvbiBleHRyYWN0TnVtYmVycyh0aXRsZSkgewogIGNvbnN0IG1hdGNoZXMgPSB0aXRsZS5tYXRjaCgvXGQrL2cpOwogIHJldHVybiBtYXRjaGVzID8gbWF0Y2hlcy5tYXAobiA9PiBuKSA6IFtdOwp9CgpmdW5jdGlvbiBjYWxjdWxhdGVNYXRjaFNjb3JlKHVzZXJUaXRsZSwgZGJUaXRsZSkgewogIGNvbnN0IHVzZXJLZXl3b3JkcyA9IGdldEtleXdvcmRzKHVzZXJUaXRsZSk7CiAgY29uc3QgZGJLZXl3b3JkcyA9IGdldEtleXdvcmRzKGRiVGl0bGUpOwogIAogIGlmICh1c2VyS2V5d29yZHMubGVuZ3RoID09PSAwKSByZXR1cm4geyBzY29yZTogMCwgbnVtYmVyTWF0Y2g6IGZhbHNlLCBjb25zZWN1dGl2ZU1hdGNoZXM6IDAgfTsKICAKICBsZXQgbWF0Y2hlZFdvcmRzID0gMDsKICBsZXQgcGFydGlhbE1hdGNoZXMgPSAwOwogIGxldCBjb25zZWN1dGl2ZU1hdGNoZXMgPSAwOwogIGxldCBsYXN0TWF0Y2hJbmRleCA9IC0yOwogIAogIC8vIENoZWNrIGZvciBudW1iZXIgbWF0Y2hpbmcKICBjb25zdCB1c2VyTnVtYmVycyA9IGV4dHJhY3ROdW1iZXJzKHVzZXJUaXRsZSk7CiAgY29uc3QgZGJOdW1iZXJzID0gZXh0cmFjdE51bWJlcnMoZGJUaXRsZSk7CiAgY29uc3QgaGFzRXhhY3ROdW1iZXJNYXRjaCA9IHVzZXJOdW1iZXJzLmxlbmd0aCA+IDAgJiYgCiAgICB1c2VyTnVtYmVycy5ldmVyeShudW0gPT4gZGJOdW1iZXJzLmluY2x1ZGVzKG51bSkpOwogIAogIHVzZXJLZXl3b3Jkcy5mb3JFYWNoKCh1c2VyV29yZCwgaWR4KSA9PiB7CiAgICBsZXQgbWF0Y2hlZCA9IGZhbHNlOwogICAgCiAgICAvLyBDaGVjayBmb3IgZXhhY3Qgd29yZCBtYXRjaAogICAgY29uc3QgZXhhY3RJZHggPSBkYktleXdvcmRzLmZpbmRJbmRleChkYldvcmQgPT4gZGJXb3JkID09PSB1c2VyV29yZCk7CiAgICBpZiAoZXhhY3RJZHggIT09IC0xKSB7CiAgICAgIG1hdGNoZWRXb3JkcyArPSAxOwogICAgICBtYXRjaGVkID0gdHJ1ZTsKICAgICAgCiAgICAgIC8vIFRyYWNrIGNvbnNlY3V0aXZlIG1hdGNoZXMKICAgICAgaWYgKGV4YWN0SWR4ID09PSBsYXN0TWF0Y2hJbmRleCArIDEpIHsKICAgICAgICBjb25zZWN1dGl2ZU1hdGNoZXMrKzsKICAgICAgfQogICAgICBsYXN0TWF0Y2hJbmRleCA9IGV4YWN0SWR4OwogICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIC8vIENoZWNrIGZvciBzdWJzdHJpbmcgbWF0Y2ggLSBidXQgcmVxdWlyZSBtaW5pbXVtIGxlbmd0aAogICAgLy8gQU5EIHRoZSB1c2VyIHdvcmQgbXVzdCBiZSBzdWJzdGFudGlhbCAoMysgY2hhcnMgZm9yIG1vc3QsIDQrIGZvciB2ZXJ5IGNvbW1vbiB3b3JkcykKICAgIGlmICh1c2VyV29yZC5sZW5ndGggPj0gMykgewogICAgICBjb25zdCBzdWJzdHJpbmdJZHggPSBkYktleXdvcmRzLmZpbmRJbmRleChkYldvcmQgPT4gewogICAgICAgIC8vIERCIHdvcmQgbXVzdCBiZSBsb25nIGVub3VnaCB0byBjb250YWluIHRoZSB1c2VyIHdvcmQgbWVhbmluZ2Z1bGx5CiAgICAgICAgaWYgKGRiV29yZC5sZW5ndGggPj0gdXNlcldvcmQubGVuZ3RoICsgMSAmJiBkYldvcmQuaW5jbHVkZXModXNlcldvcmQpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgLy8gT3IgaWYgdXNlciB3b3JkIGlzIGxvbmdlciwgY2hlY2sgaWYgaXQgY29udGFpbnMgREIgd29yZCAoZm9yIGNvbXBvdW5kIHdvcmRzKQogICAgICAgIGlmICh1c2VyV29yZC5sZW5ndGggPj0gNCAmJiB1c2VyV29yZC5pbmNsdWRlcyhkYldvcmQpICYmIGRiV29yZC5sZW5ndGggPj0gMykgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSk7CiAgICAgIAogICAgICBpZiAoc3Vic3RyaW5nSWR4ICE9PSAtMSkgewogICAgICAgIC8vIEdpdmUgaGlnaGVyIHNjb3JlIGZvciBsb25nZXIgbWF0Y2hlcwogICAgICAgIGNvbnN0IG1hdGNoU3RyZW5ndGggPSB1c2VyV29yZC5sZW5ndGggPj0gNCA/IDAuOCA6IDAuNjsKICAgICAgICBwYXJ0aWFsTWF0Y2hlcyArPSBtYXRjaFN0cmVuZ3RoOwogICAgICAgIG1hdGNoZWQgPSB0cnVlOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgCiAgICAvLyBDaGVjayBmb3IgdmVyeSBjbG9zZSB0eXBvIChzaW5nbGUgY2hhciBkaWZmZXJlbmNlKQogICAgLy8gT25seSBmb3Igd29yZHMgMysgY2hhcmFjdGVycwogICAgaWYgKHVzZXJXb3JkLmxlbmd0aCA+PSAzKSB7CiAgICAgIGRiS2V5d29yZHMuZm9yRWFjaChkYldvcmQgPT4gewogICAgICAgIGlmIChkYldvcmQubGVuZ3RoIDwgMykgcmV0dXJuOyAvLyBTa2lwIHNob3J0IHdvcmRzCiAgICAgICAgCiAgICAgICAgY29uc3QgbWF4TGVuID0gTWF0aC5tYXgodXNlcldvcmQubGVuZ3RoLCBkYldvcmQubGVuZ3RoKTsKICAgICAgICBjb25zdCBtaW5MZW4gPSBNYXRoLm1pbih1c2VyV29yZC5sZW5ndGgsIGRiV29yZC5sZW5ndGgpOwogICAgICAgIAogICAgICAgIC8vIE9ubHkgY29uc2lkZXIgaWYgbGVuZ3RocyBhcmUgc2ltaWxhcgogICAgICAgIGlmIChtYXhMZW4gLSBtaW5MZW4gPD0gMiAmJiBtaW5MZW4gPj0gMykgewogICAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBsZXZlbnNodGVpbkRpc3RhbmNlKHVzZXJXb3JkLCBkYldvcmQpOwogICAgICAgICAgaWYgKGRpc3RhbmNlIDw9IDIpIHsKICAgICAgICAgICAgcGFydGlhbE1hdGNoZXMgKz0gMC41OwogICAgICAgICAgICBtYXRjaGVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwogIAogIGNvbnN0IHRvdGFsTWF0Y2hlZCA9IG1hdGNoZWRXb3JkcyArIHBhcnRpYWxNYXRjaGVzOwogIGNvbnN0IHNjb3JlID0gdG90YWxNYXRjaGVkIC8gdXNlcktleXdvcmRzLmxlbmd0aDsKICAKICByZXR1cm4geyAKICAgIHNjb3JlLCAKICAgIG51bWJlck1hdGNoOiBoYXNFeGFjdE51bWJlck1hdGNoLAogICAgY29uc2VjdXRpdmVNYXRjaGVzLAogICAgdGl0bGVMZW5ndGg6IGRiS2V5d29yZHMubGVuZ3RoLAogICAgZXhhY3RXb3JkQ291bnQ6IG1hdGNoZWRXb3JkcyAgLy8gVHJhY2sgZXhhY3QgbWF0Y2hlcyBzZXBhcmF0ZWx5CiAgfTsKfQoKZnVuY3Rpb24gZmluZEJlc3RNYXRjaCh1c2VyVGl0bGUsIGRiSXRlbXMpIHsKICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplVGl0bGUodXNlclRpdGxlKTsKICAKICAvLyBUcnkgZXhhY3QgbWF0Y2ggZmlyc3QKICBjb25zdCBleGFjdE1hdGNoID0gZGJJdGVtcy5maW5kKGl0ZW0gPT4gbm9ybWFsaXplVGl0bGUoaXRlbS5uYW1lKSA9PT0gbm9ybWFsaXplZCk7CiAgaWYgKGV4YWN0TWF0Y2gpIHsKICAgIHJldHVybiB7IG1hdGNoOiBleGFjdE1hdGNoLCBjb25maWRlbmNlOiAnZXhhY3QnLCBzY29yZTogMS4wIH07CiAgfQogIAogIC8vIFNjb3JlIGFsbCBpdGVtcwogIGNvbnN0IHNjb3JlZCA9IGRiSXRlbXMubWFwKGl0ZW0gPT4gewogICAgY29uc3QgbWF0Y2hEYXRhID0gY2FsY3VsYXRlTWF0Y2hTY29yZSh1c2VyVGl0bGUsIGl0ZW0ubmFtZSk7CiAgICByZXR1cm4gewogICAgICBpdGVtLAogICAgICAuLi5tYXRjaERhdGEKICAgIH07CiAgfSkuZmlsdGVyKHMgPT4gcy5zY29yZSA+IDApOwogIAogIGlmIChzY29yZWQubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDsKICAKICAvLyBTb3J0IGJ5IHByaW9yaXR5OgogIC8vIDEuIE51bWJlciBtYXRjaCAoY3JpdGljYWwgZm9yIHNlcXVlbHMvdmVyc2lvbnMpCiAgLy8gMi4gRXhhY3Qgd29yZCBjb3VudCAocHJlZmVyIG1vcmUgZXhhY3QgbWF0Y2hlcykKICAvLyAzLiBTY29yZQogIC8vIDQuIENvbnNlY3V0aXZlIG1hdGNoZXMgKHdvcmQgb3JkZXIgbWF0dGVycykKICAvLyA1LiBTaG9ydGVyIHRpdGxlIChtb3JlIHByZWNpc2UpCiAgc2NvcmVkLnNvcnQoKGEsIGIpID0+IHsKICAgIC8vIFByaW9yaXR5IDE6IEV4YWN0IG51bWJlciBtYXRjaAogICAgaWYgKGEubnVtYmVyTWF0Y2ggJiYgIWIubnVtYmVyTWF0Y2gpIHJldHVybiAtMTsKICAgIGlmICghYS5udW1iZXJNYXRjaCAmJiBiLm51bWJlck1hdGNoKSByZXR1cm4gMTsKICAgIAogICAgLy8gUHJpb3JpdHkgMjogTW9yZSBleGFjdCB3b3JkIG1hdGNoZXMgd2lucwogICAgaWYgKGEuZXhhY3RXb3JkQ291bnQgIT09IGIuZXhhY3RXb3JkQ291bnQpIHsKICAgICAgcmV0dXJuIGIuZXhhY3RXb3JkQ291bnQgLSBhLmV4YWN0V29yZENvdW50OwogICAgfQogICAgCiAgICAvLyBQcmlvcml0eSAzOiBTY29yZSBkaWZmZXJlbmNlCiAgICBjb25zdCBzY29yZURpZmYgPSBiLnNjb3JlIC0gYS5zY29yZTsKICAgIGlmIChNYXRoLmFicyhzY29yZURpZmYpID4gMC4xNSkgcmV0dXJuIHNjb3JlRGlmZjsKICAgIAogICAgLy8gUHJpb3JpdHkgNDogQ29uc2VjdXRpdmUgbWF0Y2hlcyAocGhyYXNlIG1hdGNoaW5nKQogICAgaWYgKGEuY29uc2VjdXRpdmVNYXRjaGVzICE9PSBiLmNvbnNlY3V0aXZlTWF0Y2hlcykgewogICAgICByZXR1cm4gYi5jb25zZWN1dGl2ZU1hdGNoZXMgLSBhLmNvbnNlY3V0aXZlTWF0Y2hlczsKICAgIH0KICAgIAogICAgLy8gUHJpb3JpdHkgNTogUHJlZmVyIHNob3J0ZXIgdGl0bGVzCiAgICByZXR1cm4gYS50aXRsZUxlbmd0aCAtIGIudGl0bGVMZW5ndGg7CiAgfSk7CiAgCiAgY29uc3QgYmVzdCA9IHNjb3JlZFswXTsKICAKICAvLyBEZXRlcm1pbmUgY29uZmlkZW5jZSBiYXNlZCBvbiBzY29yZQogIGxldCBjb25maWRlbmNlOwogIGlmIChiZXN0LnNjb3JlID49IDAuOTUpIHsKICAgIGNvbmZpZGVuY2UgPSAnaGlnaCc7CiAgfSBlbHNlIGlmIChiZXN0LnNjb3JlID49IDAuNykgewogICAgY29uZmlkZW5jZSA9ICdtZWRpdW0nOwogIH0gZWxzZSBpZiAoYmVzdC5zY29yZSA+PSAwLjUpIHsKICAgIGNvbmZpZGVuY2UgPSAnbG93JzsKICB9IGVsc2UgewogICAgcmV0dXJuIG51bGw7IC8vIFRvbyBsb3cgY29uZmlkZW5jZQogIH0KICAKICByZXR1cm4geyBtYXRjaDogYmVzdC5pdGVtLCBjb25maWRlbmNlLCBzY29yZTogYmVzdC5zY29yZSB9Owp9CgpmdW5jdGlvbiBtYXRjaFVzZXJMaXN0KHVzZXJMaXN0KSB7CiAgY29uc3QgbGluZXMgPSB1c2VyTGlzdC5zcGxpdCgnXG4nKS5tYXAocyA9PiBzLnRyaW0oKSkuZmlsdGVyKEJvb2xlYW4pOwogIGNvbnN0IHJlc3VsdHMgPSB7CiAgICBleGFjdDogW10sCiAgICBoaWdoOiBbXSwKICAgIG1lZGl1bTogW10sCiAgICBsb3c6IFtdLAogICAgbm90Rm91bmQ6IFtdCiAgfTsKICAKICBsaW5lcy5mb3JFYWNoKHVzZXJUaXRsZSA9PiB7CiAgICBjb25zdCByZXN1bHQgPSBmaW5kQmVzdE1hdGNoKHVzZXJUaXRsZSwgc3RhdGUuaXRlbXMpOwogICAgCiAgICBpZiAoIXJlc3VsdCkgewogICAgICByZXN1bHRzLm5vdEZvdW5kLnB1c2godXNlclRpdGxlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlc3VsdHNbcmVzdWx0LmNvbmZpZGVuY2VdLnB1c2goewogICAgICAgIG9yaWdpbmFsOiB1c2VyVGl0bGUsCiAgICAgICAgbWF0Y2hlZDogcmVzdWx0Lm1hdGNoLm5hbWUsCiAgICAgICAgc2l6ZTogcmVzdWx0Lm1hdGNoLnNpemUsCiAgICAgICAgc2NvcmU6IHJlc3VsdC5zY29yZQogICAgICB9KTsKICAgIH0KICB9KTsKICAKICByZXR1cm4gcmVzdWx0czsKfQoKJCgnbWF0Y2hMaXN0Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVzTW9kYWwnKTsKICBtb2RhbC5pbm5lckhUTUwgPSAnJzsKICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICBtb2RhbC5zdHlsZS5tYXhXaWR0aCA9ICc2MDBweCc7CiAgCiAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgaGVhZGVyLmlubmVySFRNTCA9ICc8c3Ryb25nPk1hdGNoIFVzZXIgTGlzdDwvc3Ryb25nPjxicj48c3BhbiBjbGFzcz0ibWV0YSI+UGFzdGUgdXNlclwncyBnYW1lIGxpc3QgYmVsb3cgKG9uZSBwZXIgbGluZSk8L3NwYW4+JzsKICBtb2RhbC5hcHBlbmRDaGlsZChoZWFkZXIpOwogIAogIGNvbnN0IHRleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTsKICB0ZXh0YXJlYS5zdHlsZS5jc3NUZXh0ID0gJ3dpZHRoOjEwMCU7bWluLWhlaWdodDoyMDBweDttYXJnaW4tdG9wOjEycHg7cGFkZGluZzo4cHg7Ym9yZGVyOjFweCBzb2xpZCAjZTVlN2ViO2JvcmRlci1yYWRpdXM6OHB4O2ZvbnQtZmFtaWx5Om1vbm9zcGFjZTtmb250LXNpemU6MTNweDsnOwogIHRleHRhcmVhLnBsYWNlaG9sZGVyID0gJ1N1cGVyIE1hcmlvIE9keXNzZXlcblRoZSBMZWdlbmQgb2YgWmVsZGFcbk1hcmlvIEthcnQgOFxuLi4uJzsKICBtb2RhbC5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7CiAgCiAgY29uc3QgYnRuQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgYnRuQ29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAnZGlzcGxheTpmbGV4O2dhcDo4cHg7bWFyZ2luLXRvcDoxMnB4Oyc7CiAgCiAgY29uc3QgbWF0Y2hCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICBtYXRjaEJ0bi50ZXh0Q29udGVudCA9ICdBbmFseXplICYgTWF0Y2gnOwogIG1hdGNoQnRuLmNsYXNzTmFtZSA9ICdidG4nOwogIG1hdGNoQnRuLm9uY2xpY2sgPSAoKSA9PiB7CiAgICBjb25zdCB1c2VyTGlzdCA9IHRleHRhcmVhLnZhbHVlLnRyaW0oKTsKICAgIGlmICghdXNlckxpc3QpIHsKICAgICAgYWxlcnQoJ1BsZWFzZSBwYXN0ZSBhIGdhbWUgbGlzdCcpOwogICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIHNob3dNYXRjaFJlc3VsdHModXNlckxpc3QpOwogIH07CiAgYnRuQ29udGFpbmVyLmFwcGVuZENoaWxkKG1hdGNoQnRuKTsKICAKICBjb25zdCBjbG9zZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogIGNsb3NlQnRuLnRleHRDb250ZW50ID0gJ0NhbmNlbCc7CiAgY2xvc2VCdG4uY2xhc3NOYW1lID0gJ2J0biBnaG9zdCc7CiAgY2xvc2VCdG4ub25jbGljayA9ICgpID0+IHsKICAgIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBtb2RhbC5pbm5lckhUTUwgPSAnJzsKICB9OwogIGJ0bkNvbnRhaW5lci5hcHBlbmRDaGlsZChjbG9zZUJ0bik7CiAgCiAgbW9kYWwuYXBwZW5kQ2hpbGQoYnRuQ29udGFpbmVyKTsKfSk7CgpmdW5jdGlvbiBzaG93TWF0Y2hSZXN1bHRzKHVzZXJMaXN0KSB7CiAgY29uc3QgcmVzdWx0cyA9IG1hdGNoVXNlckxpc3QodXNlckxpc3QpOwogIGNvbnN0IHRvdGFsTWF0Y2hlZCA9IHJlc3VsdHMuZXhhY3QubGVuZ3RoICsgcmVzdWx0cy5oaWdoLmxlbmd0aCArIHJlc3VsdHMubWVkaXVtLmxlbmd0aCArIHJlc3VsdHMubG93Lmxlbmd0aDsKICBjb25zdCB0b3RhbEl0ZW1zID0gdG90YWxNYXRjaGVkICsgcmVzdWx0cy5ub3RGb3VuZC5sZW5ndGg7CiAgCiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZXNNb2RhbCcpOwogIG1vZGFsLmlubmVySFRNTCA9ICcnOwogIG1vZGFsLnN0eWxlLm1heFdpZHRoID0gJzcwMHB4JzsKICBtb2RhbC5zdHlsZS5tYXhIZWlnaHQgPSAnODB2aCc7CiAgCiAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgaGVhZGVyLmlubmVySFRNTCA9IGA8c3Ryb25nPk1hdGNoIFJlc3VsdHM8L3N0cm9uZz48YnI+PHNwYW4gY2xhc3M9Im1ldGEiPk1hdGNoZWQ6ICR7dG90YWxNYXRjaGVkfSAvICR7dG90YWxJdGVtc308L3NwYW4+YDsKICBtb2RhbC5hcHBlbmRDaGlsZChoZWFkZXIpOwogIAogIGNvbnN0IHJlc3VsdENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIHJlc3VsdENvbnRhaW5lci5zdHlsZS5jc3NUZXh0ID0gJ21hcmdpbi10b3A6MTJweDttYXgtaGVpZ2h0OjQwMHB4O292ZXJmbG93LXk6YXV0bzsnOwogIAogIC8vIEV4YWN0IG1hdGNoZXMKICBpZiAocmVzdWx0cy5leGFjdC5sZW5ndGggPiAwKSB7CiAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MICs9IGA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjhweDsiPjxzdHJvbmcgc3R5bGU9ImNvbG9yOiMxMGI5ODE7Ij7inJMgRXhhY3QgTWF0Y2hlcyAoJHtyZXN1bHRzLmV4YWN0Lmxlbmd0aH0pPC9zdHJvbmc+PC9kaXY+YDsKICAgIHJlc3VsdHMuZXhhY3QuZm9yRWFjaChyID0+IHsKICAgICAgcmVzdWx0Q29udGFpbmVyLmlubmVySFRNTCArPSBgPGRpdiBzdHlsZT0icGFkZGluZzo0cHggOHB4O2JhY2tncm91bmQ6I2YwZmRmNDtib3JkZXItbGVmdDozcHggc29saWQgIzEwYjk4MTttYXJnaW4tYm90dG9tOjRweDtmb250LXNpemU6MTJweDsiPiR7ZXNjKHIubWF0Y2hlZCl9IDxzcGFuIHN0eWxlPSJjb2xvcjojNmI3MjgwOyI+JHtlc2Moci5zaXplKX08L3NwYW4+PC9kaXY+YDsKICAgIH0pOwogIH0KICAKICAvLyBIaWdoIGNvbmZpZGVuY2UKICBpZiAocmVzdWx0cy5oaWdoLmxlbmd0aCA+IDApIHsKICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgc3R5bGU9Im1hcmdpbjoxMnB4IDAgOHB4OyI+PHN0cm9uZyBzdHlsZT0iY29sb3I6IzNiODJmNjsiPuKJiCBIaWdoIENvbmZpZGVuY2UgKCR7cmVzdWx0cy5oaWdoLmxlbmd0aH0pPC9zdHJvbmc+PC9kaXY+YDsKICAgIHJlc3VsdHMuaGlnaC5mb3JFYWNoKHIgPT4gewogICAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MICs9IGA8ZGl2IHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7YmFja2dyb3VuZDojZWZmNmZmO2JvcmRlci1sZWZ0OjNweCBzb2xpZCAjM2I4MmY2O21hcmdpbi1ib3R0b206NHB4O2ZvbnQtc2l6ZToxMnB4OyI+PGRpdj4ke2VzYyhyLm9yaWdpbmFsKX0g4oaSIDxzdHJvbmc+JHtlc2Moci5tYXRjaGVkKX08L3N0cm9uZz48L2Rpdj48ZGl2IHN0eWxlPSJjb2xvcjojNmI3MjgwOyI+JHtlc2Moci5zaXplKX08L2Rpdj48L2Rpdj5gOwogICAgfSk7CiAgfQogIAogIC8vIE1lZGl1bSBjb25maWRlbmNlCiAgaWYgKHJlc3VsdHMubWVkaXVtLmxlbmd0aCA+IDApIHsKICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgc3R5bGU9Im1hcmdpbjoxMnB4IDAgOHB4OyI+PHN0cm9uZyBzdHlsZT0iY29sb3I6I2Y1OWUwYjsiPj8gTWVkaXVtIENvbmZpZGVuY2UgKCR7cmVzdWx0cy5tZWRpdW0ubGVuZ3RofSk8L3N0cm9uZz4gPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZToxMnB4O2NvbG9yOiM2YjcyODA7Ij5SZXZpZXcgdGhlc2U8L3NwYW4+PC9kaXY+YDsKICAgIHJlc3VsdHMubWVkaXVtLmZvckVhY2gociA9PiB7CiAgICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgc3R5bGU9InBhZGRpbmc6NHB4IDhweDtiYWNrZ3JvdW5kOiNmZmZiZWI7Ym9yZGVyLWxlZnQ6M3B4IHNvbGlkICNmNTllMGI7bWFyZ2luLWJvdHRvbTo0cHg7Zm9udC1zaXplOjEycHg7Ij48ZGl2PiR7ZXNjKHIub3JpZ2luYWwpfSDihpIgPHN0cm9uZz4ke2VzYyhyLm1hdGNoZWQpfTwvc3Ryb25nPjwvZGl2PjxkaXYgc3R5bGU9ImNvbG9yOiM2YjcyODA7Ij4ke2VzYyhyLnNpemUpfTwvZGl2PjwvZGl2PmA7CiAgICB9KTsKICB9CiAgCiAgLy8gTG93IGNvbmZpZGVuY2UKICBpZiAocmVzdWx0cy5sb3cubGVuZ3RoID4gMCkgewogICAgcmVzdWx0Q29udGFpbmVyLmlubmVySFRNTCArPSBgPGRpdiBzdHlsZT0ibWFyZ2luOjEycHggMCA4cHg7Ij48c3Ryb25nIHN0eWxlPSJjb2xvcjojZjk3MzE2OyI+4pqgIExvdyBDb25maWRlbmNlICgke3Jlc3VsdHMubG93Lmxlbmd0aH0pPC9zdHJvbmc+IDxzcGFuIHN0eWxlPSJmb250LXNpemU6MTJweDtjb2xvcjojNmI3MjgwOyI+VmVyaWZ5IG1hbnVhbGx5PC9zcGFuPjwvZGl2PmA7CiAgICByZXN1bHRzLmxvdy5mb3JFYWNoKHIgPT4gewogICAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MICs9IGA8ZGl2IHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7YmFja2dyb3VuZDojZmZmN2VkO2JvcmRlci1sZWZ0OjNweCBzb2xpZCAjZjk3MzE2O21hcmdpbi1ib3R0b206NHB4O2ZvbnQtc2l6ZToxMnB4OyI+PGRpdj4ke2VzYyhyLm9yaWdpbmFsKX0g4oaSIDxzdHJvbmc+JHtlc2Moci5tYXRjaGVkKX08L3N0cm9uZz48L2Rpdj48ZGl2IHN0eWxlPSJjb2xvcjojNmI3MjgwOyI+JHtlc2Moci5zaXplKX08L2Rpdj48L2Rpdj5gOwogICAgfSk7CiAgfQogIAogIC8vIE5vdCBmb3VuZAogIGlmIChyZXN1bHRzLm5vdEZvdW5kLmxlbmd0aCA+IDApIHsKICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgc3R5bGU9Im1hcmdpbjoxMnB4IDAgOHB4OyI+PHN0cm9uZyBzdHlsZT0iY29sb3I6I2VmNDQ0NDsiPuKclyBOb3QgRm91bmQgKCR7cmVzdWx0cy5ub3RGb3VuZC5sZW5ndGh9KTwvc3Ryb25nPjwvZGl2PmA7CiAgICByZXN1bHRzLm5vdEZvdW5kLmZvckVhY2godGl0bGUgPT4gewogICAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MICs9IGA8ZGl2IHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7YmFja2dyb3VuZDojZmVmMmYyO2JvcmRlci1sZWZ0OjNweCBzb2xpZCAjZWY0NDQ0O21hcmdpbi1ib3R0b206NHB4O2ZvbnQtc2l6ZToxMnB4OyI+JHtlc2ModGl0bGUpfTwvZGl2PmA7CiAgICB9KTsKICB9CiAgCiAgbW9kYWwuYXBwZW5kQ2hpbGQocmVzdWx0Q29udGFpbmVyKTsKICAKICBjb25zdCBidG5Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICBidG5Db250YWluZXIuc3R5bGUuY3NzVGV4dCA9ICdkaXNwbGF5OmZsZXg7Z2FwOjhweDttYXJnaW4tdG9wOjEycHg7ZmxleC13cmFwOndyYXA7JzsKICAKICBpZiAodG90YWxNYXRjaGVkID4gMCkgewogICAgY29uc3QgYWRkQWxsQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICBhZGRBbGxCdG4udGV4dENvbnRlbnQgPSBgQWRkICR7dG90YWxNYXRjaGVkfSBNYXRjaGVzIHRvIFNlbGVjdGlvbmA7CiAgICBhZGRBbGxCdG4uY2xhc3NOYW1lID0gJ2J0bic7CiAgICBhZGRBbGxCdG4ub25jbGljayA9ICgpID0+IHsKICAgICAgbGV0IGFkZGVkID0gMDsKICAgICAgWy4uLnJlc3VsdHMuZXhhY3QsIC4uLnJlc3VsdHMuaGlnaCwgLi4ucmVzdWx0cy5tZWRpdW0sIC4uLnJlc3VsdHMubG93XS5mb3JFYWNoKHIgPT4gewogICAgICAgIGlmICghc3RhdGUuc2VsZWN0ZWQuc29tZShzID0+IHMubmFtZSA9PT0gci5tYXRjaGVkKSkgewogICAgICAgICAgY29uc3QgaXRlbSA9IHN0YXRlLml0ZW1zLmZpbmQoaXQgPT4gaXQubmFtZSA9PT0gci5tYXRjaGVkKTsKICAgICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgIHN0YXRlLnNlbGVjdGVkLnB1c2goewogICAgICAgICAgICAgIG5hbWU6IGl0ZW0ubmFtZSwKICAgICAgICAgICAgICBmaWxlbmFtZTogaXRlbS5maWxlbmFtZSB8fCBpdGVtLm5hbWUsCiAgICAgICAgICAgICAgc2l6ZTogaXRlbS5zaXplCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhZGRlZCsrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIAogICAgICB1cGRhdGVUb3RhbHMoKTsKICAgICAgcmVuZGVyT3ZlcmxheSgpOwogICAgICByZW5kZXJMaXN0KHN0YXRlLml0ZW1zKTsKICAgICAgdG9hc3QoYEFkZGVkICR7YWRkZWR9IG1hdGNoZWQgZ2FtZXNgKTsKICAgICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgbW9kYWwuaW5uZXJIVE1MID0gJyc7CiAgICB9OwogICAgYnRuQ29udGFpbmVyLmFwcGVuZENoaWxkKGFkZEFsbEJ0bik7CiAgfQogIAogIGNvbnN0IGV4cG9ydE1hdGNoZWRCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICBleHBvcnRNYXRjaGVkQnRuLnRleHRDb250ZW50ID0gJ0V4cG9ydCBNYXRjaGVkJzsKICBleHBvcnRNYXRjaGVkQnRuLmNsYXNzTmFtZSA9ICdidG4gZ2hvc3QnOwogIGV4cG9ydE1hdGNoZWRCdG4ub25jbGljayA9ICgpID0+IHsKICAgIGNvbnN0IGNvbnRlbnQgPSBbLi4ucmVzdWx0cy5leGFjdCwgLi4ucmVzdWx0cy5oaWdoLCAuLi5yZXN1bHRzLm1lZGl1bSwgLi4ucmVzdWx0cy5sb3ddCiAgICAgIC5tYXAociA9PiByLm1hdGNoZWQpCiAgICAgIC5qb2luKCdcbicpOwogICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtjb250ZW50XSwgeyB0eXBlOiAndGV4dC9wbGFpbicgfSk7CiAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgYS5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgIGEuZG93bmxvYWQgPSBgbWF0Y2hlZF8ke0RhdGUubm93KCl9LnR4dGA7CiAgICBhLmNsaWNrKCk7CiAgICBVUkwucmV2b2tlT2JqZWN0VVJMKGEuaHJlZik7CiAgICB0b2FzdCgnRXhwb3J0ZWQgbWF0Y2hlZCBsaXN0Jyk7CiAgfTsKICBidG5Db250YWluZXIuYXBwZW5kQ2hpbGQoZXhwb3J0TWF0Y2hlZEJ0bik7CiAgCiAgaWYgKHJlc3VsdHMubm90Rm91bmQubGVuZ3RoID4gMCkgewogICAgY29uc3QgZXhwb3J0Tm90Rm91bmRCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgIGV4cG9ydE5vdEZvdW5kQnRuLnRleHRDb250ZW50ID0gJ0V4cG9ydCBOb3QgRm91bmQnOwogICAgZXhwb3J0Tm90Rm91bmRCdG4uY2xhc3NOYW1lID0gJ2J0biBnaG9zdCc7CiAgICBleHBvcnROb3RGb3VuZEJ0bi5zdHlsZS5iYWNrZ3JvdW5kID0gJyNmZWYyZjInOwogICAgZXhwb3J0Tm90Rm91bmRCdG4uc3R5bGUuY29sb3IgPSAnI2VmNDQ0NCc7CiAgICBleHBvcnROb3RGb3VuZEJ0bi5vbmNsaWNrID0gKCkgPT4gewogICAgICBjb25zdCBjb250ZW50ID0gcmVzdWx0cy5ub3RGb3VuZC5qb2luKCdcbicpOwogICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2NvbnRlbnRdLCB7IHR5cGU6ICd0ZXh0L3BsYWluJyB9KTsKICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgYS5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgYS5kb3dubG9hZCA9IGBub3RfZm91bmRfJHtEYXRlLm5vdygpfS50eHRgOwogICAgICBhLmNsaWNrKCk7CiAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwoYS5ocmVmKTsKICAgICAgdG9hc3QoJ0V4cG9ydGVkIG5vdCBmb3VuZCBsaXN0Jyk7CiAgICB9OwogICAgYnRuQ29udGFpbmVyLmFwcGVuZENoaWxkKGV4cG9ydE5vdEZvdW5kQnRuKTsKICB9CiAgCiAgY29uc3QgY2xvc2VCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICBjbG9zZUJ0bi50ZXh0Q29udGVudCA9ICdDbG9zZSc7CiAgY2xvc2VCdG4uY2xhc3NOYW1lID0gJ2J0biBnaG9zdCc7CiAgY2xvc2VCdG4ub25jbGljayA9ICgpID0+IHsKICAgIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBtb2RhbC5pbm5lckhUTUwgPSAnJzsKICB9OwogIGJ0bkNvbnRhaW5lci5hcHBlbmRDaGlsZChjbG9zZUJ0bik7CiAgCiAgbW9kYWwuYXBwZW5kQ2hpbGQoYnRuQ29udGFpbmVyKTsKfQoKaWYgKCFpc0xvY2FsKSB7CiAgY29uc3QgYWRtaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRtaW5FeHBvcnQnKTsKICBpZiAoYWRtaW4pIGFkbWluLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogIGNvbnN0IGJpbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaW5MaXN0Jyk7CiAgaWYgKGJpbikgYmluLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7Cn0KCmNvbnN0IHNlYXJjaElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaCcpOwoKaWYgKCFpc01vYmlsZSkgewogIGZ1bmN0aW9uIHJlZm9jdXNTZWFyY2goKSB7CiAgICBjb25zdCBhY3RpdmUgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50OwogICAgaWYgKAogICAgICBhY3RpdmUgJiYKICAgICAgKGFjdGl2ZS5pZCA9PT0gJ2N1c3RvbWVyJyB8fAogICAgICAgYWN0aXZlLnRhZ05hbWUgPT09ICdTRUxFQ1QnIHx8CiAgICAgICBhY3RpdmUudGFnTmFtZSA9PT0gJ1RFWFRBUkVBJykKICAgICkgcmV0dXJuOwogICAgc2VhcmNoSW5wdXQuZm9jdXMoKTsKICAgIHNlYXJjaElucHV0LnNlbGVjdCgpOwogIH0KCiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCByZWZvY3VzU2VhcmNoKTsKCiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgY29uc3QgbW9kYWxPcGVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVzTW9kYWwnKS5zdHlsZS5kaXNwbGF5ID09PSAnYmxvY2snOwogICAgY29uc3Qgb3ZlcmxheU9wZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3ZlcmxheScpLnN0eWxlLmRpc3BsYXkgPT09ICdmbGV4JzsKICAgIGlmICgKICAgICAgIW1vZGFsT3BlbiAmJgogICAgICAhb3ZlcmxheU9wZW4gJiYKICAgICAgZS50YXJnZXQuaWQgIT09ICdzZWFyY2gnICYmCiAgICAgIGUudGFyZ2V0LmlkICE9PSAnY3VzdG9tZXInICYmCiAgICAgICFlLnRhcmdldC5jbG9zZXN0KCdzZWxlY3QnKQogICAgKSB7CiAgICAgIHJlZm9jdXNTZWFyY2goKTsKICAgIH0KICB9KTsKCiAgWydjbGVhclNlYXJjaCcsICdzaG93U2VsZWN0ZWQnLCAnc2F2ZUJ0bicsICd1cGxvYWRCdG4nXS5mb3JFYWNoKGlkID0+IHsKICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKICAgIGlmIChidG4pIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHJlZm9jdXNTZWFyY2gpOwogIH0pOwoKICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdpdGVtJykpIHsKICAgICAgc2V0VGltZW91dChyZWZvY3VzU2VhcmNoLCAxMjApOwogICAgfQogIH0pOwoKICBbJ2Nsb3NlT3ZlcmxheSddLmZvckVhY2goaWQgPT4gewogICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgaWYgKGJ0bikgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gc2V0VGltZW91dChyZWZvY3VzU2VhcmNoLCAyMDApKTsKICB9KTsKCiAgc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldikgPT4gewogICAgaWYgKGV2LmtleSA9PT0gJ0VudGVyJykgewogICAgICBzZXRUaW1lb3V0KHJlZm9jdXNTZWFyY2gsIDE1MCk7CiAgICB9CiAgfSk7Cn0KCihhc3luYyBmdW5jdGlvbiBpbml0KCkgewogIGJ1aWxkRHluYW1pY0NvbnRyb2xzKCk7CiAgYXdhaXQgbG9hZFhNTCgpOwogIHVwZGF0ZVRvdGFscygpOwogIHVwZGF0ZUZpbGVuYW1lUHJldmlldygpOwp9KSgpOwo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+`;
    const decoded = atob(base64html);
    const iframe = document.getElementById('viewer');
    const doc = iframe.contentWindow.document;
    doc.open();
    doc.write(decoded);
    doc.close();
  </script>
</body>
</html>