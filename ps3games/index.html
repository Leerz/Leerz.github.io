<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PremazingPH Games</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
    }
    iframe {
      width: 100vw; height: 100vh;
      border: none;
      display: block;
    }
  </style>
</head>
<body>
  <iframe id="viewer"></iframe>
  <script>
    const base64html = `PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLGluaXRpYWwtc2NhbGU9MSIgLz4KPHRpdGxlIGlkPSJwYWdlVGl0bGUiPkdhbWUgU2VsZWN0b3I8L3RpdGxlPgo8c3R5bGU+Cjpyb290ey0tYmc6I2Y0ZjZmODstLXBhbmVsOiNmZmY7LS1tdXRlZDojNmI3MjgwOy0tcHJpbWFyeTojMDM2NmQ2Oy0tYWNjZW50OiNmZjhhMDA7LS1kYW5nZXI6I2VmNDQ0NDstLXJhZGl1czoxMHB4fQoqe2JveC1zaXppbmc6Ym9yZGVyLWJveH0KaHRtbCxib2R5e2hlaWdodDoxMDAlO21hcmdpbjowO2ZvbnQtZmFtaWx5OkludGVyLFNlZ29lIFVJLEFyaWFsLHNhbnMtc2VyaWY7YmFja2dyb3VuZDp2YXIoLS1iZyk7Y29sb3I6IzExMX0KLmhlYWRlcntwb3NpdGlvbjpmaXhlZDt0b3A6MDtyaWdodDowO2xlZnQ6MDtoZWlnaHQ6NzZweDtiYWNrZ3JvdW5kOnZhcigtLXBhbmVsKTtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDoxMnB4O3BhZGRpbmc6MTBweCAxNHB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNlNmVlZjY7ei1pbmRleDo2MH0KLmhlYWRlciAuc2VhcmNoe2ZsZXg6MTttaW4td2lkdGg6MTYwcHh9Ci5oZWFkZXIgaW5wdXQuc2VhcmNoLCAuaGVhZGVyIGJ1dHRvbntoZWlnaHQ6NDRweDtib3JkZXItcmFkaXVzOjEwcHg7Ym9yZGVyOjFweCBzb2xpZCAjZTZlZWY2O3BhZGRpbmc6MCAxMnB4fQouaGVhZGVyIC5hY3Rpb25ze2Rpc3BsYXk6ZmxleDtnYXA6OHB4O2FsaWduLWl0ZW1zOmNlbnRlcn0KLmhlYWRlciAudXBsb2Fke2JhY2tncm91bmQ6dmFyKC0tYWNjZW50KTtjb2xvcjojZmZmO2JvcmRlcjpub25lO3BhZGRpbmc6MTBweCAxNnB4O2JvcmRlci1yYWRpdXM6MTBweDtmb250LXdlaWdodDo2MDB9Ci5jb250YWluZXJ7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczoxZnIgMzgwcHg7Z2FwOjEycHg7cGFkZGluZzpjYWxjKDc2cHggKyAxMnB4KSAxMnB4IDE2cHg7aGVpZ2h0OmNhbGMoMTAwdmgpfQoubGVmdFBhbmV7YmFja2dyb3VuZDp2YXIoLS1wYW5lbCk7Ym9yZGVyLXJhZGl1czoxMnB4O3BhZGRpbmc6MTJweDtvdmVyZmxvdzphdXRvO2JveC1zaGFkb3c6MCA2cHggMThweCByZ2JhKDEyLDE4LDMwLDAuMDQpfQoucmlnaHRQYW5le2JhY2tncm91bmQ6dmFyKC0tcGFuZWwpO2JvcmRlci1yYWRpdXM6MTJweDtwYWRkaW5nOjEycHg7b3ZlcmZsb3c6aGlkZGVuO2JveC1zaGFkb3c6MCA2cHggMThweCByZ2JhKDEyLDE4LDMwLDAuMDQpO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW59Ci5pdGVte2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpjZW50ZXI7cGFkZGluZzoxMHB4O2JvcmRlci1yYWRpdXM6OHB4O2JvcmRlcjoxcHggc29saWQgdHJhbnNwYXJlbnQ7Y3Vyc29yOnBvaW50ZXI7bWFyZ2luLWJvdHRvbTo4cHh9Ci5pdGVtOmhvdmVye2JhY2tncm91bmQ6I2ZiZmRmZn0KLml0ZW0uc2VsZWN0ZWR7YmFja2dyb3VuZDojMGIzYjY2O2NvbG9yOiNmZmZ9Ci5tZXRhe2ZvbnQtc2l6ZToxMnB4O2NvbG9yOnZhcigtLW11dGVkKX0KLmNvbnRyb2xze2Rpc3BsYXk6Z3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6MWZyIDFmcjtnYXA6OHB4O21hcmdpbi1ib3R0b206OHB4fQouY29udHJvbHMgLmZ1bGx7Z3JpZC1jb2x1bW46MSAvIC0xfQouZmlsZW5hbWUtcHJldmlld3tncmlkLWNvbHVtbjoxIC8gLTE7cGFkZGluZzo4cHg7YmFja2dyb3VuZDojZjlmYWZiO2JvcmRlcjoxcHggc29saWQgI2U1ZTdlYjtib3JkZXItcmFkaXVzOjhweDtmb250LWZhbWlseTptb25vc3BhY2U7b3ZlcmZsb3cteDphdXRvO3doaXRlLXNwYWNlOm5vd3JhcH0KLmluZm9Sb3d7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcjtwYWRkaW5nOjEwcHg7Ym9yZGVyLXJhZGl1czo4cHg7YmFja2dyb3VuZDojZmZmO21hcmdpbi10b3A6OHB4O2JvcmRlcjoxcHggc29saWQgI2YxZjVmOX0KLmJ0bntwYWRkaW5nOjhweCAxMnB4O2JvcmRlci1yYWRpdXM6OHB4O2JvcmRlcjpub25lO2JhY2tncm91bmQ6dmFyKC0tcHJpbWFyeSk7Y29sb3I6I2ZmZjtjdXJzb3I6cG9pbnRlcn0KLmJ0bi5naG9zdHtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O2NvbG9yOnZhcigtLXByaW1hcnkpO2JvcmRlcjoxcHggc29saWQgI2U2ZWVmNn0KLnNtYWxse2ZvbnQtc2l6ZToxM3B4O2NvbG9yOnZhcigtLW11dGVkKX0KLm92ZXJsYXl7cG9zaXRpb246Zml4ZWQ7aW5zZXQ6MDtiYWNrZ3JvdW5kOnJnYmEoMjE1LDI0MCwyNTAsLjk1KTtkaXNwbGF5Om5vbmU7ZmxleC1kaXJlY3Rpb246Y29sdW1uO3otaW5kZXg6MTUwfQoub3ZlcmxheSAuaGVhZHtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47cGFkZGluZzoxMnB4O2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjU1KTthbGlnbi1pdGVtczpjZW50ZXJ9Ci5vdmVybGF5IC5ib2R5e3BhZGRpbmc6MTJweDtvdmVyZmxvdzphdXRvO2ZsZXg6MX0KLm92ZXJsYXkgLnJvd3tkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO3BhZGRpbmc6OHB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4wNil9Ci5vdmVybGF5IC5yb3cuaGlnaGxpZ2h0IHtiYWNrZ3JvdW5kOiAjZmZmM2NkO3RyYW5zaXRpb246IGJhY2tncm91bmQgMC42cyBlYXNlO30KI2ZpbGVzTW9kYWw6OmJhY2tkcm9wIHtiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMyk7fQojdG90YWxzLmV4Y2VlZGVkIHtjb2xvcjogI2MwMDtmb250LXdlaWdodDogYm9sZDt9Ci5idG4uZGFuZ2VyIHtiYWNrZ3JvdW5kOiAjYzAwO2NvbG9yOiAjZmZmO30KLm92ZXJsYXkgYnV0dG9uLmljb257cGFkZGluZzo2cHggOHB4O2JvcmRlci1yYWRpdXM6NnB4O2JvcmRlcjpub25lO2N1cnNvcjpwb2ludGVyO21hcmdpbi1sZWZ0OjZweH0KLm92ZXJsYXkgYnV0dG9uLnVwLCAub3ZlcmxheSBidXR0b24uZG93bntiYWNrZ3JvdW5kOiNmZmY7Y29sb3I6IzExMX0KLm92ZXJsYXkgYnV0dG9uLnJlbW92ZXtiYWNrZ3JvdW5kOnZhcigtLWRhbmdlcik7Y29sb3I6I2ZmZn0KLmZvb3RlckNvbnRyb2xze2Rpc3BsYXk6ZmxleDtnYXA6OHB4O2ZsZXgtd3JhcDp3cmFwO2FsaWduLWl0ZW1zOmNlbnRlcn0KQG1lZGlhIChtYXgtd2lkdGg6OTAwcHgpewogIC5jb250YWluZXJ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjFmcjsgcGFkZGluZy10b3A6Y2FsYyg3NnB4ICsgOHB4KX0KICAucmlnaHRQYW5le29yZGVyOi0xfQogIC5oZWFkZXJ7cGFkZGluZzo4cHh9Cn0KLnNlbGVjdGVkLXBhbmVsIHttYXJnaW4tdG9wOiAxMnB4O2JhY2tncm91bmQ6IHZhcigtLXBhbmVsKTtib3JkZXI6IDFweCBzb2xpZCAjZTZlZWY2O2JvcmRlci1yYWRpdXM6IDEwcHg7Ym94LXNoYWRvdzogMCA0cHggMTJweCByZ2JhKDAsMCwwLDAuMDUpO2Rpc3BsYXk6IGZsZXg7ZmxleC1kaXJlY3Rpb246IGNvbHVtbjtoZWlnaHQ6IDEwMCU7b3ZlcmZsb3c6IGhpZGRlbjt9Ci5zZWxlY3RlZC1wYW5lbCAuaGVhZCB7YmFja2dyb3VuZDogI2Y4ZmFmYztwYWRkaW5nOiA4cHggMTJweDtib3JkZXItYm90dG9tOiAxcHggc29saWQgI2U2ZWVmNjtmb250LXdlaWdodDogNjAwO2ZvbnQtc2l6ZTogMTRweDt9Ci5zZWxlY3RlZC1wYW5lbCAuYm9keSB7ZmxleDogMTtvdmVyZmxvdy15OiBhdXRvO2ZvbnQtc2l6ZTogMTNweDtwYWRkaW5nOiA4cHggMTJweDt9CkBtZWRpYSAobWF4LXdpZHRoOiA5MDBweCkgey5zZWxlY3RlZC1wYW5lbCB7ZGlzcGxheTogbm9uZSAhaW1wb3J0YW50O319Ci5jb25maWctc2VjdGlvbiB7dHJhbnNpdGlvbjogYWxsIDAuMjVzIGVhc2U7fQoubW9iaWxlLW9ubHkge2Rpc3BsYXk6IG5vbmU7fQpAbWVkaWEgKG1heC13aWR0aDogOTAwcHgpIHsKICAubW9iaWxlLW9ubHkge2Rpc3BsYXk6IGJsb2NrO30KICAuY29uZmlnLXNlY3Rpb24ge2Rpc3BsYXk6IG5vbmU7fQogIC5jb25maWctc2VjdGlvbi5hY3RpdmUge2Rpc3BsYXk6IGJsb2NrO30KfQo8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogIDxkaXYgY2xhc3M9ImhlYWRlciI+Cgk8aW5wdXQgaWQ9InNlYXJjaCIgY2xhc3M9InNlYXJjaCIgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9IlNlYXJjaCBnYW1lcy4uLiI+CgkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CiAgICAgIDxidXR0b24gaWQ9InVwbG9hZEJ0biIgY2xhc3M9ImJ0biBnaG9zdCI+VXBsb2FkPC9idXR0b24+CiAgICAgIDxidXR0b24gaWQ9InNob3dTZWxlY3RlZCIgY2xhc3M9ImJ0biBnaG9zdCI+U2hvdzwvYnV0dG9uPgoJICA8YnV0dG9uIGlkPSJzb3J0TGF0ZXN0IiBjbGFzcz0iYnRuIGdob3N0Ij5Tb3J0PC9idXR0b24+CiAgICAgIDxidXR0b24gaWQ9ImNsZWFyU2VhcmNoIiBjbGFzcz0iYnRuIGdob3N0Ij5+PC9idXR0b24+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCiAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgIDxzZWN0aW9uIGNsYXNzPSJsZWZ0UGFuZSIgaWQ9ImxlZnRQYW5lIiBhcmlhLWxhYmVsPSJHYW1lIGxpc3QiPjwvc2VjdGlvbj4KCiAgICA8YXNpZGUgY2xhc3M9InJpZ2h0UGFuZSI+CjxidXR0b24gaWQ9InRvZ2dsZUNvbmZpZyIgY2xhc3M9ImJ0biBnaG9zdCBtb2JpbGUtb25seSIgc3R5bGU9Im1hcmdpbi1ib3R0b206OHB4OyI+SGlkZSBDb25maWd1cmF0aW9uPC9idXR0b24+Cgo8ZGl2IGlkPSJjb25maWdTZWN0aW9uIiBjbGFzcz0iY29uZmlnLXNlY3Rpb24iPgogICAgICA8ZGl2IGNsYXNzPSJjb250cm9scyI+CiAgICAgICAgPGlucHV0IGlkPSJjdXN0b21lciIgY2xhc3M9ImZ1bGwiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJDdXN0b21lciBuYW1lICh1c2UgdW5kZXJzY29yZXMpIj4KICAgICAgICA8ZGl2IGNsYXNzPSJmaWxlbmFtZS1wcmV2aWV3IiBpZD0iZmlsZW5hbWVQcmV2aWV3Ij5GaWxlbmFtZSBwcmV2aWV3IHdpbGwgYXBwZWFyIGhlcmXigKY8L2Rpdj4KCQk8ZGl2IGlkPSJkeW5hbWljQ29udHJvbHMiPjwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9ImluZm9Sb3ciIHN0eWxlPSJtYXJnaW4tdG9wOjhweDsiPgogICAgICAgIDxkaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJzbWFsbCI+U3BhY2UgZm9yIGdhbWVzPC9kaXY+CiAgICAgICAgICA8ZGl2PjxzdHJvbmcgaWQ9InNwYWNlIj4wPC9zdHJvbmc+IEdCPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9InNtYWxsIj5TZWxlY3RlZCBzaXplPC9kaXY+CiAgICAgICAgICA8ZGl2PjxzdHJvbmcgaWQ9InNlbGVjdGVkU2l6ZSI+MC4wMDwvc3Ryb25nPiBHQjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9ImluZm9Sb3ciIHN0eWxlPSJtYXJnaW4tdG9wOjhweDsiPgogICAgICAgIDxkaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJzbWFsbCI+SW5zdGFsbCBlc3RpbWF0ZTwvZGl2PgogICAgICAgICAgPGRpdj48c3BhbiBpZD0iaW5zdGFsbEVzdGltYXRlIj4waCAwbTwvc3Bhbj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ic21hbGwiPlNlbGVjdGVkPC9kaXY+CiAgICAgICAgICA8ZGl2PjxzcGFuIGlkPSJjb3VudCI+MDwvc3Bhbj4gZ2FtZXM8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogIDwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjEycHg7ZGlzcGxheTpmbGV4O2dhcDo4cHg7YWxpZ24taXRlbXM6Y2VudGVyOyI+CgkJPGlucHV0IGlkPSJzaGFyZWFibGUiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJVcGxvYWRlZCBmaWxlIGxpbmsiIHN0eWxlPSJmbGV4OjE7cGFkZGluZzo4cHg7Ym9yZGVyLXJhZGl1czo4cHg7Ym9yZGVyOjFweCBzb2xpZCAjZTZlZWY2IiByZWFkb25seT4KCQk8YnV0dG9uIGlkPSJjb3B5TGluayIgY2xhc3M9ImJ0biI+Q29weSBMaXN0ICYgTGluazwvYnV0dG9uPgogICAgICAgIDxidXR0b24gaWQ9InNhdmVCdG4iIGNsYXNzPSJidG4iPlNhdmU8L2J1dHRvbj4KCQk8bGFiZWwgZm9yPSJmaWxlSW4iIHN0eWxlPSJiYWNrZ3JvdW5kOiMzYTZkZjA7Y29sb3I6I2ZmZjtwYWRkaW5nOjVweCA1cHg7Ym9yZGVyLXJhZGl1czozcHg7Zm9udC1zaXplOjEycHg7Y3Vyc29yOnBvaW50ZXI7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZjtkaXNwbGF5OmlubGluZS1ibG9jazsiPk9wZW48L2xhYmVsPgo8aW5wdXQgaWQ9ImZpbGVJbiIgdHlwZT0iZmlsZSIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6MTJweDtkaXNwbGF5OmZsZXg7Z2FwOjhweDthbGlnbi1pdGVtczpjZW50ZXI7ZmxleC13cmFwOndyYXAiPgogICAgICAgIDxidXR0b24gaWQ9ImFkbWluRXhwb3J0IiBjbGFzcz0iYnRuIGdob3N0Ij5FeHBvcnQgQWRtaW48L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGlkPSJtYXRjaExpc3QiIGNsYXNzPSJidG4gZ2hvc3QiPk1hdGNoIExpc3Q8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGlkPSJiaW5MaXN0IiBjbGFzcz0iYnRuIGdob3N0Ij5VcGxvYWRzPC9idXR0b24+CgkJPGRpdiBpZD0iZmlsZUxpc3RDb250YWluZXIiIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij4KCQkgIDxkaXYgaWQ9ImJpbkZpbGVMaXN0Ij48L2Rpdj4KCQk8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjEycHg7ZmxleDoxO292ZXJmbG93OmF1dG87Zm9udC1zaXplOjEzcHg7Y29sb3I6dmFyKC0tbXV0ZWQpIj4KICAgICAgICA8ZGl2IGlkPSJzdGF0dXMiPlJlYWR5PC9kaXY+CiAgICAgIDwvZGl2Pgo8ZGl2IGlkPSJzZWxlY3RlZFBhbmVsIiBjbGFzcz0ic2VsZWN0ZWQtcGFuZWwiPgogIDxkaXYgY2xhc3M9ImJvZHkiIGlkPSJzZWxlY3RlZFBhbmVsQm9keSI+PC9kaXY+CjwvZGl2PgogICAgPC9hc2lkZT4KICA8L2Rpdj4KCiAgPGRpdiBjbGFzcz0ib3ZlcmxheSIgaWQ9Im92ZXJsYXkiPgogICAgPGRpdiBjbGFzcz0iaGVhZCI+PGRpdj48c3Ryb25nPlNlbGVjdGVkIFRpdGxlczwvc3Ryb25nPiDigJMgPHNwYW4gaWQ9Im92ZXJsYXlDb3VudCI+MDwvc3Bhbj48L2Rpdj48ZGl2PjxidXR0b24gaWQ9ImNsb3NlT3ZlcmxheSIgY2xhc3M9ImJ0biBnaG9zdCI+Q2xvc2U8L2J1dHRvbj48L2Rpdj48L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImJvZHkiIGlkPSJvdmVybGF5Qm9keSI+PC9kaXY+CiAgPC9kaXY+CjxkaXYgaWQ9ImZpbGVzTW9kYWwiIHN0eWxlPSJkaXNwbGF5Om5vbmU7cG9zaXRpb246Zml4ZWQ7dG9wOjUwJTtsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlKC01MCUsLTUwJSk7CiAgYmFja2dyb3VuZDojZmZmO3BhZGRpbmc6MTZweDtib3JkZXItcmFkaXVzOjEwcHg7Ym94LXNoYWRvdzowIDZweCAxOHB4IHJnYmEoMCwwLDAsMC4yNSk7ei1pbmRleDoyMDA7CiAgbWF4LXdpZHRoOjQyMHB4O3dpZHRoOjkwJTttYXgtaGVpZ2h0Ojcwdmg7b3ZlcmZsb3c6YXV0bztmb250LXNpemU6MTNweCI+CjwvZGl2Pgo8c2NyaXB0PgovLyA9PT09PT09PT09PT09PT09PT09PSBDT05GSUdVUkFUSU9OIEJMT0NLID09PT09PT09PT09PT09PT09PT09CmNvbnN0IENPTkZJRyA9IHsKICB4bWxGaWxlOiAncHJtem5nX1BTM0lTT19kYi54bWwnLCAgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBwbGF0Zm9ybSBYTUwKICBjbGllbnRGaWxlRXh0OiAnLkNMSV9QUk1aUCcsCiAgYWRtaW5GaWxlRXh0OiAnLlBSTVpQJywKICBmaWxlYmluQnVja2V0OiAnb2QxYmVsOHo2enBndDVldicsCiAgCiAgLy8gQXV0by1kZXRlY3RlZCBmcm9tIFhNTAogIHBsYXRmb3JtOiBudWxsLAogIHN0cnVjdHVyZVR5cGU6IG51bGwsICAvLyAnZm9sZGVycycgb3IgJ2ZpbGVzJwogIGFkbWluQmFzZVBhdGg6ICdQOlxcUFMzSVNPXFwnLAogIAogIHN0b3JhZ2VDb250cm9sczogWwogICAgewogICAgICBpZDogJ2NvbnNvbGUnLAogICAgICBsYWJlbDogJ0NvbnNvbGUnLAogICAgICB0eXBlOiAnc2VsZWN0JywKICAgICAgb3B0aW9uczogWwogICAgICAgIHsgdmFsdWU6ICdmYXQnLCBsYWJlbDogJ2ZhdCcgfSwKICAgICAgICB7IHZhbHVlOiAnc2xpbScsIGxhYmVsOiAnc2xpbScgfSwKICAgICAgICB7IHZhbHVlOiAnc3VwZXJzbGltJywgbGFiZWw6ICdzdXBlcnNsaW0nIH0KICAgICAgXSwKICAgICAgZGVmYXVsdDogJ3NsaW0nLAogICAgICBmaWxlbmFtZVRva2VuOiB0cnVlCiAgICB9LAogICAgewogICAgICBpZDogJ2hkZCcsCiAgICAgIGxhYmVsOiAnSEREIChHQiknLAogICAgICB0eXBlOiAnc2VsZWN0JywKICAgICAgb3B0aW9uczogWwogICAgICAgIHsgdmFsdWU6ICc1MDAnLCBsYWJlbDogJzUwMCcgfSwKICAgICAgICB7IHZhbHVlOiAnMTAwMCcsIGxhYmVsOiAnMTAwMCcgfQogICAgICBdLAogICAgICBkZWZhdWx0OiAnNTAwJywKICAgICAgZmlsZW5hbWVUb2tlbjogJ2hkZCcsCiAgICAgIHN0b3JhZ2VDYWxjOiB0cnVlCiAgICB9LAogIF0sCiAgCiAgY2FsY3VsYXRlU3RvcmFnZTogZnVuY3Rpb24odmFsdWVzKSB7CiAgICBjb25zdCBjb25zb2xlVmFsID0gdmFsdWVzLmNvbnNvbGUgfHwgJ2ZhdCc7CiAgICBjb25zdCBoZGRWYWwgPSBOdW1iZXIodmFsdWVzLmhkZCB8fCA1MDApOwogICAgY29uc3QgYnVmZmEgPSBNYXRoLmZsb29yKGhkZFZhbCAtIChoZGRWYWwgKi4xOCkgKTsKICAgIGNvbnN0IHRvdGFsUmVzZXJ2ZWQgPSBoZGRWYWwgLSBidWZmYTsKICAgIHJldHVybiAoaGRkVmFsIC0gdG90YWxSZXNlcnZlZCk7CiAgfQp9OwovLyA9PT09PT09PT09PT09PT09PT09PSBFTkQgQ09ORklHVVJBVElPTiA9PT09PT09PT09PT09PT09PT09PQoKY29uc3Qgc3RhdGUgPSB7IGl0ZW1zOiBbXSwgc2VsZWN0ZWQ6IFtdLCB4bWw6IG51bGwsIGxhc3RVcGxvYWQ6MCB9Owpjb25zdCBsZWZ0UGFuZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZWZ0UGFuZScpOwpjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ292ZXJsYXknKTsKY29uc3Qgb3ZlcmxheUJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3ZlcmxheUJvZHknKTsKY29uc3QgaXNNb2JpbGUgPSAvTW9iaXxBbmRyb2lkfGlQaG9uZXxpUGFkfGlQb2QvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOwpjb25zdCBpc0xvY2FsID0gZmFsc2U7Cgpjb25zdCBNSU5fREVMQVkgPSAxMDAwOwpsZXQgbm93ID0gRGF0ZS5ub3coKTsKbGV0IGxhc3RFeHBvcnRUaW1lID0gRGF0ZS5ub3coKTsKCmNvbnN0ICQgPSBpZD0+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwpmdW5jdGlvbiBlc2Mocyl7IHJldHVybiAoc3x8JycpLnJlcGxhY2UoLyYvZywnJmFtcDsnKS5yZXBsYWNlKC88L2csJyZsdDsnKS5yZXBsYWNlKC8+L2csJyZndDsnKS5yZXBsYWNlKC8nL2csJyYjMzk7JykucmVwbGFjZSgvIi9nLCcmcXVvdDsnKTsgfQpmdW5jdGlvbiB0b2FzdChtc2cpeyAkKCdzdGF0dXMnKS50ZXh0Q29udGVudCA9IG1zZzsgc2V0VGltZW91dCgoKT0+eyBpZigkKCdzdGF0dXMnKS50ZXh0Q29udGVudCA9PT0gbXNnKSAkKCdzdGF0dXMnKS50ZXh0Q29udGVudCA9ICdSZWFkeSc7IH0sIDI1MDApOyB9CgpmdW5jdGlvbiBwYXJzZVNpemVUZXh0KHMpeyBpZighcykgcmV0dXJuIDA7IGNvbnN0IG0gPSAoJycrcykubWF0Y2goLyhbXGRcLl0rKVxzKihHaUJ8TWlCfEtpQnxHQnxNQnxLQnxCKS9pKTsgaWYoIW0pIHJldHVybiAwOyBjb25zdCB2PXBhcnNlRmxvYXQobVsxXSk7IGNvbnN0IHU9bVsyXS50b1VwcGVyQ2FzZSgpOyBpZih1PT09J0InKSByZXR1cm4gdjsgaWYodT09PSdLQid8fHU9PT0nS0lCJykgcmV0dXJuIHYqMTAyNDsgaWYodT09PSdNQid8fHU9PT0nTUlCJykgcmV0dXJuIHYqMTAyNCoxMDI0OyByZXR1cm4gdioxMDI0KjEwMjQqMTAyNDsgfQpmdW5jdGlvbiBieXRlc1RvR0IoYil7IHJldHVybiBiLygxMDI0KjEwMjQqMTAyNCk7IH0KCmZ1bmN0aW9uIGJ1aWxkRHluYW1pY0NvbnRyb2xzKCkgewogIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkeW5hbWljQ29udHJvbHMnKTsKICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7CiAgY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnZ3JpZCc7CiAgY29udGFpbmVyLnN0eWxlLmdyaWRUZW1wbGF0ZUNvbHVtbnMgPSAnMWZyIDFmcic7CiAgY29udGFpbmVyLnN0eWxlLmdhcCA9ICc4cHgnOwogIAogIENPTkZJRy5zdG9yYWdlQ29udHJvbHMuZm9yRWFjaChjdHJsID0+IHsKICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgY29uc3QgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpOwogICAgbGFiZWwuY2xhc3NOYW1lID0gJ3NtYWxsJzsKICAgIGxhYmVsLnRleHRDb250ZW50ID0gY3RybC5sYWJlbDsKICAgIGRpdi5hcHBlbmRDaGlsZChsYWJlbCk7CiAgICBpZiAoY3RybC50eXBlID09PSAnc2VsZWN0JykgewogICAgICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWxlY3QnKTsKICAgICAgc2VsZWN0LmlkID0gY3RybC5pZDsKICAgICAgc2VsZWN0LnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGN0cmwubGFiZWwpOwogICAgICBjdHJsLm9wdGlvbnMuZm9yRWFjaChvcHQgPT4gewogICAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwogICAgICAgIG9wdGlvbi52YWx1ZSA9IG9wdC52YWx1ZTsKICAgICAgICBvcHRpb24udGV4dENvbnRlbnQgPSBvcHQubGFiZWw7CiAgICAgICAgaWYgKG9wdC52YWx1ZSA9PT0gY3RybC5kZWZhdWx0KSBvcHRpb24uc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgIHNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb24pOwogICAgICB9KTsKICAgICAgZGl2LmFwcGVuZENoaWxkKHNlbGVjdCk7CiAgICAgIHNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHVwZGF0ZUZpbGVuYW1lUHJldmlldygpKTsKICAgICAgc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHVwZGF0ZVRvdGFscygpKTsKICAgIH0KICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOwogIH0pOwp9Cgphc3luYyBmdW5jdGlvbiBsb2FkWE1MKCl7CiAgdHJ5ewogICAgY29uc3QgdHh0ID0gYXdhaXQgZmV0Y2goQ09ORklHLnhtbEZpbGUpLnRoZW4ocj0+ci50ZXh0KCkpOwogICAgY29uc3QgeG1sID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyh0eHQsJ2FwcGxpY2F0aW9uL3htbCcpOwogICAgc3RhdGUueG1sID0geG1sOwogICAgCiAgICBjb25zdCByb290ID0geG1sLmRvY3VtZW50RWxlbWVudDsKICAgIENPTkZJRy5wbGF0Zm9ybSA9IHJvb3QuZ2V0QXR0cmlidXRlKCdwbGF0Zm9ybScpIHx8ICdVbmtub3duJzsKICAgIENPTkZJRy5zdHJ1Y3R1cmVUeXBlID0gcm9vdC5nZXRBdHRyaWJ1dGUoJ3N0cnVjdHVyZVR5cGUnKSB8fCAnZm9sZGVycyc7CiAgICAKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdlVGl0bGUnKS50ZXh0Q29udGVudCA9IGAke0NPTkZJRy5wbGF0Zm9ybX0gR2FtZXNgOwogICAgCiAgICBsZXQgaXRlbXMgPSBbXTsKICAgIAogICAgaWYgKENPTkZJRy5zdHJ1Y3R1cmVUeXBlID09PSAnZm9sZGVycycpIHsKICAgICAgaXRlbXMgPSBBcnJheS5mcm9tKHhtbC5xdWVyeVNlbGVjdG9yQWxsKCdmb2xkZXInKSkKICAgICAgICAubWFwKGYgPT4gKHsKICAgICAgICAgIG5hbWU6IGYuZ2V0QXR0cmlidXRlKCduYW1lJyksCiAgICAgICAgICBzY29yZTogZi5nZXRBdHRyaWJ1dGUoJ3Njb3JlJykgfHwgJzAnLAogICAgICAgICAgc2l6ZTogZi5nZXRBdHRyaWJ1dGUoJ3NpemUnKSB8fCAnMCBHaUInLAogICAgICAgICAgZGF0ZTogZi5nZXRBdHRyaWJ1dGUoJ2RhdGVDcmVhdGVkJykgfHwgJycsCiAgICAgICAgICBmaWxlQ291bnQ6IGYuZ2V0QXR0cmlidXRlKCdmaWxlQ291bnQnKSB8fCAnMCcsCiAgICAgICAgICBmaWxlczogQXJyYXkuZnJvbShmLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ZpbGUnKSkubWFwKHggPT4geC5nZXRBdHRyaWJ1dGUoJ25hbWUnKSkKICAgICAgICB9KSk7CiAgICB9IGVsc2UgewogICAgICBpdGVtcyA9IEFycmF5LmZyb20oeG1sLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ZpbGUnKSkKICAgICAgICAubWFwKGYgPT4gKHsKICAgICAgICAgIG5hbWU6IGYuZ2V0QXR0cmlidXRlKCduYW1lJyksCiAgICAgICAgICBmaWxlbmFtZTogZi5nZXRBdHRyaWJ1dGUoJ2ZpbGVuYW1lJykgfHwgZi5nZXRBdHRyaWJ1dGUoJ25hbWUnKSwKICAgICAgICAgIHNpemU6IGYuZ2V0QXR0cmlidXRlKCdzaXplJykgfHwgJzAgR2lCJywKICAgICAgICAgIGRhdGU6IGYuZ2V0QXR0cmlidXRlKCdkYXRlQ3JlYXRlZCcpIHx8ICcnCiAgICAgICAgfSkpOwogICAgfQogICAgCiAgICBzdGF0ZS5pdGVtcyA9IGl0ZW1zOwogICAgcmVuZGVyTGlzdChpdGVtcyk7CiAgICB0b2FzdChgTG9hZGVkICR7aXRlbXMubGVuZ3RofSAke0NPTkZJRy5wbGF0Zm9ybX0gZ2FtZXNgKTsKICB9Y2F0Y2goZSl7IAogICAgY29uc29sZS5lcnJvcihlKTsgCiAgICBsZWZ0UGFuZS5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0iY29sb3I6I2I5MWMxYztwYWRkaW5nOjEycHgiPkZhaWxlZCB0byBsb2FkICR7Q09ORklHLnhtbEZpbGV9PC9kaXY+YDsgCiAgfQp9CgpmdW5jdGlvbiByZW5kZXJMaXN0KGxpc3QpeyAKICBsZWZ0UGFuZS5pbm5lckhUTUwgPSAnJzsgCiAgaWYoIWxpc3R8fCFsaXN0Lmxlbmd0aCl7IAogICAgbGVmdFBhbmUuaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9Im1ldGEiPk5vIGl0ZW1zIGZvdW5kPC9kaXY+JzsgCiAgICByZXR1cm47IAogIH0KICAKICBsaXN0LmZvckVhY2goaXRlbT0+ewogICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7IAogICAgcm93LmNsYXNzTmFtZT0naXRlbSc7IAogICAgcm93LmRhdGFzZXQubmFtZSA9IGl0ZW0ubmFtZTsgCiAgICByb3cuZGF0YXNldC5zaXplID0gaXRlbS5zaXplOwogICAgaWYgKGl0ZW0uZmlsZW5hbWUpIHJvdy5kYXRhc2V0LmZpbGVuYW1lID0gaXRlbS5maWxlbmFtZTsKICAgIAogICAgY29uc3QgbWV0YUluZm8gPSBpdGVtLmZpbGVDb3VudCA/IGBGaWxlczogJHtpdGVtLmZpbGVDb3VudH1gIDogJyc7CiAgICBjb25zdCBzY29yZUluZm8gPSBpdGVtLnNjb3JlID8gYFNjb3JlOiAke2VzYyhpdGVtLnNjb3JlKX1gIDogJyc7CiAgICBjb25zdCBkYXRlSW5mbyA9IGl0ZW0uZGF0ZSA/IGBNb2RpZmllZDogJHtlc2MoaXRlbS5kYXRlKX1gIDogJyc7CiAgICBjb25zdCBtZXRhUGFydHMgPSBbbWV0YUluZm8sIHNjb3JlSW5mbywgZGF0ZUluZm9dLmZpbHRlcihCb29sZWFuKS5qb2luKCcgOyAnKTsKICAgIAogICAgY29uc3QgaGFzRmlsZXMgPSBDT05GSUcuc3RydWN0dXJlVHlwZSA9PT0gJ2ZvbGRlcnMnICYmIGl0ZW0uZmlsZXMgJiYgaXRlbS5maWxlcy5sZW5ndGggPiAwOwogICAgCiAgICByb3cuaW5uZXJIVE1MID0gYAogICAgICA8ZGl2PgogICAgICAgICR7aGFzRmlsZXMgPyBgPGJ1dHRvbiBjbGFzcz0iYnRuIGdob3N0IGZpbGUtYnRuIiBzdHlsZT0icGFkZGluZzoycHggNnB4O2ZvbnQtc2l6ZToxMXB4Ij4/PC9idXR0b24+YCA6ICcnfQogICAgICAgIDxzdHJvbmc+JHtlc2MoaXRlbS5uYW1lKX08L3N0cm9uZz4KICAgICAgICA8ZGl2IGNsYXNzPSdtZXRhJz4ke21ldGFQYXJ0c308L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9J21ldGEnPiR7ZXNjKGl0ZW0uc2l6ZSl9PC9kaXY+CiAgICBgOwoKICAgIGlmKHN0YXRlLnNlbGVjdGVkLnNvbWUocz0+cy5uYW1lPT09aXRlbS5uYW1lKSkgcm93LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7CiAgICAKICAgIGlmIChoYXNGaWxlcykgewogICAgICBjb25zdCBmaWxlQnRuID0gcm93LnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWJ0bicpOwogICAgICBpZiAoZmlsZUJ0bikgewogICAgICAgIGZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXYpPT57CiAgICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIHNob3dGaWxlcyhpdGVtLm5hbWUsIGl0ZW0uZmlsZXMgfHwgW10sIGl0ZW0uc2l6ZSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcm93LmFkZEV2ZW50TGlzdGVuZXIoJ2RibGNsaWNrJywgKCk9PiBzaG93RmlsZXMoaXRlbS5uYW1lLCBpdGVtLmZpbGVzfHxbXSwgaXRlbS5zaXplKSk7CiAgICB9CiAgICAKICAgIHJvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldik9PnsKICAgICAgaWYoZXYuYWx0S2V5ICYmIGhhc0ZpbGVzKXsgCiAgICAgICAgc2hvd0ZpbGVzKGl0ZW0ubmFtZSwgaXRlbS5maWxlcyB8fCBbXSwgaXRlbS5zaXplKTsgCiAgICAgICAgcmV0dXJuOyAKICAgICAgfSAKICAgICAgdG9nZ2xlU2VsZWN0KGl0ZW0sIHJvdyk7IAogICAgfSk7CiAgICAKICAgIGxlZnRQYW5lLmFwcGVuZENoaWxkKHJvdyk7CiAgfSk7Cn0KCmZ1bmN0aW9uIHRvZ2dsZVNlbGVjdChpdGVtLCByb3dFbCl7IAogIGNvbnN0IGlkeCA9IHN0YXRlLnNlbGVjdGVkLmZpbmRJbmRleChzPT5zLm5hbWU9PT1pdGVtLm5hbWUpOyAKICBpZihpZHg+PTApeyAKICAgIHN0YXRlLnNlbGVjdGVkLnNwbGljZShpZHgsMSk7IAogICAgaWYocm93RWwpIHJvd0VsLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7IAogIH0gZWxzZSB7IAogICAgc3RhdGUuc2VsZWN0ZWQucHVzaCh7IAogICAgICBuYW1lOml0ZW0ubmFtZSwgCiAgICAgIGZpbGVuYW1lOiBpdGVtLmZpbGVuYW1lIHx8IGl0ZW0ubmFtZSwKICAgICAgc2l6ZTppdGVtLnNpemUgCiAgICB9KTsgCiAgICBpZihyb3dFbCkgcm93RWwuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTsgCiAgfQogIHVwZGF0ZVRvdGFscygpOyAKICByZW5kZXJPdmVybGF5KCk7IAp9CgpmdW5jdGlvbiByZW5kZXJPdmVybGF5KCkgewogIG92ZXJsYXlCb2R5LmlubmVySFRNTCA9ICcnOwogIHN0YXRlLnNlbGVjdGVkLmZvckVhY2goKHMsaSk9PnsKICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgcm93LmNsYXNzTmFtZT0ncm93JzsKICAgIHJvdy5pbm5lckhUTUwgPSBgCiAgICAgIDxkaXY+CiAgICAgICAgPHN0cm9uZz4ke2krMX0uICR7ZXNjKHMubmFtZSl9PC9zdHJvbmc+CiAgICAgICAgPGRpdiBjbGFzcz0nbWV0YSc+JHtlc2Mocy5zaXplKX08L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXY+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0naWNvbiB1cCc+dTwvYnV0dG9uPgogICAgICAgIDxidXR0b24gY2xhc3M9J2ljb24gZG93bic+ZDwvYnV0dG9uPgogICAgICAgIDxidXR0b24gY2xhc3M9J2ljb24gcmVtb3ZlJz54PC9idXR0b24+CiAgICAgIDwvZGl2PmA7CgogICAgcm93LnF1ZXJ5U2VsZWN0b3IoJy51cCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PnsKICAgICAgaWYoaT4wKXsKICAgICAgICBbc3RhdGUuc2VsZWN0ZWRbaS0xXSwgc3RhdGUuc2VsZWN0ZWRbaV1dID0gW3N0YXRlLnNlbGVjdGVkW2ldLCBzdGF0ZS5zZWxlY3RlZFtpLTFdXTsKICAgICAgICByZW5kZXJPdmVybGF5KCk7CiAgICAgICAgcmVuZGVyTGlzdChzdGF0ZS5pdGVtcyk7CiAgICAgICAgdXBkYXRlVG90YWxzKCk7CiAgICAgICAgb3ZlcmxheUJvZHkuY2hpbGRyZW5baS0xXS5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQnKTsKICAgICAgfQogICAgfSk7CgogICAgcm93LnF1ZXJ5U2VsZWN0b3IoJy5kb3duJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+ewogICAgICBpZihpPHN0YXRlLnNlbGVjdGVkLmxlbmd0aC0xKXsKICAgICAgICBbc3RhdGUuc2VsZWN0ZWRbaSsxXSwgc3RhdGUuc2VsZWN0ZWRbaV1dID0gW3N0YXRlLnNlbGVjdGVkW2ldLCBzdGF0ZS5zZWxlY3RlZFtpKzFdXTsKICAgICAgICByZW5kZXJPdmVybGF5KCk7CiAgICAgICAgcmVuZGVyTGlzdChzdGF0ZS5pdGVtcyk7CiAgICAgICAgdXBkYXRlVG90YWxzKCk7CiAgICAgICAgb3ZlcmxheUJvZHkuY2hpbGRyZW5baSsxXS5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQnKTsKICAgICAgfQogICAgfSk7CgogICAgcm93LnF1ZXJ5U2VsZWN0b3IoJy5yZW1vdmUnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT57CiAgICAgIGNvbnN0IHJlbW92ZWQgPSBzdGF0ZS5zZWxlY3RlZC5zcGxpY2UoaSwxKVswXTsKICAgICAgY29uc3QgbGVmdFJvdyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLml0ZW0nKSkKICAgICAgICAuZmluZCh4PT54LmRhdGFzZXQubmFtZT09PXJlbW92ZWQubmFtZSk7CiAgICAgIGlmKGxlZnRSb3cpIGxlZnRSb3cuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTsKICAgICAgcmVuZGVyT3ZlcmxheSgpOwogICAgICByZW5kZXJMaXN0KHN0YXRlLml0ZW1zKTsKICAgICAgdXBkYXRlVG90YWxzKCk7CiAgICB9KTsKCiAgICBvdmVybGF5Qm9keS5hcHBlbmRDaGlsZChyb3cpOwogIH0pOwogICQoJ292ZXJsYXlDb3VudCcpLnRleHRDb250ZW50ID0gc3RhdGUuc2VsZWN0ZWQubGVuZ3RoOwogIHJlbmRlclNlbGVjdGVkUGFuZWwoKTsKfQoKJCgnc2hvd1NlbGVjdGVkJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+eyBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7IHJlbmRlck92ZXJsYXkoKTsgfSk7CiQoJ2Nsb3NlT3ZlcmxheScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PiBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZScpOwoKZnVuY3Rpb24gc2hvd0ZpbGVzKG5hbWUsIGZpbGVzLCBzaXplKSB7CiAgaWYgKCFmaWxlcyB8fCAhZmlsZXMubGVuZ3RoKSB7CiAgICBhbGVydChgTm8gZmlsZXMgZm9yICR7bmFtZX1gKTsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVzTW9kYWwnKTsKICBtb2RhbC5pbm5lckhUTUwgPSAnJzsgCiAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgCiAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgaGVhZGVyLmlubmVySFRNTCA9IGA8c3Ryb25nPiR7ZXNjKG5hbWUpfTwvc3Ryb25nPjxicj48c3BhbiBjbGFzcz0ibWV0YSI+U2l6ZTogJHtlc2Moc2l6ZSl9IOKAkyAke2ZpbGVzLmxlbmd0aH0gZmlsZXM8L3NwYW4+YDsKICBtb2RhbC5hcHBlbmRDaGlsZChoZWFkZXIpOwoKICBjb25zdCBsaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgbGlzdC5zdHlsZS5tYXJnaW5Ub3AgPSAnOHB4JzsKICBtb2RhbC5hcHBlbmRDaGlsZChsaXN0KTsKCiAgbGV0IGluZGV4ID0gMDsKICBjb25zdCBiYXRjaCA9IDIwOwogIGZ1bmN0aW9uIGxvYWRNb3JlKCkgewogICAgY29uc3QgbmV4dCA9IGZpbGVzLnNsaWNlKGluZGV4LCBpbmRleCtiYXRjaCk7CiAgICBsaXN0LmlubmVySFRNTCArPSBuZXh0Lm1hcChmPT5lc2MoZikpLmpvaW4oJzxicj4nKTsKICAgIGluZGV4ICs9IGJhdGNoOwogICAgaWYgKGluZGV4ID49IGZpbGVzLmxlbmd0aCkgewogICAgICBtb3JlQnRuLnJlbW92ZSgpOwogICAgfQogIH0KCiAgY29uc3QgbW9yZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogIG1vcmVCdG4udGV4dENvbnRlbnQgPSAnTW9yZSc7CiAgbW9yZUJ0bi5jbGFzc05hbWUgPSAnYnRuIGdob3N0JzsKICBtb3JlQnRuLnN0eWxlLm1hcmdpblRvcCA9ICcxMHB4JzsKICBtb3JlQnRuLm9uY2xpY2sgPSBsb2FkTW9yZTsKICBtb2RhbC5hcHBlbmRDaGlsZChtb3JlQnRuKTsKCiAgY29uc3QgY2xvc2VCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICBjbG9zZUJ0bi50ZXh0Q29udGVudCA9ICdDbG9zZSc7CiAgY2xvc2VCdG4uY2xhc3NOYW1lID0gJ2J0bic7CiAgY2xvc2VCdG4uc3R5bGUubWFyZ2luVG9wID0gJzEwcHgnOwogIGNsb3NlQnRuLm9uY2xpY2sgPSAoKT0+eyBtb2RhbC5zdHlsZS5kaXNwbGF5PSdub25lJzsgbW9kYWwuaW5uZXJIVE1MPScnOyB9OwogIG1vZGFsLmFwcGVuZENoaWxkKGNsb3NlQnRuKTsKICBsb2FkTW9yZSgpOwp9CgpmdW5jdGlvbiBnZXRDb250cm9sVmFsdWVzKCkgewogIGNvbnN0IHZhbHVlcyA9IHt9OwogIENPTkZJRy5zdG9yYWdlQ29udHJvbHMuZm9yRWFjaChjdHJsID0+IHsKICAgIGNvbnN0IGVsID0gJChjdHJsLmlkKTsKICAgIGlmIChlbCkgdmFsdWVzW2N0cmwuaWRdID0gZWwudmFsdWU7CiAgfSk7CiAgcmV0dXJuIHZhbHVlczsKfQoKZnVuY3Rpb24gdXBkYXRlVG90YWxzKCkgewogIGNvbnN0IHRvdGFsQnl0ZXMgPSBzdGF0ZS5zZWxlY3RlZC5yZWR1Y2UoKHN1bSwgcykgPT4gc3VtICsgcGFyc2VTaXplVGV4dChzLnNpemUpLCAwKTsKICBjb25zdCBnYiA9IGJ5dGVzVG9HQih0b3RhbEJ5dGVzKTsKICAkKCdzZWxlY3RlZFNpemUnKS50ZXh0Q29udGVudCA9IGdiLnRvRml4ZWQoMik7CgogIGNvbnN0IGJsb2F0ZWQgPSB0b3RhbEJ5dGVzICogMS4yOwogIGNvbnN0IHNwZWVkID0gMTQgKiAxMDI0ICogMTAyNDsKICBjb25zdCBzZWNzID0gTWF0aC5jZWlsKGJsb2F0ZWQgLyBzcGVlZCk7CiAgJCgnaW5zdGFsbEVzdGltYXRlJykudGV4dENvbnRlbnQgPSBgJHtNYXRoLmZsb29yKHNlY3MvMzYwMCl9aCAke01hdGguZmxvb3IoKHNlY3MlMzYwMCkvNjApfW1gOwoKICAkKCdjb3VudCcpLnRleHRDb250ZW50ID0gc3RhdGUuc2VsZWN0ZWQubGVuZ3RoOwoKICBjb25zdCB2YWx1ZXMgPSBnZXRDb250cm9sVmFsdWVzKCk7CiAgY29uc3Qgc3BhY2VGb3JHYW1lcyA9IENPTkZJRy5jYWxjdWxhdGVTdG9yYWdlKHZhbHVlcyk7CgogICQoJ3NwYWNlJykudGV4dENvbnRlbnQgPSBpc0Zpbml0ZShzcGFjZUZvckdhbWVzKSA/IHNwYWNlRm9yR2FtZXMgOiAwOwoKICBpZiAoZ2IgPiBzcGFjZUZvckdhbWVzKSB7CiAgICAkKCdzZWxlY3RlZFNpemUnKS5zdHlsZS5jb2xvciA9ICcjYzAwJzsKICAgICQoJ3NlbGVjdGVkU2l6ZScpLnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7CiAgfSBlbHNlIHsKICAgICQoJ3NlbGVjdGVkU2l6ZScpLnN0eWxlLmNvbG9yID0gJyc7CiAgICAkKCdzZWxlY3RlZFNpemUnKS5zdHlsZS5mb250V2VpZ2h0ID0gJyc7CiAgfQoKICB1cGRhdGVGaWxlbmFtZVByZXZpZXcoKTsKfQoKZnVuY3Rpb24gdXBkYXRlRmlsZW5hbWVQcmV2aWV3KCkgewogIGNvbnN0IGN1c3RvbWVyID0gKCQoJ2N1c3RvbWVyJykudmFsdWUgfHwgJ2N1c3RvbWVyJykudHJpbSgpLnJlcGxhY2UoL1teYS16QS1aMC05XS9nLCdfJykudG9Mb3dlckNhc2UoKTsKICBjb25zdCB2YWx1ZXMgPSBnZXRDb250cm9sVmFsdWVzKCk7CiAgY29uc3QgdG9rZW5zID0gW2N1c3RvbWVyXTsKICAKICBDT05GSUcuc3RvcmFnZUNvbnRyb2xzLmZvckVhY2goY3RybCA9PiB7CiAgICBpZiAoY3RybC5maWxlbmFtZVRva2VuKSB7CiAgICAgIGNvbnN0IHZhbCA9IHZhbHVlc1tjdHJsLmlkXSB8fCBjdHJsLmRlZmF1bHQ7CiAgICAgIGNvbnN0IHRva2VuID0gY3RybC5maWxlbmFtZVRva2VuID09PSB0cnVlID8gdmFsIDogKGN0cmwuZmlsZW5hbWVUb2tlbiArIHZhbCk7CiAgICAgIHRva2Vucy5wdXNoKHRva2VuKTsKICAgIH0KICB9KTsKICAKICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpOwogIGNvbnN0IHN0YW1wID0gbm93LmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKSArCiAgICBTdHJpbmcobm93LmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpICsKICAgIFN0cmluZyhub3cuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCAnMCcpICsKICAgIFN0cmluZyhub3cuZ2V0SG91cnMoKSkucGFkU3RhcnQoMiwgJzAnKSArCiAgICBTdHJpbmcobm93LmdldE1pbnV0ZXMoKSkucGFkU3RhcnQoMiwgJzAnKSArCiAgICBTdHJpbmcobm93LmdldFNlY29uZHMoKSkucGFkU3RhcnQoMiwgJzAnKTsKICB0b2tlbnMucHVzaChzdGFtcCk7CiAgCiAgJCgnZmlsZW5hbWVQcmV2aWV3JykudGV4dENvbnRlbnQgPSB0b2tlbnMuam9pbignXycpICsgQ09ORklHLmNsaWVudEZpbGVFeHQ7Cn0KCmZ1bmN0aW9uIGRlYm91bmNlKGZuLG1zPTIwMCl7IGxldCBoOyByZXR1cm4gKC4uLmEpPT57IGNsZWFyVGltZW91dChoKTsgaD1zZXRUaW1lb3V0KCgpPT5mbiguLi5hKSxtcyk7IH07IH0KCmZ1bmN0aW9uIHNtYXJ0U2VhcmNoKGl0ZW1zLCBxdWVyeSkgewogIGlmICghcXVlcnkgfHwgIXF1ZXJ5LnRyaW0oKSkgcmV0dXJuIGl0ZW1zOwogIAogIGNvbnN0IHEgPSBxdWVyeS50b0xvd2VyQ2FzZSgpLnRyaW0oKTsKICAKICAvLyBQYXJzZSBzZWFyY2ggdGVybXM6IHN1cHBvcnQgcXVvdGVzIGZvciBleGFjdCBwaHJhc2VzCiAgY29uc3QgdGVybXMgPSBbXTsKICBjb25zdCBxdW90ZVJlZ2V4ID0gLyIoW14iXSspInwnKFteJ10rKSd8KFxTKykvZzsKICBsZXQgbWF0Y2g7CiAgCiAgd2hpbGUgKChtYXRjaCA9IHF1b3RlUmVnZXguZXhlYyhxKSkgIT09IG51bGwpIHsKICAgIGNvbnN0IHRlcm0gPSAobWF0Y2hbMV0gfHwgbWF0Y2hbMl0gfHwgbWF0Y2hbM10pLnRvTG93ZXJDYXNlKCk7CiAgICB0ZXJtcy5wdXNoKHRlcm0pOwogIH0KICAKICBpZiAodGVybXMubGVuZ3RoID09PSAwKSByZXR1cm4gaXRlbXM7CiAgCiAgLy8gRmlsdGVyIGl0ZW1zOiBBTEwgdGVybXMgbXVzdCBtYXRjaCAoQU5EIGxvZ2ljKQogIHJldHVybiBpdGVtcy5maWx0ZXIoaXRlbSA9PiB7CiAgICBjb25zdCBzZWFyY2hUZXh0ID0gKGl0ZW0ubmFtZSB8fCAnJykudG9Mb3dlckNhc2UoKQogICAgICAucmVwbGFjZSgvW15cd1xzXS9nLCAnICcpOyAvLyBSZW1vdmUgcHVuY3R1YXRpb24gZm9yIG1hdGNoaW5nCiAgICAKICAgIHJldHVybiB0ZXJtcy5ldmVyeSh0ZXJtID0+IHNlYXJjaFRleHQuaW5jbHVkZXModGVybSkpOwogIH0pOwp9CgokKCdzZWFyY2gnKS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGRlYm91bmNlKChlKT0+eyAKICBjb25zdCBxID0gZS50YXJnZXQudmFsdWUgfHwgJyc7CiAgY29uc3QgZmlsdGVyZWQgPSBzbWFydFNlYXJjaChzdGF0ZS5pdGVtcywgcSk7CiAgcmVuZGVyTGlzdChmaWx0ZXJlZCk7Cn0sIDE4MCkpOwoKJCgnY2xlYXJTZWFyY2gnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT57ICQoJ3NlYXJjaCcpLnZhbHVlPScnOyByZW5kZXJMaXN0KHN0YXRlLml0ZW1zKTsgJCgnc2VhcmNoJykuZm9jdXMoKTsgfSk7CgpDT05GSUcuc3RvcmFnZUNvbnRyb2xzLmZvckVhY2goY3RybCA9PiB7CiAgY29uc3QgaWQgPSBjdHJsLmlkOwogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4gewogICAgY29uc3QgZWwgPSAkKGlkKTsKICAgIGlmKGVsKXsKICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiB1cGRhdGVGaWxlbmFtZVByZXZpZXcoKSk7CiAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHVwZGF0ZVRvdGFscygpKTsKICAgIH0KICB9KTsKfSk7CgokKCdjdXN0b21lcicpLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4gdXBkYXRlRmlsZW5hbWVQcmV2aWV3KCkpOwoKZnVuY3Rpb24gcGFyc2VGaWxlbmFtZVRvQ29uZmlnKGZuKSB7CiAgY29uc3QgYmFzZSA9IGZuLnJlcGxhY2UobmV3IFJlZ0V4cChgXFwke0NPTkZJRy5jbGllbnRGaWxlRXh0fXxcXCR7Q09ORklHLmFkbWluRmlsZUV4dH18XFwuKHR4dCkkYCwgJ2knKSwgJycpOwogIGNvbnN0IHBhcnRzID0gYmFzZS5zcGxpdCgnXycpOwogIGlmIChwYXJ0cy5sZW5ndGggPCAyKSByZXR1cm4gbnVsbDsKICAKICBjb25zdCBjb25maWcgPSB7IGN1c3RvbWVyOiBwYXJ0c1swXSB9OwogIAogIENPTkZJRy5zdG9yYWdlQ29udHJvbHMuZm9yRWFjaChjdHJsID0+IHsKICAgIGlmIChjdHJsLmZpbGVuYW1lVG9rZW4pIHsKICAgICAgY29uc3QgcGF0dGVybiA9IGN0cmwuZmlsZW5hbWVUb2tlbiA9PT0gdHJ1ZSAKICAgICAgICA/IGBeKCR7Y3RybC5vcHRpb25zLm1hcChvID0+IG8udmFsdWUpLmpvaW4oJ3wnKX0pJGAKICAgICAgICA6IGBeJHtjdHJsLmZpbGVuYW1lVG9rZW59XFxkKyRgOwogICAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAocGF0dGVybik7CiAgICAgIAogICAgICBwYXJ0cy5mb3JFYWNoKHAgPT4gewogICAgICAgIGlmIChyZWdleC50ZXN0KHApKSB7CiAgICAgICAgICBjb25maWdbY3RybC5pZF0gPSBjdHJsLmZpbGVuYW1lVG9rZW4gPT09IHRydWUgPyBwIDogcC5yZXBsYWNlKGN0cmwuZmlsZW5hbWVUb2tlbiwgJycpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CiAgCiAgcmV0dXJuIGNvbmZpZzsKfQoKJCgnZmlsZUluJykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGV2KT0+ewogIGNvbnN0IGYgPSBldi50YXJnZXQuZmlsZXNbMF07IAogIGlmKCFmKSByZXR1cm47IAogIAogIGNvbnN0IGNmZyA9IHBhcnNlRmlsZW5hbWVUb0NvbmZpZyhmLm5hbWUpOyAKICBpZihjZmcpeyAKICAgICQoJ2N1c3RvbWVyJykudmFsdWUgPSBjZmcuY3VzdG9tZXIgfHwgJyc7CiAgICBDT05GSUcuc3RvcmFnZUNvbnRyb2xzLmZvckVhY2goY3RybCA9PiB7CiAgICAgIGNvbnN0IGVsID0gJChjdHJsLmlkKTsKICAgICAgaWYgKGVsICYmIGNmZ1tjdHJsLmlkXSkgewogICAgICAgIGlmIChjdHJsLnR5cGUgPT09ICdzZWxlY3QnKSB7CiAgICAgICAgICBBcnJheS5mcm9tKGVsLm9wdGlvbnMpLmZvckVhY2gobyA9PiB7CiAgICAgICAgICAgIGlmIChvLnZhbHVlID09PSBjZmdbY3RybC5pZF0pIG8uc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIHVwZGF0ZUZpbGVuYW1lUHJldmlldygpOyAKICAgIHVwZGF0ZVRvdGFscygpOwogIH0KICAKICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOyAKICByZWFkZXIub25sb2FkID0gKGUpPT57IAogICAgY29uc3QgbGluZXMgPSBlLnRhcmdldC5yZXN1bHQuc3BsaXQoJ1xuJykubWFwKHM9PnMudHJpbSgpKS5maWx0ZXIoQm9vbGVhbik7IAogICAgc3RhdGUuc2VsZWN0ZWQ9W107IAogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLml0ZW0nKS5mb3JFYWNoKGk9PmkuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKSk7CiAgICAKICAgIGxpbmVzLmZvckVhY2godGl0bGU9PnsgCiAgICAgIGNvbnN0IGxlZnQgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pdGVtJykpLmZpbmQoaT0+aS5kYXRhc2V0Lm5hbWU9PT10aXRsZSk7IAogICAgICBpZihsZWZ0KXsgCiAgICAgICAgbGVmdC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpOyAKICAgICAgICBzdGF0ZS5zZWxlY3RlZC5wdXNoKHsgbmFtZTpsZWZ0LmRhdGFzZXQubmFtZSwgZmlsZW5hbWU6IGxlZnQuZGF0YXNldC5maWxlbmFtZSB8fCBsZWZ0LmRhdGFzZXQubmFtZSwgc2l6ZTpsZWZ0LmRhdGFzZXQuc2l6ZSB9KTsgCiAgICAgIH0gZWxzZSB7IAogICAgICAgIGNvbnN0IG1heWJlID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaXRlbScpKS5maW5kKGk9PmkuZGF0YXNldC5uYW1lICYmIGkuZGF0YXNldC5uYW1lLnRvTG93ZXJDYXNlKCk9PT10aXRsZS50b0xvd2VyQ2FzZSgpKTsgCiAgICAgICAgaWYobWF5YmUpeyAKICAgICAgICAgIG1heWJlLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7IAogICAgICAgICAgc3RhdGUuc2VsZWN0ZWQucHVzaCh7IG5hbWU6bWF5YmUuZGF0YXNldC5uYW1lLCBmaWxlbmFtZTogbWF5YmUuZGF0YXNldC5maWxlbmFtZSB8fCBtYXliZS5kYXRhc2V0Lm5hbWUsIHNpemU6bWF5YmUuZGF0YXNldC5zaXplIH0pOyAKICAgICAgICB9IAogICAgICB9IAogICAgfSk7IAogICAgdXBkYXRlVG90YWxzKCk7IAogICAgcmVuZGVyT3ZlcmxheSgpOyAKICB9OwogIHJlYWRlci5yZWFkQXNUZXh0KGYpOwp9KTsKCiQoJ3NhdmVCdG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+ewogIG5vdyA9IERhdGUubm93KCk7CiAgaWYgKG5vdyAtIGxhc3RFeHBvcnRUaW1lIDwgTUlOX0RFTEFZKSB7CiAgICB0b2FzdCgnUGxlYXNlIHdhaXQgYmVmb3JlIGV4cG9ydGluZyBhZ2FpbicpOwogICAgYWxlcnQoJ1BsZWFzZSB3YWl0IGJlZm9yZSBleHBvcnRpbmcgYWdhaW4nKTsKICAgIHJldHVybjsKICB9CiAgbGFzdEV4cG9ydFRpbWUgPSBub3c7CgogIGlmKHN0YXRlLnNlbGVjdGVkLmxlbmd0aD09PTApeyBhbGVydCgnTm8gaXRlbXMgc2VsZWN0ZWQnKTsgcmV0dXJuOyB9CiAgY29uc3QgY3VzdCA9ICgkKCdjdXN0b21lcicpLnZhbHVlfHwnJykudHJpbSgpOyAKICBpZighY3VzdCl7IGFsZXJ0KCdDdXN0b21lciBuYW1lIHJlcXVpcmVkJyk7IHJldHVybjsgfQogIGNvbnN0IGZpbGVuYW1lID0gJCgnZmlsZW5hbWVQcmV2aWV3JykudGV4dENvbnRlbnQgfHwgYGxpc3Qke0NPTkZJRy5jbGllbnRGaWxlRXh0fWA7CiAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtzdGF0ZS5zZWxlY3RlZC5tYXAocz0+cy5uYW1lKS5qb2luKCdcbicpXSwgeyB0eXBlOid0ZXh0L3BsYWluJyB9KTsgCiAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsgCiAgYS5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsgCiAgYS5kb3dubG9hZCA9IGZpbGVuYW1lOyAKICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpOyAKICBhLmNsaWNrKCk7IAogIGEucmVtb3ZlKCk7IAogIFVSTC5yZXZva2VPYmplY3RVUkwoYS5ocmVmKTsgCiAgdG9hc3QoJ1NhdmVkIGNsaWVudCBmaWxlJyk7Cn0pOwoKJCgnYWRtaW5FeHBvcnQnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKT0+ewogIG5vdyA9IERhdGUubm93KCk7CiAgaWYgKG5vdyAtIGxhc3RFeHBvcnRUaW1lIDwgTUlOX0RFTEFZKSB7CiAgICB0b2FzdCgnUGxlYXNlIHdhaXQgYmVmb3JlIGV4cG9ydGluZyBhZ2FpbicpOwogICAgYWxlcnQoJ1BsZWFzZSB3YWl0IGJlZm9yZSBleHBvcnRpbmcgYWdhaW4nKTsKICAgIHJldHVybjsKICB9CiAgbGFzdEV4cG9ydFRpbWUgPSBub3c7CgogIGlmKHN0YXRlLnNlbGVjdGVkLmxlbmd0aD09PTApeyBhbGVydCgnTm8gaXRlbXMgc2VsZWN0ZWQnKTsgcmV0dXJuOyB9CiAgY29uc3QgY3VzdCA9ICgkKCdjdXN0b21lcicpLnZhbHVlfHwnJykudHJpbSgpOyAKICBpZighY3VzdCl7IGFsZXJ0KCdDdXN0b21lciBuYW1lIHJlcXVpcmVkJyk7IHJldHVybjsgfQogIAogIHRyeXsgCiAgICBjb25zdCB4bWx0eHQgPSBhd2FpdCBmZXRjaChDT05GSUcueG1sRmlsZSkudGhlbihyPT5yLnRleHQoKSk7IAogICAgY29uc3QgeG1sID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyh4bWx0eHQsJ2FwcGxpY2F0aW9uL3htbCcpOyAKICAgIGxldCBjb250ZW50PScnOyAKICAgIAogICAgaWYgKENPTkZJRy5zdHJ1Y3R1cmVUeXBlID09PSAnZm9sZGVycycpIHsKICAgICAgc3RhdGUuc2VsZWN0ZWQuZm9yRWFjaChzZWw9PnsgCiAgICAgICAgY29uc3QgZm9sZGVyID0gQXJyYXkuZnJvbSh4bWwucXVlcnlTZWxlY3RvckFsbCgnZm9sZGVyJykpLmZpbmQoZj0+Zi5nZXRBdHRyaWJ1dGUoJ25hbWUnKT09PXNlbC5uYW1lKTsgCiAgICAgICAgaWYoZm9sZGVyKXsgCiAgICAgICAgICBmb2xkZXIucXVlcnlTZWxlY3RvckFsbCgnZmlsZScpLmZvckVhY2goZmlsZT0+IAogICAgICAgICAgICBjb250ZW50ICs9IGAke0NPTkZJRy5hZG1pbkJhc2VQYXRofSR7Zm9sZGVyLmdldEF0dHJpYnV0ZSgnbmFtZScpfVxcJHtmaWxlLmdldEF0dHJpYnV0ZSgnbmFtZScpfVxuYAogICAgICAgICAgKTsgCiAgICAgICAgfSAKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBzdGF0ZS5zZWxlY3RlZC5mb3JFYWNoKHNlbD0+eyAKICAgICAgICBjb25zdCBmaWxlbmFtZSA9IHNlbC5maWxlbmFtZSB8fCBzZWwubmFtZTsKICAgICAgICBjb250ZW50ICs9IGAke0NPTkZJRy5hZG1pbkJhc2VQYXRofSR7ZmlsZW5hbWV9XG5gOwogICAgICB9KTsKICAgIH0KICAgIAogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsgCiAgICBjb25zdCBzdGFtcCA9IGAke25vdy5nZXRGdWxsWWVhcigpfSR7U3RyaW5nKG5vdy5nZXRNb250aCgpKzEpLnBhZFN0YXJ0KDIsJzAnKX0ke1N0cmluZyhub3cuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCcwJyl9XyR7U3RyaW5nKG5vdy5nZXRIb3VycygpKS5wYWRTdGFydCgyLCcwJyl9JHtTdHJpbmcobm93LmdldE1pbnV0ZXMoKSkucGFkU3RhcnQoMiwnMCcpfWA7IAogICAgY29uc3QgZm5hbWUgPSBgJHsoY3VzdHx8J2N1c3RvbWVyJykucmVwbGFjZSgvW15hLXpBLVowLTldL2csJ18nKX1fJHtzdGFtcH0ke0NPTkZJRy5hZG1pbkZpbGVFeHR9YDsgCiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2NvbnRlbnRdLCB7IHR5cGU6J3RleHQvcGxhaW4nIH0pOyAKICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7IAogICAgYS5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsgCiAgICBhLmRvd25sb2FkID0gZm5hbWU7IAogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsgCiAgICBhLmNsaWNrKCk7IAogICAgYS5yZW1vdmUoKTsgCiAgICBVUkwucmV2b2tlT2JqZWN0VVJMKGEuaHJlZik7IAogICAgdG9hc3QoJ0FkbWluIGV4cG9ydCByZWFkeScpOyAKICB9Y2F0Y2goZSl7IAogICAgY29uc29sZS5lcnJvcihlKTsgCiAgICB0b2FzdCgnQWRtaW4gZXhwb3J0IGZhaWxlZCcpOyAKICB9Cn0pOwoKJCgndXBsb2FkQnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKT0+ewogIGlmKHN0YXRlLnNlbGVjdGVkLmxlbmd0aD09PTApeyBhbGVydCgnTm8gaXRlbXMgc2VsZWN0ZWQnKTsgcmV0dXJuOyB9CiAgY29uc3QgY3VzdCA9ICgkKCdjdXN0b21lcicpLnZhbHVlfHwnJykudHJpbSgpOyAKICBpZighY3VzdCl7IGFsZXJ0KCdDdXN0b21lciByZXF1aXJlZCcpOyByZXR1cm47IH0KICBpZighY29uZmlybShgVXBsb2FkIGxpc3QgZm9yICR7Y3VzdH0/YCkpIHJldHVybjsgCiAgCiAgY29uc3QgZmlsZW5hbWUgPSAkKCdmaWxlbmFtZVByZXZpZXcnKS50ZXh0Q29udGVudCB8fCBgbGlzdCR7Q09ORklHLmNsaWVudEZpbGVFeHR9YDsgCiAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtzdGF0ZS5zZWxlY3RlZC5tYXAocz0+cy5uYW1lKS5qb2luKCdcbicpXSwgeyB0eXBlOid0ZXh0L3BsYWluJyB9KTsgCiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsgCiAgaWYobm93IC0gc3RhdGUubGFzdFVwbG9hZCA8IDE1MDAwKXsgYWxlcnQoJ1BsZWFzZSB3YWl0IDE1IHNlY29uZHMgYmV0d2VlbiB1cGxvYWRzJyk7IHJldHVybjsgfQogIAogIHRyeXsgCiAgICBjb25zdCB1cmwgPSBgaHR0cHM6Ly9maWxlYmluLm5ldC8ke0NPTkZJRy5maWxlYmluQnVja2V0fS8ke2ZpbGVuYW1lfWA7IAogICAgY29uc3QgciA9IGF3YWl0IGZldGNoKHVybCx7IG1ldGhvZDonUE9TVCcsIGhlYWRlcnM6eyAnQ29udGVudC1UeXBlJzondGV4dC9wbGFpbicgfSwgYm9keTogYmxvYiB9KTsgCiAgICAKICAgIGlmKHIub2sgfHwgci5zdGF0dXM9PT0yMDEpeyAKICAgICAgc3RhdGUubGFzdFVwbG9hZCA9IG5vdzsgCiAgICAgICQoJ3NoYXJlYWJsZScpLnZhbHVlID0gYGh0dHBzOi8vZmlsZWJpbi5uZXQvJHtDT05GSUcuZmlsZWJpbkJ1Y2tldH0vJHtmaWxlbmFtZX1gOyAKICAgICAgdG9hc3QoJ1VwbG9hZGVkIHRvIGZpbGViaW4nKTsgCiAgICAgIHNob3dCYW5uZXIoIlVwbG9hZCBDb21wbGV0ZSAtIFByZXNzIENvcHkgTGluayBhbmQgc2VuZCBpdCB0byBvdXIgY2hhdCIpOwogICAgICAKICAgICAgY29uc3QgY29uZmlnU2VjdGlvbiA9ICQoJ2NvbmZpZ1NlY3Rpb24nKTsKICAgICAgY29uc3QgdG9nZ2xlQnRuID0gJCgndG9nZ2xlQ29uZmlnJyk7CiAgICAgIGlmIChjb25maWdTZWN0aW9uICYmIHRvZ2dsZUJ0biAmJiBjb25maWdTZWN0aW9uLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykpIHsKICAgICAgICBjb25maWdTZWN0aW9uLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgIHRvZ2dsZUJ0bi50ZXh0Q29udGVudCA9ICdTaG93IENvbmZpZ3VyYXRpb24nOwogICAgICB9CiAgICAgIHJldHVybjsgCiAgICB9IAogIH1jYXRjaChlKXsgCiAgICBjb25zb2xlLndhcm4oJ2ZpbGViaW4gZXJyb3InLCBlKTsgCiAgfQogIAogIHRyeXsgCiAgICBjb25zdCBmb3JtID0gbmV3IEZvcm1EYXRhKCk7IAogICAgZm9ybS5hcHBlbmQoJ2ZpbGUnLCBibG9iLCBmaWxlbmFtZSk7IAogICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vdXBsb2FkLmdvZmlsZS5pby91cGxvYWRGaWxlJywgeyBtZXRob2Q6J1BPU1QnLCBib2R5OiBmb3JtIH0pOyAKICAgIGNvbnN0IGogPSBhd2FpdCByZXMuanNvbigpOyAKICAgIGlmKGouc3RhdHVzID09PSAnb2snKXsgCiAgICAgIHN0YXRlLmxhc3RVcGxvYWQgPSBub3c7IAogICAgICAkKCdzaGFyZWFibGUnKS52YWx1ZSA9IGouZGF0YS5kb3dubG9hZFBhZ2U7IAogICAgICB0b2FzdCgnVXBsb2FkZWQgdG8gR29GaWxlJyk7IAogICAgICByZXR1cm47IAogICAgfSAKICAgIHRvYXN0KCdVcGxvYWQgZmFpbGVkJyk7IAogIH1jYXRjaChlKXsgCiAgICBjb25zb2xlLmVycm9yKGUpOyAKICAgIHRvYXN0KCdVcGxvYWQgZXJyb3InKTsgCiAgfQp9KTsKCmxldCBiaW5MaXN0UGFnZSA9IDA7CmNvbnN0IGJpbkxpc3RQYWdlU2l6ZSA9IDEwOwpsZXQgY2FjaGVkQmluRmlsZXMgPSBudWxsOwoKJCgnYmluTGlzdCcpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICB0cnkgewogICAgY29uc3QgciA9IGF3YWl0IGZldGNoKGBodHRwczovL2ZpbGViaW4ubmV0LyR7Q09ORklHLmZpbGViaW5CdWNrZXR9P2pzb25gLCB7CiAgICAgIGhlYWRlcnM6IHsgIkFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uIiB9CiAgICB9KTsKICAgIGlmICghci5vaykgeyB0b2FzdChgRmFpbGVkIHRvIGZldGNoIHVwbG9hZHM6ICR7ci5zdGF0dXNUZXh0fWApOyByZXR1cm47IH0KCiAgICBsZXQgajsKICAgIHRyeSB7CiAgICAgIGogPSBhd2FpdCByLmpzb24oKTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICB0b2FzdCgiRmFpbGVkIHRvIHBhcnNlIHNlcnZlciByZXNwb25zZSIpOwogICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoIWouZmlsZXMgfHwgIWouZmlsZXMubGVuZ3RoKSB7IHRvYXN0KCdObyBmaWxlcyBmb3VuZCcpOyByZXR1cm47IH0KCiAgICBjb25zdCBzb3J0ZWQgPSBqLmZpbGVzLnNvcnQoKGEsYik9PiBuZXcgRGF0ZShiLnVwZGF0ZWRfYXQpIC0gbmV3IERhdGUoYS51cGRhdGVkX2F0KSk7CiAgICBjYWNoZWRCaW5GaWxlcyA9IHNvcnRlZDsKICAgIGJpbkxpc3RQYWdlID0gMDsKICAgIHJlbmRlckJpbkxpc3QoKTsKICB9IGNhdGNoIChlKSB7CiAgICBjb25zb2xlLmVycm9yKGUpOwogICAgdG9hc3QoJ0Vycm9yIGZldGNoaW5nIHVwbG9hZHMnKTsKICB9Cn0pOwoKZnVuY3Rpb24gcmVuZGVyQmluTGlzdCgpIHsKICBpZiAoIWNhY2hlZEJpbkZpbGVzKSByZXR1cm47CiAgCiAgY29uc3Qgc3RhcnQgPSBiaW5MaXN0UGFnZSAqIGJpbkxpc3RQYWdlU2l6ZTsKICBjb25zdCBlbmQgPSBzdGFydCArIGJpbkxpc3RQYWdlU2l6ZTsKICBjb25zdCBwYWdlRmlsZXMgPSBjYWNoZWRCaW5GaWxlcy5zbGljZShzdGFydCwgZW5kKTsKICBjb25zdCBoYXNNb3JlID0gZW5kIDwgY2FjaGVkQmluRmlsZXMubGVuZ3RoOwogIAogIGxldCBodG1sID0gJzxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpsZWZ0O21hcmdpbi1ib3R0b206OHB4OyI+JzsKICBodG1sICs9ICc8YnV0dG9uIGlkPSJjbG9zZUJpbiIgY2xhc3M9ImJ0biBnaG9zdCIgc3R5bGU9InBhZGRpbmc6NHB4IDhweDsiPkNsb3NlPC9idXR0b24+JzsKICBodG1sICs9IGA8c3Ryb25nPlJlY2VudCBVcGxvYWRzPC9zdHJvbmc+YDsKICBodG1sICs9ICc8L2Rpdj4nOwogIAogIGh0bWwgKz0gJzxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6OHB4O21hcmdpbi1ib3R0b206OHB4OyI+JzsKICBodG1sICs9IGA8YnV0dG9uIGlkPSJwcmV2UGFnZSIgY2xhc3M9ImJ0biBnaG9zdCIgc3R5bGU9InBhZGRpbmc6NHB4IDhweDtmbGV4OjE7IiAke2Jpbkxpc3RQYWdlID09PSAwID8gJ2Rpc2FibGVkJyA6ICcnfT5QcmV2PC9idXR0b24+YDsKICBodG1sICs9IGA8c3BhbiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtmb250LXNpemU6MTJweDtjb2xvcjojNmI3MjgwOyI+UGFnZSAke2Jpbkxpc3RQYWdlICsgMX08L3NwYW4+YDsKICBodG1sICs9IGA8YnV0dG9uIGlkPSJuZXh0UGFnZSIgY2xhc3M9ImJ0biBnaG9zdCIgc3R5bGU9InBhZGRpbmc6NHB4IDhweDtmbGV4OjE7IiAkeyFoYXNNb3JlID8gJ2Rpc2FibGVkJyA6ICcnfT5OZXh0PC9idXR0b24+YDsKICBodG1sICs9ICc8L2Rpdj4nOwogIAogIGh0bWwgKz0gJzx1bCBzdHlsZT0ibWFyZ2luOjA7cGFkZGluZy1sZWZ0OjIwcHg7Ij4nOwogIHBhZ2VGaWxlcy5mb3JFYWNoKGZpbGUgPT4gewogICAgY29uc3QgZmlsZVVybCA9IGBodHRwczovL2ZpbGViaW4ubmV0LyR7Q09ORklHLmZpbGViaW5CdWNrZXR9LyR7ZW5jb2RlVVJJQ29tcG9uZW50KGZpbGUuZmlsZW5hbWUpfWA7CiAgICBjb25zdCBhZGRlZERhdGUgPSBuZXcgRGF0ZShmaWxlLnVwZGF0ZWRfYXQpOwogICAgY29uc3QgZm9ybWF0dGVkRGF0ZSA9IGFkZGVkRGF0ZS50b0lTT1N0cmluZygpLnNsaWNlKDAsMTApLnJlcGxhY2UoLy0vZywnJyk7CiAgICBjb25zdCBob3VycyA9IGFkZGVkRGF0ZS5nZXRIb3VycygpOwogICAgY29uc3QgbWludXRlcyA9IGFkZGVkRGF0ZS5nZXRNaW51dGVzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCcwJyk7CiAgICBjb25zdCBhbXBtID0gaG91cnMgPj0gMTIgPyAnUE0nOidBTSc7CiAgICBjb25zdCBmb3JtYXR0ZWRUaW1lID0gYCR7aG91cnMgJSAxMiB8fCAxMn06JHttaW51dGVzfSAke2FtcG19YDsKICAgIGNvbnN0IHN0cmlwcGVkTmFtZSA9IGZpbGUuZmlsZW5hbWUuc3BsaXQoJy4nKS5zbGljZSgwLC0xKS5qb2luKCcuJyk7CiAgICBjb25zdCBmaWxlU2l6ZSA9IGZpbGUuYnl0ZXNfcmVhZGFibGUgfHwgJyc7CiAgICBodG1sICs9IGA8bGkgc3R5bGU9Im1hcmdpbi1ib3R0b206NHB4OyBmb250LXNpemU6IDEycHg7Ij48YSBocmVmPSIke2ZpbGVVcmx9IiB0YXJnZXQ9Il9ibGFuayIgc3R5bGU9InRleHQtZGVjb3JhdGlvbjpub25lO2NvbG9yOiMwMzY2ZDY7Ij4ke2Zvcm1hdHRlZERhdGV9ICR7Zm9ybWF0dGVkVGltZX0gfCAke3N0cmlwcGVkTmFtZX0gfCAke2ZpbGVTaXplfTwvYT48L2xpPmA7CiAgfSk7CiAgaHRtbCArPSAnPC91bD4nOwoKICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUxpc3RDb250YWluZXInKTsKICBjb250YWluZXIuaW5uZXJIVE1MID0gaHRtbDsKICBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgY29udGFpbmVyLnN0eWxlLmJhY2tncm91bmQgPSAnI2Y5ZmFmYic7CiAgY29udGFpbmVyLnN0eWxlLnBhZGRpbmcgPSAnMTJweCc7CiAgY29udGFpbmVyLnN0eWxlLmJvcmRlclJhZGl1cyA9ICc4cHgnOwogIGNvbnRhaW5lci5zdHlsZS5ib3JkZXIgPSAnMXB4IHNvbGlkICNlNWU3ZWInOwogIGNvbnRhaW5lci5zdHlsZS5tYXJnaW5Ub3AgPSAnOHB4JzsKICAgIGNvbnRhaW5lci5zdHlsZS5vdmVyZmxvd1kgPSAnYXV0byc7CmNvbnRhaW5lci5zdHlsZS5vdmVyZmxvd1ggPSAnaGlkZGVuJzsgICAvLyBvciAnYXV0bycgaWYgeW91IHByZWZlciBob3Jpem9udGFsIHNjcm9sbApjb250YWluZXIuc3R5bGUubWF4SGVpZ2h0ID0gJzMwMHB4JzsgICAgLy8gc2V0IHdoYXRldmVyIGZpeGVkIGhlaWdodCB5b3Ugd2FudAoKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvc2VCaW4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgYmluTGlzdFBhZ2UgPSAwOwogICAgY2FjaGVkQmluRmlsZXMgPSBudWxsOwogIH0pOwogIAogIGNvbnN0IHByZXZCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJldlBhZ2UnKTsKICBpZiAocHJldkJ0biAmJiBiaW5MaXN0UGFnZSA+IDApIHsKICAgIHByZXZCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgIGJpbkxpc3RQYWdlLS07CiAgICAgIHJlbmRlckJpbkxpc3QoKTsKICAgIH0pOwogIH0KICAKICBjb25zdCBuZXh0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25leHRQYWdlJyk7CiAgaWYgKG5leHRCdG4gJiYgaGFzTW9yZSkgewogICAgbmV4dEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgYmluTGlzdFBhZ2UrKzsKICAgICAgcmVuZGVyQmluTGlzdCgpOwogICAgfSk7CiAgfQp9CgokKCdzZWFyY2gnKS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGV2KSA9PiB7CiAgaWYgKGV2LmtleSA9PT0gJ0VudGVyJykgewogICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgIAogICAgY29uc3QgdmlzaWJsZUl0ZW1zID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaXRlbScpKQogICAgICAuZmlsdGVyKGVsID0+IGVsLm9mZnNldFBhcmVudCAhPT0gbnVsbCk7IC8vIE9ubHkgdmlzaWJsZSBpdGVtcwogICAgCiAgICAvLyBDYWxjdWxhdGUgd2hhdCB3b3VsZCBiZSBhZGRlZAogICAgY29uc3QgdG9BZGQgPSB2aXNpYmxlSXRlbXMuZmlsdGVyKGVsID0+IHsKICAgICAgY29uc3QgbmFtZSA9IGVsLmRhdGFzZXQubmFtZTsKICAgICAgcmV0dXJuICFzdGF0ZS5zZWxlY3RlZC5zb21lKHMgPT4gcy5uYW1lID09PSBuYW1lKTsKICAgIH0pOwogICAgCiAgICBpZiAodG9BZGQubGVuZ3RoID09PSAwKSB7CiAgICAgIHRvYXN0KCdBbGwgdmlzaWJsZSBpdGVtcyBhbHJlYWR5IHNlbGVjdGVkJyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIAogICAgLy8gQ2FsY3VsYXRlIHRvdGFsIHNpemUgb2YgaXRlbXMgdG8gYmUgYWRkZWQKICAgIGxldCB0b3RhbEJ5dGVzID0gMDsKICAgIHRvQWRkLmZvckVhY2goZWwgPT4gewogICAgICB0b3RhbEJ5dGVzICs9IHBhcnNlU2l6ZVRleHQoZWwuZGF0YXNldC5zaXplKTsKICAgIH0pOwogICAgY29uc3QgdG90YWxHQiA9IGJ5dGVzVG9HQih0b3RhbEJ5dGVzKS50b0ZpeGVkKDIpOwogICAgCiAgICAvLyBDb25maXJtYXRpb24gZGlhbG9nCiAgICBjb25zdCBjb25maXJtZWQgPSBjb25maXJtKAogICAgICBgQWRkICR7dG9BZGQubGVuZ3RofSBnYW1lJHt0b0FkZC5sZW5ndGggIT09IDEgPyAncycgOiAnJ30gZnJvbSBzZWFyY2ggcmVzdWx0cz9cblxuYCArCiAgICAgIGBUb3RhbCBzaXplOiAke3RvdGFsR0J9IEdCXG5cbmAgKwogICAgICBgUHJlc3MgT0sgdG8gYWRkIHRoZXNlIGl0ZW1zLmAKICAgICk7CiAgICAKICAgIGlmICghY29uZmlybWVkKSB7CiAgICAgIHRvYXN0KCdBZGQgY2FuY2VsbGVkJyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIAogICAgLy8gQWRkIHRoZSBpdGVtcwogICAgbGV0IGFkZGVkID0gMDsKICAgIHRvQWRkLmZvckVhY2goZWwgPT4gewogICAgICBjb25zdCBuYW1lID0gZWwuZGF0YXNldC5uYW1lOwogICAgICBjb25zdCBzaXplID0gZWwuZGF0YXNldC5zaXplOwogICAgICBjb25zdCBmaWxlbmFtZSA9IGVsLmRhdGFzZXQuZmlsZW5hbWUgfHwgbmFtZTsKICAgICAgc3RhdGUuc2VsZWN0ZWQucHVzaCh7IG5hbWUsIGZpbGVuYW1lLCBzaXplIH0pOwogICAgICBlbC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpOwogICAgICBhZGRlZCsrOwogICAgfSk7CiAgICAKICAgIGlmIChhZGRlZCA+IDApIHsKICAgICAgdXBkYXRlVG90YWxzKCk7CiAgICAgIHJlbmRlck92ZXJsYXkoKTsKICAgICAgdG9hc3QoYEFkZGVkICR7YWRkZWR9IGl0ZW0ke2FkZGVkICE9PSAxID8gJ3MnIDogJyd9ICgke3RvdGFsR0J9IEdCKWApOwogICAgfQogIH0KfSk7CgokKCdjb3B5TGluaycpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogIGNvbnN0IGN1c3QgPSAoJCgnY3VzdG9tZXInKS52YWx1ZXx8JycpLnRyaW0oKTsgCiAgaWYoIWN1c3QpeyBhbGVydCgnQ3VzdG9tZXIgbmFtZSByZXF1aXJlZCcpOyByZXR1cm47IH0KICAKICBjb25zdCByYXdMaW5rID0gJCgnc2hhcmVhYmxlJykudmFsdWUudHJpbSgpOwogIGNvbnN0IGxpbmsgPSByYXdMaW5rCiAgICAucmVwbGFjZSgvXmh0dHBzPzpcL1wvLywgJ2h4eHBjZmYnKQogICAgLnJlcGxhY2UoL1wuL2csICdfZG90XycpOwoKICBjb25zdCB0aXRsZXNBcnIgPSBzdGF0ZS5zZWxlY3RlZC5tYXAocyA9PiBzLm5hbWUpOwoKICBpZiAodGl0bGVzQXJyLmxlbmd0aCA9PT0gMCkgewogICAgdG9hc3QoJ05vIHNlbGVjdGVkIGxpc3QgdG8gY29weScpOwogICAgYWxlcnQoJ05vIHNlbGVjdGVkIGxpc3QgdG8gY29weScpOwogICAgcmV0dXJuOwogIH0KCiAgY29uc3QgdG90YWxCeXRlcyA9IHN0YXRlLnNlbGVjdGVkLnJlZHVjZSgoc3VtLCBzKSA9PiBzdW0gKyBwYXJzZVNpemVUZXh0KHMuc2l6ZSksIDApOwogIGNvbnN0IHRvdGFsR0IgPSAodG90YWxCeXRlcyAvICgxMDI0ICoqIDMpKS50b0ZpeGVkKDIpOwogIGNvbnN0IGNvdW50ID0gdGl0bGVzQXJyLmxlbmd0aDsKCiAgY29uc3QgY3VzdG9tZXIgPSAoJCgnY3VzdG9tZXInKS52YWx1ZSB8fCAnJykudHJpbSgpIHx8ICdVbmtub3duIGN1c3RvbWVyJzsKICBjb25zdCBmaWxlbmFtZSA9ICQoJ2ZpbGVuYW1lUHJldmlldycpLnRleHRDb250ZW50IHx8IGBsaXN0JHtDT05GSUcuY2xpZW50RmlsZUV4dH1gOwoKICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpOwogIGNvbnN0IHN0YW1wID0gbm93LnRvTG9jYWxlU3RyaW5nKCdlbi1VUycsIHsKICAgIHllYXI6ICdudW1lcmljJywgbW9udGg6ICcyLWRpZ2l0JywgZGF5OiAnMi1kaWdpdCcsCiAgICBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnLCBzZWNvbmQ6ICcyLWRpZ2l0JwogIH0pOwoKICBsZXQgbGlua1RvVXNlID0gbGluazsKCiAgaWYgKCFsaW5rKSB7CiAgICBjb25zdCBhc2sgPSBjb25maXJtKAogICAgICBgTm8gbGluayBmb3VuZC5cblxuYCArCiAgICAgIGBMaXN0IGNvbnRhaW5zICR7Y291bnR9IGl0ZW1zIHRvdGFsaW5nICR7dG90YWxHQn0gR0IuXG5cbmAgKwogICAgICBgV291bGQgeW91IGxpa2UgdG8gdXBsb2FkIG5vdz9gCiAgICApOwoKICAgIGlmIChhc2spIHsKICAgICAgJCgndXBsb2FkQnRuJykuY2xpY2soKTsKICAgICAgc2hvd0Jhbm5lcigiVXBsb2FkaW5n4oCmXG5cblBsZWFzZSB3YWl0IGZvciB0aGUgbGluayB0byBhcHBlYXIsIHRoZW4gcHJlc3MgQ29weSBhZ2Fpbi4iKTsKICAgICAgdG9hc3QoIlVwbG9hZGluZ+KApiB3YWl0IGZvciBsaW5rLCB0aGVuIHByZXNzIENvcHkgYWdhaW4iKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxpbmtUb1VzZSA9ICcoTm8gbGluayB1cGxvYWRlZCknOwogIH0KCiAgY29uc3Qgc3VtbWFyeSA9CiAgICBgQ3VzdG9tZXI6ICR7Y3VzdG9tZXJ9XG5gICsKICAgIGBGaWxlbmFtZTogJHtmaWxlbmFtZX1cbmAgKwogICAgYFF1YW50aXR5OiAke2NvdW50fSBpdGVtc1xuYCArCiAgICBgVG90YWwgU2l6ZTogJHt0b3RhbEdCfSBHQlxuYCArCiAgICBgR2VuZXJhdGVkOiAke3N0YW1wfVxuXG5gICsKICAgIGAke2xpbmtUb1VzZX1cblxuYDsKCiAgY29uc3QgZmluYWxUZXh0ID0gc3VtbWFyeSArIHRpdGxlc0Fyci5qb2luKCdcbicpOwoKICBsZXQgbWVzc2FnZSA9IGxpbmsKICAgID8gYExpc3QgJiBsaW5rIGNvcGllZC4gKCR7Y291bnR9IGl0ZW1zLCAke3RvdGFsR0J9IEdCKWAKICAgIDogYExpc3QgY29waWVkIChubyBsaW5rKS4gKCR7Y291bnR9IGl0ZW1zLCAke3RvdGFsR0J9IEdCKWA7CgogIG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGZpbmFsVGV4dCkudGhlbigoKSA9PiB7CiAgICB0b2FzdChtZXNzYWdlLnJlcGxhY2UoL1xuL2csICcgJykpOwogICAgYWxlcnQobWVzc2FnZSk7CiAgfSkuY2F0Y2goKCkgPT4gewogICAgYWxlcnQoJ0NvcHkgZmFpbGVkLCBwbGVhc2UgY29weSBtYW51YWxseScpOwogIH0pOwp9KTsKCmZ1bmN0aW9uIHJlbmRlclNlbGVjdGVkUGFuZWwoKSB7CiAgY29uc3QgYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWxlY3RlZFBhbmVsQm9keScpOwogIGlmICghYm9keSkgcmV0dXJuOwoKICBib2R5LmlubmVySFRNTCA9ICcnOwogIHN0YXRlLnNlbGVjdGVkLmZvckVhY2goKHMsIGkpID0+IHsKICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgcm93LmNsYXNzTmFtZSA9ICdyb3cnOwogICAgcm93LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICByb3cuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAnc3BhY2UtYmV0d2Vlbic7CiAgICByb3cuc3R5bGUuYWxpZ25JdGVtcyA9ICdjZW50ZXInOwogICAgcm93LnN0eWxlLnBhZGRpbmcgPSAnNnB4IDAnOwogICAgcm93LmlubmVySFRNTCA9IGAKICAgICAgPGRpdj4KICAgICAgICA8c3Ryb25nPiR7aSArIDF9LiAke2VzYyhzLm5hbWUpfTwvc3Ryb25nPgogICAgICAgIDxkaXYgY2xhc3M9Im1ldGEiPiR7ZXNjKHMuc2l6ZSl9PC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjRweDsiPgogICAgICAgIDxidXR0b24gY2xhc3M9Imljb24gdXAiPnU8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJpY29uIGRvd24iPmQ8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJpY29uIHJlbW92ZSI+eDwvYnV0dG9uPgogICAgICA8L2Rpdj4KICAgIGA7CgogICAgcm93LnF1ZXJ5U2VsZWN0b3IoJy51cCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICBpZiAoaSA+IDApIHsKICAgICAgICBbc3RhdGUuc2VsZWN0ZWRbaSAtIDFdLCBzdGF0ZS5zZWxlY3RlZFtpXV0gPSBbc3RhdGUuc2VsZWN0ZWRbaV0sIHN0YXRlLnNlbGVjdGVkW2kgLSAxXV07CiAgICAgICAgcmVuZGVyT3ZlcmxheSgpOwogICAgICAgIHJlbmRlckxpc3Qoc3RhdGUuaXRlbXMpOwogICAgICAgIHVwZGF0ZVRvdGFscygpOwogICAgICB9CiAgICB9KTsKCiAgICByb3cucXVlcnlTZWxlY3RvcignLmRvd24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgaWYgKGkgPCBzdGF0ZS5zZWxlY3RlZC5sZW5ndGggLSAxKSB7CiAgICAgICAgW3N0YXRlLnNlbGVjdGVkW2kgKyAxXSwgc3RhdGUuc2VsZWN0ZWRbaV1dID0gW3N0YXRlLnNlbGVjdGVkW2ldLCBzdGF0ZS5zZWxlY3RlZFtpICsgMV1dOwogICAgICAgIHJlbmRlck92ZXJsYXkoKTsKICAgICAgICByZW5kZXJMaXN0KHN0YXRlLml0ZW1zKTsKICAgICAgICB1cGRhdGVUb3RhbHMoKTsKICAgICAgfQogICAgfSk7CgogICAgcm93LnF1ZXJ5U2VsZWN0b3IoJy5yZW1vdmUnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgc3RhdGUuc2VsZWN0ZWQuc3BsaWNlKGksIDEpOwogICAgICByZW5kZXJPdmVybGF5KCk7CiAgICAgIHJlbmRlckxpc3Qoc3RhdGUuaXRlbXMpOwogICAgICB1cGRhdGVUb3RhbHMoKTsKICAgIH0pOwoKICAgIGJvZHkuYXBwZW5kQ2hpbGQocm93KTsKICB9KTsKfQoKY29uc3QgdG9nZ2xlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZ2dsZUNvbmZpZycpOwpjb25zdCBjb25maWdTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZ1NlY3Rpb24nKTsKCmlmIChpc01vYmlsZSAmJiB0b2dnbGVCdG4gJiYgY29uZmlnU2VjdGlvbikgewogIGNvbmZpZ1NlY3Rpb24uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgdG9nZ2xlQnRuLnRleHRDb250ZW50ID0gJ0hpZGUgQ29uZmlndXJhdGlvbic7CgogIHRvZ2dsZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGNvbnN0IGlzVmlzaWJsZSA9IGNvbmZpZ1NlY3Rpb24uY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJyk7CiAgICB0b2dnbGVCdG4udGV4dENvbnRlbnQgPSBpc1Zpc2libGUgPyAnSGlkZSBDb25maWd1cmF0aW9uJyA6ICdTaG93IENvbmZpZ3VyYXRpb24nOwogIH0pOwp9CgpmdW5jdGlvbiBwYXJzZURhdGVGbGV4aWJsZShzKSB7CiAgaWYgKCFzKSByZXR1cm4gbnVsbDsKICBsZXQgZCA9IG5ldyBEYXRlKHMpOwogIGlmICghaXNOYU4oZC5nZXRUaW1lKCkpKSByZXR1cm4gZDsKCiAgY29uc3QgeW1kID0gKCcnK3MpLm1hdGNoKC8oXGR7NH0pXEQ/KFxkezEsMn0pXEQ/KFxkezEsMn0pLyk7CiAgaWYgKHltZCkgewogICAgZCA9IG5ldyBEYXRlKE51bWJlcih5bWRbMV0pLCBOdW1iZXIoeW1kWzJdKSAtIDEsIE51bWJlcih5bWRbM10pKTsKICAgIGlmICghaXNOYU4oZC5nZXRUaW1lKCkpKSByZXR1cm4gZDsKICB9CgogIGNvbnN0IGRteSA9ICgnJytzKS5tYXRjaCgvKFxkezEsMn0pXEQoXGR7MSwyfSlcRChcZHs0fSkvKTsKICBpZiAoZG15KSB7CiAgICBkID0gbmV3IERhdGUoTnVtYmVyKGRteVszXSksIE51bWJlcihkbXlbMl0pIC0gMSwgTnVtYmVyKGRteVsxXSkpOwogICAgaWYgKCFpc05hTihkLmdldFRpbWUoKSkpIHJldHVybiBkOwogIH0KCiAgcmV0dXJuIG51bGw7Cn0KCmxldCBzb3J0TW9kZSA9ICdub3JtYWwnOwoKZnVuY3Rpb24gc29ydEN5Y2xlKCkgewogIGlmICghc3RhdGUuaXRlbXMgfHwgc3RhdGUuaXRlbXMubGVuZ3RoID09PSAwKSB7CiAgICB0b2FzdCgnTm8gbGlzdCBsb2FkZWQgeWV0Jyk7CiAgICByZXR1cm47CiAgfQoKICBpZiAoc29ydE1vZGUgPT09ICdub3JtYWwnKSB7CiAgICBzb3J0TW9kZSA9ICdsYXRlc3QnOwogICAgc3RhdGUuaXRlbXMuZm9yRWFjaChpdCA9PiB7CiAgICAgIGNvbnN0IHJhdyA9IGl0LmRhdGUgfHwgaXQuZGF0ZU1vZGlmaWVkIHx8IGl0Lm1vZGlmaWVkIHx8ICcnOwogICAgICBjb25zdCBkID0gcGFyc2VEYXRlRmxleGlibGUocmF3KTsKICAgICAgaXQuX3BhcnNlZERhdGUgPSBkID8gZC5nZXRUaW1lKCkgOiAwOwogICAgfSk7CiAgICBzdGF0ZS5pdGVtcy5zb3J0KChhLCBiKSA9PiBiLl9wYXJzZWREYXRlIC0gYS5fcGFyc2VkRGF0ZSk7CiAgICByZW5kZXJMaXN0KHN0YXRlLml0ZW1zKTsKICAgIHRvYXN0KCdTb3J0ZWQgYnkgTGF0ZXN0IE1vZGlmaWVkJyk7CiAgICAkKCdzb3J0TGF0ZXN0JykudGV4dENvbnRlbnQgPSAnTGF0ZXN0JzsKCiAgfSBlbHNlIGlmIChzb3J0TW9kZSA9PT0gJ2xhdGVzdCcpIHsKICAgIHNvcnRNb2RlID0gJ3Njb3JlJzsKICAgIHN0YXRlLml0ZW1zLnNvcnQoKGEsIGIpID0+IChwYXJzZUludChiLnNjb3JlIHx8IDApIC0gcGFyc2VJbnQoYS5zY29yZSB8fCAwKSkpOwogICAgcmVuZGVyTGlzdChzdGF0ZS5pdGVtcyk7CiAgICB0b2FzdCgnU29ydGVkIGJ5IFNjb3JlJyk7CiAgICAkKCdzb3J0TGF0ZXN0JykudGV4dENvbnRlbnQgPSAnVG9wJzsKCiAgfSBlbHNlIHsKICAgIHNvcnRNb2RlID0gJ25vcm1hbCc7CiAgICByZW5kZXJMaXN0KHN0YXRlLml0ZW1zKTsKICAgIHRvYXN0KCdTb3J0ZWQgYnkgTmFtZSAoTm9ybWFsKScpOwogICAgJCgnc29ydExhdGVzdCcpLnRleHRDb250ZW50ID0gJ1NvcnQnOwogIH0KfQoKY29uc3Qgc29ydEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3J0TGF0ZXN0Jyk7CmlmIChzb3J0QnRuKSB7CiAgc29ydEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNvcnRDeWNsZSk7Cn0KCmZ1bmN0aW9uIGRldGVjdEVudmlyb25tZW50KCkgewogIGNvbnN0IHVhID0gbmF2aWdhdG9yLnVzZXJBZ2VudCB8fCBuYXZpZ2F0b3IudmVuZG9yIHx8IHdpbmRvdy5vcGVyYTsKICBjb25zdCBpc01lc3NlbmdlciA9IC9GQkFOfEZCQVZ8RkJfSUFCfE1lc3Nlbmdlci9pLnRlc3QodWEpOwogIGNvbnN0IGlzSW5zdGFncmFtID0gL0luc3RhZ3JhbS9pLnRlc3QodWEpOwogIGNvbnN0IGlzV2ViVmlldyA9IC9cYnd2XGIvLnRlc3QodWEpIHx8ICh3aW5kb3cubmF2aWdhdG9yLnN0YW5kYWxvbmUgPT09IGZhbHNlKTsKCiAgaWYgKGlzTWVzc2VuZ2VyIHx8IGlzSW5zdGFncmFtIHx8IGlzV2ViVmlldykgewogICAgc2hvd0Jhbm5lcigiTWVzc2VuZ2VyIG9yIGluLWFwcCB3ZWJ2aWV3IGRldGVjdGVkLlxuVGhpcyBwYWdlIGlzIGJlc3QgdXNlZCBvbiBhIGZ1bGwgbW9iaWxlIGJyb3dzZXIgb3IgZGVza3RvcCBicm93c2VyLCBidXQgaXQgd2lsbCBwcm9iYWJseSB3b3JrIGFueXdheSIsIDQwMDApOwogIH0KICBzaG93QmFubmVyKCJIb3cgdG8gdXNlOlxuXG4xLiBFbnRlciB5b3VyIG5hbWVcbjIuIFNlbGVjdCB5b3VyIGRldmljZSBtb2RlbCAoT0xFRC9MaXRlL1YxL1YyKVxuMy4gU2VsZWN0IHlvdXIgU0QgQ2FyZCBTaXplXG40LiBDaG9vc2UgeW91ciBnYW1lc1xuNS4gUHJlc3MgVXBsb2FkXG42LiBTZW5kIHRoZSBnZW5lcmF0ZWQgbGluayB0byBvdXIgY2hhdCBjb252ZXJzYXRpb24iLCA4MDAwKTsKfQoKZnVuY3Rpb24gc2hvd0Jhbm5lcihtZXNzYWdlLCBkdXJhdGlvbiA9IDQwMDApIHsKICBjb25zdCBiYW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICBiYW5uZXIuaW5uZXJUZXh0ID0gbWVzc2FnZTsKICBiYW5uZXIuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjpmaXhlZDt0b3A6MzAlO2xlZnQ6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGVYKC01MCUpO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjgpO2NvbG9yOiNmZmY7cGFkZGluZzoxOHB4O2JvcmRlci1yYWRpdXM6MTZweDtmb250LXNpemU6MjJweDt6LWluZGV4Ojk5OTk7Ym94LXNoYWRvdzowIDJweCA2cHggcmdiYSgwLDAsMCwwLjMpO3RyYW5zaXRpb246b3BhY2l0eSAwLjVzIGVhc2U7d2hpdGUtc3BhY2U6cHJlLWxpbmU7bWF4LXdpZHRoOjgwJSI7CiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChiYW5uZXIpOwoKICBzZXRUaW1lb3V0KCgpID0+IGJhbm5lci5zdHlsZS5vcGFjaXR5ID0gIjAiLCBkdXJhdGlvbik7CiAgc2V0VGltZW91dCgoKSA9PiBiYW5uZXIucmVtb3ZlKCksIGR1cmF0aW9uICsgNTAwKTsKfQoKZnVuY3Rpb24gbGV2ZW5zaHRlaW5EaXN0YW5jZShzdHIxLCBzdHIyKSB7CiAgY29uc3QgbGVuMSA9IHN0cjEubGVuZ3RoOwogIGNvbnN0IGxlbjIgPSBzdHIyLmxlbmd0aDsKICBjb25zdCBtYXRyaXggPSBBcnJheShsZW4yICsgMSkuZmlsbChudWxsKS5tYXAoKCkgPT4gQXJyYXkobGVuMSArIDEpLmZpbGwoMCkpOwogIAogIGZvciAobGV0IGkgPSAwOyBpIDw9IGxlbjE7IGkrKykgbWF0cml4WzBdW2ldID0gaTsKICBmb3IgKGxldCBqID0gMDsgaiA8PSBsZW4yOyBqKyspIG1hdHJpeFtqXVswXSA9IGo7CiAgCiAgZm9yIChsZXQgaiA9IDE7IGogPD0gbGVuMjsgaisrKSB7CiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBsZW4xOyBpKyspIHsKICAgICAgY29uc3QgY29zdCA9IHN0cjFbaSAtIDFdID09PSBzdHIyW2ogLSAxXSA/IDAgOiAxOwogICAgICBtYXRyaXhbal1baV0gPSBNYXRoLm1pbigKICAgICAgICBtYXRyaXhbal1baSAtIDFdICsgMSwKICAgICAgICBtYXRyaXhbaiAtIDFdW2ldICsgMSwKICAgICAgICBtYXRyaXhbaiAtIDFdW2kgLSAxXSArIGNvc3QKICAgICAgKTsKICAgIH0KICB9CiAgCiAgcmV0dXJuIG1hdHJpeFtsZW4yXVtsZW4xXTsKfQoKZnVuY3Rpb24gbm9ybWFsaXplVGl0bGUodGl0bGUpIHsKICByZXR1cm4gdGl0bGUudG9Mb3dlckNhc2UoKQogICAgLnJlcGxhY2UoL1teXHdcc10vZywgJyAnKSAgLy8gUmVtb3ZlIHB1bmN0dWF0aW9uCiAgICAucmVwbGFjZSgvXHMrL2csICcgJykgICAgICAvLyBDb2xsYXBzZSBzcGFjZXMKICAgIC50cmltKCk7Cn0KCmZ1bmN0aW9uIGdldEtleXdvcmRzKHRpdGxlKSB7CiAgY29uc3Qgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZVRpdGxlKHRpdGxlKTsKICAvLyBGaWx0ZXIgb3V0IGNvbW1vbiB3b3JkcwogIGNvbnN0IHN0b3BXb3JkcyA9IFsndGhlJywgJ29mJywgJ2FuZCcsICdhJywgJ2FuJywgJ2luJywgJ29uJywgJ2ZvcicsICd0bycsICd3aXRoJ107CiAgcmV0dXJuIG5vcm1hbGl6ZWQuc3BsaXQoJyAnKS5maWx0ZXIod29yZCA9PiB3b3JkLmxlbmd0aCA+IDAgJiYgIXN0b3BXb3Jkcy5pbmNsdWRlcyh3b3JkKSk7Cn0KCmZ1bmN0aW9uIGV4dHJhY3ROdW1iZXJzKHRpdGxlKSB7CiAgY29uc3QgbWF0Y2hlcyA9IHRpdGxlLm1hdGNoKC9cZCsvZyk7CiAgcmV0dXJuIG1hdGNoZXMgPyBtYXRjaGVzLm1hcChuID0+IG4pIDogW107Cn0KCmZ1bmN0aW9uIGNhbGN1bGF0ZU1hdGNoU2NvcmUodXNlclRpdGxlLCBkYlRpdGxlKSB7CiAgY29uc3QgdXNlcktleXdvcmRzID0gZ2V0S2V5d29yZHModXNlclRpdGxlKTsKICBjb25zdCBkYktleXdvcmRzID0gZ2V0S2V5d29yZHMoZGJUaXRsZSk7CiAgCiAgaWYgKHVzZXJLZXl3b3Jkcy5sZW5ndGggPT09IDApIHJldHVybiB7IHNjb3JlOiAwLCBudW1iZXJNYXRjaDogZmFsc2UsIGNvbnNlY3V0aXZlTWF0Y2hlczogMCB9OwogIAogIGxldCBtYXRjaGVkV29yZHMgPSAwOwogIGxldCBwYXJ0aWFsTWF0Y2hlcyA9IDA7CiAgbGV0IGNvbnNlY3V0aXZlTWF0Y2hlcyA9IDA7CiAgbGV0IGxhc3RNYXRjaEluZGV4ID0gLTI7CiAgCiAgLy8gQ2hlY2sgZm9yIG51bWJlciBtYXRjaGluZwogIGNvbnN0IHVzZXJOdW1iZXJzID0gZXh0cmFjdE51bWJlcnModXNlclRpdGxlKTsKICBjb25zdCBkYk51bWJlcnMgPSBleHRyYWN0TnVtYmVycyhkYlRpdGxlKTsKICBjb25zdCBoYXNFeGFjdE51bWJlck1hdGNoID0gdXNlck51bWJlcnMubGVuZ3RoID4gMCAmJiAKICAgIHVzZXJOdW1iZXJzLmV2ZXJ5KG51bSA9PiBkYk51bWJlcnMuaW5jbHVkZXMobnVtKSk7CiAgCiAgdXNlcktleXdvcmRzLmZvckVhY2goKHVzZXJXb3JkLCBpZHgpID0+IHsKICAgIGxldCBtYXRjaGVkID0gZmFsc2U7CiAgICAKICAgIC8vIENoZWNrIGZvciBleGFjdCB3b3JkIG1hdGNoCiAgICBjb25zdCBleGFjdElkeCA9IGRiS2V5d29yZHMuZmluZEluZGV4KGRiV29yZCA9PiBkYldvcmQgPT09IHVzZXJXb3JkKTsKICAgIGlmIChleGFjdElkeCAhPT0gLTEpIHsKICAgICAgbWF0Y2hlZFdvcmRzICs9IDE7CiAgICAgIG1hdGNoZWQgPSB0cnVlOwogICAgICAKICAgICAgLy8gVHJhY2sgY29uc2VjdXRpdmUgbWF0Y2hlcwogICAgICBpZiAoZXhhY3RJZHggPT09IGxhc3RNYXRjaEluZGV4ICsgMSkgewogICAgICAgIGNvbnNlY3V0aXZlTWF0Y2hlcysrOwogICAgICB9CiAgICAgIGxhc3RNYXRjaEluZGV4ID0gZXhhY3RJZHg7CiAgICAgIHJldHVybjsKICAgIH0KICAgIAogICAgLy8gQ2hlY2sgZm9yIHN1YnN0cmluZyBtYXRjaCAtIGJ1dCByZXF1aXJlIG1pbmltdW0gbGVuZ3RoCiAgICAvLyBBTkQgdGhlIHVzZXIgd29yZCBtdXN0IGJlIHN1YnN0YW50aWFsICgzKyBjaGFycyBmb3IgbW9zdCwgNCsgZm9yIHZlcnkgY29tbW9uIHdvcmRzKQogICAgaWYgKHVzZXJXb3JkLmxlbmd0aCA+PSAzKSB7CiAgICAgIGNvbnN0IHN1YnN0cmluZ0lkeCA9IGRiS2V5d29yZHMuZmluZEluZGV4KGRiV29yZCA9PiB7CiAgICAgICAgLy8gREIgd29yZCBtdXN0IGJlIGxvbmcgZW5vdWdoIHRvIGNvbnRhaW4gdGhlIHVzZXIgd29yZCBtZWFuaW5nZnVsbHkKICAgICAgICBpZiAoZGJXb3JkLmxlbmd0aCA+PSB1c2VyV29yZC5sZW5ndGggKyAxICYmIGRiV29yZC5pbmNsdWRlcyh1c2VyV29yZCkpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICAvLyBPciBpZiB1c2VyIHdvcmQgaXMgbG9uZ2VyLCBjaGVjayBpZiBpdCBjb250YWlucyBEQiB3b3JkIChmb3IgY29tcG91bmQgd29yZHMpCiAgICAgICAgaWYgKHVzZXJXb3JkLmxlbmd0aCA+PSA0ICYmIHVzZXJXb3JkLmluY2x1ZGVzKGRiV29yZCkgJiYgZGJXb3JkLmxlbmd0aCA+PSAzKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9KTsKICAgICAgCiAgICAgIGlmIChzdWJzdHJpbmdJZHggIT09IC0xKSB7CiAgICAgICAgLy8gR2l2ZSBoaWdoZXIgc2NvcmUgZm9yIGxvbmdlciBtYXRjaGVzCiAgICAgICAgY29uc3QgbWF0Y2hTdHJlbmd0aCA9IHVzZXJXb3JkLmxlbmd0aCA+PSA0ID8gMC44IDogMC42OwogICAgICAgIHBhcnRpYWxNYXRjaGVzICs9IG1hdGNoU3RyZW5ndGg7CiAgICAgICAgbWF0Y2hlZCA9IHRydWU7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgICAKICAgIC8vIENoZWNrIGZvciB2ZXJ5IGNsb3NlIHR5cG8gKHNpbmdsZSBjaGFyIGRpZmZlcmVuY2UpCiAgICAvLyBPbmx5IGZvciB3b3JkcyAzKyBjaGFyYWN0ZXJzCiAgICBpZiAodXNlcldvcmQubGVuZ3RoID49IDMpIHsKICAgICAgZGJLZXl3b3Jkcy5mb3JFYWNoKGRiV29yZCA9PiB7CiAgICAgICAgaWYgKGRiV29yZC5sZW5ndGggPCAzKSByZXR1cm47IC8vIFNraXAgc2hvcnQgd29yZHMKICAgICAgICAKICAgICAgICBjb25zdCBtYXhMZW4gPSBNYXRoLm1heCh1c2VyV29yZC5sZW5ndGgsIGRiV29yZC5sZW5ndGgpOwogICAgICAgIGNvbnN0IG1pbkxlbiA9IE1hdGgubWluKHVzZXJXb3JkLmxlbmd0aCwgZGJXb3JkLmxlbmd0aCk7CiAgICAgICAgCiAgICAgICAgLy8gT25seSBjb25zaWRlciBpZiBsZW5ndGhzIGFyZSBzaW1pbGFyCiAgICAgICAgaWYgKG1heExlbiAtIG1pbkxlbiA8PSAyICYmIG1pbkxlbiA+PSAzKSB7CiAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IGxldmVuc2h0ZWluRGlzdGFuY2UodXNlcldvcmQsIGRiV29yZCk7CiAgICAgICAgICBpZiAoZGlzdGFuY2UgPD0gMikgewogICAgICAgICAgICBwYXJ0aWFsTWF0Y2hlcyArPSAwLjU7CiAgICAgICAgICAgIG1hdGNoZWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CiAgCiAgY29uc3QgdG90YWxNYXRjaGVkID0gbWF0Y2hlZFdvcmRzICsgcGFydGlhbE1hdGNoZXM7CiAgY29uc3Qgc2NvcmUgPSB0b3RhbE1hdGNoZWQgLyB1c2VyS2V5d29yZHMubGVuZ3RoOwogIAogIHJldHVybiB7IAogICAgc2NvcmUsIAogICAgbnVtYmVyTWF0Y2g6IGhhc0V4YWN0TnVtYmVyTWF0Y2gsCiAgICBjb25zZWN1dGl2ZU1hdGNoZXMsCiAgICB0aXRsZUxlbmd0aDogZGJLZXl3b3Jkcy5sZW5ndGgsCiAgICBleGFjdFdvcmRDb3VudDogbWF0Y2hlZFdvcmRzICAvLyBUcmFjayBleGFjdCBtYXRjaGVzIHNlcGFyYXRlbHkKICB9Owp9CgpmdW5jdGlvbiBmaW5kQmVzdE1hdGNoKHVzZXJUaXRsZSwgZGJJdGVtcykgewogIGNvbnN0IG5vcm1hbGl6ZWQgPSBub3JtYWxpemVUaXRsZSh1c2VyVGl0bGUpOwogIAogIC8vIFRyeSBleGFjdCBtYXRjaCBmaXJzdAogIGNvbnN0IGV4YWN0TWF0Y2ggPSBkYkl0ZW1zLmZpbmQoaXRlbSA9PiBub3JtYWxpemVUaXRsZShpdGVtLm5hbWUpID09PSBub3JtYWxpemVkKTsKICBpZiAoZXhhY3RNYXRjaCkgewogICAgcmV0dXJuIHsgbWF0Y2g6IGV4YWN0TWF0Y2gsIGNvbmZpZGVuY2U6ICdleGFjdCcsIHNjb3JlOiAxLjAgfTsKICB9CiAgCiAgLy8gU2NvcmUgYWxsIGl0ZW1zCiAgY29uc3Qgc2NvcmVkID0gZGJJdGVtcy5tYXAoaXRlbSA9PiB7CiAgICBjb25zdCBtYXRjaERhdGEgPSBjYWxjdWxhdGVNYXRjaFNjb3JlKHVzZXJUaXRsZSwgaXRlbS5uYW1lKTsKICAgIHJldHVybiB7CiAgICAgIGl0ZW0sCiAgICAgIC4uLm1hdGNoRGF0YQogICAgfTsKICB9KS5maWx0ZXIocyA9PiBzLnNjb3JlID4gMCk7CiAgCiAgaWYgKHNjb3JlZC5sZW5ndGggPT09IDApIHJldHVybiBudWxsOwogIAogIC8vIFNvcnQgYnkgcHJpb3JpdHk6CiAgLy8gMS4gTnVtYmVyIG1hdGNoIChjcml0aWNhbCBmb3Igc2VxdWVscy92ZXJzaW9ucykKICAvLyAyLiBFeGFjdCB3b3JkIGNvdW50IChwcmVmZXIgbW9yZSBleGFjdCBtYXRjaGVzKQogIC8vIDMuIFNjb3JlCiAgLy8gNC4gQ29uc2VjdXRpdmUgbWF0Y2hlcyAod29yZCBvcmRlciBtYXR0ZXJzKQogIC8vIDUuIFNob3J0ZXIgdGl0bGUgKG1vcmUgcHJlY2lzZSkKICBzY29yZWQuc29ydCgoYSwgYikgPT4gewogICAgLy8gUHJpb3JpdHkgMTogRXhhY3QgbnVtYmVyIG1hdGNoCiAgICBpZiAoYS5udW1iZXJNYXRjaCAmJiAhYi5udW1iZXJNYXRjaCkgcmV0dXJuIC0xOwogICAgaWYgKCFhLm51bWJlck1hdGNoICYmIGIubnVtYmVyTWF0Y2gpIHJldHVybiAxOwogICAgCiAgICAvLyBQcmlvcml0eSAyOiBNb3JlIGV4YWN0IHdvcmQgbWF0Y2hlcyB3aW5zCiAgICBpZiAoYS5leGFjdFdvcmRDb3VudCAhPT0gYi5leGFjdFdvcmRDb3VudCkgewogICAgICByZXR1cm4gYi5leGFjdFdvcmRDb3VudCAtIGEuZXhhY3RXb3JkQ291bnQ7CiAgICB9CiAgICAKICAgIC8vIFByaW9yaXR5IDM6IFNjb3JlIGRpZmZlcmVuY2UKICAgIGNvbnN0IHNjb3JlRGlmZiA9IGIuc2NvcmUgLSBhLnNjb3JlOwogICAgaWYgKE1hdGguYWJzKHNjb3JlRGlmZikgPiAwLjE1KSByZXR1cm4gc2NvcmVEaWZmOwogICAgCiAgICAvLyBQcmlvcml0eSA0OiBDb25zZWN1dGl2ZSBtYXRjaGVzIChwaHJhc2UgbWF0Y2hpbmcpCiAgICBpZiAoYS5jb25zZWN1dGl2ZU1hdGNoZXMgIT09IGIuY29uc2VjdXRpdmVNYXRjaGVzKSB7CiAgICAgIHJldHVybiBiLmNvbnNlY3V0aXZlTWF0Y2hlcyAtIGEuY29uc2VjdXRpdmVNYXRjaGVzOwogICAgfQogICAgCiAgICAvLyBQcmlvcml0eSA1OiBQcmVmZXIgc2hvcnRlciB0aXRsZXMKICAgIHJldHVybiBhLnRpdGxlTGVuZ3RoIC0gYi50aXRsZUxlbmd0aDsKICB9KTsKICAKICBjb25zdCBiZXN0ID0gc2NvcmVkWzBdOwogIAogIC8vIERldGVybWluZSBjb25maWRlbmNlIGJhc2VkIG9uIHNjb3JlCiAgbGV0IGNvbmZpZGVuY2U7CiAgaWYgKGJlc3Quc2NvcmUgPj0gMC45NSkgewogICAgY29uZmlkZW5jZSA9ICdoaWdoJzsKICB9IGVsc2UgaWYgKGJlc3Quc2NvcmUgPj0gMC43KSB7CiAgICBjb25maWRlbmNlID0gJ21lZGl1bSc7CiAgfSBlbHNlIGlmIChiZXN0LnNjb3JlID49IDAuNSkgewogICAgY29uZmlkZW5jZSA9ICdsb3cnOwogIH0gZWxzZSB7CiAgICByZXR1cm4gbnVsbDsgLy8gVG9vIGxvdyBjb25maWRlbmNlCiAgfQogIAogIHJldHVybiB7IG1hdGNoOiBiZXN0Lml0ZW0sIGNvbmZpZGVuY2UsIHNjb3JlOiBiZXN0LnNjb3JlIH07Cn0KCmZ1bmN0aW9uIG1hdGNoVXNlckxpc3QodXNlckxpc3QpIHsKICBjb25zdCBsaW5lcyA9IHVzZXJMaXN0LnNwbGl0KCdcbicpLm1hcChzID0+IHMudHJpbSgpKS5maWx0ZXIoQm9vbGVhbik7CiAgY29uc3QgcmVzdWx0cyA9IHsKICAgIGV4YWN0OiBbXSwKICAgIGhpZ2g6IFtdLAogICAgbWVkaXVtOiBbXSwKICAgIGxvdzogW10sCiAgICBub3RGb3VuZDogW10KICB9OwogIAogIGxpbmVzLmZvckVhY2godXNlclRpdGxlID0+IHsKICAgIGNvbnN0IHJlc3VsdCA9IGZpbmRCZXN0TWF0Y2godXNlclRpdGxlLCBzdGF0ZS5pdGVtcyk7CiAgICAKICAgIGlmICghcmVzdWx0KSB7CiAgICAgIHJlc3VsdHMubm90Rm91bmQucHVzaCh1c2VyVGl0bGUpOwogICAgfSBlbHNlIHsKICAgICAgcmVzdWx0c1tyZXN1bHQuY29uZmlkZW5jZV0ucHVzaCh7CiAgICAgICAgb3JpZ2luYWw6IHVzZXJUaXRsZSwKICAgICAgICBtYXRjaGVkOiByZXN1bHQubWF0Y2gubmFtZSwKICAgICAgICBzaXplOiByZXN1bHQubWF0Y2guc2l6ZSwKICAgICAgICBzY29yZTogcmVzdWx0LnNjb3JlCiAgICAgIH0pOwogICAgfQogIH0pOwogIAogIHJldHVybiByZXN1bHRzOwp9CgokKCdtYXRjaExpc3QnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZXNNb2RhbCcpOwogIG1vZGFsLmlubmVySFRNTCA9ICcnOwogIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogIG1vZGFsLnN0eWxlLm1heFdpZHRoID0gJzYwMHB4JzsKICAKICBjb25zdCBoZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICBoZWFkZXIuaW5uZXJIVE1MID0gJzxzdHJvbmc+TWF0Y2ggVXNlciBMaXN0PC9zdHJvbmc+PGJyPjxzcGFuIGNsYXNzPSJtZXRhIj5QYXN0ZSB1c2VyXCdzIGdhbWUgbGlzdCBiZWxvdyAob25lIHBlciBsaW5lKTwvc3Bhbj4nOwogIG1vZGFsLmFwcGVuZENoaWxkKGhlYWRlcik7CiAgCiAgY29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpOwogIHRleHRhcmVhLnN0eWxlLmNzc1RleHQgPSAnd2lkdGg6MTAwJTttaW4taGVpZ2h0OjIwMHB4O21hcmdpbi10b3A6MTJweDtwYWRkaW5nOjhweDtib3JkZXI6MXB4IHNvbGlkICNlNWU3ZWI7Ym9yZGVyLXJhZGl1czo4cHg7Zm9udC1mYW1pbHk6bW9ub3NwYWNlO2ZvbnQtc2l6ZToxM3B4Oyc7CiAgdGV4dGFyZWEucGxhY2Vob2xkZXIgPSAnU3VwZXIgTWFyaW8gT2R5c3NleVxuVGhlIExlZ2VuZCBvZiBaZWxkYVxuTWFyaW8gS2FydCA4XG4uLi4nOwogIG1vZGFsLmFwcGVuZENoaWxkKHRleHRhcmVhKTsKICAKICBjb25zdCBidG5Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICBidG5Db250YWluZXIuc3R5bGUuY3NzVGV4dCA9ICdkaXNwbGF5OmZsZXg7Z2FwOjhweDttYXJnaW4tdG9wOjEycHg7JzsKICAKICBjb25zdCBtYXRjaEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogIG1hdGNoQnRuLnRleHRDb250ZW50ID0gJ0FuYWx5emUgJiBNYXRjaCc7CiAgbWF0Y2hCdG4uY2xhc3NOYW1lID0gJ2J0bic7CiAgbWF0Y2hCdG4ub25jbGljayA9ICgpID0+IHsKICAgIGNvbnN0IHVzZXJMaXN0ID0gdGV4dGFyZWEudmFsdWUudHJpbSgpOwogICAgaWYgKCF1c2VyTGlzdCkgewogICAgICBhbGVydCgnUGxlYXNlIHBhc3RlIGEgZ2FtZSBsaXN0Jyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIAogICAgc2hvd01hdGNoUmVzdWx0cyh1c2VyTGlzdCk7CiAgfTsKICBidG5Db250YWluZXIuYXBwZW5kQ2hpbGQobWF0Y2hCdG4pOwogIAogIGNvbnN0IGNsb3NlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgY2xvc2VCdG4udGV4dENvbnRlbnQgPSAnQ2FuY2VsJzsKICBjbG9zZUJ0bi5jbGFzc05hbWUgPSAnYnRuIGdob3N0JzsKICBjbG9zZUJ0bi5vbmNsaWNrID0gKCkgPT4gewogICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIG1vZGFsLmlubmVySFRNTCA9ICcnOwogIH07CiAgYnRuQ29udGFpbmVyLmFwcGVuZENoaWxkKGNsb3NlQnRuKTsKICAKICBtb2RhbC5hcHBlbmRDaGlsZChidG5Db250YWluZXIpOwp9KTsKCmZ1bmN0aW9uIHNob3dNYXRjaFJlc3VsdHModXNlckxpc3QpIHsKICBjb25zdCByZXN1bHRzID0gbWF0Y2hVc2VyTGlzdCh1c2VyTGlzdCk7CiAgY29uc3QgdG90YWxNYXRjaGVkID0gcmVzdWx0cy5leGFjdC5sZW5ndGggKyByZXN1bHRzLmhpZ2gubGVuZ3RoICsgcmVzdWx0cy5tZWRpdW0ubGVuZ3RoICsgcmVzdWx0cy5sb3cubGVuZ3RoOwogIGNvbnN0IHRvdGFsSXRlbXMgPSB0b3RhbE1hdGNoZWQgKyByZXN1bHRzLm5vdEZvdW5kLmxlbmd0aDsKICAKICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlc01vZGFsJyk7CiAgbW9kYWwuaW5uZXJIVE1MID0gJyc7CiAgbW9kYWwuc3R5bGUubWF4V2lkdGggPSAnNzAwcHgnOwogIG1vZGFsLnN0eWxlLm1heEhlaWdodCA9ICc4MHZoJzsKICAKICBjb25zdCBoZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICBoZWFkZXIuaW5uZXJIVE1MID0gYDxzdHJvbmc+TWF0Y2ggUmVzdWx0czwvc3Ryb25nPjxicj48c3BhbiBjbGFzcz0ibWV0YSI+TWF0Y2hlZDogJHt0b3RhbE1hdGNoZWR9IC8gJHt0b3RhbEl0ZW1zfTwvc3Bhbj5gOwogIG1vZGFsLmFwcGVuZENoaWxkKGhlYWRlcik7CiAgCiAgY29uc3QgcmVzdWx0Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgcmVzdWx0Q29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAnbWFyZ2luLXRvcDoxMnB4O21heC1oZWlnaHQ6NDAwcHg7b3ZlcmZsb3cteTphdXRvOyc7CiAgCiAgLy8gRXhhY3QgbWF0Y2hlcwogIGlmIChyZXN1bHRzLmV4YWN0Lmxlbmd0aCA+IDApIHsKICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgc3R5bGU9Im1hcmdpbi1ib3R0b206OHB4OyI+PHN0cm9uZyBzdHlsZT0iY29sb3I6IzEwYjk4MTsiPuKckyBFeGFjdCBNYXRjaGVzICgke3Jlc3VsdHMuZXhhY3QubGVuZ3RofSk8L3N0cm9uZz48L2Rpdj5gOwogICAgcmVzdWx0cy5leGFjdC5mb3JFYWNoKHIgPT4gewogICAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MICs9IGA8ZGl2IHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7YmFja2dyb3VuZDojZjBmZGY0O2JvcmRlci1sZWZ0OjNweCBzb2xpZCAjMTBiOTgxO21hcmdpbi1ib3R0b206NHB4O2ZvbnQtc2l6ZToxMnB4OyI+JHtlc2Moci5tYXRjaGVkKX0gPHNwYW4gc3R5bGU9ImNvbG9yOiM2YjcyODA7Ij4ke2VzYyhyLnNpemUpfTwvc3Bhbj48L2Rpdj5gOwogICAgfSk7CiAgfQogIAogIC8vIEhpZ2ggY29uZmlkZW5jZQogIGlmIChyZXN1bHRzLmhpZ2gubGVuZ3RoID4gMCkgewogICAgcmVzdWx0Q29udGFpbmVyLmlubmVySFRNTCArPSBgPGRpdiBzdHlsZT0ibWFyZ2luOjEycHggMCA4cHg7Ij48c3Ryb25nIHN0eWxlPSJjb2xvcjojM2I4MmY2OyI+4omIIEhpZ2ggQ29uZmlkZW5jZSAoJHtyZXN1bHRzLmhpZ2gubGVuZ3RofSk8L3N0cm9uZz48L2Rpdj5gOwogICAgcmVzdWx0cy5oaWdoLmZvckVhY2gociA9PiB7CiAgICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgc3R5bGU9InBhZGRpbmc6NHB4IDhweDtiYWNrZ3JvdW5kOiNlZmY2ZmY7Ym9yZGVyLWxlZnQ6M3B4IHNvbGlkICMzYjgyZjY7bWFyZ2luLWJvdHRvbTo0cHg7Zm9udC1zaXplOjEycHg7Ij48ZGl2PiR7ZXNjKHIub3JpZ2luYWwpfSDihpIgPHN0cm9uZz4ke2VzYyhyLm1hdGNoZWQpfTwvc3Ryb25nPjwvZGl2PjxkaXYgc3R5bGU9ImNvbG9yOiM2YjcyODA7Ij4ke2VzYyhyLnNpemUpfTwvZGl2PjwvZGl2PmA7CiAgICB9KTsKICB9CiAgCiAgLy8gTWVkaXVtIGNvbmZpZGVuY2UKICBpZiAocmVzdWx0cy5tZWRpdW0ubGVuZ3RoID4gMCkgewogICAgcmVzdWx0Q29udGFpbmVyLmlubmVySFRNTCArPSBgPGRpdiBzdHlsZT0ibWFyZ2luOjEycHggMCA4cHg7Ij48c3Ryb25nIHN0eWxlPSJjb2xvcjojZjU5ZTBiOyI+PyBNZWRpdW0gQ29uZmlkZW5jZSAoJHtyZXN1bHRzLm1lZGl1bS5sZW5ndGh9KTwvc3Ryb25nPiA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjEycHg7Y29sb3I6IzZiNzI4MDsiPlJldmlldyB0aGVzZTwvc3Bhbj48L2Rpdj5gOwogICAgcmVzdWx0cy5tZWRpdW0uZm9yRWFjaChyID0+IHsKICAgICAgcmVzdWx0Q29udGFpbmVyLmlubmVySFRNTCArPSBgPGRpdiBzdHlsZT0icGFkZGluZzo0cHggOHB4O2JhY2tncm91bmQ6I2ZmZmJlYjtib3JkZXItbGVmdDozcHggc29saWQgI2Y1OWUwYjttYXJnaW4tYm90dG9tOjRweDtmb250LXNpemU6MTJweDsiPjxkaXY+JHtlc2Moci5vcmlnaW5hbCl9IOKGkiA8c3Ryb25nPiR7ZXNjKHIubWF0Y2hlZCl9PC9zdHJvbmc+PC9kaXY+PGRpdiBzdHlsZT0iY29sb3I6IzZiNzI4MDsiPiR7ZXNjKHIuc2l6ZSl9PC9kaXY+PC9kaXY+YDsKICAgIH0pOwogIH0KICAKICAvLyBMb3cgY29uZmlkZW5jZQogIGlmIChyZXN1bHRzLmxvdy5sZW5ndGggPiAwKSB7CiAgICByZXN1bHRDb250YWluZXIuaW5uZXJIVE1MICs9IGA8ZGl2IHN0eWxlPSJtYXJnaW46MTJweCAwIDhweDsiPjxzdHJvbmcgc3R5bGU9ImNvbG9yOiNmOTczMTY7Ij7imqAgTG93IENvbmZpZGVuY2UgKCR7cmVzdWx0cy5sb3cubGVuZ3RofSk8L3N0cm9uZz4gPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZToxMnB4O2NvbG9yOiM2YjcyODA7Ij5WZXJpZnkgbWFudWFsbHk8L3NwYW4+PC9kaXY+YDsKICAgIHJlc3VsdHMubG93LmZvckVhY2gociA9PiB7CiAgICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgc3R5bGU9InBhZGRpbmc6NHB4IDhweDtiYWNrZ3JvdW5kOiNmZmY3ZWQ7Ym9yZGVyLWxlZnQ6M3B4IHNvbGlkICNmOTczMTY7bWFyZ2luLWJvdHRvbTo0cHg7Zm9udC1zaXplOjEycHg7Ij48ZGl2PiR7ZXNjKHIub3JpZ2luYWwpfSDihpIgPHN0cm9uZz4ke2VzYyhyLm1hdGNoZWQpfTwvc3Ryb25nPjwvZGl2PjxkaXYgc3R5bGU9ImNvbG9yOiM2YjcyODA7Ij4ke2VzYyhyLnNpemUpfTwvZGl2PjwvZGl2PmA7CiAgICB9KTsKICB9CiAgCiAgLy8gTm90IGZvdW5kCiAgaWYgKHJlc3VsdHMubm90Rm91bmQubGVuZ3RoID4gMCkgewogICAgcmVzdWx0Q29udGFpbmVyLmlubmVySFRNTCArPSBgPGRpdiBzdHlsZT0ibWFyZ2luOjEycHggMCA4cHg7Ij48c3Ryb25nIHN0eWxlPSJjb2xvcjojZWY0NDQ0OyI+4pyXIE5vdCBGb3VuZCAoJHtyZXN1bHRzLm5vdEZvdW5kLmxlbmd0aH0pPC9zdHJvbmc+PC9kaXY+YDsKICAgIHJlc3VsdHMubm90Rm91bmQuZm9yRWFjaCh0aXRsZSA9PiB7CiAgICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgc3R5bGU9InBhZGRpbmc6NHB4IDhweDtiYWNrZ3JvdW5kOiNmZWYyZjI7Ym9yZGVyLWxlZnQ6M3B4IHNvbGlkICNlZjQ0NDQ7bWFyZ2luLWJvdHRvbTo0cHg7Zm9udC1zaXplOjEycHg7Ij4ke2VzYyh0aXRsZSl9PC9kaXY+YDsKICAgIH0pOwogIH0KICAKICBtb2RhbC5hcHBlbmRDaGlsZChyZXN1bHRDb250YWluZXIpOwogIAogIGNvbnN0IGJ0bkNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIGJ0bkNvbnRhaW5lci5zdHlsZS5jc3NUZXh0ID0gJ2Rpc3BsYXk6ZmxleDtnYXA6OHB4O21hcmdpbi10b3A6MTJweDtmbGV4LXdyYXA6d3JhcDsnOwogIAogIGlmICh0b3RhbE1hdGNoZWQgPiAwKSB7CiAgICBjb25zdCBhZGRBbGxCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgIGFkZEFsbEJ0bi50ZXh0Q29udGVudCA9IGBBZGQgJHt0b3RhbE1hdGNoZWR9IE1hdGNoZXMgdG8gU2VsZWN0aW9uYDsKICAgIGFkZEFsbEJ0bi5jbGFzc05hbWUgPSAnYnRuJzsKICAgIGFkZEFsbEJ0bi5vbmNsaWNrID0gKCkgPT4gewogICAgICBsZXQgYWRkZWQgPSAwOwogICAgICBbLi4ucmVzdWx0cy5leGFjdCwgLi4ucmVzdWx0cy5oaWdoLCAuLi5yZXN1bHRzLm1lZGl1bSwgLi4ucmVzdWx0cy5sb3ddLmZvckVhY2gociA9PiB7CiAgICAgICAgaWYgKCFzdGF0ZS5zZWxlY3RlZC5zb21lKHMgPT4gcy5uYW1lID09PSByLm1hdGNoZWQpKSB7CiAgICAgICAgICBjb25zdCBpdGVtID0gc3RhdGUuaXRlbXMuZmluZChpdCA9PiBpdC5uYW1lID09PSByLm1hdGNoZWQpOwogICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgc3RhdGUuc2VsZWN0ZWQucHVzaCh7CiAgICAgICAgICAgICAgbmFtZTogaXRlbS5uYW1lLAogICAgICAgICAgICAgIGZpbGVuYW1lOiBpdGVtLmZpbGVuYW1lIHx8IGl0ZW0ubmFtZSwKICAgICAgICAgICAgICBzaXplOiBpdGVtLnNpemUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGFkZGVkKys7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgICAgCiAgICAgIHVwZGF0ZVRvdGFscygpOwogICAgICByZW5kZXJPdmVybGF5KCk7CiAgICAgIHJlbmRlckxpc3Qoc3RhdGUuaXRlbXMpOwogICAgICB0b2FzdChgQWRkZWQgJHthZGRlZH0gbWF0Y2hlZCBnYW1lc2ApOwogICAgICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICBtb2RhbC5pbm5lckhUTUwgPSAnJzsKICAgIH07CiAgICBidG5Db250YWluZXIuYXBwZW5kQ2hpbGQoYWRkQWxsQnRuKTsKICB9CiAgCiAgY29uc3QgZXhwb3J0TWF0Y2hlZEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogIGV4cG9ydE1hdGNoZWRCdG4udGV4dENvbnRlbnQgPSAnRXhwb3J0IE1hdGNoZWQnOwogIGV4cG9ydE1hdGNoZWRCdG4uY2xhc3NOYW1lID0gJ2J0biBnaG9zdCc7CiAgZXhwb3J0TWF0Y2hlZEJ0bi5vbmNsaWNrID0gKCkgPT4gewogICAgY29uc3QgY29udGVudCA9IFsuLi5yZXN1bHRzLmV4YWN0LCAuLi5yZXN1bHRzLmhpZ2gsIC4uLnJlc3VsdHMubWVkaXVtLCAuLi5yZXN1bHRzLmxvd10KICAgICAgLm1hcChyID0+IHIubWF0Y2hlZCkKICAgICAgLmpvaW4oJ1xuJyk7CiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2NvbnRlbnRdLCB7IHR5cGU6ICd0ZXh0L3BsYWluJyB9KTsKICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICBhLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgYS5kb3dubG9hZCA9IGBtYXRjaGVkXyR7RGF0ZS5ub3coKX0udHh0YDsKICAgIGEuY2xpY2soKTsKICAgIFVSTC5yZXZva2VPYmplY3RVUkwoYS5ocmVmKTsKICAgIHRvYXN0KCdFeHBvcnRlZCBtYXRjaGVkIGxpc3QnKTsKICB9OwogIGJ0bkNvbnRhaW5lci5hcHBlbmRDaGlsZChleHBvcnRNYXRjaGVkQnRuKTsKICAKICBpZiAocmVzdWx0cy5ub3RGb3VuZC5sZW5ndGggPiAwKSB7CiAgICBjb25zdCBleHBvcnROb3RGb3VuZEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgZXhwb3J0Tm90Rm91bmRCdG4udGV4dENvbnRlbnQgPSAnRXhwb3J0IE5vdCBGb3VuZCc7CiAgICBleHBvcnROb3RGb3VuZEJ0bi5jbGFzc05hbWUgPSAnYnRuIGdob3N0JzsKICAgIGV4cG9ydE5vdEZvdW5kQnRuLnN0eWxlLmJhY2tncm91bmQgPSAnI2ZlZjJmMic7CiAgICBleHBvcnROb3RGb3VuZEJ0bi5zdHlsZS5jb2xvciA9ICcjZWY0NDQ0JzsKICAgIGV4cG9ydE5vdEZvdW5kQnRuLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgIGNvbnN0IGNvbnRlbnQgPSByZXN1bHRzLm5vdEZvdW5kLmpvaW4oJ1xuJyk7CiAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbY29udGVudF0sIHsgdHlwZTogJ3RleHQvcGxhaW4nIH0pOwogICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICBhLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICBhLmRvd25sb2FkID0gYG5vdF9mb3VuZF8ke0RhdGUubm93KCl9LnR4dGA7CiAgICAgIGEuY2xpY2soKTsKICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChhLmhyZWYpOwogICAgICB0b2FzdCgnRXhwb3J0ZWQgbm90IGZvdW5kIGxpc3QnKTsKICAgIH07CiAgICBidG5Db250YWluZXIuYXBwZW5kQ2hpbGQoZXhwb3J0Tm90Rm91bmRCdG4pOwogIH0KICAKICBjb25zdCBjbG9zZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogIGNsb3NlQnRuLnRleHRDb250ZW50ID0gJ0Nsb3NlJzsKICBjbG9zZUJ0bi5jbGFzc05hbWUgPSAnYnRuIGdob3N0JzsKICBjbG9zZUJ0bi5vbmNsaWNrID0gKCkgPT4gewogICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIG1vZGFsLmlubmVySFRNTCA9ICcnOwogIH07CiAgYnRuQ29udGFpbmVyLmFwcGVuZENoaWxkKGNsb3NlQnRuKTsKICAKICBtb2RhbC5hcHBlbmRDaGlsZChidG5Db250YWluZXIpOwp9CgppZiAoIWlzTG9jYWwpIHsKICBjb25zdCBhZG1pbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZG1pbkV4cG9ydCcpOwogIGlmIChhZG1pbikgYWRtaW4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCiAgY29uc3QgYmluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jpbkxpc3QnKTsKICBpZiAoYmluKSBiaW4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKfQoKY29uc3Qgc2VhcmNoSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoJyk7CgppZiAoIWlzTW9iaWxlKSB7CiAgZnVuY3Rpb24gcmVmb2N1c1NlYXJjaCgpIHsKICAgIGNvbnN0IGFjdGl2ZSA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7CiAgICBpZiAoCiAgICAgIGFjdGl2ZSAmJgogICAgICAoYWN0aXZlLmlkID09PSAnY3VzdG9tZXInIHx8CiAgICAgICBhY3RpdmUudGFnTmFtZSA9PT0gJ1NFTEVDVCcgfHwKICAgICAgIGFjdGl2ZS50YWdOYW1lID09PSAnVEVYVEFSRUEnKQogICAgKSByZXR1cm47CiAgICBzZWFyY2hJbnB1dC5mb2N1cygpOwogICAgc2VhcmNoSW5wdXQuc2VsZWN0KCk7CiAgfQoKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIHJlZm9jdXNTZWFyY2gpOwoKICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBjb25zdCBtb2RhbE9wZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZXNNb2RhbCcpLnN0eWxlLmRpc3BsYXkgPT09ICdibG9jayc7CiAgICBjb25zdCBvdmVybGF5T3BlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdmVybGF5Jykuc3R5bGUuZGlzcGxheSA9PT0gJ2ZsZXgnOwogICAgaWYgKAogICAgICAhbW9kYWxPcGVuICYmCiAgICAgICFvdmVybGF5T3BlbiAmJgogICAgICBlLnRhcmdldC5pZCAhPT0gJ3NlYXJjaCcgJiYKICAgICAgZS50YXJnZXQuaWQgIT09ICdjdXN0b21lcicgJiYKICAgICAgIWUudGFyZ2V0LmNsb3Nlc3QoJ3NlbGVjdCcpCiAgICApIHsKICAgICAgcmVmb2N1c1NlYXJjaCgpOwogICAgfQogIH0pOwoKICBbJ2NsZWFyU2VhcmNoJywgJ3Nob3dTZWxlY3RlZCcsICdzYXZlQnRuJywgJ3VwbG9hZEJ0biddLmZvckVhY2goaWQgPT4gewogICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgaWYgKGJ0bikgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVmb2N1c1NlYXJjaCk7CiAgfSk7CgogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2l0ZW0nKSkgewogICAgICBzZXRUaW1lb3V0KHJlZm9jdXNTZWFyY2gsIDEyMCk7CiAgICB9CiAgfSk7CgogIFsnY2xvc2VPdmVybGF5J10uZm9yRWFjaChpZCA9PiB7CiAgICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgICBpZiAoYnRuKSBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBzZXRUaW1lb3V0KHJlZm9jdXNTZWFyY2gsIDIwMCkpOwogIH0pOwoKICBzZWFyY2hJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGV2KSA9PiB7CiAgICBpZiAoZXYua2V5ID09PSAnRW50ZXInKSB7CiAgICAgIHNldFRpbWVvdXQocmVmb2N1c1NlYXJjaCwgMTUwKTsKICAgIH0KICB9KTsKfQoKKGFzeW5jIGZ1bmN0aW9uIGluaXQoKSB7CiAgYnVpbGREeW5hbWljQ29udHJvbHMoKTsKICBhd2FpdCBsb2FkWE1MKCk7CiAgdXBkYXRlVG90YWxzKCk7CiAgdXBkYXRlRmlsZW5hbWVQcmV2aWV3KCk7Cn0pKCk7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4=`;
    const decoded = atob(base64html);
    const iframe = document.getElementById('viewer');
    const doc = iframe.contentWindow.document;
    doc.open();
    doc.write(decoded);
    doc.close();
  </script>
</body>
</html>